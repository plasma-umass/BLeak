{"leaks":[{"id":37711,"paths":[[{"type":1,"indexOrName":"EventLog"},{"type":1,"indexOrName":"eventbindings"}]],"scores":{"retainedSize":12368,"leakShare":12368,"transitiveClosureSize":7923232,"ownedObjects":280},"stacks":[[0,1,2,3,4]]},{"id":71417,"paths":[[{"type":1,"indexOrName":"jQuery"},{"type":1,"indexOrName":"ready"},{"type":1,"indexOrName":"then"},{"type":3,"indexOrName":"__scope__"},{"type":4,"indexOrName":"tuples"},{"type":2,"indexOrName":0},{"type":2,"indexOrName":3},{"type":1,"indexOrName":"add"},{"type":3,"indexOrName":"__scope__"},{"type":4,"indexOrName":"list"}]],"scores":{"retainedSize":56608,"leakShare":3224832,"transitiveClosureSize":7908944,"ownedObjects":726},"stacks":[[5,6,7,8,9,10,11,12]]},{"id":71812,"paths":[[{"type":1,"indexOrName":"jQuery"},{"type":1,"indexOrName":"ready"},{"type":1,"indexOrName":"then"},{"type":3,"indexOrName":"__scope__"},{"type":4,"indexOrName":"tuples"},{"type":2,"indexOrName":2},{"type":2,"indexOrName":3},{"type":1,"indexOrName":"add"},{"type":3,"indexOrName":"__scope__"},{"type":4,"indexOrName":"list"}]],"scores":{"retainedSize":56608,"leakShare":3224832,"transitiveClosureSize":7908944,"ownedObjects":726},"stacks":[[5,6,7,8,13,10,11,12]]},{"id":197647,"paths":[[{"type":6,"indexOrName":"$$$DOM$$$"},{"type":1,"indexOrName":"childNodes"},{"type":1,"indexOrName":"$$$CHILD$$$5"},{"type":1,"indexOrName":"childNodes"},{"type":1,"indexOrName":"$$$CHILD$$$3"},{"type":1,"indexOrName":"childNodes"},{"type":1,"indexOrName":"$$$CHILD$$$3"},{"type":1,"indexOrName":"childNodes"},{"type":1,"indexOrName":"$$$CHILD$$$3"},{"type":1,"indexOrName":"childNodes"}]],"scores":{"retainedSize":19008,"leakShare":19008,"transitiveClosureSize":7927952,"ownedObjects":352},"stacks":[[14,15,16,17,18],[19,15,20,21,18]]},{"id":198035,"paths":[[{"type":6,"indexOrName":"$$$DOM$$$"},{"type":1,"indexOrName":"childNodes"},{"type":1,"indexOrName":"$$$CHILD$$$5"},{"type":1,"indexOrName":"childNodes"},{"type":1,"indexOrName":"$$$CHILD$$$3"},{"type":1,"indexOrName":"childNodes"},{"type":1,"indexOrName":"$$$CHILD$$$6"},{"type":1,"indexOrName":"childNodes"},{"type":1,"indexOrName":"$$$CHILD$$$0"},{"type":1,"indexOrName":"childNodes"},{"type":1,"indexOrName":"$$$CHILD$$$1"},{"type":1,"indexOrName":"childNodes"},{"type":1,"indexOrName":"$$$CHILD$$$1"},{"type":1,"indexOrName":"childNodes"}]],"scores":{"retainedSize":15520,"leakShare":15520,"transitiveClosureSize":7924464,"ownedObjects":368},"stacks":[[19,15,20,22,23,24]]}],"stackFrames":[["http://localhost:33411/api/0/jsapi/as.js?ts=1.0.0rc0-1519924545",799,21,"Object.subscribe","    at Object.subscribe (http://localhost:33411/api/0/jsapi/as.js?ts=1.0.0rc0-1519924545:1316:21)"],["http://localhost:33411/api/0/jsapi/app.js?ts=1.0.0rc0-1519924545",2002,8,"Object.init","    at Object.init (http://localhost:33411/api/0/jsapi/app.js?ts=1.0.0rc0-1519924545:1588:11)"],[null,3,19,"HTMLDocument.<anonymous>","    at HTMLDocument.<anonymous> (<anonymous>:3:19)"],["http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0",1,45794,null,"    at http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0:2243:47"],["http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0",1,46422,null,"    at http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0:2251:44"],["http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0",1,43732,"Function.<anonymous>","    at Function.<anonymous> (http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0:2146:87)"],["http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0",1,3885,"Function.each","    at Function.each (http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0:775:69)"],["http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0",1,43647,"add","    at add (http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0:2145:16)"],["http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0",1,43800,"Object.<anonymous>","    at Object.<anonymous> (http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0:2148:12)"],["http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0",1,46806,"Object.<anonymous>","    at Object.<anonymous> (http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0:2260:25)"],["http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0",1,47594,"Function.Deferred","    at Function.Deferred (http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0:2277:62)"],["http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0",1,46765,"Object.then","    at Object.then (http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0:2259:23)"],["http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0",1,48871,"Object.ready","    at Object.ready (http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0:2315:24)"],["http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0",1,47004,"Object.<anonymous>","    at Object.<anonymous> (http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0:2260:316)"],["http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0",1,74580,"HTMLDivElement.<anonymous>","    at HTMLDivElement.<anonymous> (http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0:3019:13)"],["http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0",1,71729,"domManip","    at domManip (http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0:2940:185)"],["http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0",1,74441,"Object.prepend","    at Object.prepend (http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0:3016:39)"],["http://localhost:33411/api/0/jsapi/as.js?ts=1.0.0rc0-1519924545",1365,18,"Object.notification","    at Object.notification (http://localhost:33411/api/0/jsapi/as.js?ts=1.0.0rc0-1519924545:1741:12)"],["http://localhost:33411/api/0/jsapi/as.js?ts=1.0.0rc0-1519924545",1391,25,null,"    at http://localhost:33411/api/0/jsapi/as.js?ts=1.0.0rc0-1519924545:1762:28"],["http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0",1,75967,"HTMLDivElement.<anonymous>","    at HTMLDivElement.<anonymous> (http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0:3069:120)"],["http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0",1,75831,"Object.replaceWith","    at Object.replaceWith (http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0:3067:39)"],["http://localhost:33411/api/0/jsapi/as.js?ts=1.0.0rc0-1519924545",1360,12,"Object.notification","    at Object.notification (http://localhost:33411/api/0/jsapi/as.js?ts=1.0.0rc0-1519924545:1737:9)"],["http://localhost:33411/api/0/jsapi/as.js?ts=1.0.0rc0-1519924545",2593,40,null,"    at http://localhost:33411/api/0/jsapi/as.js?ts=1.0.0rc0-1519924545:2830:28"],["http://localhost:33411/api/0/jsapi/as.js?ts=1.0.0rc0-1519924545",339,40,"Object.success","    at Object.success (http://localhost:33411/api/0/jsapi/as.js?ts=1.0.0rc0-1519924545:414:42)"],["http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0",1,43370,null,"    at http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0:2127:46"]],"sourceFiles":{"http://localhost:33411/api/0/jsapi/as.js?ts=1.0.0rc0-1519924545":{"mimeType":"text/javascript","source":"// Make console.log not crash JS browsers that do not support it...\nif (!window.console) window.console = {\n  log: $.noop,\n  group: $.noop,\n  groupEnd: $.noop,\n  info: $.noop,\n  error: $.noop\n};\n\n\n// Mailpile global Javascript state and configuration /========================\nMailpile = {\n  csrf_token:         \"5a98483a-F7-SvBs9nV7XbQ7U4sa--L6iwzSGs0YaYKdAJPKG_IH_do8S2JTqQJd309G4Tpsadk1OWApr6AqGGK3ZORrPNQ\",\n  ui_in_action:       0,\n  instance:           {},\n  select_between:     false,\n  search_target:      'none',\n  search_cache:       [],\n  messages_cache:     [],\n  messages_composing: {},\n  crypto_keylookup:   [],\n  tags_cache:         [],\n  contacts_cache:     [],\n  keybindings:        [\n    [\"normal\", \"/\",      function() { $(\"#search-query\").focus(); return false; }],\n    [\"normal\", \"a c\",    function() { Mailpile.UI.Modals.ContactAdd(); }],\n    [\"normal\", \"a t\",    function() { Mailpile.UI.Modals.TagAdd(); }],\n    [\"normal\", \"c\",      function() { Mailpile.activities.compose(); }],\n    [\"normal\", \"g i\",    function() { Mailpile.go(\"/in/inbox/\"); }],\n    [\"normal\", \"g d\",    function() { Mailpile.go(\"/in/drafts/\"); }],\n    [\"normal\", \"g c\",    function() { Mailpile.go(\"/contacts/\"); }],\n    [\"normal\", \"g n c\",  function() { Mailpile.go(\"/contacts/add/\"); }],\n    [\"normal\", \"g t\",    function() { Mailpile.go(\"/tags/\"); }],\n    [\"normal\", \"g n t\",  function() { Mailpile.go(\"/tags/add/\"); }],\n    [\"normal\", \"g s\",    function() { Mailpile.go(\"/settings/profiles/\"); }],\n    [\"normal\", \"g h\",    function() { Mailpile.go(\"/help/\"); }],\n    //[\"normal\", \"command+z\", function() { alert('Undo Something ') }],\n    //[\"normal\", \"ctrl+z\",    function() { alert('Undo Something ') }],\n    //[\"normal\", \"shift+[\",   function() { alert('Will move up sidebar in:tag list') }],\n    //[\"normal\", \"shift+]\",   function() { alert('Will move down sidebar in:tag list') }],\n    //[\"normal\", \"command+z\", function() { alert('Undo Something ') }],\n    [\"normal\", \"space\",  function() { Mailpile.bulk_action_toggle_target(); }],\n    [\"normal\", \"s a\",    function() { Mailpile.bulk_action_select_all(); }],\n    [\"normal\", \"s b\",    function() { Mailpile.bulk_action_select_between(); }],\n    [\"normal\", \"s n\",    function() { Mailpile.bulk_action_select_none(); }],\n    [\"normal\", \"s i\",    function() { Mailpile.bulk_action_select_invert(); }],\n    [\"normal\", \"j\",      function() { Mailpile.bulk_action_selection_down(); }],\n    [\"normal\", \"k\",      function() { Mailpile.bulk_action_selection_up(); }],\n    [\"normal\", \"enter\",  function() { Mailpile.open_selected_thread(); }],\n    [\"normal\", [\"m a\"],  function() { Mailpile.keybinding_move_message(''); }],\n    [\"normal\", [\"m d\"],  function() { Mailpile.keybinding_move_message('trash'); }],\n    [\"normal\", [\"m s\"],  function() { Mailpile.keybinding_move_message('spam'); }],\n    [\"normal\", [\"t\"],    function() { Mailpile.render_modal_tags(); }],\n    [\"normal\", [\"r\"],    function() { Mailpile.bulk_action_read(); }],\n    [\"normal\", [\"u\"],    function() { Mailpile.bulk_action_unread(); }],\n    [\"normal\", [\"up\"],   function() { Mailpile.keybinding_target('up'); }],\n    [\"normal\", [\"down\"], function() { Mailpile.keybinding_target('down'); }],\n    [\"normal\", \"left\",   function() { if ($('#pile-previous').length) { Mailpile.go($('#pile-previous').attr('href'));} }],\n    [\"normal\", \"right\",  function() { if ($('#pile-next').length) { Mailpile.go($('#pile-next').attr('href'));} }],\n    [\"global\", \"esc\",    function() {\n      $('input[type=text]').blur();\n      $('textarea').blur();\n    }]\n  ],\n  nagify: 1000 * 60 * 60 * 24 * 7, // Default nag is 1 per week\n  commands:      [],\n  graphselected: [],\n  defaults: {\n    view_size: \"comfy\",\n  },\n  config: {\n    web: {\n \"email_reply_hint\": false, \n \"release_notes\": false, \n \"subtags_collapsed\": []\n}\n  },\n  api: {\n    compose      : \"/api/0/message/compose/\",\n    compose_send : \"/api/0/message/update/send/\",\n    compose_save : \"/api/0/message/update/\",\n    contacts     : \"/api/0/search/address/\",\n    message      : \"/api/0/message/=\",\n    tag          : \"/api/0/tag/\",\n    tag_list     : \"/api/0/tags/\",\n    tag_add      : \"/api/0/tags/add/\",\n    tag_update   : \"/api/0/settings/set/\",\n    search_new   : \"/api/0/search/?q=in%3Anew\",\n    search       : \"/api/0/search/\",\n    settings_add : \"/api/0/settings/add/\"\n  },\n  urls: {\n    message_draft : \"/message/draft/=\",\n    message_sent  : \"/thread/=\",\n    tags          : \"/tags/\"\n  },\n  plugins: [],\n  theme: {},\n  activities: {},\n  local_storage: localStorage || {},\n  unsafe_template: function(tpl) { return _.template(tpl); },\n  safe_template: function(tpl) {\n    return _.template(tpl, undefined, {\n      evaluate: /<%([\\s\\S]+?)%>/g,\n      // interpolate: /<%=([\\s\\S]+?)%>/g, <- DISABLED FOR SAFETY :)\n      escape: /<%[-=]([\\s\\S]+?)%>/g\n    });\n  }\n};\nMailpile.theme = {\n \"authors\": [\n  \"The Mailpile Team \\x3cteam@mailpile.is>\"\n ], \n \"colors\": {\n  \"01-gray-mid\": \"#cccccc\", \n  \"02-gray\": \"#b3b3b3\", \n  \"03-gray-dark\": \"#4d4d4d\", \n  \"04-black\": \"#333333\", \n  \"05-blue-light\": \"#85b2e8\", \n  \"06-blue\": \"#337fb2\", \n  \"07-green-light\": \"#a3ce73\", \n  \"08-green\": \"#4b9441\", \n  \"09-yellow\": \"#e9db2f\", \n  \"10-orange\": \"#fbb03b\", \n  \"11-orange-red\": \"#f15a24\", \n  \"12-red\": \"#be1c21\", \n  \"13-brown\": \"#7d4837\", \n  \"14-brown-light\": \"#90746c\", \n  \"15-pink\": \"#f08dca\", \n  \"16-purple\": \"#6a27a4\"\n }, \n \"icons\": [\n  \"icon-new\", \n  \"icon-compose\", \n  \"icon-mailsource\", \n  \"icon-inbox\", \n  \"icon-sent\", \n  \"icon-outbox\", \n  \"icon-spam\", \n  \"icon-trash\", \n  \"icon-archive\", \n  \"icon-tag\", \n  \"icon-tags\", \n  \"icon-home\", \n  \"icon-comment\", \n  \"icon-forum\", \n  \"icon-star\", \n  \"icon-donate\", \n  \"icon-dislike\", \n  \"icon-like\", \n  \"icon-news\", \n  \"icon-photos\", \n  \"icon-image\", \n  \"icon-video\", \n  \"icon-music\", \n  \"icon-themes\", \n  \"icon-links\", \n  \"icon-document\", \n  \"icon-text\", \n  \"icon-travel\", \n  \"icon-transit\", \n  \"icon-money\", \n  \"icon-receipts\", \n  \"icon-trophy\", \n  \"icon-calendar\", \n  \"icon-spreadsheet\", \n  \"icon-attachment\", \n  \"icon-user\", \n  \"icon-social\", \n  \"icon-groups\", \n  \"icon-graph\", \n  \"icon-force-graph\", \n  \"icon-list\", \n  \"icon-checkmark\", \n  \"icon-alerts\", \n  \"icon-lightbulb\", \n  \"icon-zip\", \n  \"icon-work\", \n  \"icon-rss\", \n  \"icon-robot\", \n  \"icon-code\", \n  \"icon-eye\", \n  \"icon-privacy\", \n  \"icon-lock-closed\", \n  \"icon-key\", \n  \"icon-map\", \n  \"icon-geopoint\", \n  \"icon-animals\", \n  \"icon-clock\", \n  \"icon-columns\", \n  \"icon-flashlight\", \n  \"icon-food\", \n  \"icon-help\", \n  \"icon-purchases\", \n  \"icon-upload\", \n  \"icon-download\"\n ], \n \"name\": \"Mailpile (Chelsea)\", \n \"navigation_link\": \"#4d4d4d\", \n \"navigation_on_color\": \"#4d4d4d\"\n};\n\n\n// AJAX Wappers - This is the core Mailpile JS API /==========================\nMailpile.API = {\n  _endpoints: {    ps_get: \"/0/ps/\",      browse_get: \"/0/browse/\",      settings_get: \"/0/settings/\",      settings_mailbox_get: \"/0/settings/mailbox/\",      page_get: \"/0/page/\",      help_get: \"/0/help/\",      help_variables_get: \"/0/help/variables/\",      help_splash_get: \"/0/help/splash/\",      quitquitquit_get: \"/0/quitquitquit/\",      abortabortabort_get: \"/0/abortabortabort/\",      cached_get: \"/0/cached/\",      auth_login_get: \"/0/auth/login/\",      auth_logout_get: \"/0/auth/logout/\",      settings_set_password_get: \"/0/settings/set/password/\",      help_urlmap_get: \"/0/help/urlmap/\",      message_download_get: \"/0/message/download/\",      search_get: \"/0/search/\",      message_get: \"/0/message/\",      tags_add_get: \"/0/tags/add/\",      tags_get: \"/0/tags/\",      filter_list_get: \"/0/filter/list/\",      message_draft_get: \"/0/message/draft/\",      eventlog_get: \"/0/eventlog/\",      contacts_view_get: \"/0/contacts/view/\",      contacts_add_get: \"/0/contacts/add/\",      contacts_get: \"/0/contacts/\",      search_address_get: \"/0/search/address/\",      profiles_view_get: \"/0/profiles/view/\",      profiles_add_get: \"/0/profiles/add/\",      profiles_edit_get: \"/0/profiles/edit/\",      profiles_get: \"/0/profiles/\",      profiles_choose_from_get: \"/0/profiles/choose_from/\",      contacts_import_get: \"/0/contacts/import/\",      contacts_importers_get: \"/0/contacts/importers/\",      crypto_gpg_vcards_get: \"/0/crypto/gpg/vcards/\",      crypto_gpg_vcardimport_get: \"/0/crypto/gpg/vcardimport/\",      crypto_keylookup_get: \"/0/crypto/keylookup/\",      crypto_gpg_searchkey_get: \"/0/crypto/gpg/searchkey/\",      crypto_gpg_keylist_get: \"/0/crypto/gpg/keylist/\",      crypto_gpg_statistics_get: \"/0/crypto/gpg/statistics/\",      crypto_gpg_keylist_secret_get: \"/0/crypto/gpg/keylist/secret/\",      crypto_gpg_check_keys_get: \"/0/crypto/gpg/check_keys/\",      crypto_policy_get: \"/0/crypto_policy/\",      setup_email_servers_get: \"/0/setup/email_servers/\",      setup_welcome_get: \"/0/setup/welcome/\",      setup_password_get: \"/0/setup/password/\",      setup_crypto_get: \"/0/setup/crypto/\",      setup_profiles_get: \"/0/setup/profiles/\",      setup_configure_key_get: \"/0/setup/configure_key/\",      setup_get: \"/0/setup/\",      jsapi_get: \"/0/jsapi/\",      http_proxy_get: \"/0/http_proxy/\",      datadig_get: \"/0/datadig/\",      rescan_post: \"/0/rescan/\",      settings_post: \"/0/settings/\",      settings_set_post: \"/0/settings/set/\",      settings_add_post: \"/0/settings/add/\",      settings_unset_post: \"/0/settings/unset/\",      settings_mailbox_post: \"/0/settings/mailbox/\",      auth_login_post: \"/0/auth/login/\",      auth_logout_post: \"/0/auth/logout/\",      settings_set_password_post: \"/0/settings/set/password/\",      tag_post: \"/0/tag/\",      tag_later_post: \"/0/tag/later/\",      tag_tmp_post: \"/0/tag/tmp/\",      tags_add_post: \"/0/tags/add/\",      tags_delete_post: \"/0/tags/delete/\",      filter_post: \"/0/filter/\",      filter_list_post: \"/0/filter/list/\",      message_compose_post: \"/0/message/compose/\",      message_reply_post: \"/0/message/reply/\",      message_forward_post: \"/0/message/forward/\",      message_update_post: \"/0/message/update/\",      message_attach_post: \"/0/message/attach/\",      message_unattach_post: \"/0/message/unattach/\",      message_unthread_post: \"/0/message/unthread/\",      message_send_post: \"/0/message/send/\",      message_update_send_post: \"/0/message/update/send/\",      eventlog_cancel_post: \"/0/eventlog/cancel/\",      eventlog_undo_post: \"/0/eventlog/undo/\",      vcards_addlines_post: \"/0/vcards/addlines/\",      vcards_set_post: \"/0/vcards/set/\",      contacts_add_post: \"/0/contacts/add/\",      contacts_remove_post: \"/0/contacts/remove/\",      contacts_set_post: \"/0/contacts/set/\",      profiles_add_post: \"/0/profiles/add/\",      profiles_edit_post: \"/0/profiles/edit/\",      profiles_remove_post: \"/0/profiles/remove/\",      profiles_set_post: \"/0/profiles/set/\",      crypto_keyimport_post: \"/0/crypto/keyimport/\",      crypto_gpg_receivekey_post: \"/0/crypto/gpg/receivekey/\",      crypto_gpg_importkey_post: \"/0/crypto/gpg/importkey/\",      crypto_gpg_importkeyfrommail_post: \"/0/crypto/gpg/importkeyfrommail/\",      crypto_gpg_signkey_post: \"/0/crypto/gpg/signkey/\",      crypto_policy_set_post: \"/0/crypto_policy/set/\",      setup_welcome_post: \"/0/setup/welcome/\",      setup_password_post: \"/0/setup/password/\",      setup_crypto_post: \"/0/setup/crypto/\",      setup_profiles_post: \"/0/setup/profiles/\",      setup_configure_key_post: \"/0/setup/configure_key/\",      setup_test_route_post: \"/0/setup/test_route/\",      groups_addlines_post: \"/0/groups/addlines/\",      settings_set_update: \"/0/settings/set/\",      settings_add_update: \"/0/settings/add/\",      settings_mailbox_update: \"/0/settings/mailbox/\",      message_update_update: \"/0/message/update/\",      message_attach_update: \"/0/message/attach/\",      message_unattach_update: \"/0/message/unattach/\",      message_unthread_update: \"/0/message/unthread/\",      message_update_send_update: \"/0/message/update/send/\",      vcards_addlines_update: \"/0/vcards/addlines/\",      vcards_set_update: \"/0/vcards/set/\",      contacts_set_update: \"/0/contacts/set/\",      profiles_set_update: \"/0/profiles/set/\",      groups_addlines_update: \"/0/groups/addlines/\",      tags_delete_delete: \"/0/tags/delete/\",      contacts_remove_delete: \"/0/contacts/remove/\",      profiles_remove_delete: \"/0/profiles/remove/\"  },\n  _sync_url: \"/api\",\n  _async_url: \"/async\",\n\n  _dead_notification: undefined,\n  _notify_dead: function(status, message, fullscreen) {\n    var advice = ((document.location.href.indexOf('/localhost:') == -1)\n                  ? 'Check your network?'\n                  : 'Restart the app?');\n    if (fullscreen) {\n      if (!$('#connection-down').length) {\n        var template = Mailpile.safe_template($('#template-connection-down').html());\n        $('body').append(template({\n          message: message,\n          advice: advice\n        }));\n      }\n    }\n    else {\n      Mailpile.API._dead_notification = Mailpile.notification({\n        status: status,\n        message: message,\n        message2: advice,\n        event_id: Mailpile.API._dead_notification,\n        icon: 'icon-signature-unknown'\n      });\n    }\n  },\n  _ajax_dead_count: 0,\n  _ajax_is_alive: function() {\n    Mailpile.API._ajax_dead_count = 0;\n    if (Mailpile.API._dead_notification) {\n      Mailpile.cancel_notification(Mailpile.API._dead_notification);\n      Mailpile.API._dead_notification = undefined;\n      if ($('#connection-down').length) {\n        $('#connection-down').fadeOut().remove();\n      }\n    }\n  },\n  _ajax_error: function(base_url, command, data, method, response, status) {\n    console.log('Oops, an AJAX call returned as error :(');\n    console.log('status: ' + status + ' method: ' + method + ' base_url: ' + base_url + ' command: ' + command);\n    console.log(response);\n\n    if (response.status == 403) {\n      // We have been logged out or the backend restated, go to login\n      var href = document.location.href;\n      if (href.indexOf('#') != -1) href = href.substring(0, href.indexOf('#'));\n      href += (href.indexOf('?') == -1) ? '?' : '&';\n      document.location.href = href + 'ui_relogin=1';\n      return;\n    }\n    else if (response.status == 500) {\n      // 500 internal errors and timeouts...\n      if (command != '/0/cached/' && command != '/0/eventlog/') {\n        Mailpile.notification({\n          status: 'error',\n          message: 'Oops. Mailpile failed to complete your task.',\n          icon: 'icon-signature-unknown'\n        });\n      }\n      Mailpile.API._ajax_dead_count = 0;\n      return;\n    }\n    if (response.status == 0 || response.status == 503) {\n      // FIXME: 503 actually means pagekite or some other reverse proxy is\n      //        down - we tell the user to check the network, but could\n      //        probably provide clearer feedback.\n      Mailpile.API._ajax_dead_count += 1;\n    }\n\n    if (Mailpile.API._ajax_dead_count > 3) {\n      Mailpile.API._notify_dead('error', 'Mailpile is unreachable.',\n                                (Mailpile.API._ajax_dead_count > 10));\n    }\n    else if (status == \"timeout\") {\n      Mailpile.API._notify_dead('warning', 'Mailpile timed out...');\n    }\n  },\n\n  _action: function(base_url, command, data, method, callback) {\n    // Output format, timeout...\n    var output = '';\n    var timeout = 10000;\n    var error_callback = undefined;\n    if (data._output) {\n      output = data._output;\n      delete data['_output'];\n    }\n    if (data._timeout) {\n      timeout = data._timeout;\n      delete data['_timeout'];\n    }\n    if (data._error_callback) {\n      error_callback = data._error_callback;\n      delete data['_error_callback'];\n    }\n    if (data._args) {\n      for (var i in data._args) {\n        command = command + '/' + data._args[i];\n      }\n      delete data['_args'];\n    }\n\n    // Get search context; should be overridden by methods that know better\n    var context = (data['context'] || $('#search-query').data('context'));\n\n    // Force method to GET if not POST\n    if (method !== 'GET' && method !== 'POST') method = 'GET';\n\n    if (method === 'GET') {\n      // Make Querystring\n      var params = data._serialized;\n      if (!params) {\n        for (var k in data) {\n          if (!data[k] || data[k] == undefined) {\n            delete data[k];\n          }\n        }\n        params = $.param(data);\n      }\n      if (context && (-1 == params.indexOf('&context=')) &&\n                     (0 != params.indexOf('context='))) {\n        params += '&context=' + context;\n      }\n\n      $.ajax({\n        url: base_url + command + output + \"?\" + params,\n        type: 'GET',\n        timeout: timeout,\n        dataType: 'json',\n        success: function(response, status) {\n          Mailpile.API._ajax_is_alive();\n          if (callback) return callback(response, status);\n        },\n        error: function(response, status) {\n          Mailpile.API._ajax_error(base_url, command, data,\n                                   method, response, status);\n          if (error_callback) error_callback(response, status);\n        }\n      });\n    }\n    else if (method === 'POST') {\n      if (data._serialized) {\n        data = data._serialized + '&csrf=' + Mailpile.csrf_token;\n        if (context) data = data + '&context=' + context;\n      }\n      else {\n        if (context) data['context'] = context;\n        if (data['csrf']) {\n          Mailpile.csrf_token = data['csrf'];\n        }\n        else {\n          data['csrf'] = Mailpile.csrf_token;\n        }\n      }\n      $.ajax({\n        url: base_url + command + output,\n        type: 'POST',\n        data: data,\n        timeout: timeout,\n        dataType: 'json',\n        success: function(response, status) {\n          Mailpile.API._ajax_is_alive();\n          if (callback) return callback(response, status);\n        },\n        error: function(response, status) {\n          Mailpile.API._ajax_error(base_url, command, data,\n                                   method, response, status);\n          if (error_callback) error_callback(response, status);\n        }\n      });\n    }\n    return true;\n  },\n\n  U: function(original_url) {\n    var prefix = \"\";\n    if (original_url.indexOf(prefix) != 0) {\n      return prefix + original_url;\n    }\n    return original_url;\n  },\n\n  jhtml_url: function(original_url, rendering) {\n    var new_url = original_url;\n    var html = new_url.indexOf('.html');\n    rendering = rendering || 'minimal';\n    if (html != -1) {\n      new_url = (new_url.slice(0, html+1) + 'jhtml!' + rendering +\n                 new_url.slice(html+5));\n    }\n    else {\n      var qs = new_url.indexOf('?');\n      if (qs != -1) {\n        new_url = (new_url.slice(0, qs) + 'as.jhtml!' + rendering +\n                   new_url.slice(qs));\n      }\n      else {\n        var anch = new_url.indexOf('#');\n        if (anch != -1) {\n          new_url = (new_url.slice(0, anch) + 'as.jhtml!' + rendering +\n                     new_url.slice(anch));\n        }\n        else {\n          new_url += 'as.jhtml!' + rendering;\n        }\n      }\n    }\n    return new_url;\n  },\n\n  with_template: function(name, action, error, flags, unsafe) {\n      var url = \"/jsapi/templates/\" + name + \".html\";\n      if (flags) {\n        url += '?ui_flags=' + flags.replace(' ', '+');\n      }\n      $.ajax({\n        url: url,\n        type: 'GET',\n        success: function(data) {\n          action((unsafe) ? Mailpile.unsafe_template(data)\n                          : Mailpile.safe_template(data));\n        },\n        error: error\n      });\n  },\n\n  _sync_action: function(command, data, method, callback) {\n    return Mailpile.API._action(Mailpile.API._sync_url, command, data, method, callback);\n  },\n\n  _async_action: function(command, data, method, callback, flags) {\n    function handle_event(data) {\n      if (data.result.resultid) {\n        subreq = {event_id: data.result.resultid, flags: flags};\n        var subid = EventLog.subscribe(subreq, function(ev) {\n          callback(ev.private_data, ev);\n          if (ev.flags == \"c\") {\n            EventLog.unsubscribe(data.result.resultid, subid);\n          }\n        });\n      }\n    }\n    return Mailpile.API._action(Mailpile.API._async_url, command, data, method, handle_event, flags);\n  },\n\n  _method: function(method, methods) {\n    if (!method || methods.indexOf(method) == -1) return methods[0];\n    return method;\n  },\n  ps_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/ps/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_ps_get: function(d,c,m){return Mailpile.API._async_action(\"/0/ps/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  browse_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/browse/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_browse_get: function(d,c,m){return Mailpile.API._async_action(\"/0/browse/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  settings_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/settings/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_settings_get: function(d,c,m){return Mailpile.API._async_action(\"/0/settings/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  settings_mailbox_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/settings/mailbox/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_settings_mailbox_get: function(d,c,m){return Mailpile.API._async_action(\"/0/settings/mailbox/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  page_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/page/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_page_get: function(d,c,m){return Mailpile.API._async_action(\"/0/page/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  help_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/help/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_help_get: function(d,c,m){return Mailpile.API._async_action(\"/0/help/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  help_variables_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/help/variables/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_help_variables_get: function(d,c,m){return Mailpile.API._async_action(\"/0/help/variables/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  help_splash_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/help/splash/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_help_splash_get: function(d,c,m){return Mailpile.API._async_action(\"/0/help/splash/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  quitquitquit_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/quitquitquit/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_quitquitquit_get: function(d,c,m){return Mailpile.API._async_action(\"/0/quitquitquit/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  abortabortabort_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/abortabortabort/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_abortabortabort_get: function(d,c,m){return Mailpile.API._async_action(\"/0/abortabortabort/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  cached_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/cached/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_cached_get: function(d,c,m){return Mailpile.API._async_action(\"/0/cached/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  auth_login_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/auth/login/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_auth_login_get: function(d,c,m){return Mailpile.API._async_action(\"/0/auth/login/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  auth_logout_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/auth/logout/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_auth_logout_get: function(d,c,m){return Mailpile.API._async_action(\"/0/auth/logout/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  settings_set_password_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/settings/set/password/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_settings_set_password_get: function(d,c,m){return Mailpile.API._async_action(\"/0/settings/set/password/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  help_urlmap_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/help/urlmap/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_help_urlmap_get: function(d,c,m){return Mailpile.API._async_action(\"/0/help/urlmap/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  message_download_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/message/download/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_message_download_get: function(d,c,m){return Mailpile.API._async_action(\"/0/message/download/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  search_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/search/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_search_get: function(d,c,m){return Mailpile.API._async_action(\"/0/search/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  message_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/message/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_message_get: function(d,c,m){return Mailpile.API._async_action(\"/0/message/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  tags_add_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/tags/add/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_tags_add_get: function(d,c,m){return Mailpile.API._async_action(\"/0/tags/add/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  tags_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/tags/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_tags_get: function(d,c,m){return Mailpile.API._async_action(\"/0/tags/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  filter_list_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/filter/list/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_filter_list_get: function(d,c,m){return Mailpile.API._async_action(\"/0/filter/list/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  message_draft_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/message/draft/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_message_draft_get: function(d,c,m){return Mailpile.API._async_action(\"/0/message/draft/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  eventlog_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/eventlog/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_eventlog_get: function(d,c,m){return Mailpile.API._async_action(\"/0/eventlog/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  contacts_view_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/contacts/view/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_contacts_view_get: function(d,c,m){return Mailpile.API._async_action(\"/0/contacts/view/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  contacts_add_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/contacts/add/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_contacts_add_get: function(d,c,m){return Mailpile.API._async_action(\"/0/contacts/add/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  contacts_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/contacts/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_contacts_get: function(d,c,m){return Mailpile.API._async_action(\"/0/contacts/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  search_address_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/search/address/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_search_address_get: function(d,c,m){return Mailpile.API._async_action(\"/0/search/address/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  profiles_view_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/profiles/view/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_profiles_view_get: function(d,c,m){return Mailpile.API._async_action(\"/0/profiles/view/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  profiles_add_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/profiles/add/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_profiles_add_get: function(d,c,m){return Mailpile.API._async_action(\"/0/profiles/add/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  profiles_edit_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/profiles/edit/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_profiles_edit_get: function(d,c,m){return Mailpile.API._async_action(\"/0/profiles/edit/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  profiles_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/profiles/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_profiles_get: function(d,c,m){return Mailpile.API._async_action(\"/0/profiles/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  profiles_choose_from_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/profiles/choose_from/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_profiles_choose_from_get: function(d,c,m){return Mailpile.API._async_action(\"/0/profiles/choose_from/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  contacts_import_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/contacts/import/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_contacts_import_get: function(d,c,m){return Mailpile.API._async_action(\"/0/contacts/import/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  contacts_importers_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/contacts/importers/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_contacts_importers_get: function(d,c,m){return Mailpile.API._async_action(\"/0/contacts/importers/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  crypto_gpg_vcards_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/crypto/gpg/vcards/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_crypto_gpg_vcards_get: function(d,c,m){return Mailpile.API._async_action(\"/0/crypto/gpg/vcards/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  crypto_gpg_vcardimport_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/crypto/gpg/vcardimport/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_crypto_gpg_vcardimport_get: function(d,c,m){return Mailpile.API._async_action(\"/0/crypto/gpg/vcardimport/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  crypto_keylookup_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/crypto/keylookup/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_crypto_keylookup_get: function(d,c,m){return Mailpile.API._async_action(\"/0/crypto/keylookup/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  crypto_gpg_searchkey_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/crypto/gpg/searchkey/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_crypto_gpg_searchkey_get: function(d,c,m){return Mailpile.API._async_action(\"/0/crypto/gpg/searchkey/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  crypto_gpg_keylist_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/crypto/gpg/keylist/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_crypto_gpg_keylist_get: function(d,c,m){return Mailpile.API._async_action(\"/0/crypto/gpg/keylist/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  crypto_gpg_statistics_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/crypto/gpg/statistics/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_crypto_gpg_statistics_get: function(d,c,m){return Mailpile.API._async_action(\"/0/crypto/gpg/statistics/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  crypto_gpg_keylist_secret_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/crypto/gpg/keylist/secret/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_crypto_gpg_keylist_secret_get: function(d,c,m){return Mailpile.API._async_action(\"/0/crypto/gpg/keylist/secret/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  crypto_gpg_check_keys_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/crypto/gpg/check_keys/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_crypto_gpg_check_keys_get: function(d,c,m){return Mailpile.API._async_action(\"/0/crypto/gpg/check_keys/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  crypto_policy_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/crypto_policy/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_crypto_policy_get: function(d,c,m){return Mailpile.API._async_action(\"/0/crypto_policy/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  setup_email_servers_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/setup/email_servers/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_setup_email_servers_get: function(d,c,m){return Mailpile.API._async_action(\"/0/setup/email_servers/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  setup_welcome_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/setup/welcome/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_setup_welcome_get: function(d,c,m){return Mailpile.API._async_action(\"/0/setup/welcome/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  setup_password_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/setup/password/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_setup_password_get: function(d,c,m){return Mailpile.API._async_action(\"/0/setup/password/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  setup_crypto_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/setup/crypto/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_setup_crypto_get: function(d,c,m){return Mailpile.API._async_action(\"/0/setup/crypto/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  setup_profiles_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/setup/profiles/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_setup_profiles_get: function(d,c,m){return Mailpile.API._async_action(\"/0/setup/profiles/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  setup_configure_key_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/setup/configure_key/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_setup_configure_key_get: function(d,c,m){return Mailpile.API._async_action(\"/0/setup/configure_key/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  setup_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/setup/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_setup_get: function(d,c,m){return Mailpile.API._async_action(\"/0/setup/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  jsapi_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/jsapi/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_jsapi_get: function(d,c,m){return Mailpile.API._async_action(\"/0/jsapi/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  http_proxy_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/http_proxy/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_http_proxy_get: function(d,c,m){return Mailpile.API._async_action(\"/0/http_proxy/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  datadig_get: function(d,c,m){return Mailpile.API._sync_action(\"/0/datadig/\",d,Mailpile.API._method(m,[\"GET\"]),c);},\n  async_datadig_get: function(d,c,m){return Mailpile.API._async_action(\"/0/datadig/\",d,Mailpile.API._method(m,[\"GET\"]),c);},  \n  rescan_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/rescan/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_rescan_post: function(d,c,m){return Mailpile.API._async_action(\"/0/rescan/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  settings_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/settings/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_settings_post: function(d,c,m){return Mailpile.API._async_action(\"/0/settings/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  settings_set_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/settings/set/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_settings_set_post: function(d,c,m){return Mailpile.API._async_action(\"/0/settings/set/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  settings_add_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/settings/add/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_settings_add_post: function(d,c,m){return Mailpile.API._async_action(\"/0/settings/add/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  settings_unset_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/settings/unset/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_settings_unset_post: function(d,c,m){return Mailpile.API._async_action(\"/0/settings/unset/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  settings_mailbox_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/settings/mailbox/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_settings_mailbox_post: function(d,c,m){return Mailpile.API._async_action(\"/0/settings/mailbox/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  auth_login_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/auth/login/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_auth_login_post: function(d,c,m){return Mailpile.API._async_action(\"/0/auth/login/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  auth_logout_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/auth/logout/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_auth_logout_post: function(d,c,m){return Mailpile.API._async_action(\"/0/auth/logout/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  settings_set_password_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/settings/set/password/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_settings_set_password_post: function(d,c,m){return Mailpile.API._async_action(\"/0/settings/set/password/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  tag_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/tag/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_tag_post: function(d,c,m){return Mailpile.API._async_action(\"/0/tag/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  tag_later_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/tag/later/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_tag_later_post: function(d,c,m){return Mailpile.API._async_action(\"/0/tag/later/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  tag_tmp_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/tag/tmp/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_tag_tmp_post: function(d,c,m){return Mailpile.API._async_action(\"/0/tag/tmp/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  tags_add_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/tags/add/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_tags_add_post: function(d,c,m){return Mailpile.API._async_action(\"/0/tags/add/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  tags_delete_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/tags/delete/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_tags_delete_post: function(d,c,m){return Mailpile.API._async_action(\"/0/tags/delete/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  filter_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/filter/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_filter_post: function(d,c,m){return Mailpile.API._async_action(\"/0/filter/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  filter_list_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/filter/list/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_filter_list_post: function(d,c,m){return Mailpile.API._async_action(\"/0/filter/list/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  message_compose_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/message/compose/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_message_compose_post: function(d,c,m){return Mailpile.API._async_action(\"/0/message/compose/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  message_reply_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/message/reply/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_message_reply_post: function(d,c,m){return Mailpile.API._async_action(\"/0/message/reply/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  message_forward_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/message/forward/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_message_forward_post: function(d,c,m){return Mailpile.API._async_action(\"/0/message/forward/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  message_update_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/message/update/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_message_update_post: function(d,c,m){return Mailpile.API._async_action(\"/0/message/update/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  message_attach_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/message/attach/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_message_attach_post: function(d,c,m){return Mailpile.API._async_action(\"/0/message/attach/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  message_unattach_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/message/unattach/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_message_unattach_post: function(d,c,m){return Mailpile.API._async_action(\"/0/message/unattach/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  message_unthread_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/message/unthread/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_message_unthread_post: function(d,c,m){return Mailpile.API._async_action(\"/0/message/unthread/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  message_send_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/message/send/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_message_send_post: function(d,c,m){return Mailpile.API._async_action(\"/0/message/send/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  message_update_send_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/message/update/send/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_message_update_send_post: function(d,c,m){return Mailpile.API._async_action(\"/0/message/update/send/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  eventlog_cancel_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/eventlog/cancel/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_eventlog_cancel_post: function(d,c,m){return Mailpile.API._async_action(\"/0/eventlog/cancel/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  eventlog_undo_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/eventlog/undo/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_eventlog_undo_post: function(d,c,m){return Mailpile.API._async_action(\"/0/eventlog/undo/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  vcards_addlines_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/vcards/addlines/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_vcards_addlines_post: function(d,c,m){return Mailpile.API._async_action(\"/0/vcards/addlines/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  vcards_set_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/vcards/set/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_vcards_set_post: function(d,c,m){return Mailpile.API._async_action(\"/0/vcards/set/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  contacts_add_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/contacts/add/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_contacts_add_post: function(d,c,m){return Mailpile.API._async_action(\"/0/contacts/add/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  contacts_remove_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/contacts/remove/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_contacts_remove_post: function(d,c,m){return Mailpile.API._async_action(\"/0/contacts/remove/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  contacts_set_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/contacts/set/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_contacts_set_post: function(d,c,m){return Mailpile.API._async_action(\"/0/contacts/set/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  profiles_add_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/profiles/add/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_profiles_add_post: function(d,c,m){return Mailpile.API._async_action(\"/0/profiles/add/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  profiles_edit_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/profiles/edit/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_profiles_edit_post: function(d,c,m){return Mailpile.API._async_action(\"/0/profiles/edit/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  profiles_remove_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/profiles/remove/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_profiles_remove_post: function(d,c,m){return Mailpile.API._async_action(\"/0/profiles/remove/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  profiles_set_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/profiles/set/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_profiles_set_post: function(d,c,m){return Mailpile.API._async_action(\"/0/profiles/set/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  crypto_keyimport_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/crypto/keyimport/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_crypto_keyimport_post: function(d,c,m){return Mailpile.API._async_action(\"/0/crypto/keyimport/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  crypto_gpg_receivekey_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/crypto/gpg/receivekey/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_crypto_gpg_receivekey_post: function(d,c,m){return Mailpile.API._async_action(\"/0/crypto/gpg/receivekey/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  crypto_gpg_importkey_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/crypto/gpg/importkey/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_crypto_gpg_importkey_post: function(d,c,m){return Mailpile.API._async_action(\"/0/crypto/gpg/importkey/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  crypto_gpg_importkeyfrommail_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/crypto/gpg/importkeyfrommail/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_crypto_gpg_importkeyfrommail_post: function(d,c,m){return Mailpile.API._async_action(\"/0/crypto/gpg/importkeyfrommail/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  crypto_gpg_signkey_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/crypto/gpg/signkey/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_crypto_gpg_signkey_post: function(d,c,m){return Mailpile.API._async_action(\"/0/crypto/gpg/signkey/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  crypto_policy_set_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/crypto_policy/set/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_crypto_policy_set_post: function(d,c,m){return Mailpile.API._async_action(\"/0/crypto_policy/set/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  setup_welcome_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/setup/welcome/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_setup_welcome_post: function(d,c,m){return Mailpile.API._async_action(\"/0/setup/welcome/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  setup_password_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/setup/password/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_setup_password_post: function(d,c,m){return Mailpile.API._async_action(\"/0/setup/password/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  setup_crypto_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/setup/crypto/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_setup_crypto_post: function(d,c,m){return Mailpile.API._async_action(\"/0/setup/crypto/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  setup_profiles_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/setup/profiles/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_setup_profiles_post: function(d,c,m){return Mailpile.API._async_action(\"/0/setup/profiles/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  setup_configure_key_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/setup/configure_key/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_setup_configure_key_post: function(d,c,m){return Mailpile.API._async_action(\"/0/setup/configure_key/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  setup_test_route_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/setup/test_route/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_setup_test_route_post: function(d,c,m){return Mailpile.API._async_action(\"/0/setup/test_route/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  groups_addlines_post: function(d,c,m){return Mailpile.API._sync_action(\"/0/groups/addlines/\",d,Mailpile.API._method(m,[\"POST\"]),c);},\n  async_groups_addlines_post: function(d,c,m){return Mailpile.API._async_action(\"/0/groups/addlines/\",d,Mailpile.API._method(m,[\"POST\"]),c);},  \n  settings_set_update: function(d,c,m){return Mailpile.API._sync_action(\"/0/settings/set/\",d,Mailpile.API._method(m,[\"UPDATE\"]),c);},\n  async_settings_set_update: function(d,c,m){return Mailpile.API._async_action(\"/0/settings/set/\",d,Mailpile.API._method(m,[\"UPDATE\"]),c);},  \n  settings_add_update: function(d,c,m){return Mailpile.API._sync_action(\"/0/settings/add/\",d,Mailpile.API._method(m,[\"UPDATE\"]),c);},\n  async_settings_add_update: function(d,c,m){return Mailpile.API._async_action(\"/0/settings/add/\",d,Mailpile.API._method(m,[\"UPDATE\"]),c);},  \n  settings_mailbox_update: function(d,c,m){return Mailpile.API._sync_action(\"/0/settings/mailbox/\",d,Mailpile.API._method(m,[\"UPDATE\"]),c);},\n  async_settings_mailbox_update: function(d,c,m){return Mailpile.API._async_action(\"/0/settings/mailbox/\",d,Mailpile.API._method(m,[\"UPDATE\"]),c);},  \n  message_update_update: function(d,c,m){return Mailpile.API._sync_action(\"/0/message/update/\",d,Mailpile.API._method(m,[\"UPDATE\"]),c);},\n  async_message_update_update: function(d,c,m){return Mailpile.API._async_action(\"/0/message/update/\",d,Mailpile.API._method(m,[\"UPDATE\"]),c);},  \n  message_attach_update: function(d,c,m){return Mailpile.API._sync_action(\"/0/message/attach/\",d,Mailpile.API._method(m,[\"UPDATE\"]),c);},\n  async_message_attach_update: function(d,c,m){return Mailpile.API._async_action(\"/0/message/attach/\",d,Mailpile.API._method(m,[\"UPDATE\"]),c);},  \n  message_unattach_update: function(d,c,m){return Mailpile.API._sync_action(\"/0/message/unattach/\",d,Mailpile.API._method(m,[\"UPDATE\"]),c);},\n  async_message_unattach_update: function(d,c,m){return Mailpile.API._async_action(\"/0/message/unattach/\",d,Mailpile.API._method(m,[\"UPDATE\"]),c);},  \n  message_unthread_update: function(d,c,m){return Mailpile.API._sync_action(\"/0/message/unthread/\",d,Mailpile.API._method(m,[\"UPDATE\"]),c);},\n  async_message_unthread_update: function(d,c,m){return Mailpile.API._async_action(\"/0/message/unthread/\",d,Mailpile.API._method(m,[\"UPDATE\"]),c);},  \n  message_update_send_update: function(d,c,m){return Mailpile.API._sync_action(\"/0/message/update/send/\",d,Mailpile.API._method(m,[\"UPDATE\"]),c);},\n  async_message_update_send_update: function(d,c,m){return Mailpile.API._async_action(\"/0/message/update/send/\",d,Mailpile.API._method(m,[\"UPDATE\"]),c);},  \n  vcards_addlines_update: function(d,c,m){return Mailpile.API._sync_action(\"/0/vcards/addlines/\",d,Mailpile.API._method(m,[\"UPDATE\"]),c);},\n  async_vcards_addlines_update: function(d,c,m){return Mailpile.API._async_action(\"/0/vcards/addlines/\",d,Mailpile.API._method(m,[\"UPDATE\"]),c);},  \n  vcards_set_update: function(d,c,m){return Mailpile.API._sync_action(\"/0/vcards/set/\",d,Mailpile.API._method(m,[\"UPDATE\"]),c);},\n  async_vcards_set_update: function(d,c,m){return Mailpile.API._async_action(\"/0/vcards/set/\",d,Mailpile.API._method(m,[\"UPDATE\"]),c);},  \n  contacts_set_update: function(d,c,m){return Mailpile.API._sync_action(\"/0/contacts/set/\",d,Mailpile.API._method(m,[\"UPDATE\"]),c);},\n  async_contacts_set_update: function(d,c,m){return Mailpile.API._async_action(\"/0/contacts/set/\",d,Mailpile.API._method(m,[\"UPDATE\"]),c);},  \n  profiles_set_update: function(d,c,m){return Mailpile.API._sync_action(\"/0/profiles/set/\",d,Mailpile.API._method(m,[\"UPDATE\"]),c);},\n  async_profiles_set_update: function(d,c,m){return Mailpile.API._async_action(\"/0/profiles/set/\",d,Mailpile.API._method(m,[\"UPDATE\"]),c);},  \n  groups_addlines_update: function(d,c,m){return Mailpile.API._sync_action(\"/0/groups/addlines/\",d,Mailpile.API._method(m,[\"UPDATE\"]),c);},\n  async_groups_addlines_update: function(d,c,m){return Mailpile.API._async_action(\"/0/groups/addlines/\",d,Mailpile.API._method(m,[\"UPDATE\"]),c);},  \n  tags_delete_delete: function(d,c,m){return Mailpile.API._sync_action(\"/0/tags/delete/\",d,Mailpile.API._method(m,[\"DELETE\"]),c);},\n  async_tags_delete_delete: function(d,c,m){return Mailpile.API._async_action(\"/0/tags/delete/\",d,Mailpile.API._method(m,[\"DELETE\"]),c);},  \n  contacts_remove_delete: function(d,c,m){return Mailpile.API._sync_action(\"/0/contacts/remove/\",d,Mailpile.API._method(m,[\"DELETE\"]),c);},\n  async_contacts_remove_delete: function(d,c,m){return Mailpile.API._async_action(\"/0/contacts/remove/\",d,Mailpile.API._method(m,[\"DELETE\"]),c);},  \n  profiles_remove_delete: function(d,c,m){return Mailpile.API._sync_action(\"/0/profiles/remove/\",d,Mailpile.API._method(m,[\"DELETE\"]),c);},\n  async_profiles_remove_delete: function(d,c,m){return Mailpile.API._async_action(\"/0/profiles/remove/\",d,Mailpile.API._method(m,[\"DELETE\"]),c);}  \n};\n\n\n// JS App Files /=============================================================\nvar EventLog = {\n  eventbindings: [],  // All the subscriptions\n  last_ts: Mailpile.local_storage['eventlog_last_ts'] || -1800,\n  first_load: true,\n  timer: null\n};\n\n\nEventLog.pause = function() {\n  return EventLog.timer.pause();\n};\n\n\nEventLog.play = function() {\n  return EventLog.timer.play();\n};\n\n\nEventLog.request = function(conditions, callback) {\n  if (EventLog.first_load) {\n    Mailpile.API.eventlog_get({incomplete: true}, EventLog.invoke_callbacks);\n    EventLog.first_load = false;\n  }\n  var conditions = conditions || {};\n  conditions._error_callback = EventLog.process_error;\n  Mailpile.API.eventlog_get(conditions, callback || EventLog.process_result);\n};\n\n\nEventLog.poll = function() {\n  // BRE: disabled the filtering for now, as the eventlog filter language\n  //      is not flexible enough to watch for all the different events\n  //      we need in one call. It also has the issue that if subscriptions\n  //      change then we need the ability to immediately terminate the\n  //      outstanding request and fire off a new one. So for now we just\n  //      use the firehose, but increase the gather time to 1 second.\n  //\n  // Request news about updates to the mail sources and command cache\n  //var source_re = '~(.mail_source|.command_cache';\n  //\n  // ... and any other things we consider exciting\n  //for (id in EventLog.eventbindings) {\n  //   binding = EventLog.eventbindings[id][0];\n  //   source_re += '|' + binding.source;\n  //}\n  //source_re += ')';\n\n  EventLog.request({\n  //source: source_re,\n    since: EventLog.last_ts,\n    gather: (EventLog.last_ts < 0) ? 0.2 : 1.0,\n    wait: 30,\n    _timeout: 31000\n  });\n};\n\n\nEventLog.invoke_callbacks = function(response) {\n  // Update the API CSRF token\n  Mailpile.csrf_token = response.state.csrf_token;\n\n  // Iterate through the events, calling callbacks...\n  var last_ts = response.result.ts;\n  for (event in response.result.events) {\n    var ev = response.result.events[event];\n    for (id in EventLog.eventbindings) {\n      binding = EventLog.eventbindings[id][0];\n      callback = EventLog.eventbindings[id][1];\n      if ((!binding.source || ev.source.match(new RegExp(binding.source)))\n          && (!binding.event_id || ev.event_id == binding.event_id)\n          && (!binding.flags || ev.flags.match(new RegExp(binding.flags)))) {\n        callback(ev);\n      }\n    }\n    last_ts = response.result.ts;\n  }\n  return last_ts;\n};\n\n\nEventLog.process_error = function(result, textstatus) {\n  setTimeout(function() {EventLog.poll();}, 5000);\n};\n\n\nEventLog.process_result = function(result, textstatus) {\n  EventLog.last_ts = EventLog.invoke_callbacks(result);\n  EventLog.poll();\n  Mailpile.local_storage['eventlog_last_ts'] = EventLog.last_ts;\n};\n\n\nEventLog.subscribe = function(ev, func) {\n  // Subscribe a function to an event.\n  // Returns a subscription ID.\n  if (!$.isFunction(func)) {\n    console.log(\"Can only subscribe functions\");\n    return false;\n  }\n  if (typeof(ev) == \"string\") {\n    ev = {source: ev, event_id: null};\n  }\n  this.eventbindings.push([ev, func]);\n  return this.eventbindings.length - 1;\n};\n\n\nEventLog.unsubscribe = function(ev, func_or_id) {\n  // Given an event class and a subscription id\n  // or a function, will unsubscribe from the event.\n  // Returns true if successfully unsubscribed.\n  if ($.isFunction(func_or_id)) {\n    for (i in this.eventbindings) {\n      if (this.eventbindings[i][1] == func_or_id) {\n        this.eventbindings.splice(i, 1);\n        return true;\n      }\n    }\n  } else {\n    this.eventbindings.splice(func_or_id, 1);\n    return true;\n  }\n  return false;\n};/* Activities */\nMailpile.activities.compose = function(to, from) {\n  var compose_data = {};\n  if (to) compose_data.to = to;\n  if (from) compose_data.from = from;\n\tMailpile.API.message_compose_post(compose_data, function(response) {\n    if (response.status === 'success') {\n      Mailpile.go(Mailpile.urls.message_draft + response.result.message_ids[0] + '/');\n    } else {\n      Mailpile.notification(response);\n    }\n  });\n};\n\n\nMailpile.activities.render_typeahead = function() {\n\n  var baseMatcher = function(strs) {\n    return function findMatches(q, cb) {\n      var matches, substrRegex;\n      matches = [];\n      substrRegex = new RegExp(q, 'i');\n      $.each(strs, function(i, str) {\n        if (substrRegex.test(str.term)) {\n          matches.push(str);\n        }\n      });\n      cb(matches);\n    };\n  };\n\n  var tagMatcher = function(strs) {\n    return function findMatches(q, cb) {\n      var matches, substrRegex;\n      matches = [];\n      substrRegex = new RegExp(q, 'i');\n      $.each(strs, function(i, str) {\n        if (substrRegex.test(str.name)) {\n          matches.push(str);\n        }\n      });\n      cb(matches);\n    };\n  };\n\n  var peopleMatcher = function(strs) {\n    return function findMatches(q, cb) {\n      var matches, substrRegex;\n      matches = [];\n      substrRegex = new RegExp(q, 'i');\n      $.each(strs, function(i, str) {\n        if (substrRegex.test(str.fn) || substrRegex.test(str.address)) {\n          str.term =  'from:';\n          matches.push(str);\n        }\n      });\n      cb(matches);\n    };\n  };\n\n  // List of basic suggestions for search helpers\n  var helpers = [\n    { term: 'dates:', helper: '2011-12..2012-04-15' },\n    { term: 'date:', helper: 'date:2013-8-3 +date:2013-9-10' },\n    { term: 'year:', helper: '2013' },\n    { term: 'month:', helper: '8' },\n    { term: 'subject:', helper: 'any normal words' },\n    { term: 'att:', helper: 'jpg' },\n    { term: 'has:', helper: 'attachment' },\n    { term: 'contacts: ', helper: 'name@email.com' },\n    { term: 'to:', helper: 'name@email.com' }\n  ];\n\n  // Create Typeahead\n  $('#form-search .typeahead').typeahead({\n    hint: true,\n    highlight: true,\n    minLength: 0\n  },{\n    name: 'search',\n    displayKey: 'term',\n    source: baseMatcher(helpers),\n    templates: {\n      suggestion: function(data) {\n        var template = Mailpile.safe_template('<div class=\"tt-suggestion\"><p><span class=\"icon-search\"></span> <%= term %> <span class=\"helper\"><%= helper %></span></p></div>');\n        return template(data);\n      }\n    }\n  },{\n    name: 'tags',\n    displayKey: function(value) {\n      return 'in:' + value.slug\n    },\n    source: tagMatcher(Mailpile.instance.tags),\n    templates: {\n      empty: '<div class=\"tt-suggestion\"><p><span class=\"icon-tag\"></span> No tags match your search</p></div>',\n      suggestion: function(data) {\n        if (data.display !== 'invisible') {\n          var template = Mailile.safe_template('<div class=\"tt-suggestion\"><p><span class=\"color-<%= label_color %> <%= icon %>\"></span> <%= name %></p></div>');\n          return template(data);\n        }\n      }\n    }\n  },{\n    name: 'people',\n    displayKey: function(value) {\n      return value.term + value.address;\n    },\n    source: peopleMatcher(Mailpile.instance.addresses),\n    templates: {\n      header: '<span class=\"separator\"></span>',\n      empty: '<div class=\"tt-suggestion\"><p><span class=\"icon-user\"></span> No people match your search</p></div>',\n      suggestion: function(data) {\n        if (data.photo === undefined) { data.photo = '/static/img/avatar-default.png'; }\n        var template = Mailpile.safe_template('<div class=\"tt-suggestion\"><p><img class=\"avatar\" src=\"<%= photo %>\"> <%= term %> <%= fn %></p></div>');\n        return template(data);\n      }\n    }\n  },{\n    name: 'keys',\n    displayKey: 'term',\n    source: baseMatcher([{ term: 'keys: team@mailpile.is' },{ term: 'keys: 707775F9' }]),\n    templates: {\n      suggestion: function(data) {\n        var template = Mailpile.safe_template('<div class=\"tt-suggestion\"><p><span class=\"icon-key\"></span> <%= term %></p></div>');\n        return template(data);\n      }\n    }\n  });\n\n};Mailpile.fix_url = function(url) {\n  if (url.indexOf(\"\") != 0) {\n    return \"\" + url;\n  }\n  return url;\n}\n\nMailpile.go = function(url) {\n  Mailpile.notify_working(undefined, 1000);\n  window.location.href = Mailpile.fix_url(url);\n};\n\n\nMailpile.bulk_cache_human_length = function(type) {\n  if (_.indexOf(this[type], '!all') < 0) return this[type].length;\n  return 'All';\n};\n\nMailpile.bulk_cache_add = function(type, value) {\n  if (_.indexOf(this[type], value) < 0) {\n    this[type].push(value);\n  }\n};\n\nMailpile.bulk_cache_remove = function(type, value) {\n  if (_.indexOf(this[type], value) > -1) {\n    this[type] = _.without(this[type], value);\n  }\n  // Removing anything at all implies we not everything is selected\n  if (_.indexOf(this[type], '!all') > -1) {\n    this[type] = _.without(this[type], '!all');\n  }\n};\n\n\n/* Compose - Create a new email to an address */\n$(document).on('click', 'a', function(e) {\n  if ($(this).attr('href') && ($(this).attr('href').indexOf('mailto:') == 0)) {\n    e.preventDefault();\n    Mailpile.activities.compose($(this).attr('href').replace('mailto:', ''));\n  }\n});/* Helpers */\n\nMailpile.Helpers = [{\n    slug: 'what-is-encryption-key', \n    title: 'What is an Encryption Key',\n    actions: false\n},{\n    slug: 'what-is-missing-key',\n    title: 'What is Missing Encryption Key',\n    actions: ['hideable']\n}];\n\n\n$(document).on('click', '.btn-helper', function(e) {\n  e.preventDefault();\n  var helper = $(this).data('helper');\n  var helper_data = _.findWhere(Mailpile.Helpers, {slug: helper});\n\n  helper_data['content'] = $('#template-helper-' + helper).html();\n\n  console.log(helper);\n  console.log(helper_data);\n\n  // FIXME: Unsafe template, this should be audited\n  var modal_template = Mailpile.unsafe_template($('#template-modal-helper').html());\n  Mailpile.UI.show_modal(modal_template(helper_data));\n});\n\n\n$(document).on('click', '.btn-helper-action', function(e) {\n  e.preventDefault();\n  var action = $(this).data('action');\n\n  console.log(action);\n\n  // \n  $('#modal-full').modal('hide');\n\n  // Show New  \n  setTimeout(function() {\n    Mailpile.UI.Modals[action]();\n  }, 500);\n\n});/* Setup - Complete - Model */\nMailpile.silly_strings = {\n  copying: [\n    'Mail is being imported into your Mailpile',\n    'Copying your mail, please do not be alarmed!',\n    'Copying mail. This could take a while',\n    'Please be patient, we are copying mail as fast as possible',\n    'Wow, you have a lot of mail',\n    'I hope you dont have a plane to catch or anything',\n    'Copying mail. Put your arms above your head and whistle La Cucaracha',\n    'Making a copy of your mail. Putting it in your inbox, all comfy like'\n  ],\n  nerds: [\n    'Damn kids.',\n    'RMS approves!',\n    'Formatting your C:\\x5c drive... (just kidding)',\n    'Fortifying encryption shields',\n    'Increasing entropy &amp; scrambling bits',\n    'Patching bugs...',\n    'Indexing kittens...',\n    'Indexing lovenotes',\n    'Reticulating Splines',\n    'Syntax error in line 45 of this e\\x2dmail',\n    'Shoveling more coal into the server',\n    'Calibrating flux capacitors',\n    'A few bytes tried to escape, but we caught them',\n    'Deterministically simulating future state',\n    'Embiggening prototypes',\n    'Resolving interdependence',\n    'Spinning violently around the y\\x2daxis',\n    'Locating additional gigapixels',\n    'Initializing hamsters',\n    'This is our world now... the world of the electron and the switch',\n    'Fedexing all your spam to online advertisers...',\n    'Becoming self\\x2daware',\n    'Looking for heretofore unknown prime numbers',\n    'Re\\x2daligning satellite grid',\n    'Re\\x2drouting bitstream',\n    'Warming up particle accelerator',\n    'Time is an illusion. Loading time doubly so',\n    'Verifying local gravitational constant',\n    'This server is powered by a lemon and two electrodes'\n  ],\n  email: [\n    'Wow, you have a lot of mail',\n    'Mailpile has an advanced tagging system &amp; search engine at its core',\n    'Do you really need to keep all these Amazon Prime shipping confirmations?',\n    'I am pretty sure e\\x2dmail from ThinkGeeks 2011 X\\x2dmas sale can be deleted.',\n    'Do you really need an e\\x2dmail to know when you have been retweeted?',\n    'E\\x2dmail is the largest internet based social network on the planet',\n    'Which other technology do you use that is 40 years old?',\n    'There are 2.5 billion e\\x2dmail users worldwide, thats double the amount of Facebook users!',\n    'Use Mailpile Tags to better organize and search your mail',\n    'Remember getting your first e\\x2dmail address? Remember how it felt like something private?',\n    'E\\x2dmail is a decentralized by design, this means no one company or government owns it!',\n    'Over 100 trillion e\\x2dmails are sent per year, wow!',\n    'E\\x2dmail is the most widely used communication protocol ever created by humans',\n    'E\\x2dmail uses an open standard agreed upon by the entire world &amp; owned by no one'\n  ],\n  security: [\n    'BCC\\x2ding ALL THE SPIES!',\n    'Many powerful governments are conducting mass dragnet surveillance',\n    'Most e\\x2dmail can be read by network operators as it travels through the internet',\n    'Encryption ensures that your e\\x2dmails are only read by the intended recipient',\n    'Unencrypted e\\x2dmail is more like sending a postcard than sending a letter',\n    'Mailpile uses OpenPGP to encrypt and decrypt your messages securely',\n    'All of your config settings &amp; passwords are encrypted with AES\\x2d256',\n    'Encrypting e\\x2dmails means your communication actually stays private',\n    'The more encrypted e\\x2dmail you send, the better!',\n    'Make sure you print or save your keys &amp; passphrase somewhere secure',\n    'Mailpile by default encrypts your search index!',\n    'The most common e\\x2dmail password is 123456, hopefully yours is different'\n  ],\n  misc: [\n    'Good things come to those who wait',\n    'Make Free Software and be happy',\n    'Much of Mailpile was built in cafes in Reykjavk, Iceland',\n    'Many Icelanders believe in elves and magical hidden people',\n    'The founders of Mailpile first met in a public hot tub in Reykjavk',\n    'We like volcanos, do you like volcanos?',\n    'A million hamsters are spinning their wheels right now',\n    'Tapping earth for more geothermal energy',\n    'Digging moat. Filing with alligators. Fortifying walls',\n    'Crossing out swear words...',\n    'Compiling bullshit bingo grid...',\n    'Abandon all hope, ye who enter here',\n    'Welcome to the nine circles of suffering',\n    'Informing David Cameron of suspicious ac^H^H^H ... naaah :)',\n    'Letting you wait for no apparent reason',\n    'What are you wearing?',\n    'Go put the kettle on, this could be a while',\n    'Go get a cup of tea and some biscuits. This will take approximately 4 custard creams worth of time',\n    'Did you know humans share 50 percent of their DNA with a banana? Freaky',\n    'Estimating chance of astroid hitting Earth',\n    'Reading Terms of Service documents',\n    'Catching up on shows on Netflix',\n    'Oh, you have some very interesting old e\\x2dmails',\n    'I think I better understand you now',\n    'Your past is just a story you tell yourself',\n    'Checking e\\x2dmails for stolen Winklevoss ideas',\n    'Applying coupons...',\n    'Licking stamps...',\n    'Self potato',\n    'Yum yum, that one was tasty',\n    'Hey, there is some Nigerian prince here who wants to give you twenty million dollars...',\n    'How rude!',\n    'Now enhancing photos',\n    'Backing up the entire Internet...',\n    'Really? You are still waiting?',\n    'Well... it sure is a beautiful day',\n    'You should probably go outside or something',\n    'Slacking off over here',\n    'Doing nothing',\n    'Making you wait for no reason',\n    'Testing your patience',\n    'Pay no attention to the man behind the curtain',\n    'You are great just the way you are',\n    'Warning: do not think of purple hippos',\n    'Follow the white rabbit',\n    'Wanna see how deep the rabbit hole goes?',\n    'Supplying monkeys with typewriters',\n    'Waiting for Godot.',\n    'Swapping time and space'\n  ]\n};\n\n\n// JS - UI /==================================================================\n/* UI */\n\nMailpile.UI = {\n  content_setup: [],\n  modal_options: { backdrop: true, keyboard: true, show: true, remote: false },\n  Favico: new Favico({animation:'none'}),\n\n  Crypto: {},\n  Sidebar: {},\n  Modals: {},\n  Tooltips: {},\n  Message: {},\n  Search: {}\n};\n\n\nMailpile.UI.prepare_new_content = function(content) {\n  var $content = $(content);\n\n  // Iterate through the list of setup callbacksk, so different parts of\n  // the JS app, plugins included, can mess with the new content.\n  for (var i in Mailpile.UI.content_setup) {\n    Mailpile.UI.content_setup[i]($content);\n  }\n\n  // Check if this update tells us new things about the Inbox unread count,\n  // update the Favico if so.\n  // FIXME: This will not update the favico if the sidebar is not visible.\n  var inbox_new = $content.find('.sidebar-tag-inbox').data('new');\n  if (inbox_new !== undefined) {\n    setTimeout(function() { Mailpile.UI.Favico.badge(inbox_new); }, 250);\n  }\n};\n\n\nMailpile.UI.show_modal = function(html) {\n  if (html) $('#modal-full').html(html);\n  $('#modal-full').modal(Mailpile.UI.modal_options);\n  Mailpile.UI.prepare_new_content($('#modal-full'));\n  return $('#modal-full');\n};\n\n\nMailpile.UI.init = function() {\n  // BRE: disabled for now, it doesn't really work\n  // Show Typeahead\n  //Mailpile.activities.render_typeahead();\n\n  // Start Eventlog\n  setTimeout(function() {\n\n    // make event log start async (e.g. for proper page load event handling)\n    EventLog.timer = $.timer();\n    EventLog.timer.set({ time : 22500, autostart : false });\n    EventLog.poll();\n\n    // Run Composer Autosave\n    Mailpile.Composer.AutosaveTimer.play();\n    Mailpile.Composer.AutosaveTimer.set({ time : 20000, autostart : true });\n\n  }, 200);\n\n  // Register callbacks etc on new content: the whole page is new!\n  Mailpile.UI.prepare_new_content(document);\n};\n\n\nMailpile.UI.tag_icons_as_lis = function() {\n  var icons_html = '';\n  $.each(Mailpile.theme.icons, function(key, icon) {\n    icons_html += ('<li class=\"modal-tag-icon-option ' + icon +\n                   '\" data-icon=\"' + icon + '\"></li>');\n  });\n  return icons_html;\n};\n\n\nMailpile.UI.tag_colors_as_lis = function() {\n  var sorted_colors =  _.keys(Mailpile.theme.colors).sort();\n  var colors_html = '';\n  $.each(sorted_colors, function(key, name) {\n    var hex = Mailpile.theme.colors[name];\n    colors_html += ('<li><a href=\"#\" class=\"modal-tag-color-option\" ' +\n                    'style=\"background-color: ' + hex + '\" data-name=\"' +\n                    name + '\" data-hex=\"' + hex + '\"></a></li>');\n  });\n  return colors_html;\n};/* Notifications - UI notification at top of window */\n\nMailpile.expire_canceled_notifictions = function() {\n  var expired = new Date().getTime() - (3600 * 1000);\n  for (item in Mailpile.local_storage) {\n    if (item.indexOf('canceled-') == '0'\n        && Mailpile.local_storage[item] < expired) {\n      delete Mailpile.local_storage[item];\n    }\n  }\n};\nMailpile.expire_canceled_notifictions();\n\n\nMailpile.cancel_notification = function(not_id, $existing, replace, record) {\n  // Cancel existing notification, if any\n  var $existing = $existing || $('#event-' + not_id);\n  if ($existing.length > 0) {\n    clearTimeout($existing.data('timeout_id'));\n    if (replace) {\n      return $existing;\n    }\n    else {\n      if (record) {\n        not_id = $existing.attr('id').substring(6);\n        Mailpile.local_storage['canceled-' + not_id] = new Date().getTime();\n      }\n      $existing.slideUp('normal', function() {\n        $(this).remove();\n        if ($('.notification-bubble').length < 1) {\n          $('.notifications-close-all span').hide();\n        }\n      });\n    }\n  }\n  return undefined;\n};\n\n\nMailpile.notification = function(result) {\n\n  // Create CSS friend event_id OR fake-id\n  if (result.event_id !== undefined) {\n    result.event_id = result.event_id.split('.').join('-');\n  } else {\n    result['event_id'] = 'fake-id-' + Math.random().toString(24).substring(2);\n  }\n\n  // Message\n  var default_messages = {\n    \"success\" : \"Success, we did what you asked\",\n    \"info\"    : \"Here is a basic info update\",\n    \"debug\"   : \"This is a simple debug message\",\n    \"warning\" : \"This here be a warning to you\",\n    \"error\"   : \"You have discovered an error\"\n  }\n  if (result.message  === undefined) {\n    result.message = default_messages[result.status];\n  }\n\n  // Default Options\n  if (result.message2 === undefined) {\n    if (result.data && result.data.name) {\n      result.message2 = result.message;\n      result.message = result.data.name;\n    }\n    else {\n      result.message2 = '';\n    }\n  }\n  if (result.undo        === undefined) result.undo = false;\n  if (result.type        === undefined) result.type = 'notify';\n  if (result.complete    === undefined) result.complete = 'hide';\n  if (result.action      === undefined) result.action = '';\n  if (result.action_js   === undefined) result.action_js = '';\n  if (result.action_url  === undefined) result.action_url = '';\n  if (result.action_text === undefined) result.action_text = '';\n  if (result.icon        === undefined) result.icon = 'icon-inbox';\n  if (result.timeout     === undefined) {\n    if (result.flags == \"c\") {\n      result.timeout = 8000; // Event complete, timeout quickly\n    }\n    else {\n      result.timeout = 360000000; // 100 hours - awaite completion\n    }\n  }\n\n  // Undo & Icon\n  if (result.command !== 'tag' && result.type === 'nagify') {\n    result.undo = false;\n    result.icon = 'icon-signature-unknown';\n  }\n  else if (result.command === 'tag') {\n    result.undo = true;\n    result.icon = 'icon-tag';\n  }\n\n  // If Undo, extend hide\n  if (result.undo && result.complete === 'hide') {\n    result.timeout = 20000;\n  }\n\n  // If user has canceled this notification, don't bug him again.\n  if (Mailpile.local_storage['canceled-' + result['event_id']]) {\n    return result['event_id'];\n  }\n\n  // Show Notification\n  var $elem = Mailpile.cancel_notification(result.event_id, undefined, 'keep');\n  var notification_template = Mailpile.unsafe_template($('#template-notification-bubble').html());\n  if ($elem) {\n      $elem.replaceWith(notification_template(result));\n  }\n  else {\n      var bubbles = $('#notification-bubbles');\n      if (bubbles.children().length < 15) {\n          bubbles.prepend($(notification_template(result)).slideDown('normal'));\n          $('.notifications-close-all span').show();\n      }\n  }\n\n  // If Not Nagify, default\n  if (result.complete === 'hide' && result.type !== 'nagify') {\n    var to_id = setTimeout(function() {\n      Mailpile.cancel_notification(result.event_id);\n    }, result.timeout);\n    $('#event-' + result.event_id).data('timeout_id', to_id);\n  }\n  else if (result.complete == 'redirect') {\n    setTimeout(function() {\n      Mailpile.go(result.action);\n    }, 4000);\n  }\n\n  return result['event_id'];\n};\n\n/* Use when stuff is loading in the backgrount to show progress */\nMailpile.notify_working = function(message, timeout) {\n  var events = [undefined, undefined];\n  var notify = function() {\n    var silly = Math.floor(Math.random() * Mailpile.silly_strings.misc.length);\n    events[1] = Mailpile.notification({\n      event_id: events[1],\n      message: message || \"Working...\",\n      message2: Mailpile.silly_strings.misc[silly],\n      status: 'warning',\n      icon: 'icon-robot'\n    });\n    events[0] = setTimeout(notify, 5000);\n  };\n  events[0] = setTimeout(notify, timeout);\n  return function() {\n    // This cancels the event. To avoid weird flickering, if the notification\n    // has already been displayed, we leave it up for a little longer.\n    if (events[0]) clearTimeout(events[0]);\n    setTimeout(function() {\n      if (events[1]) Mailpile.cancel_notification(events[1]);\n    }, 1250);\n  }\n};\n\n/* Notification - Close all */\n$(document).on('click', '.notifications-close-all', function() {\n  $('.notification-close').click();\n});\n\n\n\n/* Notification - Close */\n$(document).on('click', '.notification-close', function() {\n  if ($(this).data('type') === 'nagify') {\n    var next_nag = new Date().getTime() + Mailpile.nagify;\n    Mailpile.API.settings_set_post({ 'web.nag_backup_key': next_nag });\n  }\n  Mailpile.cancel_notification('', $(this).parent(), undefined, true);\n});\n\n\n/* Notification - Undo */\n$(document).on('click', '.notification-undo', function() {\n  var event_id = $(this).data('event_id').split('-').join('.');\n  Mailpile.API.eventlog_undo_post({ event_id: event_id }, function(result) {\n    if (result.status === 'success') {\n      window.location.reload(true);\n    }\n  });\n});\n\n\n/* Notification - Nag */\n$(document).on('click', '.notification-nag', function(e) {\n  e.preventDefault();\n  var href = $(this).attr('href');\n  var next_nag = new Date().getTime() + Mailpile.nagify;\n  Mailpile.API.settings_set_post({ 'web.nag_backup_key': next_nag }, function() {\n    Mailpile.go(href);\n  });\n});\n\n\n/* Set up some default notifications by listening to the Event log */\nEventLog.subscribe('.*AddProfile', function(ev) {\n  console.log('AddProfile event: ' + ev.data.keygen_started);\n  if (ev.data.keygen_started > 0) {\n      ev.icon = 'icon-lock-closed';\n      var $icon = $('.profile-' + ev.data.profile_id + '-key.icon');\n      if (ev.data.keygen_finished > 0) {\n          $icon.removeClass('unconfigured');\n          $icon.removeClass('icon-clock').removeClass('icon-lock-open');\n          $icon.addClass('configured').addClass('icon-lock-closed');\n      }\n      else {\n          $icon.removeClass('configured');\n          $icon.removeClass('icon-lock-open').removeClass('icon-lock-closed');\n          $icon.addClass('unconfigured').addClass('icon-clock');\n      }\n      Mailpile.notification(ev);\n  }\n});\nEventLog.subscribe('.*mail_source.*', function(ev) {\n  var $src = $('.source-' + ev.data.id);\n  if ($src.length > 0) {\n    var $icon = $src.find('.icon');\n    if (ev.data.connection && ev.data.connection.error[0]) {\n      $icon.removeClass('configured').removeClass('unconfigured');\n      $icon.addClass('misconfigured');\n      $src.attr('title', $src.data('title') + '\\n\\n' +\n                         'Error: ' +  ev.message);\n      ev.action_js = \"onclick=\\\"javascript:$('.source-\" + ev.data.id + \"').click();\\\"\";\n      ev.action_text = 'edit settings';\n    }\n    else {\n      $icon.removeClass('misconfigured').removeClass('unconfigured');\n      $icon.addClass('configured');\n    }\n\n    ev.icon = 'icon-mailsource';\n    Mailpile.notification(ev);\n  }\n});\nEventLog.subscribe('.*compose.Sendit', function(ev) {\n  if (ev.data.delivered == ev.data.recipients) {\n    ev.icon = 'icon-outbox';\n  }\n  else if (ev.data.last_error) {\n    ev.icon = 'icon-signature-unknown';\n    ev.message2 = ev.data.last_error\n  }\n  Mailpile.notification(ev);\n});/* This is the shared selection code (checkboxes etc).\n** \n** Instead of a global object tracking which objects are selected, selection\n** counts are calculated on-the-fly by evaluating the DOM.\n**\n** Selection contexts are grouped using the class \"selection-context\"; any\n** checkboxes contained within the same selection context are assumed to be\n** of the same type.\n**\n** The rationale for doing this, is it allows a single screen to have\n** multiple groups of selectable items, each of which can be manipulated\n** independently of the others. This should makes selection behavior stable,\n** no matter how updates happen (AJAX, js, ...).\n*/\nMailpile.UI.Selection = (function(){\n\nvar update_callbacks = {};\n\n/* Helpers... */\nfunction _call_callbacks(context, selected) {\n  for (var i in update_callbacks) {\n    update_callbacks[i](context, selected);\n  }\n}\nfunction context(selector) {\n  return $(selector).eq(0).closest('.selection-context').eq(0);\n}\nfunction _select_all(ctx) {\n  return ctx.find('#pile-select-all-action');\n}\nfunction _each_checkbox(ctx, func) {\n  ctx.find('input[type=checkbox]').each(func);\n}\n\n\n/**\n * Register a callback function, invoked when selection state changes\n * @param {String} name - Callback name\n * @param {Function} callback - Callback function\n */\nfunction register(name, callback) {\n  update_callbacks[name] = callback;\n}\n\n/**\n * Unregister a callback function\n * @param {String} name - Callback name\n */\nfunction unregister(name) {\n  delete update_callbacks[name];\n}\n\n/**\n * Select \"these\", all visible elements on page\n * @param {String|Object} selector - A JQuery selector or DOM element\n * @param {Boolean} [no_callbacks] - Skip invoking callbacks\n * @return {Array} Array of selected values\n */\nfunction select_these(selector, no_callbacks) {\n  var ctx = context(selector);\n  var sel = [];\n  _each_checkbox(ctx, function() {\n    if (this.value == '!all') this.value = '';\n    if (this.value != '') sel.push(this.value);\n    $(this).prop('checked', true);\n  });\n  if (!no_callbacks) _call_callbacks(ctx, sel);\n  return sel;\n}\n\n/**\n * Select nothing\n * @param {String|Object} selector - A JQuery selector or DOM element\n * @param {Boolean} [no_callbacks] - Skip invoking callbacks\n * @return {Array} Array of selected values, should be []\n */\nfunction select_none(selector, no_callbacks) {\n  var ctx = context(selector);\n  _each_checkbox(ctx, function() {\n    if (this.value == '!all') this.value = '';\n    $(this).prop('checked', false);\n  });\n  if (!no_callbacks) _call_callbacks(ctx, []);\n  return [];\n}\n\n/**\n * Select \"all\", potentially including things not visible on page\n * @param {String|Object} selector - A JQuery selector or DOM element\n * @param {Boolean} [no_callbacks] - Skip invoking callbacks\n * @return {Array} Array of selected values, should be ['!all']\n */\nfunction select_all(selector, no_callbacks) {\n  var ctx = context(selector);\n  Mailpile.UI.Selection.select_these(ctx, true);\n  _select_all(ctx).val('!all');\n  if (!no_callbacks) _call_callbacks(ctx, ['!all']);\n  return ['!all'];\n}\n\n/**\n * Stop selecting \"all\"\n * @param {String|Object} selector - A JQuery selector or DOM element\n * @param {Boolean} [no_callbacks] - Skip invoking callbacks\n * @return {Array} Array of selected values\n */\nfunction select_not_all(selector, no_callbacks) {\n  var ctx = context(selector);\n  _select_all(ctx).val('');\n  var sel = Mailpile.UI.Selection.selected(ctx);\n  if (!no_callbacks) _call_callbacks(ctx, sel);\n  return sel;\n}\n\n/**\n * Returns a list of currently selected items.\n * @param {String|Object} selector - A JQuery selector or DOM element\n * @return {Array} Array of selected values or ['!all']\n */\nfunction selected(selector) {\n  var ctx = context(selector);\n  var selected = [];\n  var all = false;\n  _each_checkbox(ctx, function() {\n    var $elem = $(this);\n    if ($elem.is(':checked') && this.value) {\n      if (this.value == '!all') all = true;\n      selected.push(this.value);\n    }\n  });\n  if (all) return ['!all'];\n  return selected;\n}\n\n/**\n * Returns the number of selected items or a translation of \"all\".\n * @param {Array} Array of selected values or ['!all']\n * @return {String} Length of selection as a string\n */\nfunction human_length(selection) {\n  if (selection && selection[0] != '!all') return ('' + selection.length);\n  return 'All';\n}\n\nreturn {\n  'register': register,\n  'unregister': unregister,\n  'context': context,\n  'select_these': select_these,\n  'select_none': select_none,\n  'select_all': select_all,\n  // From the Zoolander school for kids who want to learn\n  // to code good and do other stuff good too!\n  'select_not_all': select_not_all,\n  'selected': selected,\n  'human_length': human_length\n}})();/* This is shared message tagging/untagging code.\n*/\nMailpile.UI.Tagging = (function(){\n\nvar operations = {\n  'tag':     ['Tagged 1 message',\n              'Tagged (num) messages'],\n  'untag':   ['Untagged 1 message',\n              'Untagged (num) messages'],\n  'read':    ['Marked 1 message read',\n              'Marked (num) messages read'],\n  'unread':  ['Marked 1 message unread',\n              'Marked (num) messages unread'],\n  'move':    ['Moved 1 message',\n              'Moved (num) messages'],\n  'archive': ['Archived 1 message',\n              'Archived (num) messages'],\n  'trash':   ['Moved 1 message to trash',\n              'Moved (num)  messages to trash'],\n  'spam':    ['Moved 1 message to spam',\n              'Moved (num) messages to spam']\n};\n\n/**\n * Tag/untag messages and then update the visible UI to match\n * @param {String|Object} selector - A JQuery selector or DOM element\n * @param {Boolean} [no_callbacks] - Skip invoking callbacks\n * @return {Array} Array of selected values\n */\nfunction tag_and_update_ui(options, op, callback) {\n  // If there's nothing to do, don't bother the back-end.\n  if (!options.mid) return;\n  if (!options.add && !options.del) return;\n\n  var notify_done = Mailpile.notify_working(\"Tagging...\", 500);\n  options._error_callback = notify_done;\n\n  Mailpile.API.tag_post(options, function(response) {\n    notify_done();\n\n    if ((!response.result) || (response.status != \"success\")) {\n      // Just report errors, do nothing else.\n      Mailpile.notification(response);\n      return;\n    }\n\n    var count = response.result.msg_ids.length;\n    if (count < 1) return; // This was a no-op.\n\n    // Call callbacks, if any. We do this first, because callbacks may\n    // want to reference bits of the DOM that get changed below.\n    if (callback) callback(response);\n\n    $('.pile-results').each(function (i, context) {\n      var $context = $(context);\n\n      var tids = (($context.data(\"tids\") || \"\") + \"\").split(/\\s+/);\n      var context_tids = {};\n      for (var i in tids) { context_tids[tids[i]] = true; }\n\n      for (var i in response.result.untagged) {\n        var tag = response.result.untagged[i][0];\n        var mids = response.result.untagged[i][1];\n        var untagged = {};\n        for (var j in mids) { untagged[mids[j]] = true; }\n\n        $context.find('.pile-message').each(function(i, elem) {\n          var $elem = $(elem);\n          var mid = $elem.data('mid');\n          if (untagged[mid]) {\n            if (context_tids[tag.tid]) {\n              // Message should no longer appear in this context at all\n              $elem.slideUp(200, function() { $(this).remove(); });\n            }\n            else {\n              // Remove any tag labels\n              $elem.removeClass('in_' + tag.slug)\n                   .find('.pile-message-tag-' + tag.tid).remove();\n            }\n          }\n        });\n      }\n\n      // Add tag labels to elements as necessary\n      for (var i in response.result.tagged) {\n        var tag = response.result.tagged[i][0];\n        if (!context_tids[tag.tid]) {\n          var mids = response.result.tagged[i][1];\n          var tagged = {};\n          for (var j in mids) { tagged[mids[j]] = true; }\n\n          var hex = Mailpile.theme.colors[tag.label_color];\n          var tag_html = (\n            '<span class=\"pile-message-tag pile-message-tag-' + \n                          tag.tid + '\" style=\"color: ' + hex + ';\">' +\n                          '<span class=\"pile-message-tag-icon ' + tag.icon +\n                          '\"></span></span>'\n          );\n          $context.find('.pile-message').each(function(i, elem) {\n            var $elem = $(elem);\n            var mid = $elem.data('mid');\n            if (tagged[mid]) {\n              if (tag.flag_hides) {\n                // If tag is a hiding tag, make element disappear\n                $elem.slideUp(200, function() { $(this).remove(); });\n              }\n              else {\n                $elem.addClass('in_' + tag.slug);\n                if (tag.label) {\n                  $elem.find('span.item-tags').append(tag_html);\n                }\n              }\n            }\n          });\n        }\n      }\n\n    });\n\n    // Update Bulk UI; do this after a delay, so the fade-outs can complete.\n    setTimeout(Mailpile.bulk_actions_update_ui, 300);\n\n    // Override message text if we think we know better\n    if (op && operations[op]) {\n      if (count == 1) {\n        response.message = operations[op][0];\n      }\n      else {\n        var msg = operations[op][1];\n        var ofs = msg.indexOf('(num)');\n        response.message = (msg.substring(0, ofs) +\n                            count +\n                            msg.substring(ofs+5));\n                        \n      }\n    }\n\n    // Show notification\n    Mailpile.notification(response);\n  });\n}\n\nreturn {\n  'tag_and_update_ui': tag_and_update_ui\n}})();/* UI - Show specific elements */\nMailpile.show_bulk_actions = function(elements) {\n  $.each(elements, function(){    \n    $(this).css('visibility', 'visible');\n  });\n};\n\n\n/* UI - Hide specific elements */\nMailpile.hide_bulk_actions = function(elements) {\n  $.each(elements, function(){    \n    $(this).css('visibility', 'hidden');\n  });\n};\n\n\n/* UI - Update sub navigation .navigation-on class state */\n$(document).on('click', '.button-sub-navigation', function() {\n\n  var filter = $(this).data('filter');\n\n  $('.sub-navigation ul li').removeClass('navigation-on');\n  $(this).parent().addClass('navigation-on');\n\n  if (filter == 'in_unread') {\n\n    $('#display-unread').addClass('navigation-on');\n    $('tr').hide('fast', function() {\n      $('tr.in_new').show('fast');\n    });\n  }\n  else if (filter == 'in_later') {\n\n    $('#display-later').addClass('navigation-on');\n    $('tr').hide('fast', function() {\n      $('tr.in_later').show('fast');\n    });\n  }\n  else {\n    $('#display-all').addClass('navigation-on');\n    $('tr.result').show('fast');\n  }\n  return false;\n});Mailpile.render = function() {\n\n  // Dynamic CSS Reiszing\n  var dynamic_sizing = function() {\n    return;\n\n    var sidebar_width  = $('#sidebar').width();\n    var content_width  = $(window).width() - sidebar_width;\n    var content_height = $(window).height() - 62;\n    if (content_width < 10) {\n        /* This means we are in portrait mode */\n        sidebar_width = 0;\n        content_width = $(window).width();\n        content_height -= 80;\n    }\n    var content_tools_height    = $('#content-tools').height();\n    var new_content_width       = $(window).width() - sidebar_width;\n    var new_content_view_height = content_height - content_tools_height;\n\n    $('#content-tools').css('position', 'fixed');\n    $('.sub-navigation').width(content_width);\n    $('#thread-title').width(content_width);\n\n    // Set Content View\n    $('#content, #content-wide').css({'height': content_height});\n    $('#content-tools, .sub-navigation, .bulk-actions').width(new_content_width);\n    $('#content-view').css({'height': new_content_view_height, 'top': content_tools_height});\n  };\n\n\n  // Resize Elements Start + On Drag\n  dynamic_sizing();\n  window.onresize = function(event) {\n    dynamic_sizing();\n  };\n\n\n  // Show Mailboxes\n  if ($('#sidebar-tag-outbox').find('span.sidebar-notification').html() !== undefined) {\n    $('#sidebar-tag-outbox').show();\n  }\n\n  // Mousetrap Keybindings\n  Mousetrap.bind('shift', function() { \n    Mailpile.select_between = true;\n  }, 'keydown');\n\n  Mousetrap.bind('shift', function() { \n    Mailpile.select_between = false;\n  }, 'keyup');\n\n\tfor (item in Mailpile.keybindings) {\n\t  var keybinding = Mailpile.keybindings[item];\n\t\tif (keybinding[0] == \"global\") {\n\t\t\tMousetrap.bindGlobal(keybinding[1], keybinding[2]);\n\t\t} else{\n      Mousetrap.bind(keybinding[1], keybinding[2]);\n\t\t}\n\t}\n\n};\n\n\n/* Mailpile - UI - Make fingerprints nicer */\nMailpile.nice_fingerprint = function(fingerprint) {\n  // FIXME: I'd really love to make these individual pieces color coded\n  // Pertaining to the hex value pairings & even perhaps toggle-able icons\n  return fingerprint.split(/(....)/).join(' ');\n};/* Topbar - Search - Focus */\n$(document).on('click', '#search-query', function() {\n  $(this).select();\n});\n\n\nMailpile.UI.content_setup.push(function($content) {\n  var $sq = $('#search-query');\n  if (($sq.data('q') == $sq.val()) || ($sq.val() == \"\")) {\n    // FIXME: This will do silly things if we have multiple search results\n    //        on a page at a time.\n    var $st = $content.find('#search-terms');\n    var search_terms = $st.data('q');\n    if (search_terms !== undefined) {\n      $sq.data('q', search_terms).val(search_terms)\n         .data('context', $st.data('context'));\n    }\n  }\n});\n\n\n// \n\n/* Activities - Create New Blank Message */\n$(document).on('click', '.button-compose', function(e) {\n\te.preventDefault();\n  Mailpile.activities.compose($(this).data('to'), $(this).data('from'));\n});Mailpile.UI.Sidebar.SubtagsRender = function(tid, gradual) {\n  // FIXME: This assumes we have a Mailpile.config object that is up to date.\n  //        That is not a safe or reasonable assumption...\n\n  if (_.indexOf(Mailpile.config.web.subtags_collapsed, tid) == -1) {\n    $('#sidebar-tag-' + tid).find('a.sidebar-tag-expand span').removeClass('icon-arrow-right').addClass('icon-arrow-down');\n    if (gradual) {\n      $('.subtag-of-' + tid).slideDown('fast');\n    }\n    else {\n      $('.subtag-of-' + tid).show();\n    }\n  } else {\n    //$('#sidebar-tag-' + tid).removeClass('show-subtags');\n    $('#sidebar-tag-' + tid).find('a.sidebar-tag-expand span').removeClass('icon-arrow-down').addClass('icon-arrow-right');\n    if (gradual) {\n      $('.subtag-of-' + tid).slideUp('fast');\n    }\n    else {\n      $('.subtag-of-' + tid).hide();\n    }\n  }\n};\n\n\nMailpile.UI.Sidebar.SubtagsToggle = function(tid) {\n  // FIXME: This assumes we have a Mailpile.config object that is up to date.\n  //        That is not a safe or reasonable assumption...\n\n  // Toggle show/hide for this tid\n  if (_.indexOf(Mailpile.config.web.subtags_collapsed, tid) > -1) {\n    var collapsed = _.without(Mailpile.config.web.subtags_collapsed, tid);\n  } else {\n    Mailpile.config.web.subtags_collapsed.push(tid);\n    var collapsed = Mailpile.config.web.subtags_collapsed;\n  }\n\n  // Display and record new state\n  Mailpile.config.web.subtags_collapsed = collapsed;\n  Mailpile.UI.Sidebar.SubtagsRender(tid, true);\n\n  // Save to Config\n  Mailpile.API.settings_set_post({ 'web.subtags_collapsed': collapsed }, function(result) { \n  });\n};\n\n\nMailpile.UI.Sidebar.Sortable = function() {\n $('.sidebar-sortable').sortable({\n    placeholder: \"sidebar-tags-sortable\",\n    distance: 13,\n    scroll: false,\n    opacity: 0.8,\n    stop: function(event, ui) {\n\n      var item  = $(ui.item);\n      var tid   = item.data('tid');\n      var index = parseInt(item.index());\n\n      var get_order = function(index, base) {\n        var elem = item.parent().find('li:nth-child(' + index + ')');\n        if (elem.length > 0) {\n          var display_order = parseFloat(elem.data('display_order'));\n          if (!isNaN(display_order)) {\n            return display_order;\n          }\n        }\n        return base;\n      };\n\n      // Calculate new orders\n      var previous  = get_order(index, 0);\n      var next      = get_order(index + 2, 1000000);\n      var new_order = (parseFloat(previous) + parseFloat(next)) / 2.0;\n\n      // Save Tag Order\n      var tag_setting = Mailpile.tag_setting(tid, 'display_order', new_order);\n      Mailpile.API.settings_set_post(tag_setting, function(result) { \n        // Update Current Element\n        $(ui.item).attr('data-display_order', new_order).data('display_order', new_order);\n      });\n\t\t}\n\t}).disableSelection();\n};\n\n\nMailpile.UI.Sidebar.Draggable = function(element) {\n  $(element).draggable({\n    containment: 'window',\n    appendTo: 'body',\n    handle: '.name',\n    cursor: 'move',\n    cursorAt: { right: -5, top: 15 },\n    distance: 15,\n    scroll: false,\n    revert: false,\n    opacity: 1,\n    helper: function(event) {\n      // FIXME: Helper tooltip assumes only one destination for the drag,\n      //        which may not always be true!\n      var count = '';\n      var selection = Mailpile.UI.Selection.selected('#content');\n      if (selection.length >= 1) {\n        count = (' to (' +\n                 Mailpile.UI.Selection.human_length(selection) + ')');\n      }\n\n      var $elem = $(this);\n      var tid = $elem.data('tid').toString();\n      var hex = Mailpile.theme.colors[$elem.data('color')];\n      var icon = $elem.data('icon');\n      var name = $elem.find('.name').html();\n      return $('<div class=\"sidebar-tag-drag ui-widget-header\" style=\"color: '\n               + hex + '\"><span class=\"' + icon + '\"></span> '\n               + name + count + '</div>');\n    },\n    start: function() {\n      Mailpile.ui_in_action += 1;\n    },\n    stop: function() {\n      setTimeout(function() { Mailpile.ui_in_action -= 1; }, 250);\n    }\n  });\n};\n\n\nMailpile.UI.Sidebar.Droppable = function(element, accept) {\n  $(element).droppable({\n    accept: accept,\n    activeClass: 'sidebar-tags-draggable-hover',\n    hoverClass: 'sidebar-tags-draggable-active',\n    tolerance: 'pointer',\n    drop: function(event, ui) {\n      var $context = Mailpile.UI.Selection.context(ui.draggable);\n      var tags_delete = (($context.find('.pile-results').data(\"tids\") || \"\"\n                          ) + \"\").split(/\\s+/);\n      Mailpile.UI.Tagging.tag_and_update_ui({\n        add: $(this).find('a').data('tid'),\n        del: tags_delete,\n        mid: Mailpile.UI.Selection.selected($context),\n        context: $context.find('.search-context').data('context')\n      }, 'move');\n    }\n  });\n};\n\n\nMailpile.UI.Sidebar.OrganizeToggle = function(elem) {\n  var $elem = $(elem);\n  var new_message = $elem.data('message');\n  var old_message = $elem.find('span.text').html();\n\n  // Make Editable\n  if ($elem.data('state') != 'editing') {\n    Mailpile.ui_in_action += 1;\n    Mailpile.UI.Sidebar.Sortable();\n\n    // Disable Drag & Drop\n    $('a.sidebar-tag').draggable({ disabled: true });\n    \n    // Update Cursor Make Links Not Work\n    $('.sidebar-sortable li').addClass('is-editing');\n\n    // Hide Notification & Subtags\n    $('a.sidebar-tag .notification').hide();\n    $('.sidebar-subtag').hide();\n\n    // Add Minus Button\n    $.each($('.sidebar-tag'), function(key, value) {\n      $(this).append('<span class=\"sidebar-tag-archive icon-minus\"></span>');\n    });\n\n    // Update Edit Button\n    $elem.data('state', 'editing');\n    $elem.find('span.icon').removeClass('icon-settings').addClass('icon-checkmark');\n\n  } else {\n\n    Mailpile.ui_in_action -= 1;\n\n    // Enable Drag & Drop\n    $('a.sidebar-tag').draggable({ disabled: false });    \n\n    // Update Cursor Make Links Work\n    $('.sidebar-sortable li').removeClass('is-editing');\n\n    // Show Notification / Hide Minus Button\n    $('a.sidebar-tag .notification').show();\n    $('.sidebar-tag-archive').remove();\n\n    // Update Edit Button\n    $elem.data('state', 'done');\n    $elem.find('span.icon').removeClass('icon-checkmark').addClass('icon-settings');\n  }\n\n  $elem.data('message', old_message)\n  $elem.find('span.text').html(new_message);\n};\n\n\nMailpile.UI.Sidebar.TagArchive = function() {\n  // FIXME: This should use a modal or styled confirm dialogue and Int. language\n  alert('This will mark this tag as \"archived\" and remove it from your sidebar, you can go edit this in the Tags -> Tag Name -> Settings page at anytime');\n  var tid = $(this).parent().data('tid');\n  var setting = Mailpile.tag_setting(tid, 'display', 'archive');\n  Mailpile.API.settings_set_post(setting, function(result) { \n    Mailpile.notification(result);\n    $('#sidebar-tag-' + tid).fadeOut();\n  });\n};\n\n\n// Register update functions\nMailpile.UI.content_setup.push(function($content) {\n  Mailpile.UI.Sidebar.Draggable(\n    $content.find('.sidebar-tags-draggable a.sidebar-tag'));\n  Mailpile.UI.Sidebar.Droppable(\n    $content.find('.sidebar-tags-draggable'),\n   'td.draggable, div.thread-draggable');\n  $content.find('.sidebar-tag-expand').each(function(i, elem) {\n    Mailpile.UI.Sidebar.SubtagsRender($(elem).data('tid'), false);\n  });\n});/* UI - Tooltips */\nMailpile.UI.content_setup.push(function($content) {\n\n  // Topbar navigation tooltips\n  $content.find('.topbar-nav a').qtip({\n    style: {\n     tip: {\n        corner: 'top center',\n        mimic: 'top center',\n        border: 0,\n        width: 10,\n        height: 10\n      },\n      classes: 'qtip-tipped'\n    },\n    position: {\n      my: 'top center',\n      at: 'bottom center',\n\t\t\tviewport: $(window),\n\t\t\tadjust: {\n\t\t\t\tx: 0,  y: 5\n\t\t\t}\n    },\n    show: {\n      delay: 350\n    }\n  });\n\n  // Bulk action tooltips\n  $content.find('.bulk-actions ul li a').qtip({\n    style: {\n      classes: 'qtip-tipped'\n    },\n    position: {\n      my: 'top center',\n      at: 'bottom center',\n\t\t\tviewport: $(window),\n\t\t\tadjust: {\n\t\t\t\tx: 0,  y: 5\n\t\t\t}\n    }\n  });\n\n  // Email composition tooltips\n  $content.find('.compose-to-email').qtip({\n    content: {\n      title: false,\n      text: function(event, api) {\n        return 'Compose to: ' + $(this).attr('href').replace('mailto:', '');\n      }\n    },  \n    style: {\n      classes: 'qtip-tipped'\n    },\n    position: {\n      my: 'bottom center',\n      at: 'top center',\n\t\t\tviewport: $(window),\n\t\t\tadjust: {\n\t\t\t\tx: 0,  y: 0\n\t\t\t}\n    },\n    show: {\n      delay: 450\n    }\n  });\n\n});Mailpile.keybinding_move_message = function(add_tag) {\n\n  // Has Messages\n  var $context = Mailpile.UI.Selection.context('.pile-results tr.is-target');\n  var selection = Mailpile.UI.Selection.selected($context);\n  if (selection.length) {\n\n    var delete_tags = (($context.find('.pile-results').data(\"tids\") || \"\"\n                        ) + \"\").split(/\\s+/);\n    delete_tags.push('new');\n\n    Mailpile.UI.Tagging.tag_and_update_ui({\n      add: add_tag,\n      del: delete_tags,\n      mid: selection,\n      context: $context.find('.search-context').data('context')\n    }, 'move');\n  }\n  else {\n    console.log('FIXME: Provide helpful / unobstrusive UI feedback that tells a user they hit a keybinding, then fades away');\n  }\n};\n\n\nMailpile.keybinding_target =  function(direction) {\n\n  var color = this.theme.colors['01-gray-mid'];\n  var current  = this.search_target;\n\n  if (this.search_target === 'none') {\n    var next = 0;\n  }\n  else if (this.search_target !== 'none' && direction == 'up') {\n    var next = parseInt(current) - 1;\n  }\n  else if (this.search_target !== 'none' && direction == 'down') {\n    var next = parseInt(current) + 1;\n  }\n\n  this.search_target = next;\n\n  $('.pile-results tr').eq(current).removeClass('is-target result-hover').find('td.draggable');\n  $('.pile-results tr').eq(next).addClass('is-target result-hover').find('td.draggable');\n};$(document).on('click', '.sidebar-tag-expand', function(e) {\n  e.preventDefault();\n  Mailpile.UI.Sidebar.SubtagsToggle($(this).data('tid'));\n});\n\n\n$(document).on('click', '.is-editing', function(e) {\n  e.preventDefault();\n});\n\n\n$(document).on('click', '#button-sidebar-organize', function(e) {\n  e.preventDefault();\n  Mailpile.UI.Sidebar.OrganizeToggle(this);\n});\n\n\n$(document).on('click', '.sidebar-tag-archive', function(e) {\n  e.preventDefault();\n  Mailpile.UI.Sidebar.TagArchive();\n});\n\n\n$(document).on('click', '#button-sidebar-add', function(e) {\n  e.preventDefault();\n  Mailpile.UI.Modals.TagAdd({ location: 'sidebar' });\n});\n\n\n$(document).on('click', '#button-modal-add-tag', function(e) {\n  e.preventDefault();\n  Mailpile.UI.Modals.TagAddProcess($(this).data('location'));\n});\n\n\n$(document).on('click', '.hide-donate-page', function(e) {\n  Mailpile.API.settings_set_post({ 'web.donate_visibility': 'False' }, function(e) {\n    Mailpile.go('/in/inbox/');\n  });\n});\n\n\n$(document).on('click', 'span.checkbox, div.checkbox', function(e) {\n  $(this).prev().trigger('click');\n});\n\n\n$(document).on('click', 'a.show-hide, a.do-show', function(e) {\n  var $elem = $(this);\n  if ($elem.data('done') == 'show') {\n    $($elem.data('hide')).slideDown();\n    $($elem.data('show')).slideUp();\n    if ($elem.hasClass('show-hide')) {\n      $elem.data('done', 'hide').removeClass('did-show').addClass('did-hide');\n    }\n  }\n  else {\n    $($elem.data('show')).slideDown();\n    $($elem.data('hide')).slideUp();\n    if ($elem.hasClass('show-hide')) {\n      $elem.data('done', 'show').removeClass('did-hide').addClass('did-show');\n    }\n  }\n  if ($elem.data('other')) {\n    var msg = $elem.html();\n    $elem.html($elem.data('other')).data('other', msg);\n  }\n  e.preventDefault();\n});\n\n\n// FIXME: this is in the wrong place\nMailpile.auto_modal = function(params) {\n  var jhtml_url = Mailpile.API.jhtml_url(params.url);\n  if (params.flags) {\n    jhtml_url += ((jhtml_url.indexOf('?') != -1) ? '&' : '?') +\n                  'ui_flags=' + params.flags.replace(' ', '+');\n  }\n  $('#modal-full').modal('hide');\n  return Mailpile.API.with_template('modal-auto', function(modal) {\n    $.ajax({\n      url: jhtml_url,\n      type: params.method,\n      success: function(data) {\n        var mf = Mailpile.UI.show_modal(modal({\n          data: data,\n          icon: params.icon,\n          title: params.title,\n          header: params.header,\n          flags: params.flags\n        }));\n        if (params.reload && !params.callback) {\n          params.callback = function(data) { location.reload(true); };\n        }\n        if (params.callback) {\n          // If there is a callback, we override the form's default behavior\n          // and use AJAX instead so our callback can handle the result.\n          mf.find('form').submit(function(ev) {\n            ev.preventDefault();\n            var url = mf.find('form').attr('action');\n            if ('' != '') url = url.substring(''.length);\n            url = '/api/0' + url;\n            $.ajax({\n              type: \"POST\",\n              url: url,\n              data: mf.find('form').serialize(),\n              // FIXME: Errors are not handled at all here!\n              success: function(data) {\n                mf.modal('hide');\n                return params.callback(data);\n              }\n            });\n            return false;\n          });\n        }\n      }\n    });\n  }, undefined, params.flags, 'Unsafe');\n};\n\n\n$(document).on('click', '.auto-modal', function(e) {\n  var elem = $(this);\n  var title = elem.data('title') || elem.attr('title');\n  Mailpile.auto_modal({\n    url: this.href,\n    method: elem.data('method') || 'GET',\n    title: title,\n    icon: elem.data('icon'),\n    flags: elem.data('flags'),\n    header: elem.data('header'),\n    reload: elem.data('reload') || elem.hasClass('auto-modal-reload')\n  });\n  return false;\n});\n\n\n$(document).on('click', 'a.ok-got-it', function(e) {\n  var $elem = $(this);\n  var cfg_variable = $elem.data('variable');\n  var dom_remove = $elem.data('remove');\n  var cleanup = function() {\n    if (dom_remove) $('.' + dom_remove).remove();\n    $elem.closest('#modal-full').modal('hide');\n  };\n  if (cfg_variable) {\n    var args = {};\n    args[cfg_variable] = false;\n    Mailpile.API.settings_set_post(args, cleanup);\n  }\n  else cleanup();\n  return false;\n});\n\n// Plugin Javascript /========================================================\nMailpile.plugins = {};\nMailpile.plugins.autoajax = (function(){\n/*\n * This code seamlessly upgrades any <a href=...> which would cause a search\n * to happen, to instead trigger an AJAX load.  This should make searches\n * feel almost instantaneous, while allowing us to keep all the template\n * logic in the back-end as Jinja2.\n *\n * FIXME:\n *   - Invoke any logic pertaining to display modes before updating\n *   - Use pushstate to update the browser history and location bar\n */\n\nvar get_now;\nvar clear_selection_state;\nvar can_refresh;\nvar update_using_jhtml;\nvar prepare_new_content;\nvar refresh_from_cache;\n\nvar ajaxable_commands = ['search', 'ls', 'profiles'];\nvar refresh_history = {};\nvar U = Mailpile.API.U;\n\nvar refresh_timer;\nvar backup_refresh_interval = (30 * 1000) + (Math.random() * 2000);\nvar refresh_interval = backup_refresh_interval;\n\n\najaxable_url = function(url) {\n    return (url && ((url.indexOf(U(\"/in/\")) == 0) ||\n                    (url.indexOf(U(\"/browse/\")) == 0) ||\n                    (url.indexOf(U(\"/thread/\")) == 0) ||\n                    (url.indexOf(U(\"/profiles/\")) == 0) ||\n                    (url.indexOf(U(\"/search/\")) == 0)));\n};\n\n_outerHTML = function(elem) {\n    return $('<div />').append(elem.clone()).html();\n};\n\n_scroll_up = function(elem) {\n    setTimeout(function() { $(elem).scrollTop(0); }, 10);\n};\n\nget_now = function() {\n    if (Date.now) return Date.now();\n    return new Date().getTime()\n};\n\nclear_selection_state = function() {\n    // FIXME: Is this sufficient?\n    Mailpile.UI.Selection.select_none();\n};\n\ncan_refresh = function(cid) {\n    // By default we disable all refreshes of the UI if the user is busy\n    // selecting or rearranging or dragging... .\n    // FIXME: Hmm, seems other parts of the app should be able to block\n    //        updates somewhat granularly.\n    // FIXME: Should we just monitor for mouse/keyboard activity and only\n    //        update if user isn't doing anything in particular?\n    return ((Mailpile.ui_in_action < 1) &&\n            ($('.pile-results input[type=checkbox]:checked').length < 1));\n};\n\nautoajax_go = function(url, message, jhtml, noblank) {\n    url = Mailpile.fix_url(url);\n    if (jhtml === undefined) jhtml = ajaxable_url(url);\n    // If we have any composers on the page, save contents\n    // before continuing - whether we're JHTMLing or not!\n    var done = Mailpile.notify_working(message, (noblank) ? 250 : 1500);\n    var scroll_and_done = function(stuff) {\n      done();\n      return _scroll_up(stuff);\n    }\n    Mailpile.Composer.AutosaveAll(0, function() {\n        if (!(jhtml && update_using_jhtml(url, scroll_and_done, done, noblank))) {\n            document.location.href = url;\n        }\n    });\n};\n\nprepare_new_content = function(selector) {\n    $(selector).find('a').each(function(idx, elem) {\n        // FIXME: Should we add some majick to avoid dup click handlers?\n        var url = $(elem).attr('href');\n        var jhtml = ajaxable_url(url);\n        if (url &&\n                (url.indexOf('#') != 0) &&\n                (url.indexOf('mailto:') != 0) &&\n                (elem.target != '_blank') &&\n                (elem.className.indexOf('auto-modal') == -1)) {\n            $(elem).click(function(ev) {\n                // We don't hijack events that spawn new tabs/windows etc.\n                if (!(ev.ctrlKey || ev.altKey || ev.shiftKey)) {\n                    ev.preventDefault();\n                    autoajax_go(url, undefined, jhtml,\n                                $(elem).data('noblank') ? true : false);\n                }\n            });\n        }\n    });\n    var $form = $(selector).find('form#form-search');\n    $form.submit(function(ev) {\n        // We don't hijack events that spawn new tabs/windows etc.\n        if (!(ev.ctrlKey || ev.altKey || ev.shiftKey)) {\n            if (update_using_jhtml(U(\"/search/?\") + $form.serialize(), _scroll_up)) {\n                ev.preventDefault();\n            }\n        }\n    });\n};\nMailpile.UI.content_setup.push(prepare_new_content);\n\nrestore_state = function(ev) {\n    if (ev.state && ev.state.autoajax) {\n        $('#content-view').parent().replaceWith(ev.state.html).show();\n        var $context = $('#content-view');\n        clear_selection_state($context);\n        Mailpile.UI.prepare_new_content($context.parent());\n        Mailpile.render();\n    }\n};\n\nupdate_using_jhtml = function(original_url, callback, error_callback, noblank) {\n    if (ajaxable_url(document.location.pathname)) {\n        var cv = $('#content-view').parent();\n        history.replaceState({autoajax: true, html: _outerHTML(cv)},\n                             document.title);\n        if (!noblank) cv.hide();\n        return $.ajax({\n            url: Mailpile.API.jhtml_url(original_url, 'content'),\n            type: 'GET',\n            success: function(data) {\n                history.pushState({autoajax: true, html: data['result']},\n                                  data['message'], original_url);\n                cv.replaceWith(data['result']).show();\n                clear_selection_state();\n                cv = $('#content-view');\n                Mailpile.UI.prepare_new_content(cv.parent());\n                Mailpile.render();\n                // Work around bugs in drag/drop lib, nuke artefacts\n                $('div.ui-draggable-dragging').remove();\n                // Invoke any callbacks, woo!\n                if (callback) { callback(cv) };\n            },\n            error: function() {\n                if (error_callback) error_callback();\n                cv.show();\n            }\n        });\n    }\n    return false;\n};\n\nrefresh_from_cache = function(cid) {\n    var $inpage = $('.content-'+cid);\n    if ($inpage.length > 0 && ($inpage.closest('#modal-full').length < 1)) {\n        console.log('Updating from cache: ' + cid);\n        refresh_history[cid] = -1; // Avoid thrashing\n        Mailpile.API.cached_get({\n            id: cid,\n            _output: Mailpile.API.jhtml_url($inpage.data('template')\n                                            || 'as.html')\n        }, function(json) {\n             if (json.result) {\n                 var cid = json.state.cache_id;\n                 if (can_refresh(cid)) {\n                     $('.content-'+cid).replaceWith(json.result);\n                     Mailpile.UI.prepare_new_content('.content-'+cid);\n                     refresh_history[cid] = get_now();\n                     // Work around bugs in drag/drop lib, nuke artefacts\n                     $('div.ui-draggable-dragging').remove();\n                 }\n                 else {\n                     // Result discarded, mark as needing a refresh!\n                     console.log('Result discarded, will try again for ' + cid);\n                     refresh_history[cid] = 0;\n                 }\n             }\n             else {\n                 console.log('Failed to load from cache!');\n             }\n        });\n        return true;\n    }\n    else if (refresh_history[cid]) {\n        delete refresh_history[cid];\n    }\n    return false;\n};\n\n$(document).ready(function() {\n    // Set up our onpopstate handler\n    window.onpopstate = restore_state;\n\n    Mailpile.go = autoajax_go;\n\n    // Figure out which elements on the page exist in cache, initialized\n    // our refresh_history timers to match...\n    $('.cached').each(function(i, elem) {\n        var classlist = elem.className.split(/\\s+/);\n        for (var i in classlist) {\n            var cn = classlist[i];\n            if (cn.indexOf('content-') == 0) {\n                var cid = cn.substring(8);\n                refresh_history[cid] = get_now();\n                console.log('refresh_history['+cid+'] = ' + refresh_history[cid]);\n            }\n        }\n    });\n\n    // Subscribe to the event-log, to freshen up UI elements as soon as\n    // possible.\n    EventLog.subscribe('.command_cache.CommandCache', function(ev) {\n        var now = get_now();\n        for (var cidx in ev.data.cache_ids) {\n            var cid = ev.data.cache_ids[cidx];\n            refresh_history[cid] = 0; // Mark as needing a refresh!\n            console.log('Eventlog reports new data for ' + cid);\n            // If the event log is reporting things actively, lower the\n            // force-refresh interval as it's probably not needed.\n            if (refresh_interval < 120000) {\n                refresh_interval += 1000 * Math.random();\n            }\n        }\n    });\n\n    // As a backup, attempt to refresh all UI elements periodically\n    refresh_timer = $.timer(function() {\n        var now = get_now();\n        for (var cid in refresh_history) {\n            if ((refresh_history[cid] >= 0) &&\n                    (refresh_history[cid] < now - refresh_interval)) {\n                if (can_refresh(cid)) {\n                    refresh_from_cache(cid);\n                    return;\n                }\n            }\n        }\n        // If we get this far, nothing was refreshed, might need to\n        // force things.\n        if (refresh_interval > backup_refresh_interval) {\n            refresh_interval -= 1000 * Math.random();\n        }\n    });\n    refresh_timer.set({ time: 750, autostart: true });\n});\n\nreturn {\n    'timer': refresh_timer,\n    'history': refresh_history,\n    'update_using_jhtml': update_using_jhtml,\n    'refresh_from_cache': refresh_from_cache,\n    'prepare_new_content': prepare_new_content\n}\n\n})(); // End of Mailpile.plugins.autoajax /----------- ---- --- -- -\n\nMailpile.plugins.datadig = (function(){\nvar disabled = false;\n\nfunction preview() {\n  if (disabled) return false;\n  $('#modal-full .datadig-hints').hide();\n  $('#modal-full #datadig-preview').hide();\n  $('#modal-full .datadig-working').show();\n  $('#modal-full .datadig-preview-area').show();\n  Mailpile.API.datadig_get({\n    _output: 'as.jhtml!minimal',\n    _serialized: $('#modal-full .datadig-form').serialize() + '&timeout=3'\n  }, function(data) {\n    $('#modal-full .datadig-working').hide();\n    $('#modal-full #datadig-preview').html(data['result']).fadeIn();\n  });\n  return false;\n}\n\nvar column_html = '';\nfunction add_column() {\n  if (disabled) return false;\n  $('#modal-full .datadig-data-terms').append($(column_html));\n  $('#modal-full .datadig-data-terms input').last().focus();\n  return false;\n}\n\nfunction set_column_from_hint(i, elem) {\n  if (disabled) return false;\n  var cspec = $(this).find('.datadig-cspec').html();\n  $('#modal-full .datadig-columns input').last().attr('value', cspec);\n}\n\nfunction show_hints() {\n  if (disabled) return false;\n  $('#modal-full .datadig-hints').show();\n  $('#modal-full .datadig-preview-area').hide();\n}\n\nfunction download() {\n  if (disabled) return false;\n  disabled = true;\n\n  // Add hidden form-field for tracking progress\n  var track_id = '@' + (new Date()).getTime();\n  var input = $('<input class=\"datadig-track-id\" type=\"hidden\" name=\"track-id\" value=\"' + track_id + '\">');\n  mf.find('.datadig-track-id').remove();\n  mf.find('.datadig-form').append(input);\n\n  // Add form-field for search context\n  var input = $('<input class=\"datadig-search-context\" type=\"hidden\" name=\"context\" value=\"' + $('#search-query').data('context') + '\">');\n  mf.find('.datadig-search-context').remove();\n  mf.find('.datadig-form').append(input);\n\n  // Change state of UI...\n  $('#modal-full .datadig-hints').hide();\n  $('#modal-full #datadig-preview').hide();\n  $('#modal-full .datadig-working').show();\n  $('#modal-full .datadig-downloading').show();\n  $('#modal-full .datadig-preview-area').show();\n  $('#modal-full .modal-footer').css('opacity', 0.5);\n\n  // This changes the state of the modal to show the progress of our\n  // data extraction, by temporarily subscribing to the EventLog.\n  var ev_source = '.*datadig.dataDigCommand';\n  var watch_id = EventLog.subscribe(ev_source, function(ev) {\n    if (ev.private_data['track-id'] == track_id) {\n      if (ev.flags == \"c\") {\n        // Completed! Revert UI back to normal, unsubscribe from events\n        disabled = false;\n        $('#modal-full .datadig-hints').show();\n        $('#modal-full .datadig-working').hide();\n        $('#modal-full .datadig-downloading').hide();\n        $('#modal-full .datadig-preview-area').hide();\n        $('#modal-full .modal-footer').css('opacity', 1.0);\n        EventLog.unsubscribe(ev_source, watch_id);\n      }\n      else {\n        // Otherwise, report progress!\n        $('#modal-full #datadig-downloading-progress').html(\n          ev.private_data.progress + ' / ' + ev.private_data.total\n        );\n      }\n    }\n  });\n}\n\n// Display the datadig widget!\n$(document).on('click', '.bulk-action-datadig', function() {\n  var $context = $(this);\n  Mailpile.API.with_template('datadig-modal', function(modal) {\n    mf = $('#modal-full').html(modal({\n      context: $('#search-query').data('context')\n    }));\n\n    // Extract our data-term template\n    column_html = mf.find('.datadig-data-term').html();\n\n    // Add hidden form-fields for all the message metadata-IDs\n    $.each(Mailpile.UI.Selection.selected($context), function(key, mid) {\n      var input = $('<input type=\"hidden\" name=\"mid\" value=\"' + mid + '\">');\n      mf.find('.datadig-form').append(input);\n    });\n\n    // Make the hints clickable\n    mf.find('.datadig-hints .datadig-hint').click(set_column_from_hint);\n\n    disabled = false;\n    mf.modal(Mailpile.UI.ModalOptions);\n    mf.find('.datadig-data-terms input').last().focus();\n  });\n});\n\n// Expose these methods as Mailpile.plugins.datadig.*\nreturn {\n  'preview': preview,\n  'show_hints': show_hints,\n  'add_column': add_column,\n  'download': download\n}\n\n})(); // End of Mailpile.plugins.datadig /----------- ---- --- -- -\n\n\n// EOF"},"http://localhost:33411/api/0/jsapi/app.js?ts=1.0.0rc0-1519924545":{"mimeType":"text/javascript","source":"/* JS - Crypto */\n/* Crypto */\n\nMailpile.Crypto = {};\nMailpile.Crypto.Find = {};\nMailpile.Crypto.Import = {};\nMailpile.Crypto.Tooltips = {};/* Crypto - Events */\n\n$(document).on('click', '.btn-crypto-search-key', function(e) {\n  e.preventDefault();\n  Mailpile.UI.Modals.CryptoFindKeys({ query: '' });\n});\n\n\n$(document).on('click', '.btn-crypto-upload-key', function(e) {\n  e.preventDefault();\n  Mailpile.UI.Modals.CryptoUploadKey({});\n});\n\n\n/* Crypto - show / hide details */\n$(document).on('click', '.searchkey-result-score', function(e) {\n  var fingerprint = $(this).data('fingerprint');\n  var $details = $('#item-encryption-key-' + fingerprint\n                   ).find('.searchkey-result-details');\n  if ($details.css('display') == 'none') {\n    $details.fadeIn();\n  }\n  else {\n    $details.fadeOut();\n  }\n});\n\n\n$(document).on('submit', '#form-search-keyservers', function(e) {\n  e.preventDefault();\n  \n  // Hide Form\n  $('#form-search-keyservers').removeClass('fadeIn').addClass('hide');\n\n  // Query\n  var query = $(this).find('input[type=text]').val();\n  Mailpile.Crypto.Find.Keys({\n    container: '#search-keyservers',\n    action: 'hide-modal',\n    query: query,\n    complete: function() {\n      $('#search-keyservers-again').removeClass('hide').addClass('fadeIn');      \n    }\n  });\n});\n\n\n$(document).on('click', '#btn-search-keyservers-again', function(e) {\n  e.preventDefault();\n  $('#search-keyservers-again').removeClass('fadeIn').addClass('hide');\n  $('#search-keyservers').fadeOut().find('ul.result').html('');\n  $('#form-search-keyservers').removeClass('hide').addClass('fadeIn')\n    .find('input[type=text]').val('');\n});\n\n\n$(document).on('click', '.crypto-show-hidden-keys', function(e) {\n  e.preventDefault();\n  $(this).parent().fadeOut().remove();\n  $('#search-keyservers').find('ul.result-hidden-keys').removeClass('hide');\n});\n\n\n/* Crypto - import key */\n$(document).on('click', '.crypto-key-import', function(e) {\n  e.preventDefault();\n  Mailpile.Crypto.Import.Key({\n    action: $(this).data('action'),\n    fingerprint: $(this).data('fingerprint')\n  });\n});\n\n\n/* Crypto - key use */\n$(document).on('change', '.crypto-key-policy', function() {\n  \n  alert('Change Key Policy to: ' + $(this).val() + ' for fingerprint: ' + $(this).data('fingerprint'));\n\n});\n\n\n/* Crypto - looks up keys based on a given email address */\n$(document).on('click', '.crypto-searchkey-address', function(e) {\n  e.preventDefault();\n  var address = $(this).data('address');\n  var target = $(this).data('target');  \n});\n/* Crypto - Find */\n\n\nMailpile.Crypto.Find.KeysResult = function(data, options) {\n\n  var items_hidden = '';\n\n  _.each(data.result, function(key) {\n\n    if (!$('#item-encryption-key-' + key.fingerprint).length) {\n\n      // Loop through UIDs for match to Query\n      var uid = _.findWhere(key.uids, {email: options.query});\n      var avatar   = '/static/img/avatar-default.png';\n\n      // Try to find Avatar\n      if (uid) {\n        var contact  = _.findWhere(key.vcards, {address: uid.email});\n        if (contact) {\n          if (contact.photo) {\n            avatar = contact.photo;\n          }\n        }\n      } else {\n\n        // UID Featured Item\n        var uid = {\n          name: 'No Name',\n          email: 'No Email'\n        };\n\n        if (key.uids[0].name) {\n          uid.name = key.uids[0].name;\n        }\n        if (key.uids[0].email) {\n          uid.email = key.uids[0].email;\n        }\n        if (key.uids[0].comment) {\n          uid.comment = key.uids[0].comment;\n        }\n      }\n\n      // Key Score\n      var score_color = Mailpile.UI.Crypto.ScoreColor(key.score_stars);\n\n      // Show View\n      var item_data = _.extend({ score_color: score_color,\n                                 avatar: avatar,\n                                 uid: uid,\n                                 address: options.query,\n                                 action: options.action }, key);\n      var item_template = Mailpile.safe_template($('#template-crypto-encryption-key').html());\n      var item_html = item_template(item_data);\n\n      // Only show results with positive score (hide others)\n      if (key.score_stars > 0) {\n        $(options.container).find('.result').append(item_html);\n      } else {\n        $(options.container).find('.result-hidden-keys').append(item_html);\n      }\n\n      // Set Lookup State (data model)\n      var key_data = {fingerprints: key.fingerprint,\n                      address: options.query,\n                      origins: key.origins };\n      Mailpile.crypto_keylookup.push(key_data);\n    }\n  });\n\n  var $container = $(options.container);\n  if ($container.find('.result-hidden-keys li').length > 0) {\n    $container.find('.result')\n              .append($('#template-search-keyserver-show-hidden').html());\n  }\n\n  // Tooltips\n  Mailpile.Crypto.Tooltips.KeyScore();\n};\n\n\nMailpile.Crypto.Find.KeysDone = function(options) {\n  var status = 'none';\n  var $container = $(options.container);\n  $container.find('.loading').fadeOut();\n\n  // FIXME: doesn't work for 2nd and third lookups returning empty results\n  if (!Mailpile.crypto_keylookup.length) {\n    var message_template = Mailpile.safe_template($('#template-find-keys-none').html());\n    var message_html = message_template(options);\n    $container.find('.message')\n      .html(message_html)\n      .removeClass('paragraph-important paragraph-success')\n      .addClass('paragraph-alert');\n  }\n  else {\n    status = 'success';\n    $(options.container).find('.message')\n      .removeClass('paragraph-important paragraph-alert')\n      .addClass('paragraph-success');\n  }\n\n  if (options.searched) options.searched(status);\n};\n\n\nMailpile.Crypto.Find.KeysError = function(options) {\n  var $container = $(options.container);\n  $container.find('.loading').fadeOut();\n  setTimeout(function() {\n    var message_template = Mailpile.safe_template($('#template-find-keys-error').html());\n    var message_html = message_template(options);\n    $container.find('.message')\n      .html(message_html)\n      .removeClass('paragraph-success paragraph-important paragraph-alert')\n      .addClass('paragraph-warning');\n    if (options.error) options.error();\n  }, 250);\n};\n\n\n/**\n * Performs a lookup for encryption keys and renders UI elements\n * @param {string} options.container - container element of all UI elements\n * @param {string} options.action -  \n * @param {string} options.query - the term to lookup\n * @param {function} options.complete \n */\nMailpile.Crypto.Find.Keys = function(options) {\n\n  var $container = $(options.container);\n  if ($container.hasClass('hide')) $container.fadeIn();\n\n  // Register events on the container so it is possible to invoke them\n  // using $(this).closest('.has-keylookup-events').trigger('foo');\n  $container.addClass('has-keylookup-events');\n  if (options.imported) $container.on('keylookup:imported', options.imported);\n  if (options.searched) $container.on('keylookup:searched', options.searched);\n  if (options.error) $container.on('keylookup:error', options.error);\n\n  var args = {}\n  args[(options.strict ? \"email\" : \"address\")] = options.query;\n  Mailpile.API.async_crypto_keylookup_get(args, function(data, ev) {\n\n    // Render each result found\n    if (data.result) Mailpile.Crypto.Find.KeysResult(data, options);\n\n    // Report progress...\n    if (ev.flags != 'c') {\n      if (data.result && data.message) {\n        $(options.container).find('.message')\n          .html('<span class=\"icon-key\"></span> ' + data.message)\n          .removeClass('paragraph-success paragraph-alert')\n          .addClass('paragraph-important');\n      }\n      else {\n        var searching_template = Mailpile.safe_template($('#template-find-keys-running').html());\n        var searching_html     = searching_template(options);\n        $(options.container).find('.message').html(searching_html);\n      }\n    }\n    // FIXME: Detecting errors does not work well, the backend needs to\n    //        report better here.\n    else if (data.result !== undefined) {\n      console.log('Search done, no error');\n      Mailpile.Crypto.Find.KeysDone(options);\n    }\n    else {\n      console.log('Search done, error state');\n      Mailpile.Crypto.Find.KeysError(options);\n    }\n  });\n};/* Crypto - Import */\n\n\nMailpile.Crypto.Import.Key = function(import_data) {\n  // Set Null\n  if (import_data.file === undefined) import_data.file = false;\n\n  // Show Processing UI feedback\n  var importing_template = Mailpile.safe_template($('#template-crypto-encryption-key-importing').html());\n  var importing_html     = importing_template(import_data);\n  $('#item-encryption-key-' + import_data.fingerprint).replaceWith(importing_html);\n\n  // Lookup\n  var key_data = _.findWhere(Mailpile.crypto_keylookup,\n                             {fingerprints: import_data.fingerprint});\n\n  Mailpile.API.crypto_keyimport_post(key_data, function(result) {\n    if (result.status === 'success') {\n      var key_result;\n      for (var key in result.result) {\n        if (result.result[key].fingerprint === import_data.fingerprint) {\n          key_result = result.result[key];\n          key_result['avatar'] = '/static/img/avatar-default.png';\n          key_result['uid'] = key_result.uids[0];\n          key_result['action'] = 'hide-modal';\n          key_result['on_keychain'] = true;\n          key_result['score_color'] = Mailpile.UI.Crypto.ScoreColor(key.score_stars);\n        }\n      }\n\n      console.log(key_result);\n      if (key_result) {\n        var key_template = Mailpile.safe_template($('#template-crypto-encryption-key').html());\n        var key_html = key_template(key_result);\n\n        var $key_elem = $('#item-encryption-key-' + import_data.fingerprint);\n        var $events = $key_elem.closest('.has-keylookup-events');\n\n        $key_elem.replaceWith(key_html);\n        $events.trigger('keylookup:imported');\n      }\n    }\n  });\n};\n\n\nMailpile.Crypto.Import.Uploader = function() {\n\n  var uploader = new plupload.Uploader({\n  \truntimes : 'html5',\n  \tbrowse_button : 'upload-key-pick', // you can pass in id...\n  \tcontainer: 'upload-key-container', // ... or DOM Element itself\n    drop_element: 'upload-key-container',\n  \turl : '/api/0/crypto/gpg/importkey/',\n//    multipart : true,\n//    multipart_params : {'key_file': 'upload'},\n    file_data_name : 'key_data',\n  \tfilters : {\n  \t\tmax_file_size : '5mb'\n  \t},\n  \tinit: {\n      PostInit: function() {\n        $('#upload-key-pick').removeClass('hide');\n        $('#upload-key-browswer-unsupported').addClass('hide');\n        uploader.refresh();\n      },\n      FilesAdded: function(up, files) {\n  \n        // Hide Message (in case)\n        $('#upload-key-container').find('p.message').fadeOut();\n        $('#form-upload-key').addClass('hide');\n\n        // Loop through added files\n      \tplupload.each(files, function(file) {\n  \n          // Show Warning for 50 mb or larger\n          if (file.size > 52428800) {\n            start_upload = false;\n            alert(file.name + ' is too large: ' + plupload.formatSize(file.size) + '. You can not upload a key larger than 5 Megabytes.');\n          } else {\n\n            var importing_template = Mailpile.safe_template($('#template-crypto-encryption-key-importing').html());\n            var importing_html = importing_template({fingerprint: 'UPLOADING', file: file });            \n            $('#upload-key-list').removeClass('hide').html(importing_html);\n            $('#form-upload-key').addClass('hide');\n\n            // Start (with slight delay)\n            setTimeout(function() {\n              uploader.start();\n            }, 500);\n          }\n      \t});\n      },\n      UploadProgress: function(up, file) {\n      \t$('#item-encryption-key-UPLOADING').find('em.text-detail').html('Uploading ' + file.name + ' ' + file.percent + '% complete');\n      },\n      FileUploaded: function(up, file, response) {\n\n        // Delay UI feedback (for local installs)\n        setTimeout(function() {\n          if (response.status === 200) {\n            var response_data = $.parseJSON(response.response);\n\n            // Show UI feedback\n            if (response_data.status === 'success') {\n              $('#item-encryption-key-UPLOADING').html('Yay. Encrypted Key Successfully Uploaded. Someday this will look nicer :)');\n            } else {\n              $('#upload-key-container').find('p.message').fadeIn();\n              $('#item-encryption-key-UPLOADING').fadeOut().remove();\n              $('#form-upload-key').fadeIn().removeClass('hide');\n            }\n          } else {\n            Mailpile.notification({status: 'error', message: 'Could not upload encryption key. Status:: ' + response.status });\n          }\n        }, 1000);\n      },\n      Error: function(up, err) {\n        Mailpile.notification({status: 'error', message: 'Could not upload encryption key because: ' + err.message });\n        $('#' + err.file.id).find('b').html('Failed ' + err.code);\n        uploader.refresh();\n      }\n    }\n  });\n\n  return uploader.init();\n\n};\n\n\nMailpile.Crypto.Import.UploaderProcessing = function() {\n\n    \n\n};\n\nMailpile.Crypto.Import.UploaderComplete = function(key) {\n\n};/* Modals - Crypto */\n\n/* Modals - Crypto - try to find keys locally & remotely */\nMailpile.UI.Modals.CryptoFindKeys = function(options) {\n  options.container = '#search-keyservers';\n  options.action = 'hide-modal';\n  options.searched = function() {\n    $('#search-keyservers').find('.loading').slideUp('fast');\n  };\n\n  Mailpile.API.with_template('modal-search-keyservers', function(modal) {\n    Mailpile.UI.show_modal(modal(options));\n    if (options.query) {\n      Mailpile.Crypto.Find.Keys(options);\n    } else {\n      $('#form-search-keyservers').removeClass('hide').addClass('fadeIn');\n      $('#form-search-keyservers').find('input[name=query]').focus();\n    }\n  });\n};\n\nMailpile.UI.Modals.CryptoUploadKey = function(options) {\n  Mailpile.API.with_template('modal-upload-key', function(modal) {\n    Mailpile.UI.show_modal(modal(options));\n    Mailpile.Crypto.Import.Uploader();\n  });\n};/* Crypto - Tooltips */\n\nMailpile.Crypto.Tooltips.KeyScore = function() {\n  $('.searchkey-result-score').qtip({\n    content: {\n      title: false,\n      text: function(event, api) {\n        return $(this).data('score_reason') + '<small>Click For Details</small>';\n      }\n    },\n    style: {\n      classes: 'qtip-tipped',\n      tip: {\n        corner: 'left middle',\n        mimic: 'left middle',\n        border: 0,\n        width: 10,\n        height: 10\n      }\n    },\n    position: {\n      my: 'left center',\n      at: 'right center',\n\t\t\tviewport: $(window),\n\t\t\tadjust: {\n\t\t\t\tx: 5,  y: 2\n\t\t\t}\n    },\n    show: {\n      event: 'mouseenter',\n      delay: 0\n    },\n    hide: {\n      event: 'click',\n      inactive: 2000\n    }\n  });\n};/* Crypto - UI */\n\nMailpile.UI.Crypto.ScoreColor = function(score) {\n\n  var score_color = 'color-01-gray-mid';\n\n  if (score >= 5) {\n    score_color = 'color-08-green';\n  } else if (score < 5 && score > 2) {\n    score_color = 'color-06-blue';\n  } else if (score <= 2 && score >= 0) {\n    score_color = 'color-09-yellow';\n  } else if (score < 2 && score > -3) {\n    score_color = 'color-10-orange';\n  } else if (score < -3) {\n    score_color = 'color-12-red';\n  }\n\n  return score_color;\n}\n/* JS - Compose */\n/* Composer */\nMailpile.Composer = {};\nMailpile.Composer.Drafts = {};\nMailpile.Composer.Crypto = {};\nMailpile.Composer.Recipients = {};\nMailpile.Composer.Tooltips = {};\nMailpile.Composer.Body = {};\nMailpile.Composer.Attachments = {};\n\n/* Composer - Create new instance of composer */\nMailpile.Composer.init = function(mid, strings, addresses) {\n\n  // Reset tabindex for To: field\n  $('#search-query').attr('tabindex', '-1');\n\n  // Save Text Composing Objects (move to data model)\n  //\n  // FIXME: This is a bad pattern; here we're about to duplicate in JS\n  //        land information that comes from the DOM. Duplication is bad.\n  //\n  Mailpile.Composer.Drafts[mid] = Mailpile.Composer.Model(strings, addresses);\n\n  // Load Crypto States\n  // FIXME: needs dynamic support for multi composers on a page\n  Mailpile.Composer.Crypto.LoadStates(mid);\n\n  // Initialize select2\n  Mailpile.Composer.Recipients.AddressField('compose-to-' + mid);\n\n  if ($('#compose-cc-' + mid).val()) {\n    Mailpile.Composer.Recipients.AddressField('compose-cc-' + mid);\n  }\n\n  if ($('#compose-bcc-' + mid).val()) {\n    Mailpile.Composer.Recipients.AddressField('compose-bcc-' + mid);\n  }\n\n  // Show Crypto Tooltips\n  Mailpile.Composer.Crypto.UpdateEncryptionState(mid, function() {\n    Mailpile.Composer.Tooltips.Signature();\n    Mailpile.Composer.Tooltips.Encryption();\n    Mailpile.Composer.Tooltips.ContactDetails();\n  });\n\n  // Initialize Attachments; use setTimeout to isolate faults.\n  setTimeout(function() {\n    // FIXME: needs to be bound to unique ID that can be destroyed\n    Mailpile.Composer.Attachments.Uploader({\n      browse_button: 'compose-attachment-pick-' + mid,\n      container: 'compose-attachments-' + mid,\n      mid: mid\n    });\n  }, 100);\n\n  // Body\n  Mailpile.Composer.Body.Setup(mid);\n};/* Composer - Crypto */\n\nMailpile.Composer.Crypto.UpdateEncryptionState = function(mid, chain) {\n  // Assemble all the recipient addresses, as well as our sending address\n  var emails = [$('#compose-from-selected-' + mid).find('.address').html()];\n  Mailpile.Composer.Recipients.GetAll(mid, function(rcpt) {\n    emails.push(rcpt.address);\n  });\n  // Ask the back-end for updated address-book info and an aggregate\n  // recommended crypto policy.\n  Mailpile.API.crypto_policy_get({email: emails}, function(response) {\n    var r = response.result;\n\n    // Update attach key (or not) state\n    if (r['can-sign']) {\n      $('.compose-attach-key').show();\n    }\n    else {\n      $('.compose-attach-key').hide();\n    }\n    $('#compose-attach-key-' + mid).prop('checked',\n                                         r['can-sign'] && r['send-keys']);\n    Mailpile.Composer.Crypto.AttachKey(mid);\n\n    // Record our capabilities: can we encrypt? Sign?\n    $('#compose-crypto-encryption-' + mid).data('can', r['can-encrypt']);\n    $('#compose-crypto-signature-' + mid).data('can', r['can-sign']);\n    if (emails.length > 1) {\n      // Update encrypt/sign icons\n      Mailpile.Composer.Crypto.LoadStates(mid, r['crypto-policy'],\n                                               r['reason']);\n\n      // Embellish our recipients with data from the backend; in particular\n      // this adds the keys and avatars to things manually typed.\n      Mailpile.Composer.Recipients.WithToCcBcc(mid, function(field, rcpts) {\n        var changed = false;\n        for (var i in rcpts) {\n          var updated = r.addresses[rcpts[i].address];\n          if (updated) {\n            if (rcpts[i].fn.indexOf(' ') < 0) rcpts[i].fn = updated.fn;\n            rcpts[i].keys = updated.keys;\n            rcpts[i].flags = updated.flags;\n            rcpts[i].photo = updated.photo;\n            changed = true;\n          }\n        };\n        if (changed) Mailpile.Composer.Recipients.Update(mid, field, rcpts);\n      });\n    }\n    else {\n      Mailpile.Composer.Crypto.LoadStates(mid, 'none', '');\n    }\n    if (chain) chain(mid);\n  });\n};\n\n\nMailpile.Composer.Crypto.Unencryptables = function(mid) {\n  var unencryptable = [];\n  Mailpile.Composer.Recipients.GetAll(mid, function(rcpt) {\n    if (!rcpt.flags.secure) unencryptable.push(rcpt);\n  });\n  return unencryptable;\n};\n\n\nMailpile.Composer.Crypto.LoadStates = function(mid, state, reason) {\n  state = state || $('#compose-crypto-' + mid).val();\n\n  var signature = 'none';\n  if (state.match(/sign/)) {\n    signature = 'sign';\n  }\n  Mailpile.Composer.Crypto.SignatureToggle(signature, mid);\n\n  var encryption = 'none';\n  if (state.match(/encrypt/)) {\n    encryption = 'encrypt';\n  }\n  Mailpile.Composer.Crypto.EncryptionToggle(encryption, mid);\n\n  // FIXME: We need to know if encryption or signing is REQUIRED, and\n  // disable or enable the send button based on that. The conflict state\n  // doesn't cover for when the user does illegal things manually.\n  $('#form-compose-' + mid + ' button[name=send]')\n    .data('crypto-state', state || '')\n    .data('crypto-reason', reason || '')\n    .attr('title', reason || '')\n    .css({ 'opacity': (state.match(/conflict/)) ? 0.25 : 1.0 });\n};\n\n\n/* Compose - Set crypto state of message */\nMailpile.Composer.Crypto.SetState = function(mid) {\n  \n  // Returns: none, openpgp-sign, openpgp-encrypt and openpgp-sign-encrypt\n  var state = 'none';\n  var signature = $('#compose-signature-' + mid).val();\n  var encryption = $('#compose-encryption-' + mid).val();\n\n  if (signature == 'sign' && encryption == 'encrypt') {\n    state = 'openpgp-sign-encrypt'; \n  }\n  else if (signature == 'sign') {\n    state = 'openpgp-sign';\n  }\n  else if (encryption == 'encrypt') {\n    state = 'openpgp-encrypt';\n  }\n  else {\n    state = 'none';\n  }\n\n  $('#compose-crypto-' + mid).val(state);\n  return state;\n};\n\n\n/* Compose - Render crypto \"signature\" of a message */\nMailpile.Composer.Crypto.SignatureToggle = function(status, mid, manual) {\n  if ($('#compose-crypto-signature-' + mid).data('can') === false) {\n    status = (status == 'cannot') ? status : 'none';\n  }\n  if (status === 'sign') {\n    $('#compose-crypto-signature-' + mid).data('crypto_color', 'crypto-color-green');\n    $('#compose-crypto-signature-' + mid).attr('title', 'This message will be verifiable to recipients who have your encryption key. They will know it actually came from you :)');\n    $('#compose-crypto-signature-' + mid).find('span.icon').removeClass('icon-signature-none').addClass('icon-signature-verified');\n    $('#compose-crypto-signature-' + mid).find('span.text').html('Signed');\n    $('#compose-crypto-signature-' + mid).removeClass('none').addClass('signed bounce');\n\n  } else if (status === 'none') {\n    $('#compose-crypto-signature-' + mid).data('crypto_color', 'crypto-color-gray');\n    $('#compose-crypto-signature-' + mid).attr('title', 'This message will not be verifiable, recipients will have no way of knowing it actually came from you.');\n    $('#compose-crypto-signature-' + mid).find('span.icon').removeClass('icon-signature-verified').addClass('icon-signature-none');\n    $('#compose-crypto-signature-' + mid).find('span.text').html('Unsigned');\n    $('#compose-crypto-signature-' + mid).removeClass('signed').addClass('none bounce');\n\n  } else {\n    $('#compose-crypto-signature-' + mid).data('crypto_color', 'crypto-color-red');\n    $('#compose-crypto-signature-' + mid).attr('title', 'Verification Error');\n    $('#compose-crypto-signature-' + mid).find('span.icon').removeClass('icon-signature-none icon-signature-verified').addClass('icon-signature-error');\n    $('#compose-crypto-signature-' + mid).find('span.text').html('Error accessing your encryption key');\n    $('#compose-crypto-signature-' + mid).removeClass('none').addClass('error bounce');\n  }\n\n    // Set Form Value\n  if ($('#compose-signature-' + mid).val() !== status) {\n    $('#compose-crypto-signature-' + mid).addClass('bounce');\n    $('#compose-signature-' + mid).val(status);\n\n    // Remove Animation\n    setTimeout(function() {\n      $('#compose-crypto-signature-' + mid).removeClass('bounce');\n    }, 1000);\n\n    Mailpile.Composer.Crypto.SetState(mid);\n  }\n};\n\n\n/* Compose - Render crypto \"encryption\" of a message */\nMailpile.Composer.Crypto.EncryptionToggle = function(status, mid, manual) {\n  var encryption = $('#compose-encryption-' + mid).val();\n  var can = $('#compose-crypto-encryption-' + mid).data('can');\n  if (!manual && (status === 'none') && (encryption === 'encrypt') && !can) {\n    // If we were encrypting, but as a side-effect are no longer capable of\n    // doing so, then we go to the \"cannot\" state instead of \"none\".\n    status = 'cannot';\n  }\n  else if (!can) {\n    status = (status == 'cannot') ? status : 'none';\n  }\n\n  if (status === 'encrypt') {\n    $('#compose-crypto-encryption-' + mid).data('crypto_color', 'crypto-color-green');\n    $('#compose-crypto-encryption-' + mid).attr('title', 'This message and attachments will be encrypted. The recipients &amp; subject (metadata) will not');\n    $('#compose-crypto-encryption-' + mid).find('span.icon').removeClass('icon-lock-open').addClass('icon-lock-closed');\n    $('#compose-crypto-encryption-' + mid).find('span.text').html('Encrypted');\n    $('#compose-crypto-encryption-' + mid).removeClass('none error cannot').addClass('encrypted');\n\n  } else if (status === 'cannot') {\n    $('#compose-crypto-encryption-' + mid).data('crypto_color', 'crypto-color-orange');\n    $('#compose-crypto-encryption-' + mid).attr('title', 'This message cannot be encrypted because you do not have keys for one or more recipients');\n    $('#compose-crypto-encryption-' + mid).find('span.icon').removeClass('icon-lock-closed').addClass('icon-lock-open');\n    $('#compose-crypto-encryption-' + mid).find('span.text').html('Can Not Encrypt');\n    $('#compose-crypto-encryption-' + mid).removeClass('none encrypted error').addClass('cannot');\n\n  } else if (status === 'none' || status == '') {\n    $('#compose-crypto-encryption-' + mid).data('crypto_color', 'crypto-color-gray');\n    $('#compose-crypto-encryption-' + mid).attr('title', 'This message and metadata will not be encrypted');\n    $('#compose-crypto-encryption-' + mid).find('span.icon').removeClass('icon-lock-closed').addClass('icon-lock-open');\n    $('#compose-crypto-encryption-' + mid).find('span.text').html('None');\n    $('#compose-crypto-encryption-' + mid).removeClass('encrypted cannot error').addClass('none');\n\n  } else {\n    $('#compose-crypto-encryption-' + mid).data('crypto_color', 'crypto-color-red');\n    $('#compose-crypto-encryption-' + mid).attr('title', 'There was an error prepping this message for encryption');\n    $('#compose-crypto-encryption-' + mid).find('span.icon').removeClass('icon-lock-open icon-lock-closed').addClass('icon-lock-error');\n    $('#compose-crypto-encryption-' + mid).find('span.text').html('Error Encrypting');\n    $('#compose-crypto-encryption-' + mid).removeClass('encrypted cannot none').addClass('error');\n  }\n\n  // Set Form Value\n  if ($('#compose-encryption-' + mid).val() !== status) {\n    $('#compose-crypto-encryption-' + mid).addClass('bounce');\n    $('#compose-encryption-' + mid).val(status);\n\n    // Remove Animation\n    setTimeout(function() {\n      $('#compose-crypto-encryption-' + mid).removeClass('bounce');\n    }, 1000);\n    \n    Mailpile.Composer.Crypto.SetState(mid);\n  }\n};\n\n\nMailpile.Composer.Crypto.AttachKey = function(mid) {\n  var checkbox = $('#compose-attach-key-' + mid);\n  var hiddenak = $('#compose-hidden-attach-key-' + mid);\n  if (checkbox.is(':checked')) {\n    hiddenak.val('yes');\n  } else {\n    hiddenak.val('no');\n  }\n};/* Compose - Autosave */\n\nMailpile.Composer.Autosave = function(mid, form_data, callback) {\n\n  if (Mailpile.Composer.Drafts[mid] === undefined) {\n    Mailpile.Composer.Drafts[mid] = Mailpile.Composer.Model({}, {});\n    Mailpile.Composer.Body.Setup(mid);\n  }\n\n  // Has text changed, or is new?  If so, run autosave.\n  if ($('#compose-text-' + mid).val() != Mailpile.Composer.Drafts[mid].body) {\n\n    // UI Feedback\n    var autosave_msg = $('#compose-message-autosaving-' + mid).data('autosave_msg');\n    $('#compose-message-autosaving-' + mid).html(autosave_msg).fadeIn();\n\n    // Autosave It\n  \t$.ajax({\n  \t\turl\t\t\t : Mailpile.api.compose_save,\n  \t\ttype\t\t : 'POST',\n      timeout  : 15000,\n  \t\tdata     : form_data,\n  \t\tdataType : 'json',\n  \t  success  : function(response) {\n\n        // Update Message (data model)\n        Mailpile.Composer.Drafts[mid].body = $('#compose-text-' + mid).val();\n\n        // Fadeout autosave UI msg\n        setTimeout(function() {\n          $('#compose-message-autosaving-' + mid).fadeOut();\n        }, 2000);\n        callback();\n      },\n      error: function() {\n        var autosave_error_msg = $('#compose-message-autosaving-' + mid).data('autosave_error_msg');\n        $('#compose-message-autosaving-' + mid).html('<span class=\"icon-x\"></span>' + autosave_error_msg).fadeIn();\n        callback();\n      }\n  \t});\n\n  }\n  // Not Autosaving\n  else {\n    callback();\n  }\n};\n\n\nMailpile.Composer.AutosaveAll = function(delay, callback) {\n  var save_chain = [];\n  $('.form-compose').each(function(key, form) {\n    save_chain.push(function(chain) {\n      Mailpile.Composer.Autosave($(form).data('mid'), $(form).serialize(),\n                                 function() {\n        if (chain && chain.length) {\n          var nxt = chain.shift();\n          if (delay) {\n            setTimeout(function() { nxt(chain); }, delay)\n          }\n          else {\n            nxt(chain);\n          }\n        }\n      });\n    });\n  });\n  if (callback) save_chain.push(callback);\n  if (save_chain.length) save_chain.shift()(save_chain);\n}\n\n\n/* Compose Autosave - finds each compose form and performs action */\nMailpile.Composer.AutosaveTimer = $.timer(function() {\n  Mailpile.Composer.AutosaveAll(250);\n});/* Compose - Attachments */\n\nMailpile.Composer.Attachments.UploaderImagePreview = function(attachment, file) {\n\n  // Create an instance of the mOxie Image object. This\n  // utility object provides several means of reading in\n  // and loading image data from various sources.\n  // Wiki: https://github.com/moxiecode/moxie/wiki/Image\n  var preloader = new mOxie.Image();\n\n  // Define the onload BEFORE you execute the load()\n  // command as load() does not execute async.\n  preloader.onload = function() {\n\n    // Scale the image (in memory) before rendering it\n    preloader.downsize(150, 150);\n\n    // Grab preloaded the Base64 encoded image data\n    attachment['attachment_data'] = preloader.getAsDataURL();\n\n    var attachment_image_template = Mailpile.safe_template($('#template-composer-attachment-image').html());\n    var attachment_image_html = attachment_image_template(attachment);\n\n    // Append template to view\n    $('#compose-attachments-files-' + attachment.mid).append(attachment_image_html);\n  };\n\n  // Calling the .getSource() returns instance of mOxie.File\n  // Wiki: https://github.com/moxiecode/plupload/wiki/File\n  preloader.load(file.getSource());\n};\n\n\nMailpile.Composer.Attachments.ExistingImagePreview = function(attachment, file) {\n\n  // Load static preview\n  attachment['attachment_data'] = '/message/download/preview/=' + attachment.mid + '/' + attachment.aid + '/';\n\n  var attachment_image_template = Mailpile.safe_template($('#template-composer-attachment-image').html());\n  var attachment_image_html = attachment_image_template(attachment);\n\n  // Append template to view\n  $('#compose-attachments-files-' + attachment.mid).append(attachment_image_html);\n};\n\n\nMailpile.Composer.Attachments.UpdatePreviews = function(attachments, mid, file) {\n\n  // Loop through attachments\n  _.each(attachments, function(attachment, key) {\n\n    if (!$('#compose-attachment-' + mid + '-' + attachment.aid).length) {\n\n      attachment['previewable'] = _.indexOf(['image/bmp', \n                                      'image/gif',\n                                      'image/jpg',\n                                      'image/jpeg',\n                                      'image/pjpeg',\n                                      'image/x-png',\n                                      'image/png',\n                                      'application/vnd.google-apps.photo'], attachment.mimetype);\n\n      if (file && file.name === attachment.filename) {\n        attachment['is_file'] = true;\n      } else {\n        attachment['is_file'] = false;\n      }\n\n      // More UI friendly values\n      var file_parts = attachment.filename.split('.');\n      var file_parts_length = file_parts.length\n    \n      if (file_parts.length > 2 || attachment.filename.length > 20) {\n        attachment['name_fixed'] = attachment.filename.substring(0, 16);\n      } else {\n        attachment['name_fixed'] = file_parts[0];\n      }\n\n      attachment['mid'] = mid;\n      attachment['size'] = plupload.formatSize(attachment.length);\n      attachment['extension'] = file_parts[file_parts.length - 1];\n\n      // Determine Preview Type (live image, req image, graphic)\n      if (attachment.previewable > -1 && attachment.is_file) {\n        Mailpile.Composer.Attachments.UploaderImagePreview(attachment, file);\n      }\n      else if (attachment.previewable > -1 && !attachment.is_file) {\n        Mailpile.Composer.Attachments.ExistingImagePreview(attachment);\n      }\n      else {\n        var attachment_template = Mailpile.safe_template($('#template-composer-attachment').html());\n        var attachment_html = attachment_template(attachment);\n      \t$('#compose-attachments-files-' + mid).append(attachment_html);\n      }\n    } else {\n      console.log('attachment exists ' + attachment.aid);\n    }\n  });\n};\n\n\nMailpile.Composer.Attachments.Uploader = function(settings) {\n\n  var uploader = new plupload.Uploader({\n  \truntimes : 'html5',\n  \tbrowse_button : settings.browse_button, // you can pass in id...\n  \tcontainer: settings.container, // ... or DOM Element itself\n    drop_element: settings.container,\n  \turl : Mailpile.API.U('/api/0/message/attach/'),\n    multipart : true,\n    multipart_params : {\n      'mid': settings.mid,\n      'csrf': Mailpile.csrf_token\n    },\n    file_data_name : 'file-data',\n  \tfilters : {\n  \t\tmax_file_size : '50mb'\n  \t},\n    resize: {\n      width: '3600',\n      height: '3600',\n      crop: true,\n      quaility: 100\n    },\n    views: {\n      list: true,\n      thumbs: true,\n      active: 'thumbs'\n    },\n  \tinit: {\n      PostInit: function() {\n        $('#compose-attachments-' + settings.mid).find('.compose-attachment-pick').removeClass('hide');\n        $('#compose-attachments-' + settings.mid).find('.attachment-browswer-unsupported').addClass('hide');\n        uploader.refresh();\n      },\n      FilesAdded: function(up, files) {\n  \n        // Loop through added files\n      \tplupload.each(files, function(file) {\n  \n          // Show Warning for 50 mb or larger\n          if (file.size > 52428800) {\n            start_upload = false;\n            alert(file.name + ' is ' + plupload.formatSize(file.size) + '. Some people cannot receive attachments larger than 50 Megabytes.');\n          } else {\n\n            // Start\n            uploader.start();\n          }\n      \t});\n      },\n      UploadProgress: function(up, file) {\n      \t$('#' + file.id).find('b').html('<span>' + file.percent + '%</span>');\n      },\n      FileUploaded: function(up, file, response) {\n\n        if (response.status == 200) {\n\n          var response_json = $.parseJSON(response.response);\n          var new_mid = response_json.result.message_ids[0];\n\n          //console.log(file);\n          Mailpile.Composer.Attachments.UpdatePreviews(response_json.result.data.messages[new_mid].attachments, settings.mid, file);\n\n        } else {\n          Mailpile.notification({status: 'error', message: 'Attachment upload failed status: ' + response.status });\n        }\n      },\n      Error: function(up, err) {\n        Mailpile.notification({status: 'error', message: 'Could not upload attachment because: ' + err.message });\n        $('#' + err.file.id).find('b').html('Failed ' + err.code);\n        uploader.refresh();\n      }\n    }\n  });\n\n  return uploader.init();\n};\n\n\nMailpile.Composer.Attachments.Remove = function(mid, aid) {\n  Mailpile.API.message_unattach_post({ mid: mid, att: aid }, function(result) {\n    if (result.status == 'success') {\n      $('#compose-attachment-' + mid + '-' + aid).fadeOut(function() {\n        $(this).remove();\n        Mailpile.Composer.Attachments.UpdatePreviews(result.result.data.messages[mid].attachments, mid, false);\n      });\n    } else {\n      Mailpile.notification(result);\n    }\n  });\n};/* Composer - Recipients */\n\nMailpile.Composer.Recipients.Get = function(mid, which) {\n  var $elem = $('#compose-' + which + '-' + mid);\n  return Mailpile.Composer.Recipients.Analyze($elem.val());\n};\n\n\nMailpile.Composer.Recipients.WithToCcBcc = function(mid, callback) {\n  var fields = ['to', 'cc', 'bcc'];\n  for (var i in fields) {\n    var rcpts = Mailpile.Composer.Recipients.Get(mid, fields[i]);\n    callback(fields[i], rcpts);\n  }\n};\n\n\nMailpile.Composer.Recipients.GetAll = function(mid, filter) {\n  var recipients = [];\n  Mailpile.Composer.Recipients.WithToCcBcc(mid, function(field, rcpts) {\n    for (var j in rcpts) {\n      recipients.push(filter ? filter(rcpts[j]) : rcpts[j]);\n    }\n  });\n  return recipients;\n};\n\n\nMailpile.Composer.Recipients.AnalyzeAddress = function(address, preset) {\n  /* The Mailpile API guarantees consistent formatting of addresses, so\n     a simple regexp should generally work juuuust fine. However, we also\n     want to handle pasted or typed input. So we try the simple parse first,\n     and then get a bit more creative. */\n  var check = address.match(/^\\s*([^<]*?)\\s*<?([^\\s<>]+@[^\\s<>#]+)(#[a-zA-Z0-9]+)?>?\\s*$/);\n  if (!check) {\n    var check2 = address.match(/^\\s*([^\\s]+)(@[^\\s]+)\\s*$/);\n    if (check2) {\n      check = [check2[0], check2[1], check2[1] + check2[2], false];\n    }\n    else {\n      check = [address, address, address, false];\n    }\n  }\n  var fn = $.trim(check[1] || check[2].substring(0, check[2].indexOf('@')));\n  if (fn.substring(0, 1) == '<') fn = fn.substring(1);\n  var parsed = {\n    \"id\": check[2],\n    \"fn\": fn,\n    \"address\": check[2],\n    \"keys\": [],\n    \"flags\": {\"secure\" : false, \"manual\": !preset}\n  };\n  if (check[3]) {\n    parsed[\"keys\"] = [{\"fingerprint\": check[3].substring(1)}];\n    parsed[\"flags\"] = {\"secure\" : true};\n  };\n  return parsed;\n};\n\n\n/* Composer - tokenize input field (to: cc: bcc:) */\nMailpile.Composer.Recipients.Analyze = function(addresses) {\n  var existing = [];\n\n  // Is Valid & Has Multiple\n  if (addresses) {\n    // We know this simple strategy works, because the backend formats the\n    // address lines in a conisistent way.\n    var multiple = addresses.split(/>, */);\n\n    $.each(multiple, function(key, value) {\n      if (value.indexOf('@') > -1) {\n        if (value.indexOf('<') == -1) value = value + ' <' + value;\n        if (value.indexOf('>') == -1) value = value + '>';\n      }\n      existing.push(Mailpile.Composer.Recipients.AnalyzeAddress(value, true));\n    });\n  }\n  return existing;\n};\n\n\nMailpile.Composer.Recipients.RecipientToAddress = function(object) {\n  if (object.flags.secure) {\n    address = object.address + '#' + object.keys[0].fingerprint;\n  } else {\n    address = object.address;\n  }\n  if (object.fn !== \"\" && object.address !== object.fn) {\n    return object.fn + ' <' + address + '>';\n  } else {\n    return '<' + address + '>';\n  }\n};\n\n\n/* Composer - instance of select2 */\nMailpile.Composer.Recipients.AddressField = function(id) {\n\n  // Get MID\n  var mid = $('#' + id).data('mid');\n\n  $('#' + id).select2({\n    id: Mailpile.Composer.Recipients.RecipientToAddress,\n    ajax: {\n      // instead of writing the function to execute the request we use\n      // Select2's convenient helper\n      url: Mailpile.api.contacts,\n      quietMillis: 1,\n      cache: true,\n      dataType: 'json',\n      data: function(term, page) {\n        return {\n          q: term\n        };\n      },\n      results: function(response, page) {\n        // Convert the results into the format expected by Select2\n        return {\n          results: response.result.addresses\n        };\n      }\n    },\n    multiple: true,\n    allowClear: true,\n    width: '100%',\n    minimumInputLength: 1,\n    minimumResultsForSearch: -1,\n    placeholder: 'Type to add contacts',\n    maximumSelectionSize: 100,\n    tokenSeparators: [\", \", \";\"],\n    createSearchChoice: Mailpile.Composer.Recipients.AnalyzeAddress,\n    formatResult: function(state) {\n      var avatar = '<span class=\"icon-user\"></span>';\n      var secure = '';\n      if (state.photo) {\n        avatar = '<img src=\"' + _.escape(state.photo) + '\">';\n      }\n      if (state.flags.secure) {\n        secure = '<span class=\"icon-lock-closed\"></span>';\n      }\n      return ('<span class=\"compose-select-avatar\">' + avatar + '</span>' +\n              '<span class=\"compose-select-name\">' + \n              _.escape(state.fn) + secure + '<br>' +\n              '<span class=\"compose-select-address\">' + state.address +\n              '</span></span>');\n    },\n    formatSelection: function(state, elem) {\n      // Update Model\n      var found = false;\n      var model = Mailpile.Composer.Drafts[mid];\n      for (i in model.addresses) {\n        var contact_data = model.addresses[i];\n        if (contact_data.address == state.address) {\n          if (state.flags.manual) {\n            state.photo = contact_data.photo;\n            model.addresses[i] = state;\n          }\n          else {\n            state = model.addresses[i];\n          }\n          found = i;\n        }\n      }\n      if (!found) {\n        found = Math.random().toString(16).substring(6);\n        model.addresses[found] = state;\n      }\n\n      // Create HTML\n      var avatar = '<span class=\"avatar icon-user\" data-address=\"' + _.escape(state.address) + '\"></span>';\n      var name   = state.fn;\n      var secure = '';\n\n      if (state.photo) {\n        avatar = '<span class=\"avatar\"><img src=\"' + _.escape(state.photo) + '\" data-address=\"' + state.address + '\"></span>';\n      }\n      if (!state.fn) {\n        name = state.address;\n      }\n      if (state.flags.secure) {\n        secure = '<span class=\"icon-lock-closed\" data-address=\"' + _.escape(state.address) + '\"></span>';\n      }\n\n      return avatar + ' <span class=\"compose-choice-name\" data-address=\"' + _.escape(state.address) + '\">' + _.escape(name) + secure + '</span>';\n    },\n    formatSelectionTooBig: function() {\n      return 'You\\'ve added the maximum contacts allowed, to increase this go to <a href=\"#\">settings</a>';\n    },\n    selectOnBlur: true\n\n  }).on('select2-selecting', function(e) {\n    setTimeout(function() {\n      Mailpile.Composer.Crypto.UpdateEncryptionState(mid);\n      Mailpile.Composer.Tooltips.ContactDetails();\n    }, 50);\n  }).on('select2-removed', function(e) {\n    setTimeout(function() {\n      Mailpile.Composer.Crypto.UpdateEncryptionState(mid);\n    }, 50);\n  });\n\n  /* Check encryption state */\n  $('#'+id).select2('data', Mailpile.Composer.Recipients.Analyze($('#' + id).val()));\n};\n\nMailpile.Composer.Recipients.Update = function(mid, which, rcpts) {\n  var $elem = $('#compose-' + which + '-' + mid);\n  $elem.select2('data', rcpts);\n  Mailpile.Composer.Tooltips.ContactDetails();\n};/* Modals - Composer */\n\nMailpile.UI.Modals.ComposerEncryptionHelper = function(mid, determine) {\n  Mailpile.API.with_template('modal-composer-encryption-helper', function(modal) {\n    determine['mid'] = mid;\n    Mailpile.UI.show_modal(modal(determine));\n  });\n};/* Composer - Tooltips */\n\nMailpile.Composer.Tooltips.Signature = function() {\n  $('.compose-crypto-signature').qtip({\n    content: {\n      title: false,\n      text: function(event, api) {\n        $(this).find('text').removeClass('hide');\n        var html = '<div>\\\n          <h4 class=\"' + $(this).data('crypto_color') + '\">' + $(this).html().replace(' hide', '') + '</h4>\\\n          <p>' + $(this).attr('title') + '</p>\\\n          </div>';\n        return html;\n      }\n    },  \n    style: {\n     tip: {\n        corner: 'bottom center',\n        mimic: 'bottom center',\n        border: 0,\n        width: 10,\n        height: 10\n      },\n      classes: 'qtip-thread-crypto'\n    },\n    position: {\n      my: 'bottom center',\n      at: 'top center',\n\t\t\tviewport: $(window),\n\t\t\tadjust: {\n\t\t\t\tx: -5,  y: 0\n\t\t\t}\n    },\n    events: {\n      show: function(event, api) {}\n    },\n    show: { delay: 100 },\n    hide: { fixed: true, delay: 350 }\n  });\n};\n\n\nMailpile.Composer.Tooltips.Encryption = function() {\n  $('.compose-crypto-encryption').qtip({\n    content: {\n      title: false,\n      text: function(event, api) {\n        var html = '<div>\\\n          <h4 class=\"' + $(this).data('crypto_color') + '\">' + $(this).html().replace(' hide', '') + '</h4>\\\n          <p>' + $(this).attr('title') + '</p>\\\n          </div>';\n        return html;\n      }\n    },\n    style: {\n     tip: {\n        corner: 'bottom center',\n        mimic: 'bottom center',\n        border: 0,\n        width: 10,\n        height: 10\n      },\n      classes: 'qtip-thread-crypto'\n    },\n    position: {\n      my: 'bottom center',\n      at: 'top center',\n\t\t\tviewport: $(window),\n\t\t\tadjust: {\n\t\t\t\tx: -5,  y: 0\n\t\t\t}\n    },\n    events: {\n      show: function(event, api) {\n        // FIXME: Replace colors with dynamic JSAPI values\n        $('.select2-choices').css('border-color', '#fbb03b');\n        $('.compose-from').css('border-color', '#fbb03b');\n        $('.compose-subject input[type=text]').css('border-color', '#fbb03b');\n\n        if ($('#compose-encryption').val() === 'encrypt') {\n          var encrypt_color = '#a2d699';\n        } else {\n          var encrypt_color = '#fbb03b';\n        }\n\n        $('.compose-options-crypto').css('border-color', encrypt_color);\n        $('.compose-body').css('border-color', encrypt_color);\n        $('.compose-attachments').css('border-color', encrypt_color);\n      },\n      hide: function(event, api) {\n        $('.select2-choices').css('border-color', '#CCCCCC');\n        $('.compose-from').css('border-color', '#CCCCCC');\n        $('.compose-subject input[type=text]').css('border-color', '#CCCCCC');\n\n        $('.compose-options-crypto').css('border-color', '#CCCCCC');\n        $('.compose-body').css('border-color', '#CCCCCC');\n        $('.compose-attachments').css('border-color', '#CCCCCC');\n      }\n    },\n    show: { delay: 100 },\n    hide: { fixed: true, delay: 350 }\n  });\n};\n\n\nMailpile.Composer.Tooltips.ContactDetails = function() {\n  $('.select2-search-choice').qtip({\n    content: {\n      title: true,\n      text: function(e, api) {\n        $target = $(e.target);\n        var address = $target.data('address');\n        var mid = $target.closest('form.form-compose').data('mid');\n        var model = Mailpile.Composer.Drafts[mid];\n\n        if ($target.hasClass('select2-search-choice')) {\n          address = $target.find('.compose-choice-name').data('address');\n        }\n        if ($target.hasClass('select2-search-choice-close')) {\n          address = $target.parent().find('.compose-choice-name').data('address');\n        }\n        if ($target.is('img')) {\n          address = $target.parent().parent().find('.compose-choice-name').data('address');\n        } \n\n        var contact_data = _.findWhere(model.addresses, { address: address });\n        if (contact_data) {\n          contact_data['mid'] = mid;\n\n          if (contact_data.photo === undefined) {\n            contact_data.photo = '';\n          }\n\n          var contact_template = Mailpile.safe_template($('#tooltip-contact-details').html());\n          return contact_template(contact_data);\n        }\n      }\n    },\n    style: {\n     tip: {\n        corner: 'bottom center',\n        mimic: 'bottom center',\n        border: 0,\n        width: 10,\n        height: 10\n      },\n      classes: 'qtip-contact-details'\n    },\n    position: {\n      my: 'bottom center',\n      at: 'bottom center',\n\t\t\tviewport: $(window),\n\t\t\tadjust: {\n\t\t\t\tx: 5,  y: -25\n\t\t\t}\n    },\n    show: { delay: 100 },\n    hide: { fixed: true, delay: 350 }\n  });\n};\n\nMailpile.Composer.Tooltips.AttachKey = function() {\n  $('.compose-attach-key').qtip({\n    position: {\n      my: 'bottom center',\n      at: 'bottom center',\n\t\t\tviewport: $(window),\n\t\t\tadjust: {\n\t\t\t\tx: 5,  y: -25\n\t\t\t}\n    },\n    show: { delay: 100 },\n    hide: { fixed: true, delay: 350 }\n  });\n};/* Composer - Events */\n\n$(document).on('click', '.compose-contact-find-keys', function() {\n  var $elem = $(this);\n  var mid = $elem.data('mid');\n  var email = $elem.data('email');\n  Mailpile.UI.Modals.CryptoFindKeys({\n    query: email,\n    strict: true,\n    imported: function() {\n      if (mid) Mailpile.Composer.Crypto.UpdateEncryptionState(mid);\n      $('#modal-full').modal('toggle');\n    }\n  });\n});\n\n\n$(document).on('click', '.compose-crypto-encryption', function() {\n  var mid = $(this).data('mid');\n  var status = $('#compose-encryption-' + mid).val();\n  var can = $('#compose-crypto-encryption-' + mid).data('can');\n  var change = '';\n\n  if (status === 'encrypt') {\n    change = 'none';\n  }\n  else if (status === 'cannot' && can) {\n    change = 'encrypt';\n  }\n  else if (status === 'cannot' || !can) {\n    change = 'cannot';\n    Mailpile.UI.Modals.ComposerEncryptionHelper(mid, {\n      state: 'cannot',\n      unencryptables: Mailpile.Composer.Crypto.Unencryptables(mid)\n    });\n  }\n  else {\n    change = 'encrypt';\n  }\n\n  Mailpile.Composer.Crypto.EncryptionToggle(change, mid, 'manual');\n  Mailpile.Composer.Tooltips.Encryption();\n});\n\n\n$(document).on('click', '.compose-crypto-signature', function() {\n\n  var mid = $(this).data('mid');\n  var status = $('#compose-signature-' + mid).val();\n  var change = '';\n\n  if (status === 'sign') {\n    change = 'none';\n  } else {\n    change = 'sign';\n  }\n\n  Mailpile.Composer.Crypto.SignatureToggle(change, mid, 'manual');\n  Mailpile.Composer.Tooltips.Signature();\n});\n\n\n/* Compose - Show Cc, Bcc */\n$(document).on('click', '.compose-show-field', function(e) {\n  $(this).hide();\n  var field = $(this).text().toLowerCase();\n  var mid = $(this).data('mid');\n  $('#compose-' + field + '-html').show().removeClass('hide');\n\n  // Configure select2\n  Mailpile.Composer.Recipients.AddressField('compose-' + field + '-' + mid);\n});\n\n\n$(document).on('click', '.compose-hide-field', function(e) {\n  var field = $(this).attr('href').substr(1);\n  var mid = $(this).data('mid');\n  $('#compose-' + field + '-html').hide().addClass('hide');\n  $('#compose-' + field + '-show').fadeIn('fast');\n\n  // Destroy select2\n  $('#compose-' + field + '-' + mid).select2('destroy');\n});\n\n\n/* Compose - Send, Save, Reply */\n$(document).on('click', '.compose-action', function(e) {\n  e.preventDefault();\n  return Mailpile.Composer.SendMessage(this);\n});\n\nMailpile.Composer.SendMessage = function(send_btn) {\n  var $send_btn = $(send_btn);\n  var action = $send_btn.val();\n  var mid = $send_btn.parent().data('mid');\n  var post_send_url = $send_btn.closest('.has-url').data('url');\n  var form_data = $('#form-compose-' + mid).serialize();\n\n  if (action === 'send') {\n\t  var action_url     = Mailpile.api.compose_send;\n\t  var action_status  = 'success';\n\t  var action_message = 'Your message was sent <a id=\"status-undo-link\" data-action=\"undo-send\" href=\"#\">undo</a>';\n    var done_working = Mailpile.notify_working(\"Preparing to send...\", 100);\n  }\n  else if (action == 'save') {\n\t  var action_url     = Mailpile.api.compose_save;\n\t  var action_status  = 'info';\n\t  var action_message = 'Your message was saved';\n    var done_working = Mailpile.notify_working(\"Saving...\", 500);\n  }\n  else if (action == 'reply') {\n\t  var action_url     = Mailpile.api.compose_send;\n\t  var action_status  = 'success';\n\t  var action_message = 'Your reply was sent';\n    var done_working = Mailpile.notify_working(\"Preparing to send...\", 100);\n  }\n\n  // Warn the user if he's trying to go against his own security policies,\n  // let him abort... or not.\n  if ((action != 'save') && $send_btn.data('crypto-state').match(/conflict/)) {\n    if (!confirm($send_btn.data('crypto-reason') + '\\n\\n' +\n                 'Click OK to send the message anyway.')) return;\n  }\n\n  // FIXME: Use Mailpile.API instead of this.\n\t$.ajax({\n\t\turl\t\t\t : action_url,\n\t\ttype\t\t : 'POST',\n\t\tdata     : form_data,\n\t\tdataType : 'json',\n\t  success  : function(response) {\n\t    // Is A New Message (or Forward)\n      done_working();\n      if (action === 'send' && response.status === 'success') {\n        if (post_send_url) {\n          Mailpile.go(post_send_url + \"/\" + mid);\n        }\n        else {\n          Mailpile.go(Mailpile.urls.message_sent + response.result.thread_ids[0] + \"/\");\n        }\n      }\n      // Is Thread Reply\n      else if (action === 'reply' && response.status === 'success') {\n        Mailpile.Composer.Complete(response.result.thread_ids[0]);\n      }\n      else if (response.status === 'error' && response.error.locked_keys) {\n        Mailpile.auto_modal({\n          url: '/settings/set/password/?id=' + response.error.locked_keys[0],\n          header: 'off',\n          callback: function(result) {\n            // Let's try that again!\n            Mailpile.Composer.SendMessage(send_btn);\n          }\n        });\n      }\n      else {\n        Mailpile.notification(response);\n      }\n    },\n    error: function() {\n      done_working();\n      Mailpile.notification({\n        status: 'error',\n        message: 'Could not ' + action + ' your message'\n      });\n    }\n\t});\n};\n\n\n/* Compose - Pick Send Date */\n$(document).on('click', '.pick-send-datetime', function(e) {\n\n  if ($(this).data('datetime') == 'immediately') {\n    $('#reply-datetime-display').html($(this).html());\n  }\n  else {\n    $('#reply-datetime-display').html('in ' + $(this).html());\n  }\n\n  $('#reply-datetime span.icon').removeClass('icon-arrow-down').addClass('icon-arrow-right');\n});\n\n\n/* Compose - Details */\n$(document).on('click', '.compose-show-details', function(e) {\n\n  e.preventDefault();\n  var mid = $(this).data('mid');\n  var new_message = $(this).data('message');\n\n  if ($('#compose-details-' + mid).hasClass('hide')) {\n    var old_message = $(this).html();\n\n    // Instatiate select2\n    if ($('#compose-to-' + mid).val()) {\n      Mailpile.Composer.Recipients.AddressField('compose-to-' + mid);\n    }\n    if ($('#compose-cc-' + mid).val()) {\n      Mailpile.Composer.Recipients.AddressField('compose-cc-' + mid);\n    }\n    if ($('#compose-bcc-' + mid).val()) {\n      Mailpile.Composer.Recipients.AddressField('compose-bcc-' + mid);\n    }\n\n    Mailpile.Composer.Tooltips.ContactDetails();\n\n    $('#compose-details-' + mid).slideDown('fast').removeClass('hide');\n    $('#compose-to-summary-' + mid).hide();\n    $(this).html('<span class=\"icon-eye\"></span> <span class=\"text\">' + new_message + '</span>');\n    $(this).data('message', old_message).attr('data-message', old_message);\n  }\n  else {\n    var old_message = $(this).find('.text').html();\n    $('#compose-details-' + mid).slideUp('fast').addClass('hide');\n    $('#compose-to-summary-' + mid).show();\n    $(this).html(new_message);\n    $(this).data('message', old_message).attr('data-message', old_message);\n  }\n});\n\n\n/* Compose - Delete message that's in a composer */\n$(document).on('click', '.compose-message-trash', function() {\n  var mid = $(this).data('mid');\n  Mailpile.API.message_unthread_post({ mid: mid }, function(response) {\n    Mailpile.API.tag_post({\n      mid: mid,\n      add: 'trash',\n      del: ['drafts', 'blank']\n    }, function(response_trash) {\n      if (response_trash.status === 'success') {\n        // FIXME: Make this more intelligent\n        Mailpile.go('/in/inbox/');\n      }\n      else if (response_trash.status === 'success' &&\n               Mailpile.instance.state.command_url === '/message/') {\n        // FIXME: NOT REACHED\n        $('#form-compose-' + mid).removeClass('form-compose clearfix')\n                            .addClass('thread-notification')\n                            .html($('#template-thread-notification-draft-trash').html());\n      } else {\n        Mailpile.notification(response_trash.status, response_trash.message);\n      }\n    });\n  });\n});\n\n\n$(document).on('click', '.compose-from', function(e) {\n  e.preventDefault();\n  var mid = $(this).data('mid');\n  var avatar = $(this).find('.avatar img').attr('src');\n  var name = $(this).find('.name').html();\n  var address = $(this).find('.address').html();\n  $('#compose-from-selected-' + mid).find('.avatar img').attr('src', avatar);\n  $('#compose-from-selected-' + mid).find('.name').html(name);\n  $('#compose-from-selected-' + mid).find('.address').html(address);\n  $('#compose-from-' + mid).val(name + ' <' + address + '>');\n  Mailpile.Composer.Crypto.UpdateEncryptionState(mid, function() {});\n});\n\n\n$(document).on('click', '.compose-attachment-remove', function(e) {\n  Mailpile.Composer.Attachments.Remove($(this).data('mid'), $(this).data('aid'));\n});\n\n\n$(document).on('focus', '.compose-text', function() {\n  autosize($(this));\n});\n\n\n$(document).on('click', '.compose-attach-key', function(e) {\n  var mid = $(this).data('mid');\n  Mailpile.Composer.Crypto.AttachKey(mid);\n});\n\n\n/* Compose - Quoted Reply */\n$(document).on('click', '.compose-apply-quote', function(e) {\n  var mid = $(this).data('mid');\n  var state = $(this).data('quoted_reply');\n  Mailpile.Composer.Body.QuotedReply(mid, state);\n});\n\n\n$(document).on('submit', '#form-compose-quoted-reply', function(e) {\n  e.preventDefault();\n  var quoted_reply = 'enabled';\n  if ($(this).find('input[type=checkbox]').is(':checked')) {\n    quoted_reply = 'disabled';\n  }\n  Mailpile.API.settings_set_post({ 'web.quoted_reply': quoted_reply }, function(result) {\n    Mailpile.notification(result);\n    $('#modal-full').modal('hide');\n  });\n});\n\n\n$(document).on('click', '.encryption-helper-find-key', function(e) {\n  var mid = $(this).data('mid');\n  var address = $(this).data('email');\n  Mailpile.crypto_keylookup = [];  // Reset Model\n\n  e.preventDefault();\n\n  // Reset and show progress area...\n  //$('#encryption-helper-find-keys').find('ul.result').html('');\n  $('#encryption-helper-find-keys').find('.loading').fadeIn();\n  $('#encryption-helper-find-keys').find('.color-01-gray-mid').html(address);\n\n  // Hide the list of missing keys, since we don't really handle\n  // multiple searches at once.\n  $('#encryption-helper-missing-keys').slideUp('slow');\n  $('li[address=\"' + address + '\"]').hide();\n  //$('#encryption-helper-missing-keys li.searchkey-result-item').show();\n\n  // Go Get Keys\n  var find_options = {\n    query: address,\n    strict: true,\n    container: '#encryption-helper-found-keys',\n    action: 'hide-item',\n    searched: function(status) {\n      // Hide loading animation\n      $('#encryption-helper-find-keys').find('.loading').slideUp('fast');\n\n      // If nothing was found, bring back the missing key list.\n      if (status === 'none' || status === 'error') {\n        $('#encryption-helper-missing-keys').slideDown();\n        $('li[address=\"' + address + '\"]').show();\n      }\n    },\n    imported: function() {\n      Mailpile.Composer.Crypto.UpdateEncryptionState(mid, function() {\n        // If the updated state says we can encrypt, then we should make\n        // the interface all happy like!\n      });\n\n      if (false) {\n        // Tally Total Missing Keys\n        var count_missing = [];\n        _.each($('#encryption-helper-missing-keys li.searchkey-result-item'), function(elem, key) {\n          count_missing.push($(elem).css('display'));\n        });\n        count_missing = _.indexOf(count_missing, 'list-item');\n\n        // Show \"Now Able To Encrypt\" Message\n        console.log('Missing: ' + count_missing);\n        if (count_missing < 1) {\n          console.log('yay, all have been searched & imported');\n\n          // Positive Feedback\n          $('#modal-full').find('span.icon-lock-open')\n            .removeClass('icon-lock-open color-10-orange')\n            .addClass('icon-lock-closed color-08-green')\n            .html('Yay, Can Now Encrypt');\n\n          var success_template = Mailpile.safe_template($('#template-encryption-helper-complete-message').html());\n          var success_html = success_template({ mid: mid });\n\n          $('#modal-full').find('div.modal-body').html(success_html);\n\n          // Hide Missing\n          $('#encryption-helper-missing-keys').fadeOut();\n        }\n        else {\n          $('#encryption-helper-missing-keys').show();\n        }\n      }\n    },\n    error: function() {\n      $('#encryption-helper-missing-keys').slideDown();\n      $('li[address=\"' + address + '\"]').show();\n    }\n  };\n  Mailpile.Crypto.Find.Keys(find_options);\n});\n\n\n$(document).on('click', '.modal-retry-encryption', function(e) {\n  var mid = $(this).data('mid');\n  Mailpile.Composer.Crypto.UpdateEncryptionState(mid, function() {\n    $('#form-compose-' + mid + ' .compose-crypto-encryption').click();\n  });\n});/* Compose - Complete */\n\nMailpile.Composer.Complete = function(mid) {\n  Mailpile.go(Mailpile.urls.message_sent + mid + \"/\");\n};/* Composer - Body */\n\nMailpile.Composer.Model = function(strings, addresses) {\n  var model = strings;\n  model[\"addresses\"] = addresses;\n  return model;\n};\n\n\nMailpile.Composer.Body.Setup = function(mid) {\n\n  // Add Autosize\n  autosize($('#compose-text-' + mid));\n\n  // Is Ephemeral (means .compose-text has quoted_reply)\n  if (/\\breply-all\\b/g.test(mid)) {\n\n    console.log('Is Ephemeral');\n\n    // Add Quoted to Model\n    Mailpile.Composer.Drafts[mid].quoted_reply = $('#compose-text-' + mid).val();\n\n    // If Quoted Reply disabled, remove from field\n    if ($('#compose-quoted-reply-' + mid).parent().data('quoted_reply') === 'disabled') {\n      $('#compose-text-' + mid).val('').trigger('autosize:update');\n    }\n    // Not disabled, add to model\n    else {\n      Mailpile.Composer.Drafts[mid].body = $('#compose-text-' + mid).val();\n    }\n  }\n  // Is Draft add to model\n  else {\n\n    console.log('Is Not Ephemeral');\n\n    Mailpile.Composer.Drafts[mid].body = $('#compose-text-' + mid).val();\n  }\n};\n\n\nMailpile.Composer.Body.QuotedReply = function(mid, state) {\n\n  $checkbox = $('#compose-quoted-reply-' + mid);\n\n  if ($checkbox.is(':checked')) {\n    $checkbox.val('yes');\n  }\n  else {\n    $checkbox.val('no');\n\n    // Check Quoted Setting State\n    if (state === 'unset' && Mailpile.Composer.Drafts[mid].quoted_reply) {\n      Mailpile.Composer.Body.QuotedReplySetup();\n      $('#compose-text-' + mid).val('').trigger('autosize:update');\n    }\n    // Empty body & .compose-text as it's just a quoted reply\n    else if (Mailpile.Composer.Drafts[mid].body === Mailpile.Composer.Drafts[mid].quoted_reply) {\n      Mailpile.Composer.Drafts[mid].body = '';\n      $('#compose-text-' + mid).val('').trigger('autosize:update');\n    }\n    // Replace composer with quoted reply\n    else if (Mailpile.Composer.Drafts[mid].quoted_reply) {\n      Mailpile.Composer.Drafts[mid].body = Mailpile.Composer.Drafts[mid].quoted_reply;\n      $('#compose-text-' + mid).val(Mailpile.Composer.Drafts[mid].quoted_reply).trigger('autosize:update');\n    }\n  }\n};\n\n\nMailpile.Composer.Body.QuotedReplySetup = function() {\n  Mailpile.API.with_template('modal-compose-quoted-reply', function(modal) {\n    Mailpile.UI.show_modal(modal());\n  });\n};\n/* JS - Contacts */\n/* Contacts */\n\nMailpile.Contacts = {};\nMailpile.Contacts.UI = {};\n\n\nMailpile.Contacts.init = function() {\n\n  // Search Bar\n  $('#search-query').val('contacts: ');\n\n  // Hide Key Details\n  $('.contact-key-details').hide();\n\n};/* Contacts - Show contact add form */\n$(document).on('click', '.btn-activity-contact_add', function(e) {\n  e.preventDefault();\n  Mailpile.UI.Modals.ContactAdd();\n});\n\n\n/* Contact - Form  */\n$(document).on('submit', '#form-contact-add', function(e) {\n  e.preventDefault();\n  Mailpile.UI.Modals.ContactAddProcess();\n});\n\n\n/* Contacts - Show details of a given key */\n$(document).on('click', '.show-key-details', function(e) {\n  e.preventDefault();\n  $(this).hide();\n  var keyid = $(this).data('keyid');\n  $('#contact-key-details-' + keyid).fadeIn();\n});\n\n/* Modals - Contacts */\n\nMailpile.UI.Modals.ContactAdd = function() {\n  $('.sub-navigation ul li').removeClass('navigation-on');\n  $(this).addClass('navigation-on');\n\n  Mailpile.API.with_template('modal-contact-add', function(modal) {\n    var modal_data = { name: '', address: '', extras: '' };\n    Mailpile.UI.show_modal(modal(modal_data));\n  });\n};\n\n\nMailpile.UI.Modals.ContactAddProcess = function() {\n  Mailpile.API.contacts_add_post($('#form-contact-add').serialize(), function(result) {\n    if (result.status == 'success') {\n      $('#modal-full').modal('hide');\n\n      // If Contacts List\n      var $clist = $('#contacts-list');\n      if ($clist.length > 0) {\n        var contact_template = Mailpile.safe_template($('#template-contact-list-item').html());\n        var contact_html = contact_template(result.result.contact);\n        $clist.append(contact_html);\n      }\n    }\n  });\n};\n/* JS - Search */\n/* Search */\n\nMailpile.Search = {};\nMailpile.Search.Tooltips = {};\n\nMailpile.Search.init = function() {\n\n  // Drag Items\n  Mailpile.UI.Search.Draggable('td.draggable');\n  Mailpile.UI.Search.Dropable('.pile-results tr', 'a.sidebar-tag');\n\n  // Render Display Size\n  if (!Mailpile.local_storage['view_size']) {\n    Mailpile.local_storage['view_size'] = Mailpile.config.web.display_density;\n  }\n\n  var search = ($('#search-query').attr('value') + ' ');\n  if (search.match(/^\\s*all:mail\\s*$/)) {\n    $('.btn-activity-save_search, .btn-activity-edit_tag').remove();\n  }\n  else if (search.match(/^\\s*in:\\S+\\s*$/)) {\n    $('.btn-activity-save_search').remove();\n  }\n  else {\n    $('.btn-activity-edit_tag').remove();\n  }\n\n  Mailpile.pile_display(Mailpile.local_storage['view_size']);\n\n  // Display Select\n  $.each($('a.change-view-size'), function() {\n    if ($(this).data('view_size') == Mailpile.local_storage['view_size']) {\n      $(this).addClass('view-size-selected');\n    }\n  });\n\n  // Tooltips\n  Mailpile.Search.Tooltips.MessageTags();\n\n  EventLog.subscribe(\".mail_source\", function(ev) {\n    // bre: re-enabling this just for fun and to test the event subscription\n    //      code. This is broken in that it fails for non-English languages.\n    if (ev.message.indexOf(\"Rescanning:\") != -1) {\n      $(\"#logo-bluemail\").fadeOut(2000);\n      $(\"#logo-redmail\").hide(2000);\n      $(\"#logo-greenmail\").hide(3000);\n      $(\"#logo-bluemail\").fadeIn(2000);\n      $(\"#logo-greenmail\").fadeIn(4000);\n      $(\"#logo-redmail\").fadeIn(6000);\n    }\n    $('.status-in-title').attr('title', ev.data.name + ': ' + ev.message);\n\n/*\n    if (ev.flags.indexOf(\"c\") != -1 && ev.data.messages > 0) {\n      $(\"#pile-newmessages-notification\").slideDown(\"slow\");\n\n      if (Notification.permission == \"granted\") {\n        new Notification(ev.data.messages + \" new messages received\", { \n            body:'Your pile is growing...',\n            icon:'/static/img/logo-color.png', \n          }  \n        )\n      }\n    }\n*/\n  });\n};Mailpile.bulk_actions_update_ui = function() {\n  $('.selection-context').each(function (i, context) {\n    var $context = $(context);\n    var selected = Mailpile.UI.Selection.selected($context);\n    var checkboxes = $context.find('.pile-results input[type=checkbox]');\n    \n    // This is a hack to make sure the length check below fails\n    if (checkboxes.length == 0) checkboxes = ['fake', 'fake'];\n\n    // Reset state...\n    Mailpile.hide_message_hints($context);\n    if ((selected.length < 1) || (selected[0] !== \"!all\")) {\n      $context.find('#pile-select-all-action').val('');\n    }\n    if ((selected.length == checkboxes.length) ||\n        (selected[0] == '!all')) {\n      $context.find('#pile-select-all-action').prop('checked', true);\n    }\n    else {\n      $context.find('#pile-select-all-action').prop('checked', false);\n    }\n\n    if (selected.length > 0) {\n      var message = ('<span id=\"bulk-actions-selected-count\">' +\n                       Mailpile.UI.Selection.human_length(selected) +\n                     '</span> ');\n      if (selected[0] == \"!all\") {\n        message = ('<a onclick=\"javascript:Mailpile.unselect_all_matches(this);\">' +\n                     '<span class=\"icon-new\"></span> ' +\n                     $context.find('#bulk-actions-message').data('unselect_all') +\n                   '</a>');\n      }\n      else if ($context.find(\"#pile-select-all-action\").is(':checked')) {\n        message = ('<a onclick=\"javascript:Mailpile.select_all_matches(this);\">' +\n                     message + ' ' +\n                     $context.find('#bulk-actions-message').data('select_all') +\n                   '</a>');\n      }\n      else {\n        message += $context.find('#bulk-actions-message').data('bulk_selected');\n        if (selected.length == 1) Mailpile.show_message_hints($context, selected);\n      }\n      $context.find('#bulk-actions-message').html(message);\n      Mailpile.show_bulk_actions($context.find('.bulk-actions').find('li.hide'));\n    }\n    else {\n      var message = $context.find('#bulk-actions-message').data('bulk_selected_none');\n      $context.find('#bulk-actions-message').html(message);\n      Mailpile.hide_bulk_actions($context.find('.bulk-actions').find('li.hide'));\n    }\n  });\n};\n\n\nMailpile.hide_message_hints = function($context) {\n  $context.find('div.bulk-actions-hints').html('');\n};\n\n\nMailpile.show_message_hints = function($context, selected) {\n  $.each(selected, function(key, mid) {\n    if (mid != '!all') {\n      var $elem = $context.find('.pile-message-' + mid);\n      var hint = $elem.data('context-hint');\n      if (hint) {\n        var icon = $elem.data('context-icon');\n        var url = $elem.data('context-url');\n        var html = '';\n        if (icon) html += '<span class=\"icon icon-' + icon + '\"></span> ';\n        html += hint;\n        if (url) html = '<a href=\"' + url + '\">' + html + '</a>';\n        $('div.bulk-actions-hints').html(html);\n      }\n    }\n  });\n};\n\n\nMailpile.select_all_matches = function(elem) {\n  $(elem).closest('.selection-context')\n         .find('#pile-select-all-action').val('!all');\n  Mailpile.bulk_actions_update_ui();\n  return false;\n};\n\n\nMailpile.unselect_all_matches = function(elem) {\n  $(elem).closest('.selection-context')\n         .find('#pile-select-all-action').val('');\n  Mailpile.bulk_actions_update_ui();\n  return false;\n};\n\n\nMailpile.bulk_action_read = function(elem) {\n  var $context = Mailpile.UI.Selection.context(elem || '.pile-results');\n  Mailpile.UI.Tagging.tag_and_update_ui({\n    del: 'new',\n    mid: Mailpile.UI.Selection.selected($context),\n    context: $context.find('.search-context').data('context')\n  }, 'read');\n};\n\n\nMailpile.bulk_action_unread = function(elem) {\n  var $context = Mailpile.UI.Selection.context(elem || '.pile-results');\n  Mailpile.UI.Tagging.tag_and_update_ui({\n    add: 'new',\n    mid: Mailpile.UI.Selection.selected($context),\n    context: $context.find('.search-context').data('context')\n  }, 'unread');\n};\n\n\nMailpile.bulk_action_select_target = function() {\n  var target = this.search_target;\n  var $tr = $('.pile-message').eq(target);\n  $tr.addClass('result-on').find('input[type=checkbox]').prop('checked', true);\n  this.bulk_actions_update_ui();\n  return true;\n};\n\n\nMailpile.bulk_action_deselect_target = function() {\n  var target = this.search_target;\n  var $tr = $('.pile-message').eq(target);\n  $tr.removeClass('result-on')\n     .find('input[type=checkbox]').prop('checked', false);\n  this.bulk_actions_update_ui();\n  return true;\n};\n\n\nMailpile.bulk_action_toggle_target = function() {\n  var target = this.search_target;\n  var $tr = $('.pile-message').eq((target === 'none') ? 0 : target);\n  if ($tr.find('input[type=checkbox]').is(':checked')) {\n    Mailpile.pile_action_unselect($tr);\n  }\n  else {\n    Mailpile.pile_action_select($tr);\n  }\n  return true;\n};\n\n\nMailpile.bulk_action_select_all = function() {\n  var checkboxes = $('.pile-results input[type=checkbox]');\n  $.each(checkboxes, function() {\n    Mailpile.pile_action_select($(this).parent().parent());\n  });\n  $(\"#pile-select-all-action\").prop('checked', true);\n  Mailpile.bulk_actions_update_ui();\n};\n\n\nMailpile.bulk_action_select_none = function() {\n  var checkboxes = $('.pile-results input[type=checkbox]');\n  $.each(checkboxes, function() {\n    Mailpile.pile_action_unselect($(this).parent().parent());\n  });\n  $(\"#pile-select-all-action\").prop('checked', false).val('');\n  Mailpile.bulk_actions_update_ui();\n};\n\n\nMailpile.bulk_action_select_invert = function() {\n  var checkboxes = $('.pile-results input[type=checkbox]');\n  $.each(checkboxes, function() {\n    if ($(this).is(\":checked\")) {\n      Mailpile.pile_action_unselect($(this).parent().parent(), 'partial');\n    } else {\n      Mailpile.pile_action_select($(this).parent().parent(), 'partial');\n    }\n  });\n  Mailpile.bulk_actions_update_ui();\n};\n\n\nMailpile.bulk_action_select_between = function() {\n  alert('FIXME: Will select messages between two points');\n};\n\n\nMailpile.bulk_action_selection_up = function() {\n  var checkboxes = $('.pile-results input[type=checkbox]');\n  var selected = Mailpile.UI.Selection.selected(checkboxes.eq(0));\n  if (selected.length == 0) {\n    Mailpile.pile_action_select($(checkboxes[checkboxes.length-1]).parent().parent());\n    return;\n  }\n  $.each(checkboxes, function() {\n    if ($(this).parent().parent().next().children().children(\"input\").is(\":checked\")) {\n      Mailpile.pile_action_select($(this).parent().parent(), 'partial');\n    } else {\n      Mailpile.pile_action_unselect($(this).parent().parent(), 'partial');\n    }\n  });\n  Mailpile.bulk_actions_update_ui();\n};\n\n\nMailpile.bulk_action_selection_down = function() {\n  var checkboxes = $('.pile-results input[type=checkbox]');\n  var selected = Mailpile.UI.Selection.selected(checkboxes.eq(0));\n  if (selected.length == 0) {\n    Mailpile.pile_action_select($(checkboxes[0]).parent().parent());\n    return;\n  }\n  $(checkboxes.get().reverse()).each(function() {\n    if ($(this).parent().parent().prev().children().children(\"input\").is(\":checked\")) {\n      Mailpile.pile_action_select($(this).parent().parent());\n    } else {\n      Mailpile.pile_action_unselect($(this).parent().parent());\n    }\n  });\n};\n\n\nMailpile.open_selected_thread = function() {\n  var selected = Mailpile.UI.Selection.selected('.pile-results');\n  if (Mailpile.search_target !== 'none') {\n    var target = this['search_target'];\n    $('.pile-results tr').eq(target).find('.subject a').eq(0).trigger('click');\n  }\n  else if (selected.length === 1 && selected[0] != '!all') {\n    $(\".pile-results .pile-message-\" + selected[0]).eq(0)\n      .find('.subject a').eq(0).trigger('click');\n  }\n};/* Search - select item via clicking */\n$(document).on('click', '.pile-results tr.result', function(e) {\n  if ($(e.target).attr('type') === 'checkbox') {\n    $(e.target).blur();\n    Mailpile.pile_action_select($(this));\n  }\n  else if (e.target.href === undefined &&\n    $(this).data('state') !== 'selected' &&\n    $(e.target).hasClass('pile-message-tag-name') == false) {\n    Mailpile.pile_action_select($(this));    \n  }\n});\n\n\n/* Search - unselect search item via clicking */\n$(document).on('click', '.pile-results tr.result-on', function(e) {\n  if ($(e.target).attr('type') === 'checkbox') {\n    $(e.target).prop('checked', false).blur();\n    Mailpile.pile_action_unselect($(this));\n  }\n  else if (e.target.href === undefined &&\n    $(this).data('state') === 'selected' && \n    $(e.target).hasClass('pile-message-tag-name') == false) {\n    Mailpile.pile_action_unselect($(this));\n  }\n});\n\n\n/* Search - Delete Tag via Tooltip */\n$(document).on('click', '.pile-tag-delete', function(e) {\n  e.preventDefault();\n  var tid = $(this).data('tid');\n  var mid = $(this).data('mid');\n  Mailpile.UI.Tagging.tag_and_update_ui({\n    del: tid,\n    mid: mid\n  }, 'untag', function() {\n    $('.pile-message-' + mid + ' .pile-message-tag-' + tid).qtip('hide');\n  });\n});\n\n\n/* Search - Searches web for people (currently keyservers only) */\n$(document).on('click', '#btn-pile-empty-search-web', function(e) {\n  e.preventDefault();\n  Mailpile.UI.Modals.CryptoFindKeys({\n    query: $('#pile-empty-search-terms').html()\n  });\n});\n\n\n/* Save Search & Edit Tag */\n(function() {\n  $(document).on('click', '.bulk-action-save_search', function(e) {\n    var template = 'modal-save-search';\n    var searchq = ($('#search-query').attr('value') + ' ');\n    if (searchq.match(/vfs:/g)) {\n      Mailpile.auto_modal({\n        url: '/settings/mailbox/?path=' + searchq.substring(4),\n        method: 'GET',\n        reload: true\n      });\n    }\n    else {\n      Mailpile.API.with_template(template, function(modal) {\n        var mf = Mailpile.UI.show_modal(modal({ terms: searchq }));\n        mf.find('#ss-search-terms').attr('value', searchq);\n      });\n    }\n  });\n  $(document).on('click', '#modal-save-search .ss-save', function() {\n    if ($('#modal-save-search #ss-comment').val() != '') {\n      Mailpile.API.filter_post({\n        _serialized: $('#modal-save-search').serialize()\n      }, function(data) {\n        Mailpile.go('/in/saved-search-' + data['result']['id'] + '/');\n      });\n    }\n    else {\n      alert('Please name your search!');\n    }\n    return false;\n  });\n  function show_settings() {\n    $('#modal-full .modal-basic-settings').show();\n    $('#modal-full .modal-choose-tag-icon').hide();\n    $('#modal-full .modal-choose-tag-color').hide();\n    $('#modal-full .modal-save-group').show();\n  };\n  $(document).on('click', '#modal-full .modal-basic-settings-title', show_settings);\n  $(document).on('click', '#modal-full .modal-open-choose-tag-color', function() {\n    $('#modal-full ul.tag-colors').html(Mailpile.UI.tag_colors_as_lis());\n    $('#modal-full .modal-save-group').hide();\n    $('#modal-full .modal-basic-settings').hide();\n    $('#modal-full .modal-choose-tag-color').show();\n  }); \n  $(document).on('click', '#modal-full .modal-open-choose-tag-icon', function() {\n    $('#modal-full ul.tag-icons').html(Mailpile.UI.tag_icons_as_lis());\n    $('#modal-full .modal-save-group').hide();\n    $('#modal-full .modal-basic-settings').hide();\n    $('#modal-full .modal-choose-tag-icon').show();\n  }); \n  $(document).on('click', '#modal-full .modal-tag-icon-option', function() {\n    var icon = $(this).data('icon');\n    $('#modal-full input.choose-tag-icon').val(icon);\n    $('#modal-full .modal-open-choose-tag-icon'\n      ).removeClass().addClass('modal-open-choose-tag-icon').addClass(icon);\n    show_settings();\n  });\n  $(document).on('click', '#modal-full .modal-tag-color-option', function() {\n    var name = $(this).data('name');\n    var hex = $(this).data('hex');\n    $('#modal-full input.choose-tag-color').val(name);\n    $('#modal-full .modal-open-choose-tag-icon').css('color', hex);\n    $('#modal-full .modal-open-choose-tag-color').css('color', hex);\n    show_settings();\n  });\n})();/* Search - Display Mode */\nMailpile.pile_display = function(current, change) {\n\n  if (change) {\n    $('#sidebar').removeClass(current).addClass(change);\n    $('.pile-results').removeClass(current).addClass(change);\n  } else {\n    $('#sidebar').addClass(current);\n    $('.pile-results').addClass(current);\n  }\n\n  setTimeout(function() {\n    $('#sidebar').fadeIn('fast');\n    $('.pile-results').fadeIn('fast');\n  }, 250);\n};\n\n\n/* Search - Change Display Size */\n$(document).on('click', 'a.change-view-size', function(e) {\n\n  e.preventDefault();\n  var current_size = Mailpile.local_storage['view_size'];\n  var change_size = $(this).data('view_size');\n\n  // Update Link Selected\n  $('a.change-view-size').removeClass('view-size-selected');\n  $(this).addClass('view-size-selected');\n\n  // Update View Sizes\n  Mailpile.pile_display(current_size, change_size);\n\n  // Data\n  Mailpile.local_storage['view_size'] = change_size;\n\n  // Update Config & Model\n  Mailpile.API.settings_set_post({ 'web.display_density': change_size }, function(result) {});\n  Mailpile.config.web.display_density = change_size;\n\n});/* Search - Bulk Select / Unselect All */\n$(document).on('click', '#pile-select-all-action', function(e) {\n  var $checkbox = $(this);\n  var $results = $checkbox.closest('.selection-context')\n                          .find('.pile-results .pile-message');\n  if ($checkbox.is(':checked')) {\n    // Going from unchecked -> checked\n    $results.each(function(i, result) {\n      Mailpile.pile_action_select($(result), \"partial\");\n    });\n  }\n  else {\n    // Going from checked -> unchecked\n    $checkbox.val('');\n    $results.each(function(i, result) {\n      Mailpile.pile_action_unselect($(result), \"partial\");\n    });\n  }\n  Mailpile.bulk_actions_update_ui();\n  return true;\n});\n\n\n/* Search - Bulk Action - Tag */\n$(document).on('click', '.bulk-action-tag', function() {\n  Mailpile.render_modal_tags(this);\n});\n\n\n/* Search - Bulk Action - Archive */\n$(document).on('click', '.bulk-action-archive', function() {\n  var $context = Mailpile.UI.Selection.context(this);\n  Mailpile.UI.Tagging.tag_and_update_ui({\n    del: 'inbox',\n    mid: Mailpile.UI.Selection.selected($context),\n    context: $context.find('.search-context').data('context')\n  }, 'archive');\n});\n\n\n/* Search - Bulk Action - Trash */\n$(document).on('click', '.bulk-action-trash', function(result) {\n  var $context = Mailpile.UI.Selection.context(this);\n  Mailpile.UI.Tagging.tag_and_update_ui({\n    del: ['new', 'spam'],\n    add: 'trash',\n    mid: Mailpile.UI.Selection.selected($context),\n    context: $context.find('.search-context').data('context')\n  }, 'trash');\n});\n\n\n/* Search - Bulk Action - Spam */\n$(document).on('click', '.bulk-action-spam', function() {\n  var $context = Mailpile.UI.Selection.context(this);\n  Mailpile.UI.Tagging.tag_and_update_ui({\n    del: ['new', 'trash'],\n    add: 'spam',\n    mid: Mailpile.UI.Selection.selected($context),\n    context: $context.find('.search-context').data('context')\n  }, 'spam');\n});\n\n\n/* Search - Bulk Action - Mark Unread */\n$(document).on('click', '.bulk-action-unread', function() {\n  Mailpile.bulk_action_unread(this);\n});\n\n\n/* Search - Bulk Action - Mark Read */\n$(document).on('click', '.bulk-action-read', function() {\n  Mailpile.bulk_action_read(this);\n});\n\n\n/* Search - Submit multi tag/untag on search selection */\n$(document).on('submit', '#form-tag-picker', function(e) {\n\n  e.preventDefault();\n  var action = $(\"button:focus\").data('action');\n\n  var add_tags    = [];\n  var remove_tags = [];\n  var tag_data    = { mid: Mailpile.messages_cache };\n\n  // Add Selection\n  console.log(Mailpile.tags_cache);\n  _.each($(this).find('input.tag-picker-checkbox'), function(val, key) {\n    console.log($(val).val() + ' ---> ' + $(val).is(':checked') + ' ---> ' + _.indexOf(Mailpile.tags_cache, $(val).val()));\n    if ($(val).is(':checked') && _.indexOf(Mailpile.tags_cache, $(val).val()) === -1) {\n      console.log('adding to tags_cache ' + $(val).val());\n      Mailpile.tags_cache.push($(val).val());\n    }\n  });\n\n  console.log(Mailpile.tags_cache);\n\n  // Make Data Struc\n  if (action == 'add') {\n    tag_data = _.extend(tag_data, { add: Mailpile.tags_cache });\n  }\n  else if (action === 'remove') {\n    tag_data = _.extend(tag_data, { del: Mailpile.tags_cache });\n  }\n\n  // Send Result\n  Mailpile.API.tag_post(tag_data, function(result) {\n\n    // Notifications\n    Mailpile.notification(result);\n\n    // Add Tags to UI\n    if (result.status === 'success') {\n\n      var tag_link_template = Mailpile.safe_template($('#template-search-tags-link').html());\n\n      // Affected MID's\n      _.each(result.result.msg_ids, function(mid, key) {\n\n        // Select to minimize load traversing DOM\n        $item = $('.pile-message-' + mid).find('span.item-tags');\n\n        // Add / Remove Tags from UI\n        if (action == 'add') {\n          _.each(Mailpile.tags_cache, function(tid, key) {\n            if ($('.pile-message-' + mid + ' .pile-message-tag-' + tid).length < 1) {\n              var tag = _.findWhere(Mailpile.instance.tags, { tid: tid });\n              tag['mid'] = mid;\n              $item.append(tag_link_template(tag));\n            }\n          });\n        }\n        else if (action === 'remove') {\n          _.each(Mailpile.tags_cache, function(tid, key) {\n            var $elem = $('.pile-message-' + mid + ' .pile-message-tag-' + tid);\n            if ($elem.length >= 1) {\n              $elem.remove();\n            };\n          });\n        }\n      });\n    }\n\n    // Hide Modal\n    $('#modal-full').modal('hide');\n  });\n});\n\n\n$(document).on('click', '.tag-picker-checkbox', function(e) {\n//  Mailpile.tags_cache = _.without(Mailpile.tags_cache, $(this).val());\n});\n/* Search - Tooltips */\n\nMailpile.Search.Tooltips.MessageTags = function() {\n  $('.pile-message-tag').qtip({\n    content: {\n      title: false,\n      text: function(event, api) {\n        var mid = $(this).data('mid').toString();\n        var tid = $(this).data('tid').toString();\n        Mailpile.API.tags_get({ tid: tid }, function(response) {\n          var tooltip_template = Mailpile.safe_template($('#tooltip-pile-tag-details').html());\n          var tooltip_data = response.result.tags[0];\n          tooltip_data['mid'] = mid;\n          api.set('content.text', tooltip_template(tooltip_data));\n        });\n        return \"...\";\n      }\n    },\n    style: {\n      classes: 'qtip-thread-crypto',\n      tip: {\n        corner: 'bottom center',\n        mimic: 'bottom center',\n        border: 0,\n        width: 10,\n        height: 10\n      }\n    },\n    position: {\n      my: 'bottom center',\n      at: 'top left',\n      viewport: $(window),\n      adjust: {x: 7, y: 2},\n      effect: false\n    },\n    show: { delay: 100 },\n    hide: { fixed: true, delay: 350 }\n  });\n};Mailpile.focus_search = function() {\n    $(\"#search-query\").focus(); return false;\n};\n\n\n/* Search - Action Select */\nMailpile.pile_action_select = function($item, partial) {\n    if (Mailpile.select_between) {\n      console.log('FIXME: should do a shift select of multiple items');\n    }\n\n    // Add Tags\n    var metadata = _.findWhere(Mailpile.instance.metadata, { mid: $item.attr('data-mid') });\n    if (metadata && metadata.tag_tids) {\n      _.each(metadata.tag_tids, function(tid, key) {\n        var tag = _.findWhere(Mailpile.instance.tags, { tid: tid });\n        if (tag.type === 'tag') {\n          if (_.indexOf(Mailpile.tags_cache, tag.tid) === -1) {\n            Mailpile.tags_cache.push(tag.tid);\n          }\n        }\n      });\n    }\n\n    // Style & Select Checkbox\n    $item.removeClass('result').addClass('result-on')\n         .data('state', 'selected')\n         .find('td.checkbox input[type=checkbox]')\n         .prop('checked', true);\n\n    // Update Bulk UI\n    if (!partial) Mailpile.bulk_actions_update_ui();\n};\n\n\n/* Search - Action Unselect */\nMailpile.pile_action_unselect = function($item, partial) {\n    // Remove Tags\n    var metadata = _.findWhere(Mailpile.instance.metadata, { mid: $item.attr('data-mid') });\n    if (metadata && metadata.tag_tids) {\n      _.each(metadata.tag_tids, function(tid, key) {\n        var tag = _.findWhere(Mailpile.instance.tags, { tid: tid });\n        if (tag.type === 'tag') {\n          if (_.indexOf(Mailpile.tags_cache, tag.tid) > -1) {\n            Mailpile.tags_cache = _.without(Mailpile.tags_cache, tag.tid);\n          }\n        }\n      });\n    }\n\n    // Style & Unselect Checkbox\n    $item.removeClass('result-on').addClass('result')\n         .data('state', 'normal')\n         .find('td.checkbox input[type=checkbox]')\n         .prop('checked', false);\n\n    if (!partial) {\n      // If something has been unselected, then not selecting all anymore!\n      $item.closest('.selection-context')\n           .find('#pile-select-all-action').val('');\n      Mailpile.bulk_actions_update_ui();\n    }\n};\n\n\n/* Search - Result List */\nMailpile.results_list = function() {\n    // Navigation\n    $('#btn-display-list').addClass('navigation-on');\n    $('#btn-display-graph').removeClass('navigation-on');\n    \n    // Show & Hide View\n    $('#pile-graph').hide('fast', function() {\n        $('#form-pile-results').show('normal');\n        $('.pile-results').show('fast');\n        $('.pile-speed').show('normal');\n        $('#footer').show('normal');\n    });\n};\n\n\nMailpile.render_modal_tags = function(elem) {\n  var selected = Mailpile.UI.Selection.selected(elem || '.pile-results');\n  if (selected.length) {\n\n    // Open Modal with selection options\n    Mailpile.API.tags_get({}, function(data) {\n      Mailpile.API.with_template('template-modal-tag-picker-item',\n                                 function(tag_template) {\n        var priority_html = '';\n        var tags_html     = '';\n        var archive_html  = '';\n\n        /// Show tags in selected messages\n        var selected_tids = {};\n        _.each(selected, function(mid, key) {\n          if (mid != '!all') {\n            var metadata = _.findWhere(Mailpile.instance.metadata, { mid: mid });\n            if (metadata && metadata.tag_tids) {\n              _.each(metadata.tag_tids, function(tid, key) {\n                if (selected_tids[tid] === undefined) {\n                  selected_tids[tid] = 1;\n                } else {\n                  selected_tids[tid]++;\n                }\n              });\n            }\n          }\n        });\n\n        // Build Tags List\n        _.each(data.result.tags, function(tag, key) {\n          if (tag.display === 'priority' && tag.type === 'tag') {\n            priority_data  = _.extend(tag, { selected: selected_tids });\n            priority_html += tag_template(priority_data);\n          }\n          else if (tag.display === 'tag' && tag.type === 'tag') {\n            tag_data   = _.extend(tag, { selected: selected_tids });\n            tags_html += tag_template(tag_data);\n          }\n          else if (tag.display === 'archive' && tag.type === 'tag') {\n            archive_data  = _.extend(tag, { selected: selected_tids });\n            archive_html += tag_template(archive_data);\n          }\n        });\n\n        Mailpile.API.with_template('modal-tag-picker', function(modal) {\n          Mailpile.UI.show_modal(modal({\n            count: selected.length,\n            priority: priority_html,\n            tags: tags_html,\n            archive: archive_html\n          }));\n        });\n      });\n    });\n \n  } else {\n    Mailpile.notification({ status: 'info', message: 'No Messages Selected' });\n  }\n};\n\n\nMailpile.UI.Search.Draggable = function(element) {\n  var $element = $(element);\n  var initializing = true;\n  $element.draggable({\n    containment: 'window',\n    appendTo: 'body',\n    cursor: 'move',\n    scroll: false,\n    revert: false,\n    refreshPositions: true,\n    opacity: 1,\n    helper: function(event) {\n      var selected = Mailpile.UI.Selection.selected(element);\n      if ((selected.length < 2) && (selected[0] != '!all')) {\n        // Note: Dragging w/o selecting first may mean the length is zero\n        drag_count = '1 message';\n      }\n      else {\n        human_count = Mailpile.UI.Selection.human_length(selected);\n        drag_count = human_count + ' messages';\n      }\n      return $('<div class=\"pile-results-drag ui-widget-header\"><span class=\"icon-inbox\"></span> Moving ' + drag_count + '</div>');\n    },\n    drag: function() {\n      if ((!initializing) && $element.draggable('option', 'refreshPositions')) {\n        setTimeout(function() {\n          $element.draggable('option', 'refreshPositions', initializing);\n        }, 10);\n      }\n    },\n    start: function(event, ui) {\n      Mailpile.ui_in_action += 1;\n\n      // Style & Select Checkbox\n      $(event.target).parent().removeClass('result')\n                              .addClass('result-on')\n                              .data('state', 'selected')\n                              .find('td.checkbox input[type=checkbox]')\n                              .prop('checked', true);\n\n      // Update Bulk UI\n      Mailpile.bulk_actions_update_ui();\n\n      // Unveil the magical untagger!\n      $('.sidebar-untag-dropzone').slideDown(1000, function() {\n        initializing = false;\n      });\n    },\n    stop: function(event, ui) {\n      initializing = true;\n      $element.draggable('option', 'refreshPositions', initializing);\n      $('.sidebar-untag-dropzone').slideUp();\n      setTimeout(function() { Mailpile.ui_in_action -= 1; }, 250);\n    }\n  });\n};\n\n\nMailpile.UI.Search.Dropable = function(element, accept) {\n  $(element).droppable({\n    accept: accept,\n    hoverClass: 'result-hover',\n    tolerance: 'pointer',\n    drop: function(event, ui) {\n      // Suppress spurious drops that happened outside the content window\n      var $box = $('#content');\n      var ofs = $box.offset();\n      if ((ui.position.top > ofs.top + 20) &&\n          (ui.position.top < (ofs.top + $box.height() - 20)) &&\n          (ui.position.left > ofs.left + 40) &&\n          (ui.position.left < (ofs.left + $box.width() - 40)))\n      {\n        var $context = Mailpile.UI.Selection.context(event.target);\n        var selected = Mailpile.UI.Selection.selected($context);\n        selected.push($(event.target).data('mid'));\n        Mailpile.UI.Tagging.tag_and_update_ui({\n          add: ui.draggable.data('tid'),\n          mid: selected,\n          context: $context.find('.search-context').data('context')\n        }, 'tag');\n      }\n      else {\n        console.log('Dropped outside content area!');\n      }\n    }\n  });\n};\n/* JS - Settings */\n/* Settings - Shows profile add modal */\n$(document).on('click', '#btn-settings-profile-add', function(e) {\n  Mailpile.UI.show_modal($(\"#modal-settings-profile-add\").html());\n});\n\n\n\n/* Settings - Submit profile add form */\n$(document).on('submit', '#form-settings-profile-add', function(e) {\n\n  e.preventDefault();\n  var profile_data = {\n    name : $('#profile-add-name').val(),\n    email: $('#profile-add-email').val()\n  };\n\n  var smtp_route = $('#profile-add-username').val() + ':' + $('#profile-add-password').val() + '@' + $('#profile-add-server').val() + ':' + $('#profile-add-port').val();\n\n  if (smtp_route !== ':@:25') {\n    profile_data.route = 'smtp://' + smtp_route;\n  }\n\n  // FIXME: this is currently g'borked\n  // {profiles: JSON.stringify(profile_data)}\n});\n\n\n/* Settings - Shows route add modal */\n$(document).on('click', '#btn-settings-route-add', function(e) {\n  Mailpile.UI.show_modal($(\"#modal-settings-route-add\").html());\n});\n\n\n$(document).on('submit', '#form-settings-route-add', function(e) {\n\n  alert('This is not quite implemented yet :)');\n\n});\n\n\n/* Settings - Submit route edit form */\n$(document).on('submit', '.form-settings-route-edit', function() {\n\n\n});\n/* JS - Tags */\n/* Tags */\n\nMailpile.Tags = {};\nMailpile.Tags.UI = {};\nMailpile.Tags.Tooltips = {};\n\n\nMailpile.Tags.init = function() {\n\n  // Search Bar\n  $('#search-query').val('tags: ');\n\n  // Slugify\n  $('#data-tag-add-slug').slugify('#data-tag-add-tag');\n\n  // Tooltips\n  Mailpile.Tags.Tooltips.CardSubtags();\n\n};/* Modals - Tags */\n\nMailpile.UI.Modals.TagAdd = function(add_tag_data) {\n  Mailpile.API.with_template('modal-add-tag', function(modal) {\n    Mailpile.UI.show_modal(modal(add_tag_data));\n  });\n};\n\nMailpile.UI.Modals.TagAddProcess = function(location) {\n  var tag_data = $('#modal-form-tag-add').serialize();\n  Mailpile.API.tags_add_post(tag_data, function(result) {\n    var tag_template = Mailpile.safe_template($('#template-sidebar-item').html());\n    if (result.status == 'success' && location == 'sidebar') {\n      var tag_html = tag_template(result.result.added[0]);\n      $('#sidebar-tag').prepend(tag_html);\n      Mailpile.UI.prepare_new_content('#sidebar-tag');\n\n      // FIXME: these drag & drops probably break on non search views\n\n      $('#modal-full').modal('hide');\n    } else {\n      Mailpile.notification(result);\n    }\n  });  \n};/* Tag - Tag Add */\nMailpile.tag_add = function(tag_add, mids, complete) {\n  $.ajax({\n\t  url\t\t\t : Mailpile.api.tag,\n\t  type\t\t : 'POST',\n\t  data     : {\n      csrf: Mailpile.csrf_token,\n      add: tag_add,\n      mid: mids\n    },\n\t  dataType : 'json',\n    success  : function(response) {\n      if (response.status == 'success') {\n        complete(response.result);\n      } else {\n        Mailpile.notification(response);\n      }\n    }\n  });\n};\n\n\n/* Tag - Make Setting Data */\nMailpile.tag_setting = function(tid, setting, value) {\n  var key = 'tags.' + tid + '.' + setting;\n  var setting = {};\n  setting[key] = value;\n  return setting;\n};\n\n\n$(document).on('click', '#button-tag-change-icon', function() {\n  var modal_template = Mailpile.unsafe_template($(\"#modal-tag-icon-picker\").html());\n  Mailpile.UI.show_modal(modal_template({\n    icons: Mailpile.UI.tag_icons_as_lis()\n  }));\n});\n\n\n$(document).on('click', '#tag-edit-icon-picker .modal-tag-icon-option', function() {\n\n  var tid  = $('#data-tag-tid').val();\n  var old  = $('#data-tag-icon').val();\n  var icon = $(this).data('icon');\n\n  var setting = Mailpile.tag_setting(tid, 'icon', icon);\n  Mailpile.API.settings_set_post(setting, function(result) {\n\n    Mailpile.notification(result);\n\n    // Update Sidebar\n    $('#sidebar-tag-' + tid).find('span.icon').removeClass(old).addClass(icon);\n\n    // Update Tag Editor\n    $('#data-tag-icon').val(icon);\n    $('#tag-editor-icon').removeClass().addClass(icon);\n    $('#modal-full').modal('hide');\n  });\n});\n\n\n$(document).on('click', '#button-tag-change-label-color', function(e) {\n  var modal_html = $(\"#modal-tag-color-picker\").html();\n  var modal_template = Mailpile.unsafe_template(modal_html);\n  Mailpile.UI.show_modal(modal_template({\n    colors: Mailpile.UI.tag_colors_as_lis()\n  }));\n});\n\n\n$(document).on('click', '#tag-edit-color-picker .modal-tag-color-option', function(e) {\n\n  var tid   = $('#data-tag-tid').val();\n  var old   = $('#data-tag-label-color').val();\n  var name = $(this).data('name');\n  var hex = $(this).data('hex');\n\n  var setting = Mailpile.tag_setting(tid, 'label_color', name);\n  Mailpile.API.settings_set_post(setting, function(result) {\n\n    Mailpile.notification(result);\n\n    // Update Sidebar\n    $('#sidebar-tag-' + tid).find('span.icon').css('color', hex);\n\n    // Update Tag Editor\n    $('#data-tag-label-color').val(name);\n    $('#tag-editor-icon').css('color', hex);\n    $('#modal-full').modal('hide');\n  });\n});\n\n\n/* API - Tag Add */\n$(document).on('submit', '#form-tag-add', function(e) {\n  e.preventDefault();\n  var tag_data = $('#form-tag-add').serialize();\n  Mailpile.API.tags_add_post(tag_data, function() {\n    Mailpile.go('/tags/edit.html?only=' + $('#data-tag-add-slug').val());\n  });\n});\n\n\n/* Tag - Delete Tag */\n$(document).on('click', '#button-tag-delete', function(e) {\n  var tag_slug = $(this).data('slug');\n  if (confirm(\"Are you sure you want to delete this tag?\\n\"\n              + \"This action cannot be undone.\")) {\n    Mailpile.API.tags_delete_post({ tag: tag_slug }, function(response) {\n      Mailpile.go('/in/inbox/');\n    }, 'POST');\n  }\n});\n\n\n/* Tag - Toggle Archive */\n$(document).on('click', '#button-tag-toggle-archive', function(e) {\n  var new_message = $(this).data('message');\n  var old_message = $(this).html();\n  $(this).data('message', old_message);\n  $(this).html(new_message);\n  if ($('#tags-archived-list').hasClass('hide')) {\n    $('#tags-archived-list').removeClass('hide');\n  } else {\n    $('#tags-archived-list').addClass('hide');\n  }\n});\n\n\n/* Tag - Update the Name & Slug */\n$(document).on('blur', '#data-tag-add-tag', function(e) {\n  var settings = {};\n  settings['tags.' + $('#data-tag-tid').val() + '.name'] = $(this).val();\n  settings['tags.' + $('#data-tag-tid').val() + '.slug'] = $('#data-tag-add-slug').val();\n  Mailpile.API.settings_set_post(settings, function(result) {\n    Mailpile.notification(result);\n  });\n});\n\n\n/* Tag - Update the Slug */\n$(document).on('blur', '#data-tag-add-slug', function(e) {\n  var setting = Mailpile.tag_setting($('#data-tag-tid').val(), 'slug', $('#data-tag-add-slug').val());\n  Mailpile.API.settings_set_post(setting, function(result) {\n    Mailpile.notification(result);\n  });\n});\n\n\n/* Tag - Update (multiple attribute events) */\n$(document).on('change', '#data-tag-display', function(e) {\n  var setting = Mailpile.tag_setting($('#data-tag-tid').val(), 'display', $(this).val());\n  Mailpile.API.settings_set_post(setting, function(result) {\n    Mailpile.notification(result);\n  });\n});\n\n\n/* Tag - Update parent */\n$(document).on('change', '#data-tag-parent', function(e) {\n  var setting = Mailpile.tag_setting($('#data-tag-tid').val(), 'parent', $(this).val());\n  Mailpile.API.settings_set_post(setting, function(result) {\n    Mailpile.notification(result);\n  });\n});\n\n\n/* Tag - Update Label */\n$(document).on('change', '#data-tag-label', function(e) {\n  var label = 'false';\n  if ($(this).is(':checked')) {\n    label = 'true';\n  }\n  var setting = Mailpile.tag_setting($('#data-tag-tid').val(), 'label', label);\n  Mailpile.API.settings_set_post(setting, function(result) {\n    Mailpile.notification(result);\n  });\n});\n/* Tags - Tooltips */\n\nMailpile.Tags.Tooltips.CardSubtags = function() {\n  $('.tag-card-subtags').qtip({\n    content: {\n      title: false,\n      text: function(event, api) {\n        Mailpile.API.tags_get({ tid: $(this).data('tid').toString() },\n                              function(response) {\n          var tooltip_template = Mailpile.safe_template($('#tooltip-tag-subtags').html());\n          var tooltip_data = response.result.tags[0];\n          api.set('content.text', tooltip_template(tooltip_data));\n        });\n        return \"...\";\n      }\n    },\n    style: {\n      tip: {\n        target: $(this),\n        border: 0,\n        width: 10,\n        height: 10\n      },\n      classes: 'qtip-tag-details'\n    },\n    position: {\n      my: 'top center',\n      at: 'bottom center',\n      viewport: $('#content-view'),\n      adjust: {\n        x: -5,  y: 0\n      }\n    },\n    show: { delay: 100 },\n    hide: { fixed: true, delay: 350 }\n  });\n};\n/* JS - Message */\n/* Message - Create new instance of composer */\n\nMailpile.Message = {};\nMailpile.Message.Tooltips = {};\n\nMailpile.Message.setup = function($content) {\n  /* Drag & Drop */\n  Mailpile.UI.Message.Draggable($content.find('div.thread-draggable'));\n\n  /* Tooltips */\n  Mailpile.Message.Tooltips.Crypto($content);\n  Mailpile.Message.Tooltips.Attachments($content);\n};\n\nMailpile.Message.init = function() {\n  /* Scroll To */\n  Mailpile.UI.Message.ScrollToMessage();\n};\n\nMailpile.UI.content_setup.push(Mailpile.Message.setup);/* Thread - Show People In Conversation */\n$(document).on('click', '.show-thread-people', function() {\n  // FIXME: Old/unreliable modal code\n  $('#modal-full .modal-title').html($('#thread-people').data('modal_title'));\n  $('#modal-full .modal-body').html($('#thread-people').html());\n  $('#modal-full').modal(Mailpile.UI.modal_options);\n});\n\n\n/* Thread - Show Tags In Converstation */\n$(document).on('click', '.show-thread-tags', function() {\n  // FIXME: Old/unreliable modal code\n  $('#modal-full .modal-title').html($('#thread-tags').data('modal_title'));\n  $('#modal-full .modal-body').html($('#thread-tags').html());\n  $('#modal-full').modal(Mailpile.UI.modal_options);\n});\n\n\n/* Thread - Show Metadata Info */\n$(document).on('click', '.message-metadata-details-toggle', function() {\n  var mid = $(this).data('mid');\n  var target = '#metadata-details-' + mid;\n  if ($(target).css('display') === 'none') {\n    $(target).show('fast').addClass('border-bottom');\n    $(this).css('color', '#4d4d4d');\n  }\n  else {\n    $(target).hide('fast').removeClass('border-bottom');\n    $(this).css('color', '#ccc');\n  }\n});\n\n\n/* Thread - Expand Snippet */\n$(document).on('click', 'div.thread-snippet', function(e) {  \n  var mid = $(this).data('mid');\n  if (e.target.href === undefined && $(e.target).data('expand') !== 'no' && $(e.target).hasClass('show-message-metadata-details') === false) {\n    Mailpile.UI.Message.ShowMessage(mid);\n  }\n});\n\n\n/* Thread - Message Quote */\n$(document).on('click', '.message-actions-quote', function() {\n  var mid = $(this).parent().parent().data('mid');\n  $('#message-' + mid).find('.message-part-quote').removeClass('hide');\n  $('#message-' + mid).find('.message-part-signature').removeClass('hide');\n  $(this).parent().hide();\n});\n\n\n/* Thread - Might Move to Global Location / Abstraction */\n$(document).on('click', '.dropdown-toggle', function() {\n  $(this).find('.icon-arrow-right').removeClass('icon-arrow-right').addClass('icon-arrow-down');\n});\n\n\n$(document).on('click', '.message-toggle-html', function(e) {\n  var state = $(this).data('state');\n  var mid = $(this).data('mid');\n  if (state === 'plain') {\n    $(this).data('state', 'html');\n    $(this).html('Plain Text');\n    Mailpile.Message.ShowHTML(mid);\n  } else {\n    $(this).data('state', 'plain');\n    $(this).html('HTML');\n    Mailpile.Message.ShowPlain(mid);\n  }\n});\n\n\n$(document).on('click', '.message-show-html', function(e) {\n  var mid = $(this).closest('.has-mid').data('mid');\n  console.log('Should show message HTML parts for ' + mid);\n  Mailpile.Message.ShowHTML(mid);\n});\n\n\n$(document).on('click', '.message-show-text', function(e) {\n  var mid = $(this).closest('.has-mid').data('mid');\n  console.log('Should show message text parts ' + mid);\n  Mailpile.Message.ShowPlain(mid);\n});/* Message */\n\nMailpile.Message.AnalyzeMessageInline = function(mid) {\n  // Iterate through all plain-text parts of the e-mail\n  $('#message-' + mid).find('.message-part-text').each(function(i, text_part) {\n    var content = $(text_part).html();\n\n    // Check & Extract Inline PGP Key\n    var pgp_begin = '-----BEGIN PGP PUBLIC KEY BLOCK-----';\n    var pgp_end = '-----END PGP PUBLIC KEY BLOCK-----';\n    var check_inline_pgp_key = content.split(pgp_begin);\n    if (check_inline_pgp_key.length > 1) {\n      var pgp_key = check_inline_pgp_key.slice(1).join().split(pgp_end)[0];\n      pgp_key = pgp_begin + pgp_key + pgp_end;\n\n      // Make HTML5 download href\n      var pgp_href = 'data:application/pgp-keys;charset=ascii,' + encodeURIComponent(pgp_key.replace(/<\\/?[^>]+(>|$)/g, ''));\n\n      // Replace Text\n      // FIXME: Unsafe template, please audit\n      var key_template = Mailpile.unsafe_template($('#template-messsage-inline-pgp-key-import').html());\n      var name = Mailpile.instance.metadata[mid].from.fn;\n      var import_key_html = key_template({ pgp_key: pgp_key, pgp_href: pgp_href, mid: mid, name: name });\n      var new_content = content.replace(pgp_key, import_key_html);\n      $(text_part).html(new_content);\n    }\n  });\n};\n\n\n/* Message - Replies  */\nMailpile.Message.ShowReplyComposer = function(mid, response) {\n  var $msg = $('#message-' + mid);\n  if ($msg.hasClass('pile-message')) {\n    $msg.closest('td').html(response.result);\n  }\n  else {\n    $msg.append(response.result);\n    var new_mid = $msg.find('.form-compose').data('mid');\n    $('#compose-details-' + new_mid).hide();\n    $('#compose-to-summary-' + new_mid).show();\n    $('#compose-show-details-' + new_mid).show();\n  }\n};\n$(document).on('click', '.message-action-reply-all', function(e) {\n  e.preventDefault();\n  var mid = $(this).closest('.has-mid').data('mid');\n  Mailpile.API.message_reply_post({\n    mid: mid,\n    reply_all: 'True',\n    _output: 'composer.jhtml!minimal'\n  }, function(response) {\n    return Mailpile.Message.ShowReplyComposer(mid, response);\n  });\n});\n$(document).on('click', '.message-action-reply', function(e) {\n  e.preventDefault();\n  var mid = $(this).closest('.has-mid').data('mid');\n  Mailpile.API.message_reply_post({\n    mid: mid,\n    reply_all: 'False',\n    _output: 'composer.jhtml!minimal'\n  }, function(response) {\n    return Mailpile.Message.ShowReplyComposer(mid, response);\n  });\n});\n\n\n/* Message - Create forward and go to composer */\n$(document).on('click', '.message-action-forward', function(e) {\n  e.preventDefault();\n  var mid = $(this).closest('.has-mid').data('mid');\n  $.ajax({\n    url      : '/api/0/message/forward/',\n    type     : 'POST',\n    data     : {\n      csrf: Mailpile.csrf_token,\n      mid: mid,\n      atts: true\n    },\n    success  : function(response) {\n      if (response.status === 'success') {\n        Mailpile.go(Mailpile.urls.message_draft + response.result.created + '/');\n      } else {\n        Mailpile.notification(response);\n      }\n    }\n  });\n});\n\n\n/* Message - Move message to inbox */\n$(document).on('click', '.message-action-inbox', function(e) {\n  e.preventDefault();\n  var mid = $(this).closest('.has-mid').data('mid');\n  Mailpile.API.tag_post({ add: ['inbox'],  del: ['spam', 'trash'], mid: mid}, function() {\n    Mailpile.go('/in/inbox/');\n  });\n});\n\n\n/* Message - Move message to archive */\n$(document).on('click', '.message-action-archive', function() {\n  var mid = $(this).closest('.has-mid').data('mid');\n  Mailpile.API.tag_post({ add: '', del: ['inbox'], mid: mid}, function(response) {\n    Mailpile.go('/in/inbox/');\n  });\n});\n\n\n/* Message - Mark message as spam */\n$(document).on('click', '.message-action-spam', function() {\n  var mid = $(this).closest('.has-mid').data('mid');\n  Mailpile.API.tag_post({ add: ['spam'], del: ['trash', 'inbox'], mid: mid}, function() {\n    Mailpile.go('/in/inbox/');\n  });\n});\n\n\n/* Message - Unthread a message from thread */\n$(document).on('click', '.message-action-unthread', function() {\n  var mid = $(this).closest('.has-mid').data('mid');\n  $.ajax({\n    url      : '/api/0/message/unthread/',\n    type     : 'POST',\n    data     : {\n      csrf: Mailpile.csrf_token,\n      mid: mid\n    },\n    success  : function(response) {\n      if (response.status === 'success') {\n        var notification_data     = { url: Mailpile.urls.message_sent + mid + '/' };\n        var notification_template = Mailpile.safe_template($('#template-thread-notification-unthreaded').html());\n        var notification_html     = notification_template(notification_data);\n        $('#message-' + mid).removeClass('thread-snippet thread-message')\n                            .addClass('thread-notification')\n                            .html(notification_html);\n      } else {\n        Mailpile.notification(response);\n      }\n    }\n  });\n});\n\n\n/* Message - Move a message to trash */\n$(document).on('click', '.message-action-trash', function() {\n  var mid = $(this).closest('.has-mid').data('mid');\n  Mailpile.API.tag_post({ add: ['trash'], del: ['spam', 'inbox'], mid: mid}, function() {\n    Mailpile.go('/in/inbox/');\n  });\n});\n\n\n/* Message - Add Contact */\n$(document).on('click', '.message-action-add-contact', function(e) {\n\n  // FIXME: Does not work from Dropdown\n  e.preventDefault();\n  var mid = $(this).closest('.has-mid').data('mid');\n  var modal_data = {\n    name: $(this).data('name'),\n    address: $(this).data('address'),\n    signature: 'FIXME: ' + $('#message-' + mid).find('.message-part-signature').html(),\n    mid: mid\n  };\n\n  Mailpile.API.with_template('modal-contact-add', function(modal) {\n    Mailpile.UI.show_modal(modal(modal_data));\n  });\n});\n\n\n/* Message - Unsubscribe */\n$(document).on('click', '.message-action-unsubscribe', function(e) {\n  e.preventDefault();\n  alert('FIXME: this should compose an email to: ' + $(this).data('unsubscribe'));\n  //Mailpile.activities.compose($(this).data('unsubscribe'));\n});\n\n\n/* Message - Discover keys */\n$(document).on('click', '.message-action-find-keys', function(e) {\n  e.preventDefault();\n  Mailpile.UI.Modals.CryptoFindKeys({\n    query: $(this).data('email')\n  });\n});\n\n\n/* Message - Import key from a message */\n$(document).on('click', '.message-action-import-key', function() {\n  // FIXME: This is old/unreliable modal code\n  $('#modal-full .modal-title').html('<span class=\"icon-key\"></span> Import Key');\n  $('#modal-full .modal-body').html('<p>Eventually this will import a PGP key to a contact.</p>');\n  $('#modal-full').modal(Mailpile.UI.modal_options);\n});\n\n\n/* Message - Crypto Feedback Actions */\n$(document).on('click', '.message-crypto-action', function() {\n  Mailpile.API.crypto_gpg_keylist_secret_get({}, function(result) {\n    var mid = $(this).data('mid');\n    var modal_data = { name: 'User Name', address: 'name@address.org' };\n    Mailpile.API.with_template('modal-send-public-key', function(modal) {\n      var key_html = '';\n      _.each(result.result, function(key) {\n        var key_template = Mailpile.safe_template($('#template-modal-private-key-item').html());\n        key_html += key_template(key);\n      });\n\n      $('#modal-full').html(modal(modal_data));\n      $('#crypto-private-key-list').html(key_html);\n      Mailpile.UI.show_modal();\n    });\n  });\n});\n\n\n/* Message - Investigate a message with error or missing crypto state */\n$(document).on('click', '.message-crypto-investigate', function() {\n\n  var mid = $(this).data('mid');\n  var part = $(this).data('part');\n  var message = Mailpile.instance.messages[mid];\n  var missing_keys = message.text_parts[part].crypto.encryption.missing_keys;\n\n  // Search Keyservers Missing Keys\n  if (missing_keys.length) {\n    // FIXME: this needs to search all \"missing_key\" values\n    // this is tricky as searching multiple calls to keyservers\n    // can have much latency and slowness\n    Mailpile.API.crypto_gpg_searchkey_get(missing_keys[0], function(data) {\n      // FIXME: Unsafe template, please audit\n      var modal_template = Mailpile.unsafe_template($(\"#modal-search-keyservers\").html());\n      Mailpile.UI.show_modal(modal_template({\n        keys: '<li>Key of User #1</li>'\n      }));\n    });\n  }\n});\n\n\n$(document).on('click', '.message-crypto-show-inline-key', function() {\n  $(this).hide();\n  $('#message-crypto-inline-key-' + $(this).data('mid')).fadeIn();\n});\n// HTML mail display & sandboxing\n\n\nMailpile.Message.ShowHTMLLegacy = function(mid, $old_message_body, html_data) {\n  // Inject iframe\n  $old_message_body.append(\n    '<iframe id=\"message-iframe-' + mid +\n    '\" class=\"message-part-html\" sandbox=\"allow-same-origin ' +\n    'allow-popups allow-top-navigation\" ' +\n    'seamless target=\"_blank\" srcdoc=\"\"></iframe>');\n\n  // Add html parts\n  var html_parts = '';\n  _.each(html_data, function(part, key) {\n    html_parts += part.data;\n  });\n  $('#message-iframe-' + mid).attr('srcdoc', DOMPurify.sanitize(html_parts));\n\n  // Resize & Style\n  setTimeout(function() {\n    var iframe_height = $('#message-iframe-' + mid).contents().height();\n    $('#message-iframe-' + mid).height(iframe_height);\n    $('#message-iframe-' + mid).contents().find('body').addClass('message-part-html-text');\n  }, 100);\n};\n\n\nMailpile.Message.AddDOMPurifyHooks = function(with_image_proxy,\n                                              changes_callback) {\n  // The following code is based on dompurify/demos/hooks-proxy-demo.html and\n  // the whiteout.io sandbox implementation.\n  function proxy() {\n    if (changes_callback) changes_callback();\n    if (with_image_proxy) {\n      return (\n        Mailpile.API._sync_url +\n        Mailpile.API._endpoints['http_proxy_get'] +\n        '?csrf=' +\n        Mailpile.csrf_token +\n        '&url='\n      );\n    }\n    else {\n      // Replace all images with a 1x100 transparent PNG, yay!\n      // Note: using a 1x1 square results in large square empty\n      //       spaces in many e-mails, because only the width is\n      //       defined in the HTML; and the hight gets scaled\n      //       proportionally. Thus the 1x100 ratio instead.\n      return Mailpile.API.U('/static/img/1x100.png#old=');\n    }\n  }\n\n  // Specify attributes to proxy\n  var attributes = ['background', 'href', 'src'];  // not: 'action', 'poster'\n\n  // specify the regex to detect external content\n  var url_regex = /(url\\(\"?)(?!data:)/gim;\n\n  /**\n   *  Take CSS property-value pairs and proxy URLs in values,\n   *  then add the styles to an array of property-value pairs\n   */\n  function addStyles(output, styles) {\n    for (var prop = styles.length-1; prop >= 0; prop--) {\n      if (styles[styles[prop]]) {\n        var url = styles[styles[prop]].replace(url_regex, '$1' + proxy());\n        styles[styles[prop]] = url;\n      }\n      if (styles[styles[prop]]) {\n        output.push(styles[prop] + ':' + styles[styles[prop]] + ';');\n      }\n    }\n  }\n\n  /**\n   * Take CSS rules and analyze them, proxy URLs via addStyles(),\n   * then create matching CSS text for later application to the DOM\n   */\n  function addCSSRules(output, cssRules) {\n    for (var index=cssRules.length-1; index>=0; index--) {\n      var rule = cssRules[index];\n      // check for rules with selector\n      if (rule.type == 1 && rule.selectorText) {\n        output.push(rule.selectorText + '{')\n        if (rule.style) {\n          addStyles(output, rule.style)\n        }\n        output.push('}');\n      // check for @media rules\n      } else if (rule.type === rule.MEDIA_RULE) {\n        output.push('@media ' + rule.media.mediaText + '{');\n        addCSSRules(output, rule.cssRules)\n        output.push('}');\n      // check for @font-face rules\n      } else if (rule.type === rule.FONT_FACE_RULE) {\n        output.push('@font-face {');\n        if (rule.style) {\n          addStyles(output, rule.style)\n        }\n        output.push('}');\n      // check for @keyframes rules\n      } else if (rule.type === rule.KEYFRAMES_RULE) {\n        output.push('@keyframes ' + rule.name + '{');\n        for (var i=rule.cssRules.length-1;i>=0;i--) {\n          var frame = rule.cssRules[i];\n          if (frame.type === 8 && frame.keyText) {\n            output.push(frame.keyText + '{');\n            if (frame.style) {\n              addStyles(output, frame.style);\n            }\n            output.push('}');\n          }\n        }\n        output.push('}');\n      }\n    }\n  }\n\n  /**\n   * Proxy a URL in case it's not a Data URI\n   */\n  function proxyAttribute(url) {\n    if (/^data:image\\//.test(url)) {\n      return url;\n    } else {\n      return proxy() + escape(url)\n    }\n  }\n\n  // Add a hook to enforce proxy for leaky CSS rules\n  DOMPurify.removeHooks('uponSanitizeElement');\n  DOMPurify.addHook('uponSanitizeElement', function (node, data) {\n    if (data.tagName === 'style') {\n      var output  = [];\n      addCSSRules(output, node.sheet.cssRules);\n      node.textContent = output.join(\"\\n\");\n    }\n  });\n\n  DOMPurify.removeHooks('afterSanitizeAttributes');\n  DOMPurify.addHook('afterSanitizeAttributes', function(node) {\n    if ('target' in node) {\n      // This is a belt-and-suspenders thing, in case the load()\n      // event below does not fire.\n      node.setAttribute('target', '_blank');\n    }\n    else if (node.hasAttribute('xlink:href') ||\n             node.hasAttribute('href')) {\n      node.setAttribute('xlink:show', 'new');\n    }\n\n    // Check all src attributes and proxy them\n    if (node.nodeName != 'A') {\n      for(var i = 0; i <= attributes.length-1; i++) {\n        if (node.hasAttribute(attributes[i])) {\n          node.setAttribute(attributes[i], proxyAttribute(\n            node.getAttribute(attributes[i]))\n          );\n        }\n      }\n    }\n\n    // Check all style attribute values and proxy them\n    if (node.hasAttribute('style')) {\n      var styles = node.style;\n      var output = [];\n      for (var prop = styles.length-1; prop >= 0; prop--) {\n        // we re-write each property-value pair to remove invalid CSS\n        if (node.style[styles[prop]] && url_regex.test(node.style[styles[prop]])) {\n          var url = node.style[styles[prop]].replace(url_regex, '$1' + proxy())\n          node.style[styles[prop]] = url; \n        }\n        output.push(styles[prop] + ':' + node.style[styles[prop]] + ';');\n      }\n      // re-add styles in case any are left\n      if (output.length) {\n        node.setAttribute('style', output.join(\"\"));\n      } else {\n        node.removeAttribute('style');\n      }\n    }\n  });\n};\n\n\nMailpile.Message.SetHTMLPolicy = function(mid, old_policy, new_policy) {\n  // Record as preference on VCard\n  var $from = $('.pile-message-' + mid).find('.from');\n  if ($from.length > 0 && (!old_policy || old_policy != new_policy)) {\n    Mailpile.API.contacts_set_post({\n      'fn': $from.data('fn'),\n      'email': $from.data('address'),\n      'name': 'x-mailpile-html-policy',\n      'value': new_policy\n    });\n  }\n};\n\n\nMailpile.Message.SandboxHTML = function(part_id, $part, html_data, policy) {\n  var $wrapper = $('<div/>');\n  var $iframe = $(\n    '<iframe id=\"message-iframe-' + part_id + '\" seamless' +\n    // IMPORTANT: Do not allow-scripts!\n    ' sandbox=\"allow-same-origin' +    // Let us manipulate iframe contents\n    '          allow-top-navigation' + // Allow clickable links\n    '          allow-popups\"' +        // Allow links to target=_blank\n    ' class=\"message-part-html\" target=\"_blank\" srcdoc=\"\"></iframe>');\n\n  $iframe.load(function() {\n    var $contents = $iframe.contents();\n\n    // Make clicked links open in new window\n    $contents.find('a').attr('target', '_blank');\n    // FIXME: What to do about mailto: links? Convert them into links to\n    //        mailpile itself? That sounds about right.\n\n    // Copy some defaults from our CSS...\n    $contents.find('body').css('color', $part.css('color'))\n                          .css('background', $part.css('background'));\n\n    // Adjust size - the trick here is we let the $iframe load, and\n    // once it is ready, we ask how big it is. We then resize the IFrame\n    // to have the same width and height (to get rid of scroll bars) and\n    // finally use a CSS transform to scale the whole thing down so it\n    // fits again. The $wrapper keeps all this from affecting the rest\n    // of the page.\n    var cheight = $contents.outerHeight();\n    var cwidth = $contents.outerWidth();\n    var iwidth = $part.width();\n    if (cwidth > iwidth) {\n      var scale = iwidth / cwidth;\n      if (scale < 0.6) scale = 0.6; // FIXME: Breaks ratios below\n      $iframe.css({\n        'width': cwidth + 'px',\n        'height': (15 / scale + cheight) + 'px',\n        'margin': 0, 'padding': 0,\n        'transform': 'scale(' + scale + ')',\n        'transform-origin': '0 0'\n      });\n      $wrapper.height(15 + cheight * scale);\n    }\n    else {\n      $iframe.height(15 + cheight);\n      $wrapper.height(15 + cheight);\n    }\n  });\n\n  // Sanitize the HTML: the sandbox keeps Javascript from running\n  // and blocks any external content-loads; we're mainly using\n  // DOMPurify to rewrite image references to go through our proxy,\n  // as per the code above.\n  var changes = 0;\n  Mailpile.Message.AddDOMPurifyHooks(policy == 'images',\n                                     function() { changes += 1 });\n  $iframe.attr('srcdoc', DOMPurify.sanitize(html_data, {\n    WHOLE_DOCUMENT: true, \n  }));\n\n  if (changes > 0 && policy != 'images') {\n    $msg_details = $part.closest('.has-mid').find('.message-details');\n    $msg_details.find('.html-image-question').remove();\n    $msg_details.append($(\n      '<div class=\"message-app-note html-image-question\"><p>' +\n      '  <span class=\"icon icon-eye\"></span>' +\n      '  This message references images or other content from the web. Downloading and displaying these images may notify the sender that you have read the mail.' +\n      '</p><ul>' +\n      '  <li><a class=\"display-now\">Okay, display the images</a>' +\n      '  <li><a class=\"display-always\">Always display images from this sender</a>' +\n      '  <li><a class=\"dismiss\">No, thanks!</a>' +\n      '</ull></div>'\n    ));\n    $msg_details.find('.display-now').click(function() {\n      $wrapper.remove();\n      Mailpile.Message.SandboxHTML(part_id, $part, html_data, 'images');\n    });\n    $msg_details.find('.display-always').click(function() {\n      $wrapper.remove();\n      $msg_details.find('.html-image-question').remove();\n      Mailpile.Message.SandboxHTML(part_id, $part, html_data, 'images');\n      Mailpile.Message.SetHTMLPolicy($part.closest('.has-mid').data('mid'),\n                                     policy, 'images');\n    });\n    $msg_details.find('.dismiss').click(function() {\n      $msg_details.find('.html-image-question').remove();\n    });\n  }\n\n  // More size adjusting hackery. See comment above.\n  $wrapper.css({\n    'width': $part.width(),\n    'margin': 0,\n    'padding': 0,\n    'display': 'block',\n    'position': 'relative',\n    'overflow': 'hidden'\n  });\n  $wrapper.append($iframe);\n  $part.append($wrapper);\n  $wrapper.width($part.width());\n};\n\n\nMailpile.Message.ShowHTML = function(mid, policy) {\n  // HTML Parts Exist\n  var $msg = $('#message-' + mid);\n  var html_data = $msg.data('html');\n  if (html_data) {\n    $msg = $msg.closest('.has-mid');\n    $msg.find('.pile-message-html-part').show();\n    $msg.find('.html-image-question').show();\n    $msg.find('.html-display-hint').hide();\n    $msg.find('.message-part-text, .pile-message-text-part').hide();\n\n    // FIXME: Legacy code, kill kill kill\n    var $old_message_body = $msg.find('.thread-message-body');\n    if ($old_message_body.length > 0) {\n      Mailpile.Message.ShowHTMLLegacy(mid, $old_message_body, html_data);\n    }\n    else {\n      for (var i in html_data) {\n        var part_id = mid + '-' + (1 + parseInt(i));\n        var $part = $('#html-part-' + part_id);\n        if ($part.find('.noframe').length > 0) {\n          Mailpile.Message.SandboxHTML(part_id, $part, html_data[i].data, policy);\n          $part.find('.noframe').remove();\n        }\n      }\n      if (!policy || policy == 'none') {\n        Mailpile.Message.SetHTMLPolicy(mid, policy, 'display');\n      }\n    }\n  } else {\n    // FIXME: Hardcoded untranslated stuff here, ick ick.\n    $msg.find('.thread-message-body').append('<em>Message does not have any HTML parts</em>');\n  }\n};\n\n\nMailpile.Message.ShowPlain = function(mid, policy) {\n  var $msg = $('#message-' + mid).closest('.has-mid');\n  $msg.find('#message-iframe-' + mid).remove();\n  $msg.find('.html-image-question').hide();\n  $msg.find('.pile-message-html-part').hide();\n  $msg.find('.message-part-text, .pile-message-text-part').show();\n  Mailpile.Message.SetHTMLPolicy(mid, policy, 'none');\n};Mailpile.Message.Tooltips.Crypto = function($content) {\n  $content.find('.message-part-crypto-info, ' +\n                '.message-inline-crypto-info, ' +\n                '.message-metadata-crypto-info').qtip({\n    content: {\n      title: false,\n      text: function(event, api) {\n        var html = '<div>\\\n          <h4 class=\"' + $(this).data('crypto_color') + '\">\\\n            <span class=\"' + $(this).data('crypto_icon') + '\"></span>' + $(this).attr('title') + '\\\n          </h4>\\\n          <p>' + $(this).data('crypto_message') + '</p>\\\n          </div>';\n        return html;\n      }\n    },\n    style: {\n      classes: 'qtip-thread-crypto',\n      tip: {\n        corner: 'bottom center',\n        mimic: 'bottom center',\n        border: 1,\n        width: 12,\n        height: 12,\n        corner: true\n      }\n    },\n    position: {\n      my: 'bottom center',\n      at: 'top center',\n\t\t\tviewport: $(window),\n\t\t\tadjust: {\n\t\t\t\ty: -5\n\t\t\t}\n    },\n    show: { delay: 100 },\n    hide: { fixed: true, delay: 250 }\n  });\n};\n\n\nMailpile.Message.Tooltips.Attachments = function($content) {\n  $content.find('a.attachment, a.attachment-image').qtip({\n    content: {\n      title: false,\n      text: function(event, api) {\n        console.log($(this));\n        var html = '';\n          html += $(this).attr('title')\n          html += '<small>Download ' + $(this).data('size') + '</small>';\n        return html;\n      }\n    },\n    style: {\n      classes: 'qtip-tipped',\n      tip: {\n        corner: 'bottom center',\n        mimic: 'bottom center',\n        border: 1,\n        width: 12,\n        height: 12,\n        corner: true\n      }\n    },\n    position: {\n      my: 'bottom center',\n      at: 'top center',\n\t\t\tviewport: $(window),\n\t\t\tadjust: {\n\t\t\t\tx: 0, y: -5\n\t\t\t}\n    },\n    show: { delay: 100 },\n    hide: { fixed: true, delay: 250 }\n  });\n};/* UI - Message */\n\nMailpile.UI.Message.ShowMessage = function(mid) {\n  var done_loading = Mailpile.notify_working(\"Loading message...\",\n                                             500);\n  var failed = function() {\n    done_loading();\n    Mailpile.notification({\n      status: 'error',\n      message: 'Could not retrieve message'\n    });\n  }\n  Mailpile.API.message_get({\n    mid: mid,\n    _output: 'single.jhtml!minimal',\n    _error_callback: failed\n  }, function(response) {\n    if (response.result) {\n      done_loading();\n      $('#message-' + mid).replaceWith(response.result);\n      Mailpile.UI.prepare_new_content($('#message-' + mid));\n    }\n    else failed();\n  });\n};\n\n\nMailpile.UI.Message.ScrollToMessage = function() {\n\n  var msg_top_pos = 0;\n  var check_new = $('#content-view').find('div.new');\n\n  if (check_new.length) {\n    var unread_thread_id = $(check_new[0]).data('mid');\n    msg_top_pos = $('#message-' + unread_thread_id).position().top + 1;\n  } \n  else {\n    var full_message = $('#content-view').find('div.thread-message');\n    if (full_message.length) {\n      var thread_id = $(full_message[0]).data('mid');\n      msg_top_pos = $('#message-' + thread_id).position().top + 1;\n    }\n  }\n\n  // Scroll To\n  setTimeout(function(){\n    $('#content-view').animate({ scrollTop: msg_top_pos }, 450);\n  }, 50);\n};\n\n\nMailpile.UI.Message.Draggable = function(element) {\n  $(element).draggable({\n    containment: 'window',\n    appendTo: 'body',\n    cursor: 'move',\n    scroll: false,\n    revert: false,\n    opacity: 1,\n    helper: function(event) {\n      return $('<div class=\"pile-results-drag ui-widget-header\"><span class=\"icon-inbox\"></span> Moving Thread</div>');\n    },\n    start: function(event, ui) {\n      Mailpile.ui_in_action += 1;\n  \n      // FIXME: This should all come from the DOM; and a checkbox needs to\n      //        live in the DOM as well for the standard drag/drop code to\n      //        work.\n\n      // Add Draggable MID\n      var mid = location.href.split(\"thread/=\")[1].split(\"/\")[0];\n      Mailpile.bulk_cache_add('messages_cache', mid);\n  \n      // Update Bulk UI\n      // Style & Select Checkbox\n    },\n    stop: function(event, ui) {\n      setTimeout(function() { Mailpile.ui_in_action -= 1; }, 250);\n    }\n  });\n};"},"http://localhost:33411/static/js/libraries.min.js?ts=1.0.0rc0":{"mimeType":"text/javascript","source":"!function(global,factory){\"use strict\";\"object\"==typeof module&&\"object\"==typeof module.exports?module.exports=global.document?factory(global,!0):function(w){if(!w.document)throw new Error(\"jQuery requires a window with a document\");return factory(w)}:factory(global)}(\"undefined\"!=typeof window?window:this,function(window,noGlobal){\"use strict\";var arr=[],document=window.document,getProto=Object.getPrototypeOf,slice=arr.slice,concat=arr.concat,push=arr.push,indexOf=arr.indexOf,class2type={},toString=class2type.toString,hasOwn=class2type.hasOwnProperty,fnToString=hasOwn.toString,ObjectFunctionString=fnToString.call(Object),support={};function DOMEval(code,doc){var script=(doc=doc||document).createElement(\"script\");script.text=code,doc.head.appendChild(script).parentNode.removeChild(script)}var jQuery=function(selector,context){return new jQuery.fn.init(selector,context)},rtrim=/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g,rmsPrefix=/^-ms-/,rdashAlpha=/-([a-z])/g,fcamelCase=function(all,letter){return letter.toUpperCase()};function isArrayLike(obj){var length=!!obj&&\"length\"in obj&&obj.length,type=jQuery.type(obj);return\"function\"!==type&&!jQuery.isWindow(obj)&&(\"array\"===type||0===length||\"number\"==typeof length&&length>0&&length-1 in obj)}jQuery.fn=jQuery.prototype={jquery:\"3.2.1\",constructor:jQuery,length:0,toArray:function(){return slice.call(this)},get:function(num){return null==num?slice.call(this):num<0?this[num+this.length]:this[num]},pushStack:function(elems){var ret=jQuery.merge(this.constructor(),elems);return ret.prevObject=this,ret},each:function(callback){return jQuery.each(this,callback)},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)}))},slice:function(){return this.pushStack(slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(i){var len=this.length,j=+i+(i<0?len:0);return this.pushStack(j>=0&&j<len?[this[j]]:[])},end:function(){return this.prevObject||this.constructor()},push:push,sort:arr.sort,splice:arr.splice},jQuery.extend=jQuery.fn.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=!1;for(\"boolean\"==typeof target&&(deep=target,target=arguments[i]||{},i++),\"object\"==typeof target||jQuery.isFunction(target)||(target={}),i===length&&(target=this,i--);i<length;i++)if(null!=(options=arguments[i]))for(name in options)src=target[name],target!==(copy=options[name])&&(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=Array.isArray(copy)))?(copyIsArray?(copyIsArray=!1,clone=src&&Array.isArray(src)?src:[]):clone=src&&jQuery.isPlainObject(src)?src:{},target[name]=jQuery.extend(deep,clone,copy)):void 0!==copy&&(target[name]=copy));return target},jQuery.extend({expando:\"jQuery\"+(\"3.2.1\"+Math.random()).replace(/\\D/g,\"\"),isReady:!0,error:function(msg){throw new Error(msg)},noop:function(){},isFunction:function(obj){return\"function\"===jQuery.type(obj)},isWindow:function(obj){return null!=obj&&obj===obj.window},isNumeric:function(obj){var type=jQuery.type(obj);return(\"number\"===type||\"string\"===type)&&!isNaN(obj-parseFloat(obj))},isPlainObject:function(obj){var proto,Ctor;return!(!obj||\"[object Object]\"!==toString.call(obj))&&(!(proto=getProto(obj))||\"function\"==typeof(Ctor=hasOwn.call(proto,\"constructor\")&&proto.constructor)&&fnToString.call(Ctor)===ObjectFunctionString)},isEmptyObject:function(obj){var name;for(name in obj)return!1;return!0},type:function(obj){return null==obj?obj+\"\":\"object\"==typeof obj||\"function\"==typeof obj?class2type[toString.call(obj)]||\"object\":typeof obj},globalEval:function(code){DOMEval(code)},camelCase:function(string){return string.replace(rmsPrefix,\"ms-\").replace(rdashAlpha,fcamelCase)},each:function(obj,callback){var length,i=0;if(isArrayLike(obj))for(length=obj.length;i<length&&!1!==callback.call(obj[i],i,obj[i]);i++);else for(i in obj)if(!1===callback.call(obj[i],i,obj[i]))break;return obj},trim:function(text){return null==text?\"\":(text+\"\").replace(rtrim,\"\")},makeArray:function(arr,results){var ret=results||[];return null!=arr&&(isArrayLike(Object(arr))?jQuery.merge(ret,\"string\"==typeof arr?[arr]:arr):push.call(ret,arr)),ret},inArray:function(elem,arr,i){return null==arr?-1:indexOf.call(arr,elem,i)},merge:function(first,second){for(var len=+second.length,j=0,i=first.length;j<len;j++)first[i++]=second[j];return first.length=i,first},grep:function(elems,callback,invert){for(var matches=[],i=0,length=elems.length,callbackExpect=!invert;i<length;i++)!callback(elems[i],i)!==callbackExpect&&matches.push(elems[i]);return matches},map:function(elems,callback,arg){var length,value,i=0,ret=[];if(isArrayLike(elems))for(length=elems.length;i<length;i++)null!=(value=callback(elems[i],i,arg))&&ret.push(value);else for(i in elems)null!=(value=callback(elems[i],i,arg))&&ret.push(value);return concat.apply([],ret)},guid:1,proxy:function(fn,context){var tmp,args,proxy;if(\"string\"==typeof context&&(tmp=fn[context],context=fn,fn=tmp),jQuery.isFunction(fn))return args=slice.call(arguments,2),(proxy=function(){return fn.apply(context||this,args.concat(slice.call(arguments)))}).guid=fn.guid=fn.guid||jQuery.guid++,proxy},now:Date.now,support:support}),\"function\"==typeof Symbol&&(jQuery.fn[Symbol.iterator]=arr[Symbol.iterator]),jQuery.each(\"Boolean Number String Function Array Date RegExp Object Error Symbol\".split(\" \"),function(i,name){class2type[\"[object \"+name+\"]\"]=name.toLowerCase()});var Sizzle=function(window){var i,support,Expr,getText,isXML,tokenize,compile,select,outermostContext,sortInput,hasDuplicate,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando=\"sizzle\"+1*new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),sortOrder=function(a,b){return a===b&&(hasDuplicate=!0),0},hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=function(list,elem){for(var i=0,len=list.length;i<len;i++)if(list[i]===elem)return i;return-1},booleans=\"checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped\",whitespace=\"[\\\\x20\\\\t\\\\r\\\\n\\\\f]\",identifier=\"(?:\\\\\\\\.|[\\\\w-]|[^\\0-\\\\xa0])+\",attributes=\"\\\\[\"+whitespace+\"*(\"+identifier+\")(?:\"+whitespace+\"*([*^$|!~]?=)\"+whitespace+\"*(?:'((?:\\\\\\\\.|[^\\\\\\\\'])*)'|\\\"((?:\\\\\\\\.|[^\\\\\\\\\\\"])*)\\\"|(\"+identifier+\"))|)\"+whitespace+\"*\\\\]\",pseudos=\":(\"+identifier+\")(?:\\\\((('((?:\\\\\\\\.|[^\\\\\\\\'])*)'|\\\"((?:\\\\\\\\.|[^\\\\\\\\\\\"])*)\\\")|((?:\\\\\\\\.|[^\\\\\\\\()[\\\\]]|\"+attributes+\")*)|.*)\\\\)|)\",rwhitespace=new RegExp(whitespace+\"+\",\"g\"),rtrim=new RegExp(\"^\"+whitespace+\"+|((?:^|[^\\\\\\\\])(?:\\\\\\\\.)*)\"+whitespace+\"+$\",\"g\"),rcomma=new RegExp(\"^\"+whitespace+\"*,\"+whitespace+\"*\"),rcombinators=new RegExp(\"^\"+whitespace+\"*([>+~]|\"+whitespace+\")\"+whitespace+\"*\"),rattributeQuotes=new RegExp(\"=\"+whitespace+\"*([^\\\\]'\\\"]*?)\"+whitespace+\"*\\\\]\",\"g\"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp(\"^\"+identifier+\"$\"),matchExpr={ID:new RegExp(\"^#(\"+identifier+\")\"),CLASS:new RegExp(\"^\\\\.(\"+identifier+\")\"),TAG:new RegExp(\"^(\"+identifier+\"|[*])\"),ATTR:new RegExp(\"^\"+attributes),PSEUDO:new RegExp(\"^\"+pseudos),CHILD:new RegExp(\"^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\\\(\"+whitespace+\"*(even|odd|(([+-]|)(\\\\d*)n|)\"+whitespace+\"*(?:([+-]|)\"+whitespace+\"*(\\\\d+)|))\"+whitespace+\"*\\\\)|)\",\"i\"),bool:new RegExp(\"^(?:\"+booleans+\")$\",\"i\"),needsContext:new RegExp(\"^\"+whitespace+\"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\\\(\"+whitespace+\"*((?:-\\\\d)?\\\\d*)\"+whitespace+\"*\\\\)|)(?=[^-]|$)\",\"i\")},rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\\d$/i,rnative=/^[^{]+\\{\\s*\\[native \\w/,rquickExpr=/^(?:#([\\w-]+)|(\\w+)|\\.([\\w-]+))$/,rsibling=/[+~]/,runescape=new RegExp(\"\\\\\\\\([\\\\da-f]{1,6}\"+whitespace+\"?|(\"+whitespace+\")|.)\",\"ig\"),funescape=function(_,escaped,escapedWhitespace){var high=\"0x\"+escaped-65536;return high!=high||escapedWhitespace?escaped:high<0?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,1023&high|56320)},rcssescape=/([\\0-\\x1f\\x7f]|^-?\\d)|^-$|[^\\0-\\x1f\\x7f-\\uFFFF\\w-]/g,fcssescape=function(ch,asCodePoint){return asCodePoint?\"\\0\"===ch?\"\":ch.slice(0,-1)+\"\\\\\"+ch.charCodeAt(ch.length-1).toString(16)+\" \":\"\\\\\"+ch},unloadHandler=function(){setDocument()},disabledAncestor=addCombinator(function(elem){return!0===elem.disabled&&(\"form\"in elem||\"label\"in elem)},{dir:\"parentNode\",next:\"legend\"});try{push.apply(arr=slice.call(preferredDoc.childNodes),preferredDoc.childNodes),arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els))}:function(target,els){for(var j=target.length,i=0;target[j++]=els[i++];);target.length=j-1}}}function Sizzle(selector,context,results,seed){var m,i,elem,nid,match,groups,newSelector,newContext=context&&context.ownerDocument,nodeType=context?context.nodeType:9;if(results=results||[],\"string\"!=typeof selector||!selector||1!==nodeType&&9!==nodeType&&11!==nodeType)return results;if(!seed&&((context?context.ownerDocument||context:preferredDoc)!==document&&setDocument(context),context=context||document,documentIsHTML)){if(11!==nodeType&&(match=rquickExpr.exec(selector)))if(m=match[1]){if(9===nodeType){if(!(elem=context.getElementById(m)))return results;if(elem.id===m)return results.push(elem),results}else if(newContext&&(elem=newContext.getElementById(m))&&contains(context,elem)&&elem.id===m)return results.push(elem),results}else{if(match[2])return push.apply(results,context.getElementsByTagName(selector)),results;if((m=match[3])&&support.getElementsByClassName&&context.getElementsByClassName)return push.apply(results,context.getElementsByClassName(m)),results}if(support.qsa&&!compilerCache[selector+\" \"]&&(!rbuggyQSA||!rbuggyQSA.test(selector))){if(1!==nodeType)newContext=context,newSelector=selector;else if(\"object\"!==context.nodeName.toLowerCase()){for((nid=context.getAttribute(\"id\"))?nid=nid.replace(rcssescape,fcssescape):context.setAttribute(\"id\",nid=expando),i=(groups=tokenize(selector)).length;i--;)groups[i]=\"#\"+nid+\" \"+toSelector(groups[i]);newSelector=groups.join(\",\"),newContext=rsibling.test(selector)&&testContext(context.parentNode)||context}if(newSelector)try{return push.apply(results,newContext.querySelectorAll(newSelector)),results}catch(qsaError){}finally{nid===expando&&context.removeAttribute(\"id\")}}}return select(selector.replace(rtrim,\"$1\"),context,results,seed)}function createCache(){var keys=[];return function cache(key,value){return keys.push(key+\" \")>Expr.cacheLength&&delete cache[keys.shift()],cache[key+\" \"]=value}}function markFunction(fn){return fn[expando]=!0,fn}function assert(fn){var el=document.createElement(\"fieldset\");try{return!!fn(el)}catch(e){return!1}finally{el.parentNode&&el.parentNode.removeChild(el),el=null}}function addHandle(attrs,handler){for(var arr=attrs.split(\"|\"),i=arr.length;i--;)Expr.attrHandle[arr[i]]=handler}function siblingCheck(a,b){var cur=b&&a,diff=cur&&1===a.nodeType&&1===b.nodeType&&a.sourceIndex-b.sourceIndex;if(diff)return diff;if(cur)for(;cur=cur.nextSibling;)if(cur===b)return-1;return a?1:-1}function createInputPseudo(type){return function(elem){return\"input\"===elem.nodeName.toLowerCase()&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return(\"input\"===name||\"button\"===name)&&elem.type===type}}function createDisabledPseudo(disabled){return function(elem){return\"form\"in elem?elem.parentNode&&!1===elem.disabled?\"label\"in elem?\"label\"in elem.parentNode?elem.parentNode.disabled===disabled:elem.disabled===disabled:elem.isDisabled===disabled||elem.isDisabled!==!disabled&&disabledAncestor(elem)===disabled:elem.disabled===disabled:\"label\"in elem&&elem.disabled===disabled}}function createPositionalPseudo(fn){return markFunction(function(argument){return argument=+argument,markFunction(function(seed,matches){for(var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;i--;)seed[j=matchIndexes[i]]&&(seed[j]=!(matches[j]=seed[j]))})})}function testContext(context){return context&&void 0!==context.getElementsByTagName&&context}for(i in support=Sizzle.support={},isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return!!documentElement&&\"HTML\"!==documentElement.nodeName},setDocument=Sizzle.setDocument=function(node){var hasCompare,subWindow,doc=node?node.ownerDocument||node:preferredDoc;return doc!==document&&9===doc.nodeType&&doc.documentElement?(docElem=(document=doc).documentElement,documentIsHTML=!isXML(document),preferredDoc!==document&&(subWindow=document.defaultView)&&subWindow.top!==subWindow&&(subWindow.addEventListener?subWindow.addEventListener(\"unload\",unloadHandler,!1):subWindow.attachEvent&&subWindow.attachEvent(\"onunload\",unloadHandler)),support.attributes=assert(function(el){return el.className=\"i\",!el.getAttribute(\"className\")}),support.getElementsByTagName=assert(function(el){return el.appendChild(document.createComment(\"\")),!el.getElementsByTagName(\"*\").length}),support.getElementsByClassName=rnative.test(document.getElementsByClassName),support.getById=assert(function(el){return docElem.appendChild(el).id=expando,!document.getElementsByName||!document.getElementsByName(expando).length}),support.getById?(Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute(\"id\")===attrId}},Expr.find.ID=function(id,context){if(void 0!==context.getElementById&&documentIsHTML){var elem=context.getElementById(id);return elem?[elem]:[]}}):(Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=void 0!==elem.getAttributeNode&&elem.getAttributeNode(\"id\");return node&&node.value===attrId}},Expr.find.ID=function(id,context){if(void 0!==context.getElementById&&documentIsHTML){var node,i,elems,elem=context.getElementById(id);if(elem){if((node=elem.getAttributeNode(\"id\"))&&node.value===id)return[elem];for(elems=context.getElementsByName(id),i=0;elem=elems[i++];)if((node=elem.getAttributeNode(\"id\"))&&node.value===id)return[elem]}return[]}}),Expr.find.TAG=support.getElementsByTagName?function(tag,context){return void 0!==context.getElementsByTagName?context.getElementsByTagName(tag):support.qsa?context.querySelectorAll(tag):void 0}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if(\"*\"===tag){for(;elem=results[i++];)1===elem.nodeType&&tmp.push(elem);return tmp}return results},Expr.find.CLASS=support.getElementsByClassName&&function(className,context){if(void 0!==context.getElementsByClassName&&documentIsHTML)return context.getElementsByClassName(className)},rbuggyMatches=[],rbuggyQSA=[],(support.qsa=rnative.test(document.querySelectorAll))&&(assert(function(el){docElem.appendChild(el).innerHTML=\"<a id='\"+expando+\"'></a><select id='\"+expando+\"-\\r\\\\' msallowcapture=''><option selected=''></option></select>\",el.querySelectorAll(\"[msallowcapture^='']\").length&&rbuggyQSA.push(\"[*^$]=\"+whitespace+\"*(?:''|\\\"\\\")\"),el.querySelectorAll(\"[selected]\").length||rbuggyQSA.push(\"\\\\[\"+whitespace+\"*(?:value|\"+booleans+\")\"),el.querySelectorAll(\"[id~=\"+expando+\"-]\").length||rbuggyQSA.push(\"~=\"),el.querySelectorAll(\":checked\").length||rbuggyQSA.push(\":checked\"),el.querySelectorAll(\"a#\"+expando+\"+*\").length||rbuggyQSA.push(\".#.+[+~]\")}),assert(function(el){el.innerHTML=\"<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>\";var input=document.createElement(\"input\");input.setAttribute(\"type\",\"hidden\"),el.appendChild(input).setAttribute(\"name\",\"D\"),el.querySelectorAll(\"[name=d]\").length&&rbuggyQSA.push(\"name\"+whitespace+\"*[*^$|!~]?=\"),2!==el.querySelectorAll(\":enabled\").length&&rbuggyQSA.push(\":enabled\",\":disabled\"),docElem.appendChild(el).disabled=!0,2!==el.querySelectorAll(\":disabled\").length&&rbuggyQSA.push(\":enabled\",\":disabled\"),el.querySelectorAll(\"*,:x\"),rbuggyQSA.push(\",.*:\")})),(support.matchesSelector=rnative.test(matches=docElem.matches||docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector))&&assert(function(el){support.disconnectedMatch=matches.call(el,\"*\"),matches.call(el,\"[s!='']:x\"),rbuggyMatches.push(\"!=\",pseudos)}),rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join(\"|\")),rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join(\"|\")),hasCompare=rnative.test(docElem.compareDocumentPosition),contains=hasCompare||rnative.test(docElem.contains)?function(a,b){var adown=9===a.nodeType?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!(!bup||1!==bup.nodeType||!(adown.contains?adown.contains(bup):a.compareDocumentPosition&&16&a.compareDocumentPosition(bup)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},sortOrder=hasCompare?function(a,b){if(a===b)return hasDuplicate=!0,0;var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;return compare||(1&(compare=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1)||!support.sortDetached&&b.compareDocumentPosition(a)===compare?a===document||a.ownerDocument===preferredDoc&&contains(preferredDoc,a)?-1:b===document||b.ownerDocument===preferredDoc&&contains(preferredDoc,b)?1:sortInput?indexOf(sortInput,a)-indexOf(sortInput,b):0:4&compare?-1:1)}:function(a,b){if(a===b)return hasDuplicate=!0,0;var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup)return a===document?-1:b===document?1:aup?-1:bup?1:sortInput?indexOf(sortInput,a)-indexOf(sortInput,b):0;if(aup===bup)return siblingCheck(a,b);for(cur=a;cur=cur.parentNode;)ap.unshift(cur);for(cur=b;cur=cur.parentNode;)bp.unshift(cur);for(;ap[i]===bp[i];)i++;return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0},document):document},Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)},Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document&&setDocument(elem),expr=expr.replace(rattributeQuotes,\"='$1']\"),support.matchesSelector&&documentIsHTML&&!compilerCache[expr+\" \"]&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr)))try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&11!==elem.document.nodeType)return ret}catch(e){}return Sizzle(expr,document,null,[elem]).length>0},Sizzle.contains=function(context,elem){return(context.ownerDocument||context)!==document&&setDocument(context),contains(context,elem)},Sizzle.attr=function(elem,name){(elem.ownerDocument||elem)!==document&&setDocument(elem);var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):void 0;return void 0!==val?val:support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null},Sizzle.escape=function(sel){return(sel+\"\").replace(rcssescape,fcssescape)},Sizzle.error=function(msg){throw new Error(\"Syntax error, unrecognized expression: \"+msg)},Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;if(hasDuplicate=!support.detectDuplicates,sortInput=!support.sortStable&&results.slice(0),results.sort(sortOrder),hasDuplicate){for(;elem=results[i++];)elem===results[i]&&(j=duplicates.push(i));for(;j--;)results.splice(duplicates[j],1)}return sortInput=null,results},getText=Sizzle.getText=function(elem){var node,ret=\"\",i=0,nodeType=elem.nodeType;if(nodeType){if(1===nodeType||9===nodeType||11===nodeType){if(\"string\"==typeof elem.textContent)return elem.textContent;for(elem=elem.firstChild;elem;elem=elem.nextSibling)ret+=getText(elem)}else if(3===nodeType||4===nodeType)return elem.nodeValue}else for(;node=elem[i++];)ret+=getText(node);return ret},(Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{\">\":{dir:\"parentNode\",first:!0},\" \":{dir:\"parentNode\"},\"+\":{dir:\"previousSibling\",first:!0},\"~\":{dir:\"previousSibling\"}},preFilter:{ATTR:function(match){return match[1]=match[1].replace(runescape,funescape),match[3]=(match[3]||match[4]||match[5]||\"\").replace(runescape,funescape),\"~=\"===match[2]&&(match[3]=\" \"+match[3]+\" \"),match.slice(0,4)},CHILD:function(match){return match[1]=match[1].toLowerCase(),\"nth\"===match[1].slice(0,3)?(match[3]||Sizzle.error(match[0]),match[4]=+(match[4]?match[5]+(match[6]||1):2*(\"even\"===match[3]||\"odd\"===match[3])),match[5]=+(match[7]+match[8]||\"odd\"===match[3])):match[3]&&Sizzle.error(match[0]),match},PSEUDO:function(match){var excess,unquoted=!match[6]&&match[2];return matchExpr.CHILD.test(match[0])?null:(match[3]?match[2]=match[4]||match[5]||\"\":unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,!0))&&(excess=unquoted.indexOf(\")\",unquoted.length-excess)-unquoted.length)&&(match[0]=match[0].slice(0,excess),match[2]=unquoted.slice(0,excess)),match.slice(0,3))}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return\"*\"===nodeNameSelector?function(){return!0}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+\" \"];return pattern||(pattern=new RegExp(\"(^|\"+whitespace+\")\"+className+\"(\"+whitespace+\"|$)\"))&&classCache(className,function(elem){return pattern.test(\"string\"==typeof elem.className&&elem.className||void 0!==elem.getAttribute&&elem.getAttribute(\"class\")||\"\")})},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);return null==result?\"!=\"===operator:!operator||(result+=\"\",\"=\"===operator?result===check:\"!=\"===operator?result!==check:\"^=\"===operator?check&&0===result.indexOf(check):\"*=\"===operator?check&&result.indexOf(check)>-1:\"$=\"===operator?check&&result.slice(-check.length)===check:\"~=\"===operator?(\" \"+result.replace(rwhitespace,\" \")+\" \").indexOf(check)>-1:\"|=\"===operator&&(result===check||result.slice(0,check.length+1)===check+\"-\"))}},CHILD:function(type,what,argument,first,last){var simple=\"nth\"!==type.slice(0,3),forward=\"last\"!==type.slice(-4),ofType=\"of-type\"===what;return 1===first&&0===last?function(elem){return!!elem.parentNode}:function(elem,context,xml){var cache,uniqueCache,outerCache,node,nodeIndex,start,dir=simple!==forward?\"nextSibling\":\"previousSibling\",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType,diff=!1;if(parent){if(simple){for(;dir;){for(node=elem;node=node[dir];)if(ofType?node.nodeName.toLowerCase()===name:1===node.nodeType)return!1;start=dir=\"only\"===type&&!start&&\"nextSibling\"}return!0}if(start=[forward?parent.firstChild:parent.lastChild],forward&&useCache){for(diff=(nodeIndex=(cache=(uniqueCache=(outerCache=(node=parent)[expando]||(node[expando]={}))[node.uniqueID]||(outerCache[node.uniqueID]={}))[type]||[])[0]===dirruns&&cache[1])&&cache[2],node=nodeIndex&&parent.childNodes[nodeIndex];node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop();)if(1===node.nodeType&&++diff&&node===elem){uniqueCache[type]=[dirruns,nodeIndex,diff];break}}else if(useCache&&(diff=nodeIndex=(cache=(uniqueCache=(outerCache=(node=elem)[expando]||(node[expando]={}))[node.uniqueID]||(outerCache[node.uniqueID]={}))[type]||[])[0]===dirruns&&cache[1]),!1===diff)for(;(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())&&((ofType?node.nodeName.toLowerCase()!==name:1!==node.nodeType)||!++diff||(useCache&&((uniqueCache=(outerCache=node[expando]||(node[expando]={}))[node.uniqueID]||(outerCache[node.uniqueID]={}))[type]=[dirruns,diff]),node!==elem)););return(diff-=last)===first||diff%first==0&&diff/first>=0}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error(\"unsupported pseudo: \"+pseudo);return fn[expando]?fn(argument):fn.length>1?(args=[pseudo,pseudo,\"\",argument],Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){for(var idx,matched=fn(seed,argument),i=matched.length;i--;)seed[idx=indexOf(seed,matched[i])]=!(matches[idx]=matched[i])}):function(elem){return fn(elem,0,args)}):fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,\"$1\"));return matcher[expando]?markFunction(function(seed,matches,context,xml){for(var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;i--;)(elem=unmatched[i])&&(seed[i]=!(matches[i]=elem))}):function(elem,context,xml){return input[0]=elem,matcher(input,null,xml,results),input[0]=null,!results.pop()}}),has:markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0}}),contains:markFunction(function(text){return text=text.replace(runescape,funescape),function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}}),lang:markFunction(function(lang){return ridentifier.test(lang||\"\")||Sizzle.error(\"unsupported lang: \"+lang),lang=lang.replace(runescape,funescape).toLowerCase(),function(elem){var elemLang;do{if(elemLang=documentIsHTML?elem.lang:elem.getAttribute(\"xml:lang\")||elem.getAttribute(\"lang\"))return(elemLang=elemLang.toLowerCase())===lang||0===elemLang.indexOf(lang+\"-\")}while((elem=elem.parentNode)&&1===elem.nodeType);return!1}}),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:createDisabledPseudo(!1),disabled:createDisabledPseudo(!0),checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return\"input\"===nodeName&&!!elem.checked||\"option\"===nodeName&&!!elem.selected},selected:function(elem){return elem.parentNode&&elem.parentNode.selectedIndex,!0===elem.selected},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling)if(elem.nodeType<6)return!1;return!0},parent:function(elem){return!Expr.pseudos.empty(elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return\"input\"===name&&\"button\"===elem.type||\"button\"===name},text:function(elem){var attr;return\"input\"===elem.nodeName.toLowerCase()&&\"text\"===elem.type&&(null==(attr=elem.getAttribute(\"type\"))||\"text\"===attr.toLowerCase())},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1]}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length){for(var i=0;i<length;i+=2)matchIndexes.push(i);return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length){for(var i=1;i<length;i+=2)matchIndexes.push(i);return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;--i>=0;)matchIndexes.push(i);return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;++i<length;)matchIndexes.push(i);return matchIndexes})}}).pseudos.nth=Expr.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})Expr.pseudos[i]=createInputPseudo(i);for(i in{submit:!0,reset:!0})Expr.pseudos[i]=createButtonPseudo(i);function setFilters(){}function toSelector(tokens){for(var i=0,len=tokens.length,selector=\"\";i<len;i++)selector+=tokens[i].value;return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,skip=combinator.next,key=skip||dir,checkNonElements=base&&\"parentNode\"===key,doneName=done++;return combinator.first?function(elem,context,xml){for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements)return matcher(elem,context,xml);return!1}:function(elem,context,xml){var oldCache,uniqueCache,outerCache,newCache=[dirruns,doneName];if(xml){for(;elem=elem[dir];)if((1===elem.nodeType||checkNonElements)&&matcher(elem,context,xml))return!0}else for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements)if(uniqueCache=(outerCache=elem[expando]||(elem[expando]={}))[elem.uniqueID]||(outerCache[elem.uniqueID]={}),skip&&skip===elem.nodeName.toLowerCase())elem=elem[dir]||elem;else{if((oldCache=uniqueCache[key])&&oldCache[0]===dirruns&&oldCache[1]===doneName)return newCache[2]=oldCache[2];if(uniqueCache[key]=newCache,newCache[2]=matcher(elem,context,xml))return!0}return!1}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){for(var i=matchers.length;i--;)if(!matchers[i](elem,context,xml))return!1;return!0}:matchers[0]}function condense(unmatched,map,filter,context,xml){for(var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=null!=map;i<len;i++)(elem=unmatched[i])&&(filter&&!filter(elem,context,xml)||(newUnmatched.push(elem),mapped&&map.push(i)));return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){return postFilter&&!postFilter[expando]&&(postFilter=setMatcher(postFilter)),postFinder&&!postFinder[expando]&&(postFinder=setMatcher(postFinder,postSelector)),markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||function(selector,contexts,results){for(var i=0,len=contexts.length;i<len;i++)Sizzle(selector,contexts[i],results);return results}(selector||\"*\",context.nodeType?[context]:context,[]),matcherIn=!preFilter||!seed&&selector?elems:condense(elems,preMap,preFilter,context,xml),matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher&&matcher(matcherIn,matcherOut,context,xml),postFilter)for(temp=condense(matcherOut,postMap),postFilter(temp,[],context,xml),i=temp.length;i--;)(elem=temp[i])&&(matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem));if(seed){if(postFinder||preFilter){if(postFinder){for(temp=[],i=matcherOut.length;i--;)(elem=matcherOut[i])&&temp.push(matcherIn[i]=elem);postFinder(null,matcherOut=[],temp,xml)}for(i=matcherOut.length;i--;)(elem=matcherOut[i])&&(temp=postFinder?indexOf(seed,elem):preMap[i])>-1&&(seed[temp]=!(results[temp]=elem))}}else matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut),postFinder?postFinder(null,results,matcherOut,xml):push.apply(results,matcherOut)})}function matcherFromTokens(tokens){for(var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[\" \"],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,!0),matchAnyContext=addCombinator(function(elem){return indexOf(checkContext,elem)>-1},implicitRelative,!0),matchers=[function(elem,context,xml){var ret=!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml));return checkContext=null,ret}];i<len;i++)if(matcher=Expr.relative[tokens[i].type])matchers=[addCombinator(elementMatcher(matchers),matcher)];else{if((matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches))[expando]){for(j=++i;j<len&&!Expr.relative[tokens[j].type];j++);return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:\" \"===tokens[i-2].type?\"*\":\"\"})).replace(rtrim,\"$1\"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens(tokens=tokens.slice(j)),j<len&&toSelector(tokens))}matchers.push(matcher)}return elementMatcher(matchers)}return setFilters.prototype=Expr.filters=Expr.pseudos,Expr.setFilters=new setFilters,tokenize=Sizzle.tokenize=function(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+\" \"];if(cached)return parseOnly?0:cached.slice(0);for(soFar=selector,groups=[],preFilters=Expr.preFilter;soFar;){for(type in matched&&!(match=rcomma.exec(soFar))||(match&&(soFar=soFar.slice(match[0].length)||soFar),groups.push(tokens=[])),matched=!1,(match=rcombinators.exec(soFar))&&(matched=match.shift(),tokens.push({value:matched,type:match[0].replace(rtrim,\" \")}),soFar=soFar.slice(matched.length)),Expr.filter)!(match=matchExpr[type].exec(soFar))||preFilters[type]&&!(match=preFilters[type](match))||(matched=match.shift(),tokens.push({value:matched,type:type,matches:match}),soFar=soFar.slice(matched.length));if(!matched)break}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)},compile=Sizzle.compile=function(selector,match){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+\" \"];if(!cached){for(match||(match=tokenize(selector)),i=match.length;i--;)(cached=matcherFromTokens(match[i]))[expando]?setMatchers.push(cached):elementMatchers.push(cached);(cached=compilerCache(selector,function(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i=\"0\",unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find.TAG(\"*\",outermost),dirrunsUnique=dirruns+=null==contextBackup?1:Math.random()||.1,len=elems.length;for(outermost&&(outermostContext=context===document||context||outermost);i!==len&&null!=(elem=elems[i]);i++){if(byElement&&elem){for(j=0,context||elem.ownerDocument===document||(setDocument(elem),xml=!documentIsHTML);matcher=elementMatchers[j++];)if(matcher(elem,context||document,xml)){results.push(elem);break}outermost&&(dirruns=dirrunsUnique)}bySet&&((elem=!matcher&&elem)&&matchedCount--,seed&&unmatched.push(elem))}if(matchedCount+=i,bySet&&i!==matchedCount){for(j=0;matcher=setMatchers[j++];)matcher(unmatched,setMatched,context,xml);if(seed){if(matchedCount>0)for(;i--;)unmatched[i]||setMatched[i]||(setMatched[i]=pop.call(results));setMatched=condense(setMatched)}push.apply(results,setMatched),outermost&&!seed&&setMatched.length>0&&matchedCount+setMatchers.length>1&&Sizzle.uniqueSort(results)}return outermost&&(dirruns=dirrunsUnique,outermostContext=contextBackup),unmatched};return bySet?markFunction(superMatcher):superMatcher}(elementMatchers,setMatchers))).selector=selector}return cached},select=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled=\"function\"==typeof selector&&selector,match=!seed&&tokenize(selector=compiled.selector||selector);if(results=results||[],1===match.length){if((tokens=match[0]=match[0].slice(0)).length>2&&\"ID\"===(token=tokens[0]).type&&9===context.nodeType&&documentIsHTML&&Expr.relative[tokens[1].type]){if(!(context=(Expr.find.ID(token.matches[0].replace(runescape,funescape),context)||[])[0]))return results;compiled&&(context=context.parentNode),selector=selector.slice(tokens.shift().value.length)}for(i=matchExpr.needsContext.test(selector)?0:tokens.length;i--&&(token=tokens[i],!Expr.relative[type=token.type]);)if((find=Expr.find[type])&&(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context))){if(tokens.splice(i,1),!(selector=seed.length&&toSelector(tokens)))return push.apply(results,seed),results;break}}return(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,!context||rsibling.test(selector)&&testContext(context.parentNode)||context),results},support.sortStable=expando.split(\"\").sort(sortOrder).join(\"\")===expando,support.detectDuplicates=!!hasDuplicate,setDocument(),support.sortDetached=assert(function(el){return 1&el.compareDocumentPosition(document.createElement(\"fieldset\"))}),assert(function(el){return el.innerHTML=\"<a href='#'></a>\",\"#\"===el.firstChild.getAttribute(\"href\")})||addHandle(\"type|href|height|width\",function(elem,name,isXML){if(!isXML)return elem.getAttribute(name,\"type\"===name.toLowerCase()?1:2)}),support.attributes&&assert(function(el){return el.innerHTML=\"<input/>\",el.firstChild.setAttribute(\"value\",\"\"),\"\"===el.firstChild.getAttribute(\"value\")})||addHandle(\"value\",function(elem,name,isXML){if(!isXML&&\"input\"===elem.nodeName.toLowerCase())return elem.defaultValue}),assert(function(el){return null==el.getAttribute(\"disabled\")})||addHandle(booleans,function(elem,name,isXML){var val;if(!isXML)return!0===elem[name]?name.toLowerCase():(val=elem.getAttributeNode(name))&&val.specified?val.value:null}),Sizzle}(window);jQuery.find=Sizzle,jQuery.expr=Sizzle.selectors,jQuery.expr[\":\"]=jQuery.expr.pseudos,jQuery.uniqueSort=jQuery.unique=Sizzle.uniqueSort,jQuery.text=Sizzle.getText,jQuery.isXMLDoc=Sizzle.isXML,jQuery.contains=Sizzle.contains,jQuery.escapeSelector=Sizzle.escape;var dir=function(elem,dir,until){for(var matched=[],truncate=void 0!==until;(elem=elem[dir])&&9!==elem.nodeType;)if(1===elem.nodeType){if(truncate&&jQuery(elem).is(until))break;matched.push(elem)}return matched},siblings=function(n,elem){for(var matched=[];n;n=n.nextSibling)1===n.nodeType&&n!==elem&&matched.push(n);return matched},rneedsContext=jQuery.expr.match.needsContext;function nodeName(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase()}var rsingleTag=/^<([a-z][^\\/\\0>:\\x20\\t\\r\\n\\f]*)[\\x20\\t\\r\\n\\f]*\\/?>(?:<\\/\\1>|)$/i,risSimple=/^.[^:#\\[\\.,]*$/;function winnow(elements,qualifier,not){return jQuery.isFunction(qualifier)?jQuery.grep(elements,function(elem,i){return!!qualifier.call(elem,i,elem)!==not}):qualifier.nodeType?jQuery.grep(elements,function(elem){return elem===qualifier!==not}):\"string\"!=typeof qualifier?jQuery.grep(elements,function(elem){return indexOf.call(qualifier,elem)>-1!==not}):risSimple.test(qualifier)?jQuery.filter(qualifier,elements,not):(qualifier=jQuery.filter(qualifier,elements),jQuery.grep(elements,function(elem){return indexOf.call(qualifier,elem)>-1!==not&&1===elem.nodeType}))}jQuery.filter=function(expr,elems,not){var elem=elems[0];return not&&(expr=\":not(\"+expr+\")\"),1===elems.length&&1===elem.nodeType?jQuery.find.matchesSelector(elem,expr)?[elem]:[]:jQuery.find.matches(expr,jQuery.grep(elems,function(elem){return 1===elem.nodeType}))},jQuery.fn.extend({find:function(selector){var i,ret,len=this.length,self=this;if(\"string\"!=typeof selector)return this.pushStack(jQuery(selector).filter(function(){for(i=0;i<len;i++)if(jQuery.contains(self[i],this))return!0}));for(ret=this.pushStack([]),i=0;i<len;i++)jQuery.find(selector,self[i],ret);return len>1?jQuery.uniqueSort(ret):ret},filter:function(selector){return this.pushStack(winnow(this,selector||[],!1))},not:function(selector){return this.pushStack(winnow(this,selector||[],!0))},is:function(selector){return!!winnow(this,\"string\"==typeof selector&&rneedsContext.test(selector)?jQuery(selector):selector||[],!1).length}});var rootjQuery,rquickExpr=/^(?:\\s*(<[\\w\\W]+>)[^>]*|#([\\w-]+))$/;(jQuery.fn.init=function(selector,context,root){var match,elem;if(!selector)return this;if(root=root||rootjQuery,\"string\"==typeof selector){if(!(match=\"<\"===selector[0]&&\">\"===selector[selector.length-1]&&selector.length>=3?[null,selector,null]:rquickExpr.exec(selector))||!match[1]&&context)return!context||context.jquery?(context||root).find(selector):this.constructor(context).find(selector);if(match[1]){if(context=context instanceof jQuery?context[0]:context,jQuery.merge(this,jQuery.parseHTML(match[1],context&&context.nodeType?context.ownerDocument||context:document,!0)),rsingleTag.test(match[1])&&jQuery.isPlainObject(context))for(match in context)jQuery.isFunction(this[match])?this[match](context[match]):this.attr(match,context[match]);return this}return(elem=document.getElementById(match[2]))&&(this[0]=elem,this.length=1),this}return selector.nodeType?(this[0]=selector,this.length=1,this):jQuery.isFunction(selector)?void 0!==root.ready?root.ready(selector):selector(jQuery):jQuery.makeArray(selector,this)}).prototype=jQuery.fn,rootjQuery=jQuery(document);var rparentsprev=/^(?:parents|prev(?:Until|All))/,guaranteedUnique={children:!0,contents:!0,next:!0,prev:!0};function sibling(cur,dir){for(;(cur=cur[dir])&&1!==cur.nodeType;);return cur}jQuery.fn.extend({has:function(target){var targets=jQuery(target,this),l=targets.length;return this.filter(function(){for(var i=0;i<l;i++)if(jQuery.contains(this,targets[i]))return!0})},closest:function(selectors,context){var cur,i=0,l=this.length,matched=[],targets=\"string\"!=typeof selectors&&jQuery(selectors);if(!rneedsContext.test(selectors))for(;i<l;i++)for(cur=this[i];cur&&cur!==context;cur=cur.parentNode)if(cur.nodeType<11&&(targets?targets.index(cur)>-1:1===cur.nodeType&&jQuery.find.matchesSelector(cur,selectors))){matched.push(cur);break}return this.pushStack(matched.length>1?jQuery.uniqueSort(matched):matched)},index:function(elem){return elem?\"string\"==typeof elem?indexOf.call(jQuery(elem),this[0]):indexOf.call(this,elem.jquery?elem[0]:elem):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(selector,context){return this.pushStack(jQuery.uniqueSort(jQuery.merge(this.get(),jQuery(selector,context))))},addBack:function(selector){return this.add(null==selector?this.prevObject:this.prevObject.filter(selector))}}),jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&11!==parent.nodeType?parent:null},parents:function(elem){return dir(elem,\"parentNode\")},parentsUntil:function(elem,i,until){return dir(elem,\"parentNode\",until)},next:function(elem){return sibling(elem,\"nextSibling\")},prev:function(elem){return sibling(elem,\"previousSibling\")},nextAll:function(elem){return dir(elem,\"nextSibling\")},prevAll:function(elem){return dir(elem,\"previousSibling\")},nextUntil:function(elem,i,until){return dir(elem,\"nextSibling\",until)},prevUntil:function(elem,i,until){return dir(elem,\"previousSibling\",until)},siblings:function(elem){return siblings((elem.parentNode||{}).firstChild,elem)},children:function(elem){return siblings(elem.firstChild)},contents:function(elem){return nodeName(elem,\"iframe\")?elem.contentDocument:(nodeName(elem,\"template\")&&(elem=elem.content||elem),jQuery.merge([],elem.childNodes))}},function(name,fn){jQuery.fn[name]=function(until,selector){var matched=jQuery.map(this,fn,until);return\"Until\"!==name.slice(-5)&&(selector=until),selector&&\"string\"==typeof selector&&(matched=jQuery.filter(selector,matched)),this.length>1&&(guaranteedUnique[name]||jQuery.uniqueSort(matched),rparentsprev.test(name)&&matched.reverse()),this.pushStack(matched)}});var rnothtmlwhite=/[^\\x20\\t\\r\\n\\f]+/g;function Identity(v){return v}function Thrower(ex){throw ex}function adoptValue(value,resolve,reject,noValue){var method;try{value&&jQuery.isFunction(method=value.promise)?method.call(value).done(resolve).fail(reject):value&&jQuery.isFunction(method=value.then)?method.call(value,resolve,reject):resolve.apply(void 0,[value].slice(noValue))}catch(value){reject.apply(void 0,[value])}}jQuery.Callbacks=function(options){options=\"string\"==typeof options?function(options){var object={};return jQuery.each(options.match(rnothtmlwhite)||[],function(_,flag){object[flag]=!0}),object}(options):jQuery.extend({},options);var firing,memory,fired,locked,list=[],queue=[],firingIndex=-1,fire=function(){for(locked=locked||options.once,fired=firing=!0;queue.length;firingIndex=-1)for(memory=queue.shift();++firingIndex<list.length;)!1===list[firingIndex].apply(memory[0],memory[1])&&options.stopOnFalse&&(firingIndex=list.length,memory=!1);options.memory||(memory=!1),firing=!1,locked&&(list=memory?[]:\"\")},self={add:function(){return list&&(memory&&!firing&&(firingIndex=list.length-1,queue.push(memory)),function add(args){jQuery.each(args,function(_,arg){jQuery.isFunction(arg)?options.unique&&self.has(arg)||list.push(arg):arg&&arg.length&&\"string\"!==jQuery.type(arg)&&add(arg)})}(arguments),memory&&!firing&&fire()),this},remove:function(){return jQuery.each(arguments,function(_,arg){for(var index;(index=jQuery.inArray(arg,list,index))>-1;)list.splice(index,1),index<=firingIndex&&firingIndex--}),this},has:function(fn){return fn?jQuery.inArray(fn,list)>-1:list.length>0},empty:function(){return list&&(list=[]),this},disable:function(){return locked=queue=[],list=memory=\"\",this},disabled:function(){return!list},lock:function(){return locked=queue=[],memory||firing||(list=memory=\"\"),this},locked:function(){return!!locked},fireWith:function(context,args){return locked||(args=[context,(args=args||[]).slice?args.slice():args],queue.push(args),firing||fire()),this},fire:function(){return self.fireWith(this,arguments),this},fired:function(){return!!fired}};return self},jQuery.extend({Deferred:function(func){var tuples=[[\"notify\",\"progress\",jQuery.Callbacks(\"memory\"),jQuery.Callbacks(\"memory\"),2],[\"resolve\",\"done\",jQuery.Callbacks(\"once memory\"),jQuery.Callbacks(\"once memory\"),0,\"resolved\"],[\"reject\",\"fail\",jQuery.Callbacks(\"once memory\"),jQuery.Callbacks(\"once memory\"),1,\"rejected\"]],state=\"pending\",promise={state:function(){return state},always:function(){return deferred.done(arguments).fail(arguments),this},catch:function(fn){return promise.then(null,fn)},pipe:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var fn=jQuery.isFunction(fns[tuple[4]])&&fns[tuple[4]];deferred[tuple[1]](function(){var returned=fn&&fn.apply(this,arguments);returned&&jQuery.isFunction(returned.promise)?returned.promise().progress(newDefer.notify).done(newDefer.resolve).fail(newDefer.reject):newDefer[tuple[0]+\"With\"](this,fn?[returned]:arguments)})}),fns=null}).promise()},then:function(onFulfilled,onRejected,onProgress){var maxDepth=0;function resolve(depth,deferred,handler,special){return function(){var that=this,args=arguments,mightThrow=function(){var returned,then;if(!(depth<maxDepth)){if((returned=handler.apply(that,args))===deferred.promise())throw new TypeError(\"Thenable self-resolution\");then=returned&&(\"object\"==typeof returned||\"function\"==typeof returned)&&returned.then,jQuery.isFunction(then)?special?then.call(returned,resolve(maxDepth,deferred,Identity,special),resolve(maxDepth,deferred,Thrower,special)):(maxDepth++,then.call(returned,resolve(maxDepth,deferred,Identity,special),resolve(maxDepth,deferred,Thrower,special),resolve(maxDepth,deferred,Identity,deferred.notifyWith))):(handler!==Identity&&(that=void 0,args=[returned]),(special||deferred.resolveWith)(that,args))}},process=special?mightThrow:function(){try{mightThrow()}catch(e){jQuery.Deferred.exceptionHook&&jQuery.Deferred.exceptionHook(e,process.stackTrace),depth+1>=maxDepth&&(handler!==Thrower&&(that=void 0,args=[e]),deferred.rejectWith(that,args))}};depth?process():(jQuery.Deferred.getStackHook&&(process.stackTrace=jQuery.Deferred.getStackHook()),window.setTimeout(process))}}return jQuery.Deferred(function(newDefer){tuples[0][3].add(resolve(0,newDefer,jQuery.isFunction(onProgress)?onProgress:Identity,newDefer.notifyWith)),tuples[1][3].add(resolve(0,newDefer,jQuery.isFunction(onFulfilled)?onFulfilled:Identity)),tuples[2][3].add(resolve(0,newDefer,jQuery.isFunction(onRejected)?onRejected:Thrower))}).promise()},promise:function(obj){return null!=obj?jQuery.extend(obj,promise):promise}},deferred={};return jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[5];promise[tuple[1]]=list.add,stateString&&list.add(function(){state=stateString},tuples[3-i][2].disable,tuples[0][2].lock),list.add(tuple[3].fire),deferred[tuple[0]]=function(){return deferred[tuple[0]+\"With\"](this===deferred?void 0:this,arguments),this},deferred[tuple[0]+\"With\"]=list.fireWith}),promise.promise(deferred),func&&func.call(deferred,deferred),deferred},when:function(singleValue){var remaining=arguments.length,i=remaining,resolveContexts=Array(i),resolveValues=slice.call(arguments),master=jQuery.Deferred(),updateFunc=function(i){return function(value){resolveContexts[i]=this,resolveValues[i]=arguments.length>1?slice.call(arguments):value,--remaining||master.resolveWith(resolveContexts,resolveValues)}};if(remaining<=1&&(adoptValue(singleValue,master.done(updateFunc(i)).resolve,master.reject,!remaining),\"pending\"===master.state()||jQuery.isFunction(resolveValues[i]&&resolveValues[i].then)))return master.then();for(;i--;)adoptValue(resolveValues[i],updateFunc(i),master.reject);return master.promise()}});var rerrorNames=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;jQuery.Deferred.exceptionHook=function(error,stack){window.console&&window.console.warn&&error&&rerrorNames.test(error.name)&&window.console.warn(\"jQuery.Deferred exception: \"+error.message,error.stack,stack)},jQuery.readyException=function(error){window.setTimeout(function(){throw error})};var readyList=jQuery.Deferred();function completed(){document.removeEventListener(\"DOMContentLoaded\",completed),window.removeEventListener(\"load\",completed),jQuery.ready()}jQuery.fn.ready=function(fn){return readyList.then(fn).catch(function(error){jQuery.readyException(error)}),this},jQuery.extend({isReady:!1,readyWait:1,ready:function(wait){(!0===wait?--jQuery.readyWait:jQuery.isReady)||(jQuery.isReady=!0,!0!==wait&&--jQuery.readyWait>0||readyList.resolveWith(document,[jQuery]))}}),jQuery.ready.then=readyList.then,\"complete\"===document.readyState||\"loading\"!==document.readyState&&!document.documentElement.doScroll?window.setTimeout(jQuery.ready):(document.addEventListener(\"DOMContentLoaded\",completed),window.addEventListener(\"load\",completed));var access=function(elems,fn,key,value,chainable,emptyGet,raw){var i=0,len=elems.length,bulk=null==key;if(\"object\"===jQuery.type(key))for(i in chainable=!0,key)access(elems,fn,i,key[i],!0,emptyGet,raw);else if(void 0!==value&&(chainable=!0,jQuery.isFunction(value)||(raw=!0),bulk&&(raw?(fn.call(elems,value),fn=null):(bulk=fn,fn=function(elem,key,value){return bulk.call(jQuery(elem),value)})),fn))for(;i<len;i++)fn(elems[i],key,raw?value:value.call(elems[i],i,fn(elems[i],key)));return chainable?elems:bulk?fn.call(elems):len?fn(elems[0],key):emptyGet},acceptData=function(owner){return 1===owner.nodeType||9===owner.nodeType||!+owner.nodeType};function Data(){this.expando=jQuery.expando+Data.uid++}Data.uid=1,Data.prototype={cache:function(owner){var value=owner[this.expando];return value||(value={},acceptData(owner)&&(owner.nodeType?owner[this.expando]=value:Object.defineProperty(owner,this.expando,{value:value,configurable:!0}))),value},set:function(owner,data,value){var prop,cache=this.cache(owner);if(\"string\"==typeof data)cache[jQuery.camelCase(data)]=value;else for(prop in data)cache[jQuery.camelCase(prop)]=data[prop];return cache},get:function(owner,key){return void 0===key?this.cache(owner):owner[this.expando]&&owner[this.expando][jQuery.camelCase(key)]},access:function(owner,key,value){return void 0===key||key&&\"string\"==typeof key&&void 0===value?this.get(owner,key):(this.set(owner,key,value),void 0!==value?value:key)},remove:function(owner,key){var i,cache=owner[this.expando];if(void 0!==cache){if(void 0!==key){i=(key=Array.isArray(key)?key.map(jQuery.camelCase):(key=jQuery.camelCase(key))in cache?[key]:key.match(rnothtmlwhite)||[]).length;for(;i--;)delete cache[key[i]]}(void 0===key||jQuery.isEmptyObject(cache))&&(owner.nodeType?owner[this.expando]=void 0:delete owner[this.expando])}},hasData:function(owner){var cache=owner[this.expando];return void 0!==cache&&!jQuery.isEmptyObject(cache)}};var dataPriv=new Data,dataUser=new Data,rbrace=/^(?:\\{[\\w\\W]*\\}|\\[[\\w\\W]*\\])$/,rmultiDash=/[A-Z]/g;function dataAttr(elem,key,data){var name;if(void 0===data&&1===elem.nodeType)if(name=\"data-\"+key.replace(rmultiDash,\"-$&\").toLowerCase(),\"string\"==typeof(data=elem.getAttribute(name))){try{data=function(data){return\"true\"===data||\"false\"!==data&&(\"null\"===data?null:data===+data+\"\"?+data:rbrace.test(data)?JSON.parse(data):data)}(data)}catch(e){}dataUser.set(elem,key,data)}else data=void 0;return data}jQuery.extend({hasData:function(elem){return dataUser.hasData(elem)||dataPriv.hasData(elem)},data:function(elem,name,data){return dataUser.access(elem,name,data)},removeData:function(elem,name){dataUser.remove(elem,name)},_data:function(elem,name,data){return dataPriv.access(elem,name,data)},_removeData:function(elem,name){dataPriv.remove(elem,name)}}),jQuery.fn.extend({data:function(key,value){var i,name,data,elem=this[0],attrs=elem&&elem.attributes;if(void 0===key){if(this.length&&(data=dataUser.get(elem),1===elem.nodeType&&!dataPriv.get(elem,\"hasDataAttrs\"))){for(i=attrs.length;i--;)attrs[i]&&0===(name=attrs[i].name).indexOf(\"data-\")&&(name=jQuery.camelCase(name.slice(5)),dataAttr(elem,name,data[name]));dataPriv.set(elem,\"hasDataAttrs\",!0)}return data}return\"object\"==typeof key?this.each(function(){dataUser.set(this,key)}):access(this,function(value){var data;if(elem&&void 0===value)return void 0!==(data=dataUser.get(elem,key))?data:void 0!==(data=dataAttr(elem,key))?data:void 0;this.each(function(){dataUser.set(this,key,value)})},null,value,arguments.length>1,null,!0)},removeData:function(key){return this.each(function(){dataUser.remove(this,key)})}}),jQuery.extend({queue:function(elem,type,data){var queue;if(elem)return type=(type||\"fx\")+\"queue\",queue=dataPriv.get(elem,type),data&&(!queue||Array.isArray(data)?queue=dataPriv.access(elem,type,jQuery.makeArray(data)):queue.push(data)),queue||[]},dequeue:function(elem,type){type=type||\"fx\";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type);\"inprogress\"===fn&&(fn=queue.shift(),startLength--),fn&&(\"fx\"===type&&queue.unshift(\"inprogress\"),delete hooks.stop,fn.call(elem,function(){jQuery.dequeue(elem,type)},hooks)),!startLength&&hooks&&hooks.empty.fire()},_queueHooks:function(elem,type){var key=type+\"queueHooks\";return dataPriv.get(elem,key)||dataPriv.access(elem,key,{empty:jQuery.Callbacks(\"once memory\").add(function(){dataPriv.remove(elem,[type+\"queue\",key])})})}}),jQuery.fn.extend({queue:function(type,data){var setter=2;return\"string\"!=typeof type&&(data=type,type=\"fx\",setter--),arguments.length<setter?jQuery.queue(this[0],type):void 0===data?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type),\"fx\"===type&&\"inprogress\"!==queue[0]&&jQuery.dequeue(this,type)})},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type)})},clearQueue:function(type){return this.queue(type||\"fx\",[])},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){--count||defer.resolveWith(elements,[elements])};for(\"string\"!=typeof type&&(obj=type,type=void 0),type=type||\"fx\";i--;)(tmp=dataPriv.get(elements[i],type+\"queueHooks\"))&&tmp.empty&&(count++,tmp.empty.add(resolve));return resolve(),defer.promise(obj)}});var pnum=/[+-]?(?:\\d*\\.|)\\d+(?:[eE][+-]?\\d+|)/.source,rcssNum=new RegExp(\"^(?:([+-])=|)(\"+pnum+\")([a-z%]*)$\",\"i\"),cssExpand=[\"Top\",\"Right\",\"Bottom\",\"Left\"],isHiddenWithinTree=function(elem,el){return\"none\"===(elem=el||elem).style.display||\"\"===elem.style.display&&jQuery.contains(elem.ownerDocument,elem)&&\"none\"===jQuery.css(elem,\"display\")},swap=function(elem,options,callback,args){var ret,name,old={};for(name in options)old[name]=elem.style[name],elem.style[name]=options[name];for(name in ret=callback.apply(elem,args||[]),options)elem.style[name]=old[name];return ret};function adjustCSS(elem,prop,valueParts,tween){var adjusted,scale=1,maxIterations=20,currentValue=tween?function(){return tween.cur()}:function(){return jQuery.css(elem,prop,\"\")},initial=currentValue(),unit=valueParts&&valueParts[3]||(jQuery.cssNumber[prop]?\"\":\"px\"),initialInUnit=(jQuery.cssNumber[prop]||\"px\"!==unit&&+initial)&&rcssNum.exec(jQuery.css(elem,prop));if(initialInUnit&&initialInUnit[3]!==unit)for(unit=unit||initialInUnit[3],valueParts=valueParts||[],initialInUnit=+initial||1;initialInUnit/=scale=scale||\".5\",jQuery.style(elem,prop,initialInUnit+unit),scale!==(scale=currentValue()/initial)&&1!==scale&&--maxIterations;);return valueParts&&(initialInUnit=+initialInUnit||+initial||0,adjusted=valueParts[1]?initialInUnit+(valueParts[1]+1)*valueParts[2]:+valueParts[2],tween&&(tween.unit=unit,tween.start=initialInUnit,tween.end=adjusted)),adjusted}var defaultDisplayMap={};function getDefaultDisplay(elem){var temp,doc=elem.ownerDocument,nodeName=elem.nodeName,display=defaultDisplayMap[nodeName];return display||(temp=doc.body.appendChild(doc.createElement(nodeName)),display=jQuery.css(temp,\"display\"),temp.parentNode.removeChild(temp),\"none\"===display&&(display=\"block\"),defaultDisplayMap[nodeName]=display,display)}function showHide(elements,show){for(var display,elem,values=[],index=0,length=elements.length;index<length;index++)(elem=elements[index]).style&&(display=elem.style.display,show?(\"none\"===display&&(values[index]=dataPriv.get(elem,\"display\")||null,values[index]||(elem.style.display=\"\")),\"\"===elem.style.display&&isHiddenWithinTree(elem)&&(values[index]=getDefaultDisplay(elem))):\"none\"!==display&&(values[index]=\"none\",dataPriv.set(elem,\"display\",display)));for(index=0;index<length;index++)null!=values[index]&&(elements[index].style.display=values[index]);return elements}jQuery.fn.extend({show:function(){return showHide(this,!0)},hide:function(){return showHide(this)},toggle:function(state){return\"boolean\"==typeof state?state?this.show():this.hide():this.each(function(){isHiddenWithinTree(this)?jQuery(this).show():jQuery(this).hide()})}});var rcheckableType=/^(?:checkbox|radio)$/i,rtagName=/<([a-z][^\\/\\0>\\x20\\t\\r\\n\\f]+)/i,rscriptType=/^$|\\/(?:java|ecma)script/i,wrapMap={option:[1,\"<select multiple='multiple'>\",\"</select>\"],thead:[1,\"<table>\",\"</table>\"],col:[2,\"<table><colgroup>\",\"</colgroup></table>\"],tr:[2,\"<table><tbody>\",\"</tbody></table>\"],td:[3,\"<table><tbody><tr>\",\"</tr></tbody></table>\"],_default:[0,\"\",\"\"]};function getAll(context,tag){var ret;return ret=void 0!==context.getElementsByTagName?context.getElementsByTagName(tag||\"*\"):void 0!==context.querySelectorAll?context.querySelectorAll(tag||\"*\"):[],void 0===tag||tag&&nodeName(context,tag)?jQuery.merge([context],ret):ret}function setGlobalEval(elems,refElements){for(var i=0,l=elems.length;i<l;i++)dataPriv.set(elems[i],\"globalEval\",!refElements||dataPriv.get(refElements[i],\"globalEval\"))}wrapMap.optgroup=wrapMap.option,wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead,wrapMap.th=wrapMap.td;var div,input,rhtml=/<|&#?\\w+;/;function buildFragment(elems,context,scripts,selection,ignored){for(var elem,tmp,tag,wrap,contains,j,fragment=context.createDocumentFragment(),nodes=[],i=0,l=elems.length;i<l;i++)if((elem=elems[i])||0===elem)if(\"object\"===jQuery.type(elem))jQuery.merge(nodes,elem.nodeType?[elem]:elem);else if(rhtml.test(elem)){for(tmp=tmp||fragment.appendChild(context.createElement(\"div\")),tag=(rtagName.exec(elem)||[\"\",\"\"])[1].toLowerCase(),wrap=wrapMap[tag]||wrapMap._default,tmp.innerHTML=wrap[1]+jQuery.htmlPrefilter(elem)+wrap[2],j=wrap[0];j--;)tmp=tmp.lastChild;jQuery.merge(nodes,tmp.childNodes),(tmp=fragment.firstChild).textContent=\"\"}else nodes.push(context.createTextNode(elem));for(fragment.textContent=\"\",i=0;elem=nodes[i++];)if(selection&&jQuery.inArray(elem,selection)>-1)ignored&&ignored.push(elem);else if(contains=jQuery.contains(elem.ownerDocument,elem),tmp=getAll(fragment.appendChild(elem),\"script\"),contains&&setGlobalEval(tmp),scripts)for(j=0;elem=tmp[j++];)rscriptType.test(elem.type||\"\")&&scripts.push(elem);return fragment}div=document.createDocumentFragment().appendChild(document.createElement(\"div\")),(input=document.createElement(\"input\")).setAttribute(\"type\",\"radio\"),input.setAttribute(\"checked\",\"checked\"),input.setAttribute(\"name\",\"t\"),div.appendChild(input),support.checkClone=div.cloneNode(!0).cloneNode(!0).lastChild.checked,div.innerHTML=\"<textarea>x</textarea>\",support.noCloneChecked=!!div.cloneNode(!0).lastChild.defaultValue;var documentElement=document.documentElement,rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,rtypenamespace=/^([^.]*)(?:\\.(.+)|)/;function returnTrue(){return!0}function returnFalse(){return!1}function safeActiveElement(){try{return document.activeElement}catch(err){}}function on(elem,types,selector,data,fn,one){var origFn,type;if(\"object\"==typeof types){for(type in\"string\"!=typeof selector&&(data=data||selector,selector=void 0),types)on(elem,type,selector,data,types[type],one);return elem}if(null==data&&null==fn?(fn=selector,data=selector=void 0):null==fn&&(\"string\"==typeof selector?(fn=data,data=void 0):(fn=data,data=selector,selector=void 0)),!1===fn)fn=returnFalse;else if(!fn)return elem;return 1===one&&(origFn=fn,(fn=function(event){return jQuery().off(event),origFn.apply(this,arguments)}).guid=origFn.guid||(origFn.guid=jQuery.guid++)),elem.each(function(){jQuery.event.add(this,types,fn,data,selector)})}jQuery.event={global:{},add:function(elem,types,handler,data,selector){var handleObjIn,eventHandle,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=dataPriv.get(elem);if(elemData)for(handler.handler&&(handler=(handleObjIn=handler).handler,selector=handleObjIn.selector),selector&&jQuery.find.matchesSelector(documentElement,selector),handler.guid||(handler.guid=jQuery.guid++),(events=elemData.events)||(events=elemData.events={}),(eventHandle=elemData.handle)||(eventHandle=elemData.handle=function(e){return void 0!==jQuery&&jQuery.event.triggered!==e.type?jQuery.event.dispatch.apply(elem,arguments):void 0}),t=(types=(types||\"\").match(rnothtmlwhite)||[\"\"]).length;t--;)type=origType=(tmp=rtypenamespace.exec(types[t])||[])[1],namespaces=(tmp[2]||\"\").split(\".\").sort(),type&&(special=jQuery.event.special[type]||{},type=(selector?special.delegateType:special.bindType)||type,special=jQuery.event.special[type]||{},handleObj=jQuery.extend({type:type,origType:origType,data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(\".\")},handleObjIn),(handlers=events[type])||((handlers=events[type]=[]).delegateCount=0,special.setup&&!1!==special.setup.call(elem,data,namespaces,eventHandle)||elem.addEventListener&&elem.addEventListener(type,eventHandle)),special.add&&(special.add.call(elem,handleObj),handleObj.handler.guid||(handleObj.handler.guid=handler.guid)),selector?handlers.splice(handlers.delegateCount++,0,handleObj):handlers.push(handleObj),jQuery.event.global[type]=!0)},remove:function(elem,types,handler,selector,mappedTypes){var j,origCount,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=dataPriv.hasData(elem)&&dataPriv.get(elem);if(elemData&&(events=elemData.events)){for(t=(types=(types||\"\").match(rnothtmlwhite)||[\"\"]).length;t--;)if(type=origType=(tmp=rtypenamespace.exec(types[t])||[])[1],namespaces=(tmp[2]||\"\").split(\".\").sort(),type){for(special=jQuery.event.special[type]||{},handlers=events[type=(selector?special.delegateType:special.bindType)||type]||[],tmp=tmp[2]&&new RegExp(\"(^|\\\\.)\"+namespaces.join(\"\\\\.(?:.*\\\\.|)\")+\"(\\\\.|$)\"),origCount=j=handlers.length;j--;)handleObj=handlers[j],!mappedTypes&&origType!==handleObj.origType||handler&&handler.guid!==handleObj.guid||tmp&&!tmp.test(handleObj.namespace)||selector&&selector!==handleObj.selector&&(\"**\"!==selector||!handleObj.selector)||(handlers.splice(j,1),handleObj.selector&&handlers.delegateCount--,special.remove&&special.remove.call(elem,handleObj));origCount&&!handlers.length&&(special.teardown&&!1!==special.teardown.call(elem,namespaces,elemData.handle)||jQuery.removeEvent(elem,type,elemData.handle),delete events[type])}else for(type in events)jQuery.event.remove(elem,type+types[t],handler,selector,!0);jQuery.isEmptyObject(events)&&dataPriv.remove(elem,\"handle events\")}},dispatch:function(nativeEvent){var i,j,ret,matched,handleObj,handlerQueue,event=jQuery.event.fix(nativeEvent),args=new Array(arguments.length),handlers=(dataPriv.get(this,\"events\")||{})[event.type]||[],special=jQuery.event.special[event.type]||{};for(args[0]=event,i=1;i<arguments.length;i++)args[i]=arguments[i];if(event.delegateTarget=this,!special.preDispatch||!1!==special.preDispatch.call(this,event)){for(handlerQueue=jQuery.event.handlers.call(this,event,handlers),i=0;(matched=handlerQueue[i++])&&!event.isPropagationStopped();)for(event.currentTarget=matched.elem,j=0;(handleObj=matched.handlers[j++])&&!event.isImmediatePropagationStopped();)event.rnamespace&&!event.rnamespace.test(handleObj.namespace)||(event.handleObj=handleObj,event.data=handleObj.data,void 0!==(ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args))&&!1===(event.result=ret)&&(event.preventDefault(),event.stopPropagation()));return special.postDispatch&&special.postDispatch.call(this,event),event.result}},handlers:function(event,handlers){var i,handleObj,sel,matchedHandlers,matchedSelectors,handlerQueue=[],delegateCount=handlers.delegateCount,cur=event.target;if(delegateCount&&cur.nodeType&&!(\"click\"===event.type&&event.button>=1))for(;cur!==this;cur=cur.parentNode||this)if(1===cur.nodeType&&(\"click\"!==event.type||!0!==cur.disabled)){for(matchedHandlers=[],matchedSelectors={},i=0;i<delegateCount;i++)void 0===matchedSelectors[sel=(handleObj=handlers[i]).selector+\" \"]&&(matchedSelectors[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>-1:jQuery.find(sel,this,null,[cur]).length),matchedSelectors[sel]&&matchedHandlers.push(handleObj);matchedHandlers.length&&handlerQueue.push({elem:cur,handlers:matchedHandlers})}return cur=this,delegateCount<handlers.length&&handlerQueue.push({elem:cur,handlers:handlers.slice(delegateCount)}),handlerQueue},addProp:function(name,hook){Object.defineProperty(jQuery.Event.prototype,name,{enumerable:!0,configurable:!0,get:jQuery.isFunction(hook)?function(){if(this.originalEvent)return hook(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[name]},set:function(value){Object.defineProperty(this,name,{enumerable:!0,configurable:!0,writable:!0,value:value})}})},fix:function(originalEvent){return originalEvent[jQuery.expando]?originalEvent:new jQuery.Event(originalEvent)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus)return this.focus(),!1},delegateType:\"focusin\"},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur)return this.blur(),!1},delegateType:\"focusout\"},click:{trigger:function(){if(\"checkbox\"===this.type&&this.click&&nodeName(this,\"input\"))return this.click(),!1},_default:function(event){return nodeName(event.target,\"a\")}},beforeunload:{postDispatch:function(event){void 0!==event.result&&event.originalEvent&&(event.originalEvent.returnValue=event.result)}}}},jQuery.removeEvent=function(elem,type,handle){elem.removeEventListener&&elem.removeEventListener(type,handle)},jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event))return new jQuery.Event(src,props);src&&src.type?(this.originalEvent=src,this.type=src.type,this.isDefaultPrevented=src.defaultPrevented||void 0===src.defaultPrevented&&!1===src.returnValue?returnTrue:returnFalse,this.target=src.target&&3===src.target.nodeType?src.target.parentNode:src.target,this.currentTarget=src.currentTarget,this.relatedTarget=src.relatedTarget):this.type=src,props&&jQuery.extend(this,props),this.timeStamp=src&&src.timeStamp||jQuery.now(),this[jQuery.expando]=!0},jQuery.Event.prototype={constructor:jQuery.Event,isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=returnTrue,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},jQuery.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(event){var button=event.button;return null==event.which&&rkeyEvent.test(event.type)?null!=event.charCode?event.charCode:event.keyCode:!event.which&&void 0!==button&&rmouseEvent.test(event.type)?1&button?1:2&button?3:4&button?2:0:event.which}},jQuery.event.addProp),jQuery.each({mouseenter:\"mouseover\",mouseleave:\"mouseout\",pointerenter:\"pointerover\",pointerleave:\"pointerout\"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,related=event.relatedTarget,handleObj=event.handleObj;return related&&(related===this||jQuery.contains(this,related))||(event.type=handleObj.origType,ret=handleObj.handler.apply(this,arguments),event.type=fix),ret}}}),jQuery.fn.extend({on:function(types,selector,data,fn){return on(this,types,selector,data,fn)},one:function(types,selector,data,fn){return on(this,types,selector,data,fn,1)},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj)return handleObj=types.handleObj,jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+\".\"+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler),this;if(\"object\"==typeof types){for(type in types)this.off(type,selector,types[type]);return this}return!1!==selector&&\"function\"!=typeof selector||(fn=selector,selector=void 0),!1===fn&&(fn=returnFalse),this.each(function(){jQuery.event.remove(this,types,fn,selector)})}});var rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\\/\\0>\\x20\\t\\r\\n\\f]*)[^>]*)\\/>/gi,rnoInnerhtml=/<script|<style|<link/i,rchecked=/checked\\s*(?:[^=]|=\\s*.checked.)/i,rscriptTypeMasked=/^true\\/(.*)/,rcleanScript=/^\\s*<!(?:\\[CDATA\\[|--)|(?:\\]\\]|--)>\\s*$/g;function manipulationTarget(elem,content){return nodeName(elem,\"table\")&&nodeName(11!==content.nodeType?content:content.firstChild,\"tr\")&&jQuery(\">tbody\",elem)[0]||elem}function disableScript(elem){return elem.type=(null!==elem.getAttribute(\"type\"))+\"/\"+elem.type,elem}function restoreScript(elem){var match=rscriptTypeMasked.exec(elem.type);return match?elem.type=match[1]:elem.removeAttribute(\"type\"),elem}function cloneCopyEvent(src,dest){var i,l,type,pdataOld,pdataCur,udataOld,udataCur,events;if(1===dest.nodeType){if(dataPriv.hasData(src)&&(pdataOld=dataPriv.access(src),pdataCur=dataPriv.set(dest,pdataOld),events=pdataOld.events))for(type in delete pdataCur.handle,pdataCur.events={},events)for(i=0,l=events[type].length;i<l;i++)jQuery.event.add(dest,type,events[type][i]);dataUser.hasData(src)&&(udataOld=dataUser.access(src),udataCur=jQuery.extend({},udataOld),dataUser.set(dest,udataCur))}}function domManip(collection,args,callback,ignored){args=concat.apply([],args);var fragment,first,scripts,hasScripts,node,doc,i=0,l=collection.length,iNoClone=l-1,value=args[0],isFunction=jQuery.isFunction(value);if(isFunction||l>1&&\"string\"==typeof value&&!support.checkClone&&rchecked.test(value))return collection.each(function(index){var self=collection.eq(index);isFunction&&(args[0]=value.call(this,index,self.html())),domManip(self,args,callback,ignored)});if(l&&(first=(fragment=buildFragment(args,collection[0].ownerDocument,!1,collection,ignored)).firstChild,1===fragment.childNodes.length&&(fragment=first),first||ignored)){for(hasScripts=(scripts=jQuery.map(getAll(fragment,\"script\"),disableScript)).length;i<l;i++)node=fragment,i!==iNoClone&&(node=jQuery.clone(node,!0,!0),hasScripts&&jQuery.merge(scripts,getAll(node,\"script\"))),callback.call(collection[i],node,i);if(hasScripts)for(doc=scripts[scripts.length-1].ownerDocument,jQuery.map(scripts,restoreScript),i=0;i<hasScripts;i++)node=scripts[i],rscriptType.test(node.type||\"\")&&!dataPriv.access(node,\"globalEval\")&&jQuery.contains(doc,node)&&(node.src?jQuery._evalUrl&&jQuery._evalUrl(node.src):DOMEval(node.textContent.replace(rcleanScript,\"\"),doc))}return collection}function remove(elem,selector,keepData){for(var node,nodes=selector?jQuery.filter(selector,elem):elem,i=0;null!=(node=nodes[i]);i++)keepData||1!==node.nodeType||jQuery.cleanData(getAll(node)),node.parentNode&&(keepData&&jQuery.contains(node.ownerDocument,node)&&setGlobalEval(getAll(node,\"script\")),node.parentNode.removeChild(node));return elem}jQuery.extend({htmlPrefilter:function(html){return html.replace(rxhtmlTag,\"<$1></$2>\")},clone:function(elem,dataAndEvents,deepDataAndEvents){var i,l,srcElements,destElements,src,dest,nodeName,clone=elem.cloneNode(!0),inPage=jQuery.contains(elem.ownerDocument,elem);if(!(support.noCloneChecked||1!==elem.nodeType&&11!==elem.nodeType||jQuery.isXMLDoc(elem)))for(destElements=getAll(clone),i=0,l=(srcElements=getAll(elem)).length;i<l;i++)src=srcElements[i],dest=destElements[i],void 0,\"input\"===(nodeName=dest.nodeName.toLowerCase())&&rcheckableType.test(src.type)?dest.checked=src.checked:\"input\"!==nodeName&&\"textarea\"!==nodeName||(dest.defaultValue=src.defaultValue);if(dataAndEvents)if(deepDataAndEvents)for(srcElements=srcElements||getAll(elem),destElements=destElements||getAll(clone),i=0,l=srcElements.length;i<l;i++)cloneCopyEvent(srcElements[i],destElements[i]);else cloneCopyEvent(elem,clone);return(destElements=getAll(clone,\"script\")).length>0&&setGlobalEval(destElements,!inPage&&getAll(elem,\"script\")),clone},cleanData:function(elems){for(var data,elem,type,special=jQuery.event.special,i=0;void 0!==(elem=elems[i]);i++)if(acceptData(elem)){if(data=elem[dataPriv.expando]){if(data.events)for(type in data.events)special[type]?jQuery.event.remove(elem,type):jQuery.removeEvent(elem,type,data.handle);elem[dataPriv.expando]=void 0}elem[dataUser.expando]&&(elem[dataUser.expando]=void 0)}}}),jQuery.fn.extend({detach:function(selector){return remove(this,selector,!0)},remove:function(selector){return remove(this,selector)},text:function(value){return access(this,function(value){return void 0===value?jQuery.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=value)})},null,value,arguments.length)},append:function(){return domManip(this,arguments,function(elem){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||manipulationTarget(this,elem).appendChild(elem)})},prepend:function(){return domManip(this,arguments,function(elem){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var target=manipulationTarget(this,elem);target.insertBefore(elem,target.firstChild)}})},before:function(){return domManip(this,arguments,function(elem){this.parentNode&&this.parentNode.insertBefore(elem,this)})},after:function(){return domManip(this,arguments,function(elem){this.parentNode&&this.parentNode.insertBefore(elem,this.nextSibling)})},empty:function(){for(var elem,i=0;null!=(elem=this[i]);i++)1===elem.nodeType&&(jQuery.cleanData(getAll(elem,!1)),elem.textContent=\"\");return this},clone:function(dataAndEvents,deepDataAndEvents){return dataAndEvents=null!=dataAndEvents&&dataAndEvents,deepDataAndEvents=null==deepDataAndEvents?dataAndEvents:deepDataAndEvents,this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)})},html:function(value){return access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(void 0===value&&1===elem.nodeType)return elem.innerHTML;if(\"string\"==typeof value&&!rnoInnerhtml.test(value)&&!wrapMap[(rtagName.exec(value)||[\"\",\"\"])[1].toLowerCase()]){value=jQuery.htmlPrefilter(value);try{for(;i<l;i++)1===(elem=this[i]||{}).nodeType&&(jQuery.cleanData(getAll(elem,!1)),elem.innerHTML=value);elem=0}catch(e){}}elem&&this.empty().append(value)},null,value,arguments.length)},replaceWith:function(){var ignored=[];return domManip(this,arguments,function(elem){var parent=this.parentNode;jQuery.inArray(this,ignored)<0&&(jQuery.cleanData(getAll(this)),parent&&parent.replaceChild(elem,this))},ignored)}}),jQuery.each({appendTo:\"append\",prependTo:\"prepend\",insertBefore:\"before\",insertAfter:\"after\",replaceAll:\"replaceWith\"},function(name,original){jQuery.fn[name]=function(selector){for(var elems,ret=[],insert=jQuery(selector),last=insert.length-1,i=0;i<=last;i++)elems=i===last?this:this.clone(!0),jQuery(insert[i])[original](elems),push.apply(ret,elems.get());return this.pushStack(ret)}});var rmargin=/^margin/,rnumnonpx=new RegExp(\"^(\"+pnum+\")(?!px)[a-z%]+$\",\"i\"),getStyles=function(elem){var view=elem.ownerDocument.defaultView;return view&&view.opener||(view=window),view.getComputedStyle(elem)};function curCSS(elem,name,computed){var width,minWidth,maxWidth,ret,style=elem.style;return(computed=computed||getStyles(elem))&&(\"\"!==(ret=computed.getPropertyValue(name)||computed[name])||jQuery.contains(elem.ownerDocument,elem)||(ret=jQuery.style(elem,name)),!support.pixelMarginRight()&&rnumnonpx.test(ret)&&rmargin.test(name)&&(width=style.width,minWidth=style.minWidth,maxWidth=style.maxWidth,style.minWidth=style.maxWidth=style.width=ret,ret=computed.width,style.width=width,style.minWidth=minWidth,style.maxWidth=maxWidth)),void 0!==ret?ret+\"\":ret}function addGetHookIf(conditionFn,hookFn){return{get:function(){if(!conditionFn())return(this.get=hookFn).apply(this,arguments);delete this.get}}}!function(){function computeStyleTests(){if(div){div.style.cssText=\"box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%\",div.innerHTML=\"\",documentElement.appendChild(container);var divStyle=window.getComputedStyle(div);pixelPositionVal=\"1%\"!==divStyle.top,reliableMarginLeftVal=\"2px\"===divStyle.marginLeft,boxSizingReliableVal=\"4px\"===divStyle.width,div.style.marginRight=\"50%\",pixelMarginRightVal=\"4px\"===divStyle.marginRight,documentElement.removeChild(container),div=null}}var pixelPositionVal,boxSizingReliableVal,pixelMarginRightVal,reliableMarginLeftVal,container=document.createElement(\"div\"),div=document.createElement(\"div\");div.style&&(div.style.backgroundClip=\"content-box\",div.cloneNode(!0).style.backgroundClip=\"\",support.clearCloneStyle=\"content-box\"===div.style.backgroundClip,container.style.cssText=\"border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute\",container.appendChild(div),jQuery.extend(support,{pixelPosition:function(){return computeStyleTests(),pixelPositionVal},boxSizingReliable:function(){return computeStyleTests(),boxSizingReliableVal},pixelMarginRight:function(){return computeStyleTests(),pixelMarginRightVal},reliableMarginLeft:function(){return computeStyleTests(),reliableMarginLeftVal}}))}();var rdisplayswap=/^(none|table(?!-c[ea]).+)/,rcustomProp=/^--/,cssShow={position:\"absolute\",visibility:\"hidden\",display:\"block\"},cssNormalTransform={letterSpacing:\"0\",fontWeight:\"400\"},cssPrefixes=[\"Webkit\",\"Moz\",\"ms\"],emptyStyle=document.createElement(\"div\").style;function finalPropName(name){var ret=jQuery.cssProps[name];return ret||(ret=jQuery.cssProps[name]=function(name){if(name in emptyStyle)return name;for(var capName=name[0].toUpperCase()+name.slice(1),i=cssPrefixes.length;i--;)if((name=cssPrefixes[i]+capName)in emptyStyle)return name}(name)||name),ret}function setPositiveNumber(elem,value,subtract){var matches=rcssNum.exec(value);return matches?Math.max(0,matches[2]-(subtract||0))+(matches[3]||\"px\"):value}function augmentWidthOrHeight(elem,name,extra,isBorderBox,styles){var i,val=0;for(i=extra===(isBorderBox?\"border\":\"content\")?4:\"width\"===name?1:0;i<4;i+=2)\"margin\"===extra&&(val+=jQuery.css(elem,extra+cssExpand[i],!0,styles)),isBorderBox?(\"content\"===extra&&(val-=jQuery.css(elem,\"padding\"+cssExpand[i],!0,styles)),\"margin\"!==extra&&(val-=jQuery.css(elem,\"border\"+cssExpand[i]+\"Width\",!0,styles))):(val+=jQuery.css(elem,\"padding\"+cssExpand[i],!0,styles),\"padding\"!==extra&&(val+=jQuery.css(elem,\"border\"+cssExpand[i]+\"Width\",!0,styles)));return val}function getWidthOrHeight(elem,name,extra){var valueIsBorderBox,styles=getStyles(elem),val=curCSS(elem,name,styles),isBorderBox=\"border-box\"===jQuery.css(elem,\"boxSizing\",!1,styles);return rnumnonpx.test(val)?val:(valueIsBorderBox=isBorderBox&&(support.boxSizingReliable()||val===elem.style[name]),\"auto\"===val&&(val=elem[\"offset\"+name[0].toUpperCase()+name.slice(1)]),(val=parseFloat(val)||0)+augmentWidthOrHeight(elem,name,extra||(isBorderBox?\"border\":\"content\"),valueIsBorderBox,styles)+\"px\")}function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing)}jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,\"opacity\");return\"\"===ret?\"1\":ret}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:\"cssFloat\"},style:function(elem,name,value,extra){if(elem&&3!==elem.nodeType&&8!==elem.nodeType&&elem.style){var ret,type,hooks,origName=jQuery.camelCase(name),isCustomProp=rcustomProp.test(name),style=elem.style;if(isCustomProp||(name=finalPropName(origName)),hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName],void 0===value)return hooks&&\"get\"in hooks&&void 0!==(ret=hooks.get(elem,!1,extra))?ret:style[name];\"string\"===(type=typeof value)&&(ret=rcssNum.exec(value))&&ret[1]&&(value=adjustCSS(elem,name,ret),type=\"number\"),null!=value&&value==value&&(\"number\"===type&&(value+=ret&&ret[3]||(jQuery.cssNumber[origName]?\"\":\"px\")),support.clearCloneStyle||\"\"!==value||0!==name.indexOf(\"background\")||(style[name]=\"inherit\"),hooks&&\"set\"in hooks&&void 0===(value=hooks.set(elem,value,extra))||(isCustomProp?style.setProperty(name,value):style[name]=value))}},css:function(elem,name,extra,styles){var val,num,hooks,origName=jQuery.camelCase(name);return rcustomProp.test(name)||(name=finalPropName(origName)),(hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName])&&\"get\"in hooks&&(val=hooks.get(elem,!0,extra)),void 0===val&&(val=curCSS(elem,name,styles)),\"normal\"===val&&name in cssNormalTransform&&(val=cssNormalTransform[name]),\"\"===extra||extra?(num=parseFloat(val),!0===extra||isFinite(num)?num||0:val):val}}),jQuery.each([\"height\",\"width\"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){if(computed)return!rdisplayswap.test(jQuery.css(elem,\"display\"))||elem.getClientRects().length&&elem.getBoundingClientRect().width?getWidthOrHeight(elem,name,extra):swap(elem,cssShow,function(){return getWidthOrHeight(elem,name,extra)})},set:function(elem,value,extra){var matches,styles=extra&&getStyles(elem),subtract=extra&&augmentWidthOrHeight(elem,name,extra,\"border-box\"===jQuery.css(elem,\"boxSizing\",!1,styles),styles);return subtract&&(matches=rcssNum.exec(value))&&\"px\"!==(matches[3]||\"px\")&&(elem.style[name]=value,value=jQuery.css(elem,name)),setPositiveNumber(0,value,subtract)}}}),jQuery.cssHooks.marginLeft=addGetHookIf(support.reliableMarginLeft,function(elem,computed){if(computed)return(parseFloat(curCSS(elem,\"marginLeft\"))||elem.getBoundingClientRect().left-swap(elem,{marginLeft:0},function(){return elem.getBoundingClientRect().left}))+\"px\"}),jQuery.each({margin:\"\",padding:\"\",border:\"Width\"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){for(var i=0,expanded={},parts=\"string\"==typeof value?value.split(\" \"):[value];i<4;i++)expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0];return expanded}},rmargin.test(prefix)||(jQuery.cssHooks[prefix+suffix].set=setPositiveNumber)}),jQuery.fn.extend({css:function(name,value){return access(this,function(elem,name,value){var styles,len,map={},i=0;if(Array.isArray(name)){for(styles=getStyles(elem),len=name.length;i<len;i++)map[name[i]]=jQuery.css(elem,name[i],!1,styles);return map}return void 0!==value?jQuery.style(elem,name,value):jQuery.css(elem,name)},name,value,arguments.length>1)}}),jQuery.Tween=Tween,Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem,this.prop=prop,this.easing=easing||jQuery.easing._default,this.options=options,this.start=this.now=this.cur(),this.end=end,this.unit=unit||(jQuery.cssNumber[prop]?\"\":\"px\")},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this)},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];return this.options.duration?this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration):this.pos=eased=percent,this.now=(this.end-this.start)*eased+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),hooks&&hooks.set?hooks.set(this):Tween.propHooks._default.set(this),this}},Tween.prototype.init.prototype=Tween.prototype,Tween.propHooks={_default:{get:function(tween){var result;return 1!==tween.elem.nodeType||null!=tween.elem[tween.prop]&&null==tween.elem.style[tween.prop]?tween.elem[tween.prop]:(result=jQuery.css(tween.elem,tween.prop,\"\"))&&\"auto\"!==result?result:0},set:function(tween){jQuery.fx.step[tween.prop]?jQuery.fx.step[tween.prop](tween):1!==tween.elem.nodeType||null==tween.elem.style[jQuery.cssProps[tween.prop]]&&!jQuery.cssHooks[tween.prop]?tween.elem[tween.prop]=tween.now:jQuery.style(tween.elem,tween.prop,tween.now+tween.unit)}}},Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){tween.elem.nodeType&&tween.elem.parentNode&&(tween.elem[tween.prop]=tween.now)}},jQuery.easing={linear:function(p){return p},swing:function(p){return.5-Math.cos(p*Math.PI)/2},_default:\"swing\"},jQuery.fx=Tween.prototype.init,jQuery.fx.step={};var fxNow,inProgress,rfxtypes=/^(?:toggle|show|hide)$/,rrun=/queueHooks$/;function schedule(){inProgress&&(!1===document.hidden&&window.requestAnimationFrame?window.requestAnimationFrame(schedule):window.setTimeout(schedule,jQuery.fx.interval),jQuery.fx.tick())}function createFxNow(){return window.setTimeout(function(){fxNow=void 0}),fxNow=jQuery.now()}function genFx(type,includeWidth){var which,i=0,attrs={height:type};for(includeWidth=includeWidth?1:0;i<4;i+=2-includeWidth)attrs[\"margin\"+(which=cssExpand[i])]=attrs[\"padding\"+which]=type;return includeWidth&&(attrs.opacity=attrs.width=type),attrs}function createTween(value,prop,animation){for(var tween,collection=(Animation.tweeners[prop]||[]).concat(Animation.tweeners[\"*\"]),index=0,length=collection.length;index<length;index++)if(tween=collection[index].call(animation,prop,value))return tween}function Animation(elem,properties,options){var result,stopped,index=0,length=Animation.prefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem}),tick=function(){if(stopped)return!1;for(var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),percent=1-(remaining/animation.duration||0),index=0,length=animation.tweens.length;index<length;index++)animation.tweens[index].run(percent);return deferred.notifyWith(elem,[animation,percent,remaining]),percent<1&&length?remaining:(length||deferred.notifyWith(elem,[animation,1,0]),deferred.resolveWith(elem,[animation]),!1)},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(!0,{specialEasing:{},easing:jQuery.easing._default},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);return animation.tweens.push(tween),tween},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;if(stopped)return this;for(stopped=!0;index<length;index++)animation.tweens[index].run(1);return gotoEnd?(deferred.notifyWith(elem,[animation,1,0]),deferred.resolveWith(elem,[animation,gotoEnd])):deferred.rejectWith(elem,[animation,gotoEnd]),this}}),props=animation.props;for(!function(props,specialEasing){var index,name,easing,value,hooks;for(index in props)if(easing=specialEasing[name=jQuery.camelCase(index)],value=props[index],Array.isArray(value)&&(easing=value[1],value=props[index]=value[0]),index!==name&&(props[name]=value,delete props[index]),(hooks=jQuery.cssHooks[name])&&\"expand\"in hooks)for(index in value=hooks.expand(value),delete props[name],value)index in props||(props[index]=value[index],specialEasing[index]=easing);else specialEasing[name]=easing}(props,animation.opts.specialEasing);index<length;index++)if(result=Animation.prefilters[index].call(animation,elem,props,animation.opts))return jQuery.isFunction(result.stop)&&(jQuery._queueHooks(animation.elem,animation.opts.queue).stop=jQuery.proxy(result.stop,result)),result;return jQuery.map(props,createTween,animation),jQuery.isFunction(animation.opts.start)&&animation.opts.start.call(elem,animation),animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always),jQuery.fx.timer(jQuery.extend(tick,{elem:elem,anim:animation,queue:animation.opts.queue})),animation}jQuery.Animation=jQuery.extend(Animation,{tweeners:{\"*\":[function(prop,value){var tween=this.createTween(prop,value);return adjustCSS(tween.elem,prop,rcssNum.exec(value),tween),tween}]},tweener:function(props,callback){jQuery.isFunction(props)?(callback=props,props=[\"*\"]):props=props.match(rnothtmlwhite);for(var prop,index=0,length=props.length;index<length;index++)prop=props[index],Animation.tweeners[prop]=Animation.tweeners[prop]||[],Animation.tweeners[prop].unshift(callback)},prefilters:[function(elem,props,opts){var prop,value,toggle,hooks,oldfire,propTween,restoreDisplay,display,isBox=\"width\"in props||\"height\"in props,anim=this,orig={},style=elem.style,hidden=elem.nodeType&&isHiddenWithinTree(elem),dataShow=dataPriv.get(elem,\"fxshow\");for(prop in opts.queue||(null==(hooks=jQuery._queueHooks(elem,\"fx\")).unqueued&&(hooks.unqueued=0,oldfire=hooks.empty.fire,hooks.empty.fire=function(){hooks.unqueued||oldfire()}),hooks.unqueued++,anim.always(function(){anim.always(function(){hooks.unqueued--,jQuery.queue(elem,\"fx\").length||hooks.empty.fire()})})),props)if(value=props[prop],rfxtypes.test(value)){if(delete props[prop],toggle=toggle||\"toggle\"===value,value===(hidden?\"hide\":\"show\")){if(\"show\"!==value||!dataShow||void 0===dataShow[prop])continue;hidden=!0}orig[prop]=dataShow&&dataShow[prop]||jQuery.style(elem,prop)}if((propTween=!jQuery.isEmptyObject(props))||!jQuery.isEmptyObject(orig))for(prop in isBox&&1===elem.nodeType&&(opts.overflow=[style.overflow,style.overflowX,style.overflowY],null==(restoreDisplay=dataShow&&dataShow.display)&&(restoreDisplay=dataPriv.get(elem,\"display\")),\"none\"===(display=jQuery.css(elem,\"display\"))&&(restoreDisplay?display=restoreDisplay:(showHide([elem],!0),restoreDisplay=elem.style.display||restoreDisplay,display=jQuery.css(elem,\"display\"),showHide([elem]))),(\"inline\"===display||\"inline-block\"===display&&null!=restoreDisplay)&&\"none\"===jQuery.css(elem,\"float\")&&(propTween||(anim.done(function(){style.display=restoreDisplay}),null==restoreDisplay&&(display=style.display,restoreDisplay=\"none\"===display?\"\":display)),style.display=\"inline-block\")),opts.overflow&&(style.overflow=\"hidden\",anim.always(function(){style.overflow=opts.overflow[0],style.overflowX=opts.overflow[1],style.overflowY=opts.overflow[2]})),propTween=!1,orig)propTween||(dataShow?\"hidden\"in dataShow&&(hidden=dataShow.hidden):dataShow=dataPriv.access(elem,\"fxshow\",{display:restoreDisplay}),toggle&&(dataShow.hidden=!hidden),hidden&&showHide([elem],!0),anim.done(function(){for(prop in hidden||showHide([elem]),dataPriv.remove(elem,\"fxshow\"),orig)jQuery.style(elem,prop,orig[prop])})),propTween=createTween(hidden?dataShow[prop]:0,prop,anim),prop in dataShow||(dataShow[prop]=propTween.start,hidden&&(propTween.end=propTween.start,propTween.start=0))}],prefilter:function(callback,prepend){prepend?Animation.prefilters.unshift(callback):Animation.prefilters.push(callback)}}),jQuery.speed=function(speed,easing,fn){var opt=speed&&\"object\"==typeof speed?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};return jQuery.fx.off?opt.duration=0:\"number\"!=typeof opt.duration&&(opt.duration in jQuery.fx.speeds?opt.duration=jQuery.fx.speeds[opt.duration]:opt.duration=jQuery.fx.speeds._default),null!=opt.queue&&!0!==opt.queue||(opt.queue=\"fx\"),opt.old=opt.complete,opt.complete=function(){jQuery.isFunction(opt.old)&&opt.old.call(this),opt.queue&&jQuery.dequeue(this,opt.queue)},opt},jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHiddenWithinTree).css(\"opacity\",0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);(empty||dataPriv.get(this,\"finish\"))&&anim.stop(!0)};return doAnimation.finish=doAnimation,empty||!1===optall.queue?this.each(doAnimation):this.queue(optall.queue,doAnimation)},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop,stop(gotoEnd)};return\"string\"!=typeof type&&(gotoEnd=clearQueue,clearQueue=type,type=void 0),clearQueue&&!1!==type&&this.queue(type||\"fx\",[]),this.each(function(){var dequeue=!0,index=null!=type&&type+\"queueHooks\",timers=jQuery.timers,data=dataPriv.get(this);if(index)data[index]&&data[index].stop&&stopQueue(data[index]);else for(index in data)data[index]&&data[index].stop&&rrun.test(index)&&stopQueue(data[index]);for(index=timers.length;index--;)timers[index].elem!==this||null!=type&&timers[index].queue!==type||(timers[index].anim.stop(gotoEnd),dequeue=!1,timers.splice(index,1));!dequeue&&gotoEnd||jQuery.dequeue(this,type)})},finish:function(type){return!1!==type&&(type=type||\"fx\"),this.each(function(){var index,data=dataPriv.get(this),queue=data[type+\"queue\"],hooks=data[type+\"queueHooks\"],timers=jQuery.timers,length=queue?queue.length:0;for(data.finish=!0,jQuery.queue(this,type,[]),hooks&&hooks.stop&&hooks.stop.call(this,!0),index=timers.length;index--;)timers[index].elem===this&&timers[index].queue===type&&(timers[index].anim.stop(!0),timers.splice(index,1));for(index=0;index<length;index++)queue[index]&&queue[index].finish&&queue[index].finish.call(this);delete data.finish})}}),jQuery.each([\"toggle\",\"show\",\"hide\"],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return null==speed||\"boolean\"==typeof speed?cssFn.apply(this,arguments):this.animate(genFx(name,!0),speed,easing,callback)}}),jQuery.each({slideDown:genFx(\"show\"),slideUp:genFx(\"hide\"),slideToggle:genFx(\"toggle\"),fadeIn:{opacity:\"show\"},fadeOut:{opacity:\"hide\"},fadeToggle:{opacity:\"toggle\"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}}),jQuery.timers=[],jQuery.fx.tick=function(){var timer,i=0,timers=jQuery.timers;for(fxNow=jQuery.now();i<timers.length;i++)(timer=timers[i])()||timers[i]!==timer||timers.splice(i--,1);timers.length||jQuery.fx.stop(),fxNow=void 0},jQuery.fx.timer=function(timer){jQuery.timers.push(timer),jQuery.fx.start()},jQuery.fx.interval=13,jQuery.fx.start=function(){inProgress||(inProgress=!0,schedule())},jQuery.fx.stop=function(){inProgress=null},jQuery.fx.speeds={slow:600,fast:200,_default:400},jQuery.fn.delay=function(time,type){return time=jQuery.fx&&jQuery.fx.speeds[time]||time,type=type||\"fx\",this.queue(type,function(next,hooks){var timeout=window.setTimeout(next,time);hooks.stop=function(){window.clearTimeout(timeout)}})},function(){var input=document.createElement(\"input\"),opt=document.createElement(\"select\").appendChild(document.createElement(\"option\"));input.type=\"checkbox\",support.checkOn=\"\"!==input.value,support.optSelected=opt.selected,(input=document.createElement(\"input\")).value=\"t\",input.type=\"radio\",support.radioValue=\"t\"===input.value}();var boolHook,attrHandle=jQuery.expr.attrHandle;jQuery.fn.extend({attr:function(name,value){return access(this,jQuery.attr,name,value,arguments.length>1)},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name)})}}),jQuery.extend({attr:function(elem,name,value){var ret,hooks,nType=elem.nodeType;if(3!==nType&&8!==nType&&2!==nType)return void 0===elem.getAttribute?jQuery.prop(elem,name,value):(1===nType&&jQuery.isXMLDoc(elem)||(hooks=jQuery.attrHooks[name.toLowerCase()]||(jQuery.expr.match.bool.test(name)?boolHook:void 0)),void 0!==value?null===value?void jQuery.removeAttr(elem,name):hooks&&\"set\"in hooks&&void 0!==(ret=hooks.set(elem,value,name))?ret:(elem.setAttribute(name,value+\"\"),value):hooks&&\"get\"in hooks&&null!==(ret=hooks.get(elem,name))?ret:null==(ret=jQuery.find.attr(elem,name))?void 0:ret)},attrHooks:{type:{set:function(elem,value){if(!support.radioValue&&\"radio\"===value&&nodeName(elem,\"input\")){var val=elem.value;return elem.setAttribute(\"type\",value),val&&(elem.value=val),value}}}},removeAttr:function(elem,value){var name,i=0,attrNames=value&&value.match(rnothtmlwhite);if(attrNames&&1===elem.nodeType)for(;name=attrNames[i++];)elem.removeAttribute(name)}}),boolHook={set:function(elem,value,name){return!1===value?jQuery.removeAttr(elem,name):elem.setAttribute(name,name),name}},jQuery.each(jQuery.expr.match.bool.source.match(/\\w+/g),function(i,name){var getter=attrHandle[name]||jQuery.find.attr;attrHandle[name]=function(elem,name,isXML){var ret,handle,lowercaseName=name.toLowerCase();return isXML||(handle=attrHandle[lowercaseName],attrHandle[lowercaseName]=ret,ret=null!=getter(elem,name,isXML)?lowercaseName:null,attrHandle[lowercaseName]=handle),ret}});var rfocusable=/^(?:input|select|textarea|button)$/i,rclickable=/^(?:a|area)$/i;function stripAndCollapse(value){return(value.match(rnothtmlwhite)||[]).join(\" \")}function getClass(elem){return elem.getAttribute&&elem.getAttribute(\"class\")||\"\"}jQuery.fn.extend({prop:function(name,value){return access(this,jQuery.prop,name,value,arguments.length>1)},removeProp:function(name){return this.each(function(){delete this[jQuery.propFix[name]||name]})}}),jQuery.extend({prop:function(elem,name,value){var ret,hooks,nType=elem.nodeType;if(3!==nType&&8!==nType&&2!==nType)return 1===nType&&jQuery.isXMLDoc(elem)||(name=jQuery.propFix[name]||name,hooks=jQuery.propHooks[name]),void 0!==value?hooks&&\"set\"in hooks&&void 0!==(ret=hooks.set(elem,value,name))?ret:elem[name]=value:hooks&&\"get\"in hooks&&null!==(ret=hooks.get(elem,name))?ret:elem[name]},propHooks:{tabIndex:{get:function(elem){var tabindex=jQuery.find.attr(elem,\"tabindex\");return tabindex?parseInt(tabindex,10):rfocusable.test(elem.nodeName)||rclickable.test(elem.nodeName)&&elem.href?0:-1}}},propFix:{for:\"htmlFor\",class:\"className\"}}),support.optSelected||(jQuery.propHooks.selected={get:function(elem){var parent=elem.parentNode;return parent&&parent.parentNode&&parent.parentNode.selectedIndex,null},set:function(elem){var parent=elem.parentNode;parent&&(parent.selectedIndex,parent.parentNode&&parent.parentNode.selectedIndex)}}),jQuery.each([\"tabIndex\",\"readOnly\",\"maxLength\",\"cellSpacing\",\"cellPadding\",\"rowSpan\",\"colSpan\",\"useMap\",\"frameBorder\",\"contentEditable\"],function(){jQuery.propFix[this.toLowerCase()]=this}),jQuery.fn.extend({addClass:function(value){var classes,elem,cur,curValue,clazz,j,finalValue,i=0;if(jQuery.isFunction(value))return this.each(function(j){jQuery(this).addClass(value.call(this,j,getClass(this)))});if(\"string\"==typeof value&&value)for(classes=value.match(rnothtmlwhite)||[];elem=this[i++];)if(curValue=getClass(elem),cur=1===elem.nodeType&&\" \"+stripAndCollapse(curValue)+\" \"){for(j=0;clazz=classes[j++];)cur.indexOf(\" \"+clazz+\" \")<0&&(cur+=clazz+\" \");curValue!==(finalValue=stripAndCollapse(cur))&&elem.setAttribute(\"class\",finalValue)}return this},removeClass:function(value){var classes,elem,cur,curValue,clazz,j,finalValue,i=0;if(jQuery.isFunction(value))return this.each(function(j){jQuery(this).removeClass(value.call(this,j,getClass(this)))});if(!arguments.length)return this.attr(\"class\",\"\");if(\"string\"==typeof value&&value)for(classes=value.match(rnothtmlwhite)||[];elem=this[i++];)if(curValue=getClass(elem),cur=1===elem.nodeType&&\" \"+stripAndCollapse(curValue)+\" \"){for(j=0;clazz=classes[j++];)for(;cur.indexOf(\" \"+clazz+\" \")>-1;)cur=cur.replace(\" \"+clazz+\" \",\" \");curValue!==(finalValue=stripAndCollapse(cur))&&elem.setAttribute(\"class\",finalValue)}return this},toggleClass:function(value,stateVal){var type=typeof value;return\"boolean\"==typeof stateVal&&\"string\"===type?stateVal?this.addClass(value):this.removeClass(value):jQuery.isFunction(value)?this.each(function(i){jQuery(this).toggleClass(value.call(this,i,getClass(this),stateVal),stateVal)}):this.each(function(){var className,i,self,classNames;if(\"string\"===type)for(i=0,self=jQuery(this),classNames=value.match(rnothtmlwhite)||[];className=classNames[i++];)self.hasClass(className)?self.removeClass(className):self.addClass(className);else void 0!==value&&\"boolean\"!==type||((className=getClass(this))&&dataPriv.set(this,\"__className__\",className),this.setAttribute&&this.setAttribute(\"class\",className||!1===value?\"\":dataPriv.get(this,\"__className__\")||\"\"))})},hasClass:function(selector){var className,elem,i=0;for(className=\" \"+selector+\" \";elem=this[i++];)if(1===elem.nodeType&&(\" \"+stripAndCollapse(getClass(elem))+\" \").indexOf(className)>-1)return!0;return!1}});var rreturn=/\\r/g;jQuery.fn.extend({val:function(value){var hooks,ret,isFunction,elem=this[0];return arguments.length?(isFunction=jQuery.isFunction(value),this.each(function(i){var val;1===this.nodeType&&(null==(val=isFunction?value.call(this,i,jQuery(this).val()):value)?val=\"\":\"number\"==typeof val?val+=\"\":Array.isArray(val)&&(val=jQuery.map(val,function(value){return null==value?\"\":value+\"\"})),(hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()])&&\"set\"in hooks&&void 0!==hooks.set(this,val,\"value\")||(this.value=val))})):elem?(hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()])&&\"get\"in hooks&&void 0!==(ret=hooks.get(elem,\"value\"))?ret:\"string\"==typeof(ret=elem.value)?ret.replace(rreturn,\"\"):null==ret?\"\":ret:void 0}}),jQuery.extend({valHooks:{option:{get:function(elem){var val=jQuery.find.attr(elem,\"value\");return null!=val?val:stripAndCollapse(jQuery.text(elem))}},select:{get:function(elem){var value,option,i,options=elem.options,index=elem.selectedIndex,one=\"select-one\"===elem.type,values=one?null:[],max=one?index+1:options.length;for(i=index<0?max:one?index:0;i<max;i++)if(((option=options[i]).selected||i===index)&&!option.disabled&&(!option.parentNode.disabled||!nodeName(option.parentNode,\"optgroup\"))){if(value=jQuery(option).val(),one)return value;values.push(value)}return values},set:function(elem,value){for(var optionSet,option,options=elem.options,values=jQuery.makeArray(value),i=options.length;i--;)((option=options[i]).selected=jQuery.inArray(jQuery.valHooks.option.get(option),values)>-1)&&(optionSet=!0);return optionSet||(elem.selectedIndex=-1),values}}}}),jQuery.each([\"radio\",\"checkbox\"],function(){jQuery.valHooks[this]={set:function(elem,value){if(Array.isArray(value))return elem.checked=jQuery.inArray(jQuery(elem).val(),value)>-1}},support.checkOn||(jQuery.valHooks[this].get=function(elem){return null===elem.getAttribute(\"value\")?\"on\":elem.value})});var rfocusMorph=/^(?:focusinfocus|focusoutblur)$/;jQuery.extend(jQuery.event,{trigger:function(event,data,elem,onlyHandlers){var i,cur,tmp,bubbleType,ontype,handle,special,eventPath=[elem||document],type=hasOwn.call(event,\"type\")?event.type:event,namespaces=hasOwn.call(event,\"namespace\")?event.namespace.split(\".\"):[];if(cur=tmp=elem=elem||document,3!==elem.nodeType&&8!==elem.nodeType&&!rfocusMorph.test(type+jQuery.event.triggered)&&(type.indexOf(\".\")>-1&&(type=(namespaces=type.split(\".\")).shift(),namespaces.sort()),ontype=type.indexOf(\":\")<0&&\"on\"+type,(event=event[jQuery.expando]?event:new jQuery.Event(type,\"object\"==typeof event&&event)).isTrigger=onlyHandlers?2:3,event.namespace=namespaces.join(\".\"),event.rnamespace=event.namespace?new RegExp(\"(^|\\\\.)\"+namespaces.join(\"\\\\.(?:.*\\\\.|)\")+\"(\\\\.|$)\"):null,event.result=void 0,event.target||(event.target=elem),data=null==data?[event]:jQuery.makeArray(data,[event]),special=jQuery.event.special[type]||{},onlyHandlers||!special.trigger||!1!==special.trigger.apply(elem,data))){if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){for(bubbleType=special.delegateType||type,rfocusMorph.test(bubbleType+type)||(cur=cur.parentNode);cur;cur=cur.parentNode)eventPath.push(cur),tmp=cur;tmp===(elem.ownerDocument||document)&&eventPath.push(tmp.defaultView||tmp.parentWindow||window)}for(i=0;(cur=eventPath[i++])&&!event.isPropagationStopped();)event.type=i>1?bubbleType:special.bindType||type,(handle=(dataPriv.get(cur,\"events\")||{})[event.type]&&dataPriv.get(cur,\"handle\"))&&handle.apply(cur,data),(handle=ontype&&cur[ontype])&&handle.apply&&acceptData(cur)&&(event.result=handle.apply(cur,data),!1===event.result&&event.preventDefault());return event.type=type,onlyHandlers||event.isDefaultPrevented()||special._default&&!1!==special._default.apply(eventPath.pop(),data)||!acceptData(elem)||ontype&&jQuery.isFunction(elem[type])&&!jQuery.isWindow(elem)&&((tmp=elem[ontype])&&(elem[ontype]=null),jQuery.event.triggered=type,elem[type](),jQuery.event.triggered=void 0,tmp&&(elem[ontype]=tmp)),event.result}},simulate:function(type,elem,event){var e=jQuery.extend(new jQuery.Event,event,{type:type,isSimulated:!0});jQuery.event.trigger(e,null,elem)}}),jQuery.fn.extend({trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this)})},triggerHandler:function(type,data){var elem=this[0];if(elem)return jQuery.event.trigger(type,data,elem,!0)}}),jQuery.each(\"blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu\".split(\" \"),function(i,name){jQuery.fn[name]=function(data,fn){return arguments.length>0?this.on(name,null,data,fn):this.trigger(name)}}),jQuery.fn.extend({hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)}}),support.focusin=\"onfocusin\"in window,support.focusin||jQuery.each({focus:\"focusin\",blur:\"focusout\"},function(orig,fix){var handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event))};jQuery.event.special[fix]={setup:function(){var doc=this.ownerDocument||this,attaches=dataPriv.access(doc,fix);attaches||doc.addEventListener(orig,handler,!0),dataPriv.access(doc,fix,(attaches||0)+1)},teardown:function(){var doc=this.ownerDocument||this,attaches=dataPriv.access(doc,fix)-1;attaches?dataPriv.access(doc,fix,attaches):(doc.removeEventListener(orig,handler,!0),dataPriv.remove(doc,fix))}}});var location=window.location,nonce=jQuery.now(),rquery=/\\?/;jQuery.parseXML=function(data){var xml;if(!data||\"string\"!=typeof data)return null;try{xml=(new window.DOMParser).parseFromString(data,\"text/xml\")}catch(e){xml=void 0}return xml&&!xml.getElementsByTagName(\"parsererror\").length||jQuery.error(\"Invalid XML: \"+data),xml};var rbracket=/\\[\\]$/,rCRLF=/\\r?\\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;function buildParams(prefix,obj,traditional,add){var name;if(Array.isArray(obj))jQuery.each(obj,function(i,v){traditional||rbracket.test(prefix)?add(prefix,v):buildParams(prefix+\"[\"+(\"object\"==typeof v&&null!=v?i:\"\")+\"]\",v,traditional,add)});else if(traditional||\"object\"!==jQuery.type(obj))add(prefix,obj);else for(name in obj)buildParams(prefix+\"[\"+name+\"]\",obj[name],traditional,add)}jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,valueOrFunction){var value=jQuery.isFunction(valueOrFunction)?valueOrFunction():valueOrFunction;s[s.length]=encodeURIComponent(key)+\"=\"+encodeURIComponent(null==value?\"\":value)};if(Array.isArray(a)||a.jquery&&!jQuery.isPlainObject(a))jQuery.each(a,function(){add(this.name,this.value)});else for(prefix in a)buildParams(prefix,a[prefix],traditional,add);return s.join(\"&\")},jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var elements=jQuery.prop(this,\"elements\");return elements?jQuery.makeArray(elements):this}).filter(function(){var type=this.type;return this.name&&!jQuery(this).is(\":disabled\")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(type)&&(this.checked||!rcheckableType.test(type))}).map(function(i,elem){var val=jQuery(this).val();return null==val?null:Array.isArray(val)?jQuery.map(val,function(val){return{name:elem.name,value:val.replace(rCRLF,\"\\r\\n\")}}):{name:elem.name,value:val.replace(rCRLF,\"\\r\\n\")}}).get()}});var r20=/%20/g,rhash=/#.*$/,rantiCache=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \\t]*([^\\r\\n]*)$/gm,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\\/\\//,prefilters={},transports={},allTypes=\"*/\".concat(\"*\"),originAnchor=document.createElement(\"a\");function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){\"string\"!=typeof dataTypeExpression&&(func=dataTypeExpression,dataTypeExpression=\"*\");var dataType,i=0,dataTypes=dataTypeExpression.toLowerCase().match(rnothtmlwhite)||[];if(jQuery.isFunction(func))for(;dataType=dataTypes[i++];)\"+\"===dataType[0]?(dataType=dataType.slice(1)||\"*\",(structure[dataType]=structure[dataType]||[]).unshift(func)):(structure[dataType]=structure[dataType]||[]).push(func)}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR){var inspected={},seekingTransport=structure===transports;function inspect(dataType){var selected;return inspected[dataType]=!0,jQuery.each(structure[dataType]||[],function(_,prefilterOrFactory){var dataTypeOrTransport=prefilterOrFactory(options,originalOptions,jqXHR);return\"string\"!=typeof dataTypeOrTransport||seekingTransport||inspected[dataTypeOrTransport]?seekingTransport?!(selected=dataTypeOrTransport):void 0:(options.dataTypes.unshift(dataTypeOrTransport),inspect(dataTypeOrTransport),!1)}),selected}return inspect(options.dataTypes[0])||!inspected[\"*\"]&&inspect(\"*\")}function ajaxExtend(target,src){var key,deep,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src)void 0!==src[key]&&((flatOptions[key]?target:deep||(deep={}))[key]=src[key]);return deep&&jQuery.extend(!0,target,deep),target}originAnchor.href=location.href,jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:location.href,type:\"GET\",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(location.protocol),global:!0,processData:!0,async:!0,contentType:\"application/x-www-form-urlencoded; charset=UTF-8\",accepts:{\"*\":allTypes,text:\"text/plain\",html:\"text/html\",xml:\"application/xml, text/xml\",json:\"application/json, text/javascript\"},contents:{xml:/\\bxml\\b/,html:/\\bhtml/,json:/\\bjson\\b/},responseFields:{xml:\"responseXML\",text:\"responseText\",json:\"responseJSON\"},converters:{\"* text\":String,\"text html\":!0,\"text json\":JSON.parse,\"text xml\":jQuery.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(target,settings){return settings?ajaxExtend(ajaxExtend(target,jQuery.ajaxSettings),settings):ajaxExtend(jQuery.ajaxSettings,target)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){\"object\"==typeof url&&(options=url,url=void 0),options=options||{};var transport,cacheURL,responseHeadersString,responseHeaders,timeoutTimer,urlAnchor,completed,fireGlobals,i,uncached,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=s.context&&(callbackContext.nodeType||callbackContext.jquery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks(\"once memory\"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},strAbort=\"canceled\",jqXHR={readyState:0,getResponseHeader:function(key){var match;if(completed){if(!responseHeaders)for(responseHeaders={};match=rheaders.exec(responseHeadersString);)responseHeaders[match[1].toLowerCase()]=match[2];match=responseHeaders[key.toLowerCase()]}return null==match?null:match},getAllResponseHeaders:function(){return completed?responseHeadersString:null},setRequestHeader:function(name,value){return null==completed&&(name=requestHeadersNames[name.toLowerCase()]=requestHeadersNames[name.toLowerCase()]||name,requestHeaders[name]=value),this},overrideMimeType:function(type){return null==completed&&(s.mimeType=type),this},statusCode:function(map){var code;if(map)if(completed)jqXHR.always(map[jqXHR.status]);else for(code in map)statusCode[code]=[statusCode[code],map[code]];return this},abort:function(statusText){var finalText=statusText||strAbort;return transport&&transport.abort(finalText),done(0,finalText),this}};if(deferred.promise(jqXHR),s.url=((url||s.url||location.href)+\"\").replace(rprotocol,location.protocol+\"//\"),s.type=options.method||options.type||s.method||s.type,s.dataTypes=(s.dataType||\"*\").toLowerCase().match(rnothtmlwhite)||[\"\"],null==s.crossDomain){urlAnchor=document.createElement(\"a\");try{urlAnchor.href=s.url,urlAnchor.href=urlAnchor.href,s.crossDomain=originAnchor.protocol+\"//\"+originAnchor.host!=urlAnchor.protocol+\"//\"+urlAnchor.host}catch(e){s.crossDomain=!0}}if(s.data&&s.processData&&\"string\"!=typeof s.data&&(s.data=jQuery.param(s.data,s.traditional)),inspectPrefiltersOrTransports(prefilters,s,options,jqXHR),completed)return jqXHR;for(i in(fireGlobals=jQuery.event&&s.global)&&0==jQuery.active++&&jQuery.event.trigger(\"ajaxStart\"),s.type=s.type.toUpperCase(),s.hasContent=!rnoContent.test(s.type),cacheURL=s.url.replace(rhash,\"\"),s.hasContent?s.data&&s.processData&&0===(s.contentType||\"\").indexOf(\"application/x-www-form-urlencoded\")&&(s.data=s.data.replace(r20,\"+\")):(uncached=s.url.slice(cacheURL.length),s.data&&(cacheURL+=(rquery.test(cacheURL)?\"&\":\"?\")+s.data,delete s.data),!1===s.cache&&(cacheURL=cacheURL.replace(rantiCache,\"$1\"),uncached=(rquery.test(cacheURL)?\"&\":\"?\")+\"_=\"+nonce+++uncached),s.url=cacheURL+uncached),s.ifModified&&(jQuery.lastModified[cacheURL]&&jqXHR.setRequestHeader(\"If-Modified-Since\",jQuery.lastModified[cacheURL]),jQuery.etag[cacheURL]&&jqXHR.setRequestHeader(\"If-None-Match\",jQuery.etag[cacheURL])),(s.data&&s.hasContent&&!1!==s.contentType||options.contentType)&&jqXHR.setRequestHeader(\"Content-Type\",s.contentType),jqXHR.setRequestHeader(\"Accept\",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+(\"*\"!==s.dataTypes[0]?\", \"+allTypes+\"; q=0.01\":\"\"):s.accepts[\"*\"]),s.headers)jqXHR.setRequestHeader(i,s.headers[i]);if(s.beforeSend&&(!1===s.beforeSend.call(callbackContext,jqXHR,s)||completed))return jqXHR.abort();if(strAbort=\"abort\",completeDeferred.add(s.complete),jqXHR.done(s.success),jqXHR.fail(s.error),transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR)){if(jqXHR.readyState=1,fireGlobals&&globalEventContext.trigger(\"ajaxSend\",[jqXHR,s]),completed)return jqXHR;s.async&&s.timeout>0&&(timeoutTimer=window.setTimeout(function(){jqXHR.abort(\"timeout\")},s.timeout));try{completed=!1,transport.send(requestHeaders,done)}catch(e){if(completed)throw e;done(-1,e)}}else done(-1,\"No Transport\");function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;completed||(completed=!0,timeoutTimer&&window.clearTimeout(timeoutTimer),transport=void 0,responseHeadersString=headers||\"\",jqXHR.readyState=status>0?4:0,isSuccess=status>=200&&status<300||304===status,responses&&(response=function(s,jqXHR,responses){for(var ct,type,finalDataType,firstDataType,contents=s.contents,dataTypes=s.dataTypes;\"*\"===dataTypes[0];)dataTypes.shift(),void 0===ct&&(ct=s.mimeType||jqXHR.getResponseHeader(\"Content-Type\"));if(ct)for(type in contents)if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}if(dataTypes[0]in responses)finalDataType=dataTypes[0];else{for(type in responses){if(!dataTypes[0]||s.converters[type+\" \"+dataTypes[0]]){finalDataType=type;break}firstDataType||(firstDataType=type)}finalDataType=finalDataType||firstDataType}if(finalDataType)return finalDataType!==dataTypes[0]&&dataTypes.unshift(finalDataType),responses[finalDataType]}(s,jqXHR,responses)),response=function(s,response,jqXHR,isSuccess){var conv2,current,conv,tmp,prev,converters={},dataTypes=s.dataTypes.slice();if(dataTypes[1])for(conv in s.converters)converters[conv.toLowerCase()]=s.converters[conv];for(current=dataTypes.shift();current;)if(s.responseFields[current]&&(jqXHR[s.responseFields[current]]=response),!prev&&isSuccess&&s.dataFilter&&(response=s.dataFilter(response,s.dataType)),prev=current,current=dataTypes.shift())if(\"*\"===current)current=prev;else if(\"*\"!==prev&&prev!==current){if(!(conv=converters[prev+\" \"+current]||converters[\"* \"+current]))for(conv2 in converters)if((tmp=conv2.split(\" \"))[1]===current&&(conv=converters[prev+\" \"+tmp[0]]||converters[\"* \"+tmp[0]])){!0===conv?conv=converters[conv2]:!0!==converters[conv2]&&(current=tmp[0],dataTypes.unshift(tmp[1]));break}if(!0!==conv)if(conv&&s.throws)response=conv(response);else try{response=conv(response)}catch(e){return{state:\"parsererror\",error:conv?e:\"No conversion from \"+prev+\" to \"+current}}}return{state:\"success\",data:response}}(s,response,jqXHR,isSuccess),isSuccess?(s.ifModified&&((modified=jqXHR.getResponseHeader(\"Last-Modified\"))&&(jQuery.lastModified[cacheURL]=modified),(modified=jqXHR.getResponseHeader(\"etag\"))&&(jQuery.etag[cacheURL]=modified)),204===status||\"HEAD\"===s.type?statusText=\"nocontent\":304===status?statusText=\"notmodified\":(statusText=response.state,success=response.data,isSuccess=!(error=response.error))):(error=statusText,!status&&statusText||(statusText=\"error\",status<0&&(status=0))),jqXHR.status=status,jqXHR.statusText=(nativeStatusText||statusText)+\"\",isSuccess?deferred.resolveWith(callbackContext,[success,statusText,jqXHR]):deferred.rejectWith(callbackContext,[jqXHR,statusText,error]),jqXHR.statusCode(statusCode),statusCode=void 0,fireGlobals&&globalEventContext.trigger(isSuccess?\"ajaxSuccess\":\"ajaxError\",[jqXHR,s,isSuccess?success:error]),completeDeferred.fireWith(callbackContext,[jqXHR,statusText]),fireGlobals&&(globalEventContext.trigger(\"ajaxComplete\",[jqXHR,s]),--jQuery.active||jQuery.event.trigger(\"ajaxStop\")))}return jqXHR},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,\"json\")},getScript:function(url,callback){return jQuery.get(url,void 0,callback,\"script\")}}),jQuery.each([\"get\",\"post\"],function(i,method){jQuery[method]=function(url,data,callback,type){return jQuery.isFunction(data)&&(type=type||callback,callback=data,data=void 0),jQuery.ajax(jQuery.extend({url:url,type:method,dataType:type,data:data,success:callback},jQuery.isPlainObject(url)&&url))}}),jQuery._evalUrl=function(url){return jQuery.ajax({url:url,type:\"GET\",dataType:\"script\",cache:!0,async:!1,global:!1,throws:!0})},jQuery.fn.extend({wrapAll:function(html){var wrap;return this[0]&&(jQuery.isFunction(html)&&(html=html.call(this[0])),wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&wrap.insertBefore(this[0]),wrap.map(function(){for(var elem=this;elem.firstElementChild;)elem=elem.firstElementChild;return elem}).append(this)),this},wrapInner:function(html){return jQuery.isFunction(html)?this.each(function(i){jQuery(this).wrapInner(html.call(this,i))}):this.each(function(){var self=jQuery(this),contents=self.contents();contents.length?contents.wrapAll(html):self.append(html)})},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html)})},unwrap:function(selector){return this.parent(selector).not(\"body\").each(function(){jQuery(this).replaceWith(this.childNodes)}),this}}),jQuery.expr.pseudos.hidden=function(elem){return!jQuery.expr.pseudos.visible(elem)},jQuery.expr.pseudos.visible=function(elem){return!!(elem.offsetWidth||elem.offsetHeight||elem.getClientRects().length)},jQuery.ajaxSettings.xhr=function(){try{return new window.XMLHttpRequest}catch(e){}};var xhrSuccessStatus={0:200,1223:204},xhrSupported=jQuery.ajaxSettings.xhr();support.cors=!!xhrSupported&&\"withCredentials\"in xhrSupported,support.ajax=xhrSupported=!!xhrSupported,jQuery.ajaxTransport(function(options){var callback,errorCallback;if(support.cors||xhrSupported&&!options.crossDomain)return{send:function(headers,complete){var i,xhr=options.xhr();if(xhr.open(options.type,options.url,options.async,options.username,options.password),options.xhrFields)for(i in options.xhrFields)xhr[i]=options.xhrFields[i];for(i in options.mimeType&&xhr.overrideMimeType&&xhr.overrideMimeType(options.mimeType),options.crossDomain||headers[\"X-Requested-With\"]||(headers[\"X-Requested-With\"]=\"XMLHttpRequest\"),headers)xhr.setRequestHeader(i,headers[i]);callback=function(type){return function(){callback&&(callback=errorCallback=xhr.onload=xhr.onerror=xhr.onabort=xhr.onreadystatechange=null,\"abort\"===type?xhr.abort():\"error\"===type?\"number\"!=typeof xhr.status?complete(0,\"error\"):complete(xhr.status,xhr.statusText):complete(xhrSuccessStatus[xhr.status]||xhr.status,xhr.statusText,\"text\"!==(xhr.responseType||\"text\")||\"string\"!=typeof xhr.responseText?{binary:xhr.response}:{text:xhr.responseText},xhr.getAllResponseHeaders()))}},xhr.onload=callback(),errorCallback=xhr.onerror=callback(\"error\"),void 0!==xhr.onabort?xhr.onabort=errorCallback:xhr.onreadystatechange=function(){4===xhr.readyState&&window.setTimeout(function(){callback&&errorCallback()})},callback=callback(\"abort\");try{xhr.send(options.hasContent&&options.data||null)}catch(e){if(callback)throw e}},abort:function(){callback&&callback()}}}),jQuery.ajaxPrefilter(function(s){s.crossDomain&&(s.contents.script=!1)}),jQuery.ajaxSetup({accepts:{script:\"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript\"},contents:{script:/\\b(?:java|ecma)script\\b/},converters:{\"text script\":function(text){return jQuery.globalEval(text),text}}}),jQuery.ajaxPrefilter(\"script\",function(s){void 0===s.cache&&(s.cache=!1),s.crossDomain&&(s.type=\"GET\")}),jQuery.ajaxTransport(\"script\",function(s){var script,callback;if(s.crossDomain)return{send:function(_,complete){script=jQuery(\"<script>\").prop({charset:s.scriptCharset,src:s.url}).on(\"load error\",callback=function(evt){script.remove(),callback=null,evt&&complete(\"error\"===evt.type?404:200,evt.type)}),document.head.appendChild(script[0])},abort:function(){callback&&callback()}}});var body,oldCallbacks=[],rjsonp=/(=)\\?(?=&|$)|\\?\\?/;jQuery.ajaxSetup({jsonp:\"callback\",jsonpCallback:function(){var callback=oldCallbacks.pop()||jQuery.expando+\"_\"+nonce++;return this[callback]=!0,callback}}),jQuery.ajaxPrefilter(\"json jsonp\",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,jsonProp=!1!==s.jsonp&&(rjsonp.test(s.url)?\"url\":\"string\"==typeof s.data&&0===(s.contentType||\"\").indexOf(\"application/x-www-form-urlencoded\")&&rjsonp.test(s.data)&&\"data\");if(jsonProp||\"jsonp\"===s.dataTypes[0])return callbackName=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback,jsonProp?s[jsonProp]=s[jsonProp].replace(rjsonp,\"$1\"+callbackName):!1!==s.jsonp&&(s.url+=(rquery.test(s.url)?\"&\":\"?\")+s.jsonp+\"=\"+callbackName),s.converters[\"script json\"]=function(){return responseContainer||jQuery.error(callbackName+\" was not called\"),responseContainer[0]},s.dataTypes[0]=\"json\",overwritten=window[callbackName],window[callbackName]=function(){responseContainer=arguments},jqXHR.always(function(){void 0===overwritten?jQuery(window).removeProp(callbackName):window[callbackName]=overwritten,s[callbackName]&&(s.jsonpCallback=originalSettings.jsonpCallback,oldCallbacks.push(callbackName)),responseContainer&&jQuery.isFunction(overwritten)&&overwritten(responseContainer[0]),responseContainer=overwritten=void 0}),\"script\"}),support.createHTMLDocument=((body=document.implementation.createHTMLDocument(\"\").body).innerHTML=\"<form></form><form></form>\",2===body.childNodes.length),jQuery.parseHTML=function(data,context,keepScripts){return\"string\"!=typeof data?[]:(\"boolean\"==typeof context&&(keepScripts=context,context=!1),context||(support.createHTMLDocument?((base=(context=document.implementation.createHTMLDocument(\"\")).createElement(\"base\")).href=document.location.href,context.head.appendChild(base)):context=document),scripts=!keepScripts&&[],(parsed=rsingleTag.exec(data))?[context.createElement(parsed[1])]:(parsed=buildFragment([data],context,scripts),scripts&&scripts.length&&jQuery(scripts).remove(),jQuery.merge([],parsed.childNodes)));var base,parsed,scripts},jQuery.fn.load=function(url,params,callback){var selector,type,response,self=this,off=url.indexOf(\" \");return off>-1&&(selector=stripAndCollapse(url.slice(off)),url=url.slice(0,off)),jQuery.isFunction(params)?(callback=params,params=void 0):params&&\"object\"==typeof params&&(type=\"POST\"),self.length>0&&jQuery.ajax({url:url,type:type||\"GET\",dataType:\"html\",data:params}).done(function(responseText){response=arguments,self.html(selector?jQuery(\"<div>\").append(jQuery.parseHTML(responseText)).find(selector):responseText)}).always(callback&&function(jqXHR,status){self.each(function(){callback.apply(this,response||[jqXHR.responseText,status,jqXHR])})}),this},jQuery.each([\"ajaxStart\",\"ajaxStop\",\"ajaxComplete\",\"ajaxError\",\"ajaxSuccess\",\"ajaxSend\"],function(i,type){jQuery.fn[type]=function(fn){return this.on(type,fn)}}),jQuery.expr.pseudos.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem}).length},jQuery.offset={setOffset:function(elem,options,i){var curPosition,curLeft,curCSSTop,curTop,curOffset,curCSSLeft,position=jQuery.css(elem,\"position\"),curElem=jQuery(elem),props={};\"static\"===position&&(elem.style.position=\"relative\"),curOffset=curElem.offset(),curCSSTop=jQuery.css(elem,\"top\"),curCSSLeft=jQuery.css(elem,\"left\"),(\"absolute\"===position||\"fixed\"===position)&&(curCSSTop+curCSSLeft).indexOf(\"auto\")>-1?(curTop=(curPosition=curElem.position()).top,curLeft=curPosition.left):(curTop=parseFloat(curCSSTop)||0,curLeft=parseFloat(curCSSLeft)||0),jQuery.isFunction(options)&&(options=options.call(elem,i,jQuery.extend({},curOffset))),null!=options.top&&(props.top=options.top-curOffset.top+curTop),null!=options.left&&(props.left=options.left-curOffset.left+curLeft),\"using\"in options?options.using.call(elem,props):curElem.css(props)}},jQuery.fn.extend({offset:function(options){if(arguments.length)return void 0===options?this:this.each(function(i){jQuery.offset.setOffset(this,options,i)});var doc,docElem,rect,win,elem=this[0];return elem?elem.getClientRects().length?(rect=elem.getBoundingClientRect(),docElem=(doc=elem.ownerDocument).documentElement,win=doc.defaultView,{top:rect.top+win.pageYOffset-docElem.clientTop,left:rect.left+win.pageXOffset-docElem.clientLeft}):{top:0,left:0}:void 0},position:function(){if(this[0]){var offsetParent,offset,elem=this[0],parentOffset={top:0,left:0};return\"fixed\"===jQuery.css(elem,\"position\")?offset=elem.getBoundingClientRect():(offsetParent=this.offsetParent(),offset=this.offset(),nodeName(offsetParent[0],\"html\")||(parentOffset=offsetParent.offset()),parentOffset={top:parentOffset.top+jQuery.css(offsetParent[0],\"borderTopWidth\",!0),left:parentOffset.left+jQuery.css(offsetParent[0],\"borderLeftWidth\",!0)}),{top:offset.top-parentOffset.top-jQuery.css(elem,\"marginTop\",!0),left:offset.left-parentOffset.left-jQuery.css(elem,\"marginLeft\",!0)}}},offsetParent:function(){return this.map(function(){for(var offsetParent=this.offsetParent;offsetParent&&\"static\"===jQuery.css(offsetParent,\"position\");)offsetParent=offsetParent.offsetParent;return offsetParent||documentElement})}}),jQuery.each({scrollLeft:\"pageXOffset\",scrollTop:\"pageYOffset\"},function(method,prop){var top=\"pageYOffset\"===prop;jQuery.fn[method]=function(val){return access(this,function(elem,method,val){var win;if(jQuery.isWindow(elem)?win=elem:9===elem.nodeType&&(win=elem.defaultView),void 0===val)return win?win[prop]:elem[method];win?win.scrollTo(top?win.pageXOffset:val,top?val:win.pageYOffset):elem[method]=val},method,val,arguments.length)}}),jQuery.each([\"top\",\"left\"],function(i,prop){jQuery.cssHooks[prop]=addGetHookIf(support.pixelPosition,function(elem,computed){if(computed)return computed=curCSS(elem,prop),rnumnonpx.test(computed)?jQuery(elem).position()[prop]+\"px\":computed})}),jQuery.each({Height:\"height\",Width:\"width\"},function(name,type){jQuery.each({padding:\"inner\"+name,content:type,\"\":\"outer\"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||\"boolean\"!=typeof margin),extra=defaultExtra||(!0===margin||!0===value?\"margin\":\"border\");return access(this,function(elem,type,value){var doc;return jQuery.isWindow(elem)?0===funcName.indexOf(\"outer\")?elem[\"inner\"+name]:elem.document.documentElement[\"client\"+name]:9===elem.nodeType?(doc=elem.documentElement,Math.max(elem.body[\"scroll\"+name],doc[\"scroll\"+name],elem.body[\"offset\"+name],doc[\"offset\"+name],doc[\"client\"+name])):void 0===value?jQuery.css(elem,type,extra):jQuery.style(elem,type,value,extra)},type,chainable?margin:void 0,chainable)}})}),jQuery.fn.extend({bind:function(types,data,fn){return this.on(types,null,data,fn)},unbind:function(types,fn){return this.off(types,null,fn)},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return 1===arguments.length?this.off(selector,\"**\"):this.off(types,selector||\"**\",fn)}}),jQuery.holdReady=function(hold){hold?jQuery.readyWait++:jQuery.ready(!0)},jQuery.isArray=Array.isArray,jQuery.parseJSON=JSON.parse,jQuery.nodeName=nodeName,\"function\"==typeof define&&define.amd&&define(\"jquery\",[],function(){return jQuery});var _jQuery=window.jQuery,_$=window.$;return jQuery.noConflict=function(deep){return window.$===jQuery&&(window.$=_$),deep&&window.jQuery===jQuery&&(window.jQuery=_jQuery),jQuery},noGlobal||(window.jQuery=window.$=jQuery),jQuery}),function(){var root=this,previousUnderscore=root._,ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype,push=ArrayProto.push,slice=ArrayProto.slice,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,nativeCreate=Object.create,Ctor=function(){},_=function(obj){return obj instanceof _?obj:this instanceof _?void(this._wrapped=obj):new _(obj)};\"undefined\"!=typeof exports?(\"undefined\"!=typeof module&&module.exports&&(exports=module.exports=_),exports._=_):root._=_,_.VERSION=\"1.8.3\";var optimizeCb=function(func,context,argCount){if(void 0===context)return func;switch(null==argCount?3:argCount){case 1:return function(value){return func.call(context,value)};case 2:return function(value,other){return func.call(context,value,other)};case 3:return function(value,index,collection){return func.call(context,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(context,accumulator,value,index,collection)}}return function(){return func.apply(context,arguments)}},cb=function(value,context,argCount){return null==value?_.identity:_.isFunction(value)?optimizeCb(value,context,argCount):_.isObject(value)?_.matcher(value):_.property(value)};_.iteratee=function(value,context){return cb(value,context,1/0)};var createAssigner=function(keysFunc,undefinedOnly){return function(obj){var length=arguments.length;if(length<2||null==obj)return obj;for(var index=1;index<length;index++)for(var source=arguments[index],keys=keysFunc(source),l=keys.length,i=0;i<l;i++){var key=keys[i];undefinedOnly&&void 0!==obj[key]||(obj[key]=source[key])}return obj}},baseCreate=function(prototype){if(!_.isObject(prototype))return{};if(nativeCreate)return nativeCreate(prototype);Ctor.prototype=prototype;var result=new Ctor;return Ctor.prototype=null,result},property=function(key){return function(obj){return null==obj?void 0:obj[key]}},MAX_ARRAY_INDEX=Math.pow(2,53)-1,getLength=property(\"length\"),isArrayLike=function(collection){var length=getLength(collection);return\"number\"==typeof length&&length>=0&&length<=MAX_ARRAY_INDEX};function createReduce(dir){return function(obj,iteratee,memo,context){iteratee=optimizeCb(iteratee,context,4);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=dir>0?0:length-1;return arguments.length<3&&(memo=obj[keys?keys[index]:index],index+=dir),function(obj,iteratee,memo,keys,index,length){for(;index>=0&&index<length;index+=dir){var currentKey=keys?keys[index]:index;memo=iteratee(memo,obj[currentKey],currentKey,obj)}return memo}(obj,iteratee,memo,keys,index,length)}}_.each=_.forEach=function(obj,iteratee,context){var i,length;if(iteratee=optimizeCb(iteratee,context),isArrayLike(obj))for(i=0,length=obj.length;i<length;i++)iteratee(obj[i],i,obj);else{var keys=_.keys(obj);for(i=0,length=keys.length;i<length;i++)iteratee(obj[keys[i]],keys[i],obj)}return obj},_.map=_.collect=function(obj,iteratee,context){iteratee=cb(iteratee,context);for(var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,results=Array(length),index=0;index<length;index++){var currentKey=keys?keys[index]:index;results[index]=iteratee(obj[currentKey],currentKey,obj)}return results},_.reduce=_.foldl=_.inject=createReduce(1),_.reduceRight=_.foldr=createReduce(-1),_.find=_.detect=function(obj,predicate,context){var key;if(void 0!==(key=isArrayLike(obj)?_.findIndex(obj,predicate,context):_.findKey(obj,predicate,context))&&-1!==key)return obj[key]},_.filter=_.select=function(obj,predicate,context){var results=[];return predicate=cb(predicate,context),_.each(obj,function(value,index,list){predicate(value,index,list)&&results.push(value)}),results},_.reject=function(obj,predicate,context){return _.filter(obj,_.negate(cb(predicate)),context)},_.every=_.all=function(obj,predicate,context){predicate=cb(predicate,context);for(var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(!predicate(obj[currentKey],currentKey,obj))return!1}return!0},_.some=_.any=function(obj,predicate,context){predicate=cb(predicate,context);for(var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(predicate(obj[currentKey],currentKey,obj))return!0}return!1},_.contains=_.includes=_.include=function(obj,item,fromIndex,guard){return isArrayLike(obj)||(obj=_.values(obj)),(\"number\"!=typeof fromIndex||guard)&&(fromIndex=0),_.indexOf(obj,item,fromIndex)>=0},_.invoke=function(obj,method){var args=slice.call(arguments,2),isFunc=_.isFunction(method);return _.map(obj,function(value){var func=isFunc?method:value[method];return null==func?func:func.apply(value,args)})},_.pluck=function(obj,key){return _.map(obj,_.property(key))},_.where=function(obj,attrs){return _.filter(obj,_.matcher(attrs))},_.findWhere=function(obj,attrs){return _.find(obj,_.matcher(attrs))},_.max=function(obj,iteratee,context){var value,computed,result=-1/0,lastComputed=-1/0;if(null==iteratee&&null!=obj)for(var i=0,length=(obj=isArrayLike(obj)?obj:_.values(obj)).length;i<length;i++)(value=obj[i])>result&&(result=value);else iteratee=cb(iteratee,context),_.each(obj,function(value,index,list){((computed=iteratee(value,index,list))>lastComputed||computed===-1/0&&result===-1/0)&&(result=value,lastComputed=computed)});return result},_.min=function(obj,iteratee,context){var value,computed,result=1/0,lastComputed=1/0;if(null==iteratee&&null!=obj)for(var i=0,length=(obj=isArrayLike(obj)?obj:_.values(obj)).length;i<length;i++)(value=obj[i])<result&&(result=value);else iteratee=cb(iteratee,context),_.each(obj,function(value,index,list){((computed=iteratee(value,index,list))<lastComputed||computed===1/0&&result===1/0)&&(result=value,lastComputed=computed)});return result},_.shuffle=function(obj){for(var rand,set=isArrayLike(obj)?obj:_.values(obj),length=set.length,shuffled=Array(length),index=0;index<length;index++)(rand=_.random(0,index))!==index&&(shuffled[index]=shuffled[rand]),shuffled[rand]=set[index];return shuffled},_.sample=function(obj,n,guard){return null==n||guard?(isArrayLike(obj)||(obj=_.values(obj)),obj[_.random(obj.length-1)]):_.shuffle(obj).slice(0,Math.max(0,n))},_.sortBy=function(obj,iteratee,context){return iteratee=cb(iteratee,context),_.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iteratee(value,index,list)}}).sort(function(left,right){var a=left.criteria,b=right.criteria;if(a!==b){if(a>b||void 0===a)return 1;if(a<b||void 0===b)return-1}return left.index-right.index}),\"value\")};var group=function(behavior){return function(obj,iteratee,context){var result={};return iteratee=cb(iteratee,context),_.each(obj,function(value,index){var key=iteratee(value,index,obj);behavior(result,value,key)}),result}};_.groupBy=group(function(result,value,key){_.has(result,key)?result[key].push(value):result[key]=[value]}),_.indexBy=group(function(result,value,key){result[key]=value}),_.countBy=group(function(result,value,key){_.has(result,key)?result[key]++:result[key]=1}),_.toArray=function(obj){return obj?_.isArray(obj)?slice.call(obj):isArrayLike(obj)?_.map(obj,_.identity):_.values(obj):[]},_.size=function(obj){return null==obj?0:isArrayLike(obj)?obj.length:_.keys(obj).length},_.partition=function(obj,predicate,context){predicate=cb(predicate,context);var pass=[],fail=[];return _.each(obj,function(value,key,obj){(predicate(value,key,obj)?pass:fail).push(value)}),[pass,fail]},_.first=_.head=_.take=function(array,n,guard){if(null!=array)return null==n||guard?array[0]:_.initial(array,array.length-n)},_.initial=function(array,n,guard){return slice.call(array,0,Math.max(0,array.length-(null==n||guard?1:n)))},_.last=function(array,n,guard){if(null!=array)return null==n||guard?array[array.length-1]:_.rest(array,Math.max(0,array.length-n))},_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,null==n||guard?1:n)},_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,strict,startIndex){for(var output=[],idx=0,i=startIndex||0,length=getLength(input);i<length;i++){var value=input[i];if(isArrayLike(value)&&(_.isArray(value)||_.isArguments(value))){shallow||(value=flatten(value,shallow,strict));var j=0,len=value.length;for(output.length+=len;j<len;)output[idx++]=value[j++]}else strict||(output[idx++]=value)}return output};function createPredicateIndexFinder(dir){return function(array,predicate,context){predicate=cb(predicate,context);for(var length=getLength(array),index=dir>0?0:length-1;index>=0&&index<length;index+=dir)if(predicate(array[index],index,array))return index;return-1}}function createIndexFinder(dir,predicateFind,sortedIndex){return function(array,item,idx){var i=0,length=getLength(array);if(\"number\"==typeof idx)dir>0?i=idx>=0?idx:Math.max(idx+length,i):length=idx>=0?Math.min(idx+1,length):idx+length+1;else if(sortedIndex&&idx&&length)return array[idx=sortedIndex(array,item)]===item?idx:-1;if(item!=item)return(idx=predicateFind(slice.call(array,i,length),_.isNaN))>=0?idx+i:-1;for(idx=dir>0?i:length-1;idx>=0&&idx<length;idx+=dir)if(array[idx]===item)return idx;return-1}}_.flatten=function(array,shallow){return flatten(array,shallow,!1)},_.without=function(array){return _.difference(array,slice.call(arguments,1))},_.uniq=_.unique=function(array,isSorted,iteratee,context){_.isBoolean(isSorted)||(context=iteratee,iteratee=isSorted,isSorted=!1),null!=iteratee&&(iteratee=cb(iteratee,context));for(var result=[],seen=[],i=0,length=getLength(array);i<length;i++){var value=array[i],computed=iteratee?iteratee(value,i,array):value;isSorted?(i&&seen===computed||result.push(value),seen=computed):iteratee?_.contains(seen,computed)||(seen.push(computed),result.push(value)):_.contains(result,value)||result.push(value)}return result},_.union=function(){return _.uniq(flatten(arguments,!0,!0))},_.intersection=function(array){for(var result=[],argsLength=arguments.length,i=0,length=getLength(array);i<length;i++){var item=array[i];if(!_.contains(result,item)){for(var j=1;j<argsLength&&_.contains(arguments[j],item);j++);j===argsLength&&result.push(item)}}return result},_.difference=function(array){var rest=flatten(arguments,!0,!0,1);return _.filter(array,function(value){return!_.contains(rest,value)})},_.zip=function(){return _.unzip(arguments)},_.unzip=function(array){for(var length=array&&_.max(array,getLength).length||0,result=Array(length),index=0;index<length;index++)result[index]=_.pluck(array,index);return result},_.object=function(list,values){for(var result={},i=0,length=getLength(list);i<length;i++)values?result[list[i]]=values[i]:result[list[i][0]]=list[i][1];return result},_.findIndex=createPredicateIndexFinder(1),_.findLastIndex=createPredicateIndexFinder(-1),_.sortedIndex=function(array,obj,iteratee,context){for(var value=(iteratee=cb(iteratee,context,1))(obj),low=0,high=getLength(array);low<high;){var mid=Math.floor((low+high)/2);iteratee(array[mid])<value?low=mid+1:high=mid}return low},_.indexOf=createIndexFinder(1,_.findIndex,_.sortedIndex),_.lastIndexOf=createIndexFinder(-1,_.findLastIndex),_.range=function(start,stop,step){null==stop&&(stop=start||0,start=0),step=step||1;for(var length=Math.max(Math.ceil((stop-start)/step),0),range=Array(length),idx=0;idx<length;idx++,start+=step)range[idx]=start;return range};var executeBound=function(sourceFunc,boundFunc,context,callingContext,args){if(!(callingContext instanceof boundFunc))return sourceFunc.apply(context,args);var self=baseCreate(sourceFunc.prototype),result=sourceFunc.apply(self,args);return _.isObject(result)?result:self};_.bind=function(func,context){if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError(\"Bind must be called on a function\");var args=slice.call(arguments,2),bound=function(){return executeBound(func,bound,context,this,args.concat(slice.call(arguments)))};return bound},_.partial=function(func){var boundArgs=slice.call(arguments,1),bound=function(){for(var position=0,length=boundArgs.length,args=Array(length),i=0;i<length;i++)args[i]=boundArgs[i]===_?arguments[position++]:boundArgs[i];for(;position<arguments.length;)args.push(arguments[position++]);return executeBound(func,bound,this,this,args)};return bound},_.bindAll=function(obj){var i,key,length=arguments.length;if(length<=1)throw new Error(\"bindAll must be passed function names\");for(i=1;i<length;i++)obj[key=arguments[i]]=_.bind(obj[key],obj);return obj},_.memoize=function(func,hasher){var memoize=function(key){var cache=memoize.cache,address=\"\"+(hasher?hasher.apply(this,arguments):key);return _.has(cache,address)||(cache[address]=func.apply(this,arguments)),cache[address]};return memoize.cache={},memoize},_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)},_.defer=_.partial(_.delay,_,1),_.throttle=function(func,wait,options){var context,args,result,timeout=null,previous=0;options||(options={});var later=function(){previous=!1===options.leading?0:_.now(),timeout=null,result=func.apply(context,args),timeout||(context=args=null)};return function(){var now=_.now();previous||!1!==options.leading||(previous=now);var remaining=wait-(now-previous);return context=this,args=arguments,remaining<=0||remaining>wait?(timeout&&(clearTimeout(timeout),timeout=null),previous=now,result=func.apply(context,args),timeout||(context=args=null)):timeout||!1===options.trailing||(timeout=setTimeout(later,remaining)),result}},_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result,later=function(){var last=_.now()-timestamp;last<wait&&last>=0?timeout=setTimeout(later,wait-last):(timeout=null,immediate||(result=func.apply(context,args),timeout||(context=args=null)))};return function(){context=this,args=arguments,timestamp=_.now();var callNow=immediate&&!timeout;return timeout||(timeout=setTimeout(later,wait)),callNow&&(result=func.apply(context,args),context=args=null),result}},_.wrap=function(func,wrapper){return _.partial(wrapper,func)},_.negate=function(predicate){return function(){return!predicate.apply(this,arguments)}},_.compose=function(){var args=arguments,start=args.length-1;return function(){for(var i=start,result=args[start].apply(this,arguments);i--;)result=args[i].call(this,result);return result}},_.after=function(times,func){return function(){if(--times<1)return func.apply(this,arguments)}},_.before=function(times,func){var memo;return function(){return--times>0&&(memo=func.apply(this,arguments)),times<=1&&(func=null),memo}},_.once=_.partial(_.before,2);var hasEnumBug=!{toString:null}.propertyIsEnumerable(\"toString\"),nonEnumerableProps=[\"valueOf\",\"isPrototypeOf\",\"toString\",\"propertyIsEnumerable\",\"hasOwnProperty\",\"toLocaleString\"];function collectNonEnumProps(obj,keys){var nonEnumIdx=nonEnumerableProps.length,constructor=obj.constructor,proto=_.isFunction(constructor)&&constructor.prototype||ObjProto,prop=\"constructor\";for(_.has(obj,prop)&&!_.contains(keys,prop)&&keys.push(prop);nonEnumIdx--;)(prop=nonEnumerableProps[nonEnumIdx])in obj&&obj[prop]!==proto[prop]&&!_.contains(keys,prop)&&keys.push(prop)}_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var keys=[];for(var key in obj)_.has(obj,key)&&keys.push(key);return hasEnumBug&&collectNonEnumProps(obj,keys),keys},_.allKeys=function(obj){if(!_.isObject(obj))return[];var keys=[];for(var key in obj)keys.push(key);return hasEnumBug&&collectNonEnumProps(obj,keys),keys},_.values=function(obj){for(var keys=_.keys(obj),length=keys.length,values=Array(length),i=0;i<length;i++)values[i]=obj[keys[i]];return values},_.mapObject=function(obj,iteratee,context){iteratee=cb(iteratee,context);for(var currentKey,keys=_.keys(obj),length=keys.length,results={},index=0;index<length;index++)results[currentKey=keys[index]]=iteratee(obj[currentKey],currentKey,obj);return results},_.pairs=function(obj){for(var keys=_.keys(obj),length=keys.length,pairs=Array(length),i=0;i<length;i++)pairs[i]=[keys[i],obj[keys[i]]];return pairs},_.invert=function(obj){for(var result={},keys=_.keys(obj),i=0,length=keys.length;i<length;i++)result[obj[keys[i]]]=keys[i];return result},_.functions=_.methods=function(obj){var names=[];for(var key in obj)_.isFunction(obj[key])&&names.push(key);return names.sort()},_.extend=createAssigner(_.allKeys),_.extendOwn=_.assign=createAssigner(_.keys),_.findKey=function(obj,predicate,context){predicate=cb(predicate,context);for(var key,keys=_.keys(obj),i=0,length=keys.length;i<length;i++)if(predicate(obj[key=keys[i]],key,obj))return key},_.pick=function(object,oiteratee,context){var iteratee,keys,result={},obj=object;if(null==obj)return result;_.isFunction(oiteratee)?(keys=_.allKeys(obj),iteratee=optimizeCb(oiteratee,context)):(keys=flatten(arguments,!1,!1,1),iteratee=function(value,key,obj){return key in obj},obj=Object(obj));for(var i=0,length=keys.length;i<length;i++){var key=keys[i],value=obj[key];iteratee(value,key,obj)&&(result[key]=value)}return result},_.omit=function(obj,iteratee,context){if(_.isFunction(iteratee))iteratee=_.negate(iteratee);else{var keys=_.map(flatten(arguments,!1,!1,1),String);iteratee=function(value,key){return!_.contains(keys,key)}}return _.pick(obj,iteratee,context)},_.defaults=createAssigner(_.allKeys,!0),_.create=function(prototype,props){var result=baseCreate(prototype);return props&&_.extendOwn(result,props),result},_.clone=function(obj){return _.isObject(obj)?_.isArray(obj)?obj.slice():_.extend({},obj):obj},_.tap=function(obj,interceptor){return interceptor(obj),obj},_.isMatch=function(object,attrs){var keys=_.keys(attrs),length=keys.length;if(null==object)return!length;for(var obj=Object(object),i=0;i<length;i++){var key=keys[i];if(attrs[key]!==obj[key]||!(key in obj))return!1}return!0};var eq=function(a,b,aStack,bStack){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof _&&(a=a._wrapped),b instanceof _&&(b=b._wrapped);var className=toString.call(a);if(className!==toString.call(b))return!1;switch(className){case\"[object RegExp]\":case\"[object String]\":return\"\"+a==\"\"+b;case\"[object Number]\":return+a!=+a?+b!=+b:0==+a?1/+a==1/b:+a==+b;case\"[object Date]\":case\"[object Boolean]\":return+a==+b}var areArrays=\"[object Array]\"===className;if(!areArrays){if(\"object\"!=typeof a||\"object\"!=typeof b)return!1;var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)&&\"constructor\"in a&&\"constructor\"in b)return!1}bStack=bStack||[];for(var length=(aStack=aStack||[]).length;length--;)if(aStack[length]===a)return bStack[length]===b;if(aStack.push(a),bStack.push(b),areArrays){if((length=a.length)!==b.length)return!1;for(;length--;)if(!eq(a[length],b[length],aStack,bStack))return!1}else{var key,keys=_.keys(a);if(length=keys.length,_.keys(b).length!==length)return!1;for(;length--;)if(key=keys[length],!_.has(b,key)||!eq(a[key],b[key],aStack,bStack))return!1}return aStack.pop(),bStack.pop(),!0};_.isEqual=function(a,b){return eq(a,b)},_.isEmpty=function(obj){return null==obj||(isArrayLike(obj)&&(_.isArray(obj)||_.isString(obj)||_.isArguments(obj))?0===obj.length:0===_.keys(obj).length)},_.isElement=function(obj){return!(!obj||1!==obj.nodeType)},_.isArray=nativeIsArray||function(obj){return\"[object Array]\"===toString.call(obj)},_.isObject=function(obj){var type=typeof obj;return\"function\"===type||\"object\"===type&&!!obj},_.each([\"Arguments\",\"Function\",\"String\",\"Number\",\"Date\",\"RegExp\",\"Error\"],function(name){_[\"is\"+name]=function(obj){return toString.call(obj)===\"[object \"+name+\"]\"}}),_.isArguments(arguments)||(_.isArguments=function(obj){return _.has(obj,\"callee\")}),\"function\"!=typeof/./&&\"object\"!=typeof Int8Array&&(_.isFunction=function(obj){return\"function\"==typeof obj||!1}),_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))},_.isNaN=function(obj){return _.isNumber(obj)&&obj!==+obj},_.isBoolean=function(obj){return!0===obj||!1===obj||\"[object Boolean]\"===toString.call(obj)},_.isNull=function(obj){return null===obj},_.isUndefined=function(obj){return void 0===obj},_.has=function(obj,key){return null!=obj&&hasOwnProperty.call(obj,key)},_.noConflict=function(){return root._=previousUnderscore,this},_.identity=function(value){return value},_.constant=function(value){return function(){return value}},_.noop=function(){},_.property=property,_.propertyOf=function(obj){return null==obj?function(){}:function(key){return obj[key]}},_.matcher=_.matches=function(attrs){return attrs=_.extendOwn({},attrs),function(obj){return _.isMatch(obj,attrs)}},_.times=function(n,iteratee,context){var accum=Array(Math.max(0,n));iteratee=optimizeCb(iteratee,context,1);for(var i=0;i<n;i++)accum[i]=iteratee(i);return accum},_.random=function(min,max){return null==max&&(max=min,min=0),min+Math.floor(Math.random()*(max-min+1))},_.now=Date.now||function(){return(new Date).getTime()};var escapeMap={\"&\":\"&amp;\",\"<\":\"&lt;\",\">\":\"&gt;\",'\"':\"&quot;\",\"'\":\"&#x27;\",\"`\":\"&#x60;\"},unescapeMap=_.invert(escapeMap),createEscaper=function(map){var escaper=function(match){return map[match]},source=\"(?:\"+_.keys(map).join(\"|\")+\")\",testRegexp=RegExp(source),replaceRegexp=RegExp(source,\"g\");return function(string){return string=null==string?\"\":\"\"+string,testRegexp.test(string)?string.replace(replaceRegexp,escaper):string}};_.escape=createEscaper(escapeMap),_.unescape=createEscaper(unescapeMap),_.result=function(object,property,fallback){var value=null==object?void 0:object[property];return void 0===value&&(value=fallback),_.isFunction(value)?value.call(object):value};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+\"\";return prefix?prefix+id:id},_.templateSettings={evaluate:/<%([\\s\\S]+?)%>/g,interpolate:/<%=([\\s\\S]+?)%>/g,escape:/<%-([\\s\\S]+?)%>/g};var noMatch=/(.)^/,escapes={\"'\":\"'\",\"\\\\\":\"\\\\\",\"\\r\":\"r\",\"\\n\":\"n\",\"\\u2028\":\"u2028\",\"\\u2029\":\"u2029\"},escaper=/\\\\|'|\\r|\\n|\\u2028|\\u2029/g,escapeChar=function(match){return\"\\\\\"+escapes[match]};_.template=function(text,settings,oldSettings){!settings&&oldSettings&&(settings=oldSettings),settings=_.defaults({},settings,_.templateSettings);var matcher=RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join(\"|\")+\"|$\",\"g\"),index=0,source=\"__p+='\";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){return source+=text.slice(index,offset).replace(escaper,escapeChar),index=offset+match.length,escape?source+=\"'+\\n((__t=(\"+escape+\"))==null?'':_.escape(__t))+\\n'\":interpolate?source+=\"'+\\n((__t=(\"+interpolate+\"))==null?'':__t)+\\n'\":evaluate&&(source+=\"';\\n\"+evaluate+\"\\n__p+='\"),match}),source+=\"';\\n\",settings.variable||(source=\"with(obj||{}){\\n\"+source+\"}\\n\"),source=\"var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\\n\"+source+\"return __p;\\n\";try{var render=new Function(settings.variable||\"obj\",\"_\",source)}catch(e){throw e.source=source,e}var template=function(data){return render.call(this,data,_)},argument=settings.variable||\"obj\";return template.source=\"function(\"+argument+\"){\\n\"+source+\"}\",template},_.chain=function(obj){var instance=_(obj);return instance._chain=!0,instance};var result=function(instance,obj){return instance._chain?_(obj).chain():obj};_.mixin=function(obj){_.each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];return push.apply(args,arguments),result(this,func.apply(_,args))}})},_.mixin(_),_.each([\"pop\",\"push\",\"reverse\",\"shift\",\"sort\",\"splice\",\"unshift\"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;return method.apply(obj,arguments),\"shift\"!==name&&\"splice\"!==name||0!==obj.length||delete obj[0],result(this,obj)}}),_.each([\"concat\",\"join\",\"slice\"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result(this,method.apply(this._wrapped,arguments))}}),_.prototype.value=function(){return this._wrapped},_.prototype.valueOf=_.prototype.toJSON=_.prototype.value,_.prototype.toString=function(){return\"\"+this._wrapped},\"function\"==typeof define&&define.amd&&define(\"underscore\",[],function(){return _})}.call(this),function($){$.timer=function(func,time,autostart){return this.set=function(func,time,autostart){if(this.init=!0,\"object\"==typeof func){var paramList=[\"autostart\",\"time\"];for(var arg in paramList)null!=func[paramList[arg]]&&eval(paramList[arg]+\" = func[paramList[arg]]\");func=func.action}return\"function\"==typeof func&&(this.action=func),isNaN(time)||(this.intervalTime=time),autostart&&!this.isActive&&(this.isActive=!0,this.setTimer()),this},this.once=function(time){var timer=this;return isNaN(time)&&(time=0),window.setTimeout(function(){timer.action()},time),this},this.play=function(reset){return this.isActive||(reset?this.setTimer():this.setTimer(this.remaining),this.isActive=!0),this},this.pause=function(){return this.isActive&&(this.isActive=!1,this.remaining-=new Date-this.last,this.clearTimer()),this},this.stop=function(){return this.isActive=!1,this.remaining=this.intervalTime,this.clearTimer(),this},this.toggle=function(reset){return this.isActive?this.pause():reset?this.play(!0):this.play(),this},this.reset=function(){return this.isActive=!1,this.play(!0),this},this.clearTimer=function(){window.clearTimeout(this.timeoutObject)},this.setTimer=function(time){var timer=this;\"function\"==typeof this.action&&(isNaN(time)&&(time=this.intervalTime),this.remaining=time,this.last=new Date,this.clearTimer(),this.timeoutObject=window.setTimeout(function(){timer.go()},time))},this.go=function(){this.isActive&&(this.action(),this.setTimer())},this.init?new $.timer(func,time,autostart):(this.set(func,time,autostart),this)}}(jQuery),function(global,factory){if(\"function\"==typeof define&&define.amd)define([\"exports\",\"module\"],factory);else if(\"undefined\"!=typeof exports&&\"undefined\"!=typeof module)factory(exports,module);else{var mod={exports:{}};factory(mod.exports,mod),global.autosize=mod.exports}}(this,function(exports,module){\"use strict\";var keys,values,map=\"function\"==typeof Map?new Map:(keys=[],values=[],{has:function(key){return keys.indexOf(key)>-1},get:function(key){return values[keys.indexOf(key)]},set:function(key,value){-1===keys.indexOf(key)&&(keys.push(key),values.push(value))},delete:function(key){var index=keys.indexOf(key);index>-1&&(keys.splice(index,1),values.splice(index,1))}}),createEvent=function(name){return new Event(name,{bubbles:!0})};try{new Event(\"test\")}catch(e){createEvent=function(name){var evt=document.createEvent(\"Event\");return evt.initEvent(name,!0,!1),evt}}function assign(ta){if(ta&&ta.nodeName&&\"TEXTAREA\"===ta.nodeName&&!map.has(ta)){var style,heightOffset=null,clientWidth=ta.clientWidth,cachedHeight=null,pageResize=function(){ta.clientWidth!==clientWidth&&update()},destroy=function(style){window.removeEventListener(\"resize\",pageResize,!1),ta.removeEventListener(\"input\",update,!1),ta.removeEventListener(\"keyup\",update,!1),ta.removeEventListener(\"autosize:destroy\",destroy,!1),ta.removeEventListener(\"autosize:update\",update,!1),Object.keys(style).forEach(function(key){ta.style[key]=style[key]}),map.delete(ta)}.bind(ta,{height:ta.style.height,resize:ta.style.resize,overflowY:ta.style.overflowY,overflowX:ta.style.overflowX,wordWrap:ta.style.wordWrap});ta.addEventListener(\"autosize:destroy\",destroy,!1),\"onpropertychange\"in ta&&\"oninput\"in ta&&ta.addEventListener(\"keyup\",update,!1),window.addEventListener(\"resize\",pageResize,!1),ta.addEventListener(\"input\",update,!1),ta.addEventListener(\"autosize:update\",update,!1),ta.style.overflowX=\"hidden\",ta.style.wordWrap=\"break-word\",map.set(ta,{destroy:destroy,update:update}),\"vertical\"===(style=window.getComputedStyle(ta,null)).resize?ta.style.resize=\"none\":\"both\"===style.resize&&(ta.style.resize=\"horizontal\"),heightOffset=\"content-box\"===style.boxSizing?-(parseFloat(style.paddingTop)+parseFloat(style.paddingBottom)):parseFloat(style.borderTopWidth)+parseFloat(style.borderBottomWidth),isNaN(heightOffset)&&(heightOffset=0),update()}function changeOverflow(value){var width=ta.style.width;ta.style.width=\"0px\",ta.offsetWidth,ta.style.width=width,ta.style.overflowY=value}function resize(){var originalHeight=ta.style.height,overflows=function(el){for(var arr=[];el&&el.parentNode&&el.parentNode instanceof Element;)el.parentNode.scrollTop&&arr.push({node:el.parentNode,scrollTop:el.parentNode.scrollTop}),el=el.parentNode;return arr}(ta),docTop=document.documentElement&&document.documentElement.scrollTop;ta.style.height=\"auto\";var endHeight=ta.scrollHeight+heightOffset;0!==ta.scrollHeight?(ta.style.height=endHeight+\"px\",clientWidth=ta.clientWidth,overflows.forEach(function(el){el.node.scrollTop=el.scrollTop}),docTop&&(document.documentElement.scrollTop=docTop)):ta.style.height=originalHeight}function update(){resize();var styleHeight=Math.round(parseFloat(ta.style.height)),computed=window.getComputedStyle(ta,null),actualHeight=\"content-box\"===computed.boxSizing?Math.round(parseFloat(computed.height)):ta.offsetHeight;if(actualHeight!==styleHeight?\"hidden\"===computed.overflowY&&(changeOverflow(\"scroll\"),resize(),actualHeight=\"content-box\"===computed.boxSizing?Math.round(parseFloat(window.getComputedStyle(ta,null).height)):ta.offsetHeight):\"hidden\"!==computed.overflowY&&(changeOverflow(\"hidden\"),resize(),actualHeight=\"content-box\"===computed.boxSizing?Math.round(parseFloat(window.getComputedStyle(ta,null).height)):ta.offsetHeight),cachedHeight!==actualHeight){cachedHeight=actualHeight;var evt=createEvent(\"autosize:resized\");try{ta.dispatchEvent(evt)}catch(err){}}}}function destroy(ta){var methods=map.get(ta);methods&&methods.destroy()}function update(ta){var methods=map.get(ta);methods&&methods.update()}var autosize=null;\"undefined\"==typeof window||\"function\"!=typeof window.getComputedStyle?((autosize=function(el){return el}).destroy=function(el){return el},autosize.update=function(el){return el}):((autosize=function(el,options){return el&&Array.prototype.forEach.call(el.length?el:[el],function(x){return assign(x)}),el}).destroy=function(el){return el&&Array.prototype.forEach.call(el.length?el:[el],destroy),el},autosize.update=function(el){return el&&Array.prototype.forEach.call(el.length?el:[el],update),el}),module.exports=autosize}),function(window,document,undefined){for(var _REVERSE_MAP,_resetTimer,_MAP={8:\"backspace\",9:\"tab\",13:\"enter\",16:\"shift\",17:\"ctrl\",18:\"alt\",20:\"capslock\",27:\"esc\",32:\"space\",33:\"pageup\",34:\"pagedown\",35:\"end\",36:\"home\",37:\"left\",38:\"up\",39:\"right\",40:\"down\",45:\"ins\",46:\"del\",91:\"meta\",93:\"meta\",224:\"meta\"},_KEYCODE_MAP={106:\"*\",107:\"+\",109:\"-\",110:\".\",111:\"/\",186:\";\",187:\"=\",188:\",\",189:\"-\",190:\".\",191:\"/\",192:\"`\",219:\"[\",220:\"\\\\\",221:\"]\",222:\"'\"},_SHIFT_MAP={\"~\":\"`\",\"!\":\"1\",\"@\":\"2\",\"#\":\"3\",$:\"4\",\"%\":\"5\",\"^\":\"6\",\"&\":\"7\",\"*\":\"8\",\"(\":\"9\",\")\":\"0\",_:\"-\",\"+\":\"=\",\":\":\";\",'\"':\"'\",\"<\":\",\",\">\":\".\",\"?\":\"/\",\"|\":\"\\\\\"},_SPECIAL_ALIASES={option:\"alt\",command:\"meta\",return:\"enter\",escape:\"esc\",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?\"meta\":\"ctrl\"},_callbacks={},_directMap={},_sequenceLevels={},_ignoreNextKeyup=!1,_ignoreNextKeypress=!1,_nextExpectedAction=!1,i=1;i<20;++i)_MAP[111+i]=\"f\"+i;for(i=0;i<=9;++i)_MAP[i+96]=i;function _addEvent(object,type,callback){object.addEventListener?object.addEventListener(type,callback,!1):object.attachEvent(\"on\"+type,callback)}function _characterFromEvent(e){if(\"keypress\"==e.type){var character=String.fromCharCode(e.which);return e.shiftKey||(character=character.toLowerCase()),character}return _MAP[e.which]?_MAP[e.which]:_KEYCODE_MAP[e.which]?_KEYCODE_MAP[e.which]:String.fromCharCode(e.which).toLowerCase()}function _resetSequences(doNotReset){doNotReset=doNotReset||{};var key,activeSequences=!1;for(key in _sequenceLevels)doNotReset[key]?activeSequences=!0:_sequenceLevels[key]=0;activeSequences||(_nextExpectedAction=!1)}function _getMatches(character,modifiers,e,sequenceName,combination,level){var i,callback,modifiers1,modifiers2,matches=[],action=e.type;if(!_callbacks[character])return[];for(\"keyup\"==action&&_isModifier(character)&&(modifiers=[character]),i=0;i<_callbacks[character].length;++i)if(callback=_callbacks[character][i],(sequenceName||!callback.seq||_sequenceLevels[callback.seq]==callback.level)&&action==callback.action&&(\"keypress\"==action&&!e.metaKey&&!e.ctrlKey||(modifiers1=modifiers,modifiers2=callback.modifiers,modifiers1.sort().join(\",\")===modifiers2.sort().join(\",\")))){var deleteCombo=!sequenceName&&callback.combo==combination,deleteSequence=sequenceName&&callback.seq==sequenceName&&callback.level==level;(deleteCombo||deleteSequence)&&_callbacks[character].splice(i,1),matches.push(callback)}return matches}function _fireCallback(callback,e,combo,sequence){Mousetrap.stopCallback(e,e.target||e.srcElement,combo,sequence)||!1===callback(e,combo)&&(function(e){e.preventDefault?e.preventDefault():e.returnValue=!1}(e),function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}(e))}function _handleKeyEvent(e){\"number\"!=typeof e.which&&(e.which=e.keyCode);var character=_characterFromEvent(e);character&&(\"keyup\"!=e.type||_ignoreNextKeyup!==character?Mousetrap.handleKey(character,function(e){var modifiers=[];return e.shiftKey&&modifiers.push(\"shift\"),e.altKey&&modifiers.push(\"alt\"),e.ctrlKey&&modifiers.push(\"ctrl\"),e.metaKey&&modifiers.push(\"meta\"),modifiers}(e),e):_ignoreNextKeyup=!1)}function _isModifier(key){return\"shift\"==key||\"ctrl\"==key||\"alt\"==key||\"meta\"==key}function _pickBestAction(key,modifiers,action){return action||(action=function(){if(!_REVERSE_MAP)for(var key in _REVERSE_MAP={},_MAP)key>95&&key<112||_MAP.hasOwnProperty(key)&&(_REVERSE_MAP[_MAP[key]]=key);return _REVERSE_MAP}()[key]?\"keydown\":\"keypress\"),\"keypress\"==action&&modifiers.length&&(action=\"keydown\"),action}function _bindSequence(combo,keys,callback,action){function _increaseSequence(nextAction){return function(){_nextExpectedAction=nextAction,++_sequenceLevels[combo],clearTimeout(_resetTimer),_resetTimer=setTimeout(_resetSequences,1e3)}}function _callbackAndReset(e){_fireCallback(callback,e,combo),\"keyup\"!==action&&(_ignoreNextKeyup=_characterFromEvent(e)),setTimeout(_resetSequences,10)}_sequenceLevels[combo]=0;for(var i=0;i<keys.length;++i){var wrappedCallback=i+1===keys.length?_callbackAndReset:_increaseSequence(action||_getKeyInfo(keys[i+1]).action);_bindSingle(keys[i],wrappedCallback,action,combo,i)}}function _getKeyInfo(combination,action){var keys,key,i,modifiers=[];for(keys=function(combination){return\"+\"===combination?[\"+\"]:combination.split(\"+\")}(combination),i=0;i<keys.length;++i)key=keys[i],_SPECIAL_ALIASES[key]&&(key=_SPECIAL_ALIASES[key]),action&&\"keypress\"!=action&&_SHIFT_MAP[key]&&(key=_SHIFT_MAP[key],modifiers.push(\"shift\")),_isModifier(key)&&modifiers.push(key);return{key:key,modifiers:modifiers,action:action=_pickBestAction(key,modifiers,action)}}function _bindSingle(combination,callback,action,sequenceName,level){_directMap[combination+\":\"+action]=callback;var info,sequence=(combination=combination.replace(/\\s+/g,\" \")).split(\" \");sequence.length>1?_bindSequence(combination,sequence,callback,action):(info=_getKeyInfo(combination,action),_callbacks[info.key]=_callbacks[info.key]||[],_getMatches(info.key,info.modifiers,{type:info.action},sequenceName,combination,level),_callbacks[info.key][sequenceName?\"unshift\":\"push\"]({callback:callback,modifiers:info.modifiers,action:info.action,seq:sequenceName,level:level,combo:combination}))}_addEvent(document,\"keypress\",_handleKeyEvent),_addEvent(document,\"keydown\",_handleKeyEvent),_addEvent(document,\"keyup\",_handleKeyEvent);var Mousetrap={bind:function(keys,callback,action){return function(combinations,callback,action){for(var i=0;i<combinations.length;++i)_bindSingle(combinations[i],callback,action)}(keys=keys instanceof Array?keys:[keys],callback,action),this},unbind:function(keys,action){return Mousetrap.bind(keys,function(){},action)},trigger:function(keys,action){return _directMap[keys+\":\"+action]&&_directMap[keys+\":\"+action]({},keys),this},reset:function(){return _callbacks={},_directMap={},this},stopCallback:function(e,element){return!((\" \"+element.className+\" \").indexOf(\" mousetrap \")>-1)&&(\"INPUT\"==element.tagName||\"SELECT\"==element.tagName||\"TEXTAREA\"==element.tagName||element.isContentEditable)},handleKey:function(character,modifiers,e){var i,callbacks=_getMatches(character,modifiers,e),doNotReset={},maxLevel=0,processedSequenceCallback=!1;for(i=0;i<callbacks.length;++i)callbacks[i].seq&&(maxLevel=Math.max(maxLevel,callbacks[i].level));for(i=0;i<callbacks.length;++i)if(callbacks[i].seq){if(callbacks[i].level!=maxLevel)continue;processedSequenceCallback=!0,doNotReset[callbacks[i].seq]=1,_fireCallback(callbacks[i].callback,e,callbacks[i].combo,callbacks[i].seq)}else processedSequenceCallback||_fireCallback(callbacks[i].callback,e,callbacks[i].combo);var ignoreThisKeypress=\"keypress\"==e.type&&_ignoreNextKeypress;e.type!=_nextExpectedAction||_isModifier(character)||ignoreThisKeypress||_resetSequences(doNotReset),_ignoreNextKeypress=processedSequenceCallback&&\"keydown\"==e.type}};window.Mousetrap=Mousetrap,\"function\"==typeof define&&define.amd&&define(Mousetrap)}(window,document),Mousetrap=function(Mousetrap){var _globalCallbacks={},_originalStopCallback=Mousetrap.stopCallback;return Mousetrap.stopCallback=function(e,element,combo,sequence){return!_globalCallbacks[combo]&&!_globalCallbacks[sequence]&&_originalStopCallback(e,element,combo)},Mousetrap.bindGlobal=function(keys,callback,action){if(Mousetrap.bind(keys,callback,action),keys instanceof Array)for(var i=0;i<keys.length;i++)_globalCallbacks[keys[i]]=!0;else _globalCallbacks[keys]=!0},Mousetrap}(Mousetrap),function($,undefined){var orig,removeData,uuid=0,runiqueId=/^ui-id-\\d+$/;function focusable(element,isTabIndexNotNaN){var map,mapName,img,nodeName=element.nodeName.toLowerCase();return\"area\"===nodeName?(mapName=(map=element.parentNode).name,!(!element.href||!mapName||\"map\"!==map.nodeName.toLowerCase())&&(!!(img=$(\"img[usemap=#\"+mapName+\"]\")[0])&&visible(img))):(/input|select|textarea|button|object/.test(nodeName)?!element.disabled:\"a\"===nodeName&&element.href||isTabIndexNotNaN)&&visible(element)}function visible(element){return $.expr.filters.visible(element)&&!$(element).parents().addBack().filter(function(){return\"hidden\"===$.css(this,\"visibility\")}).length}$.ui=$.ui||{},$.extend($.ui,{version:\"@VERSION\",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),$.fn.extend({focus:(orig=$.fn.focus,function(delay,fn){return\"number\"==typeof delay?this.each(function(){var elem=this;setTimeout(function(){$(elem).focus(),fn&&fn.call(elem)},delay)}):orig.apply(this,arguments)}),scrollParent:function(){var scrollParent;return scrollParent=$.ui.ie&&/(static|relative)/.test(this.css(\"position\"))||/absolute/.test(this.css(\"position\"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test($.css(this,\"position\"))&&/(auto|scroll)/.test($.css(this,\"overflow\")+$.css(this,\"overflow-y\")+$.css(this,\"overflow-x\"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test($.css(this,\"overflow\")+$.css(this,\"overflow-y\")+$.css(this,\"overflow-x\"))}).eq(0),/fixed/.test(this.css(\"position\"))||!scrollParent.length?$(document):scrollParent},zIndex:function(zIndex){if(void 0!==zIndex)return this.css(\"zIndex\",zIndex);if(this.length)for(var position,value,elem=$(this[0]);elem.length&&elem[0]!==document;){if((\"absolute\"===(position=elem.css(\"position\"))||\"relative\"===position||\"fixed\"===position)&&(value=parseInt(elem.css(\"zIndex\"),10),!isNaN(value)&&0!==value))return value;elem=elem.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id=\"ui-id-\"+ ++uuid)})},removeUniqueId:function(){return this.each(function(){runiqueId.test(this.id)&&$(this).removeAttr(\"id\")})}}),$.extend($.expr[\":\"],{data:$.expr.createPseudo?$.expr.createPseudo(function(dataName){return function(elem){return!!$.data(elem,dataName)}}):function(elem,i,match){return!!$.data(elem,match[3])},focusable:function(element){return focusable(element,!isNaN($.attr(element,\"tabindex\")))},tabbable:function(element){var tabIndex=$.attr(element,\"tabindex\"),isTabIndexNaN=isNaN(tabIndex);return(isTabIndexNaN||tabIndex>=0)&&focusable(element,!isTabIndexNaN)}}),$(\"<a>\").outerWidth(1).jquery||$.each([\"Width\",\"Height\"],function(i,name){var side=\"Width\"===name?[\"Left\",\"Right\"]:[\"Top\",\"Bottom\"],type=name.toLowerCase(),orig={innerWidth:$.fn.innerWidth,innerHeight:$.fn.innerHeight,outerWidth:$.fn.outerWidth,outerHeight:$.fn.outerHeight};function reduce(elem,size,border,margin){return $.each(side,function(){size-=parseFloat($.css(elem,\"padding\"+this))||0,border&&(size-=parseFloat($.css(elem,\"border\"+this+\"Width\"))||0),margin&&(size-=parseFloat($.css(elem,\"margin\"+this))||0)}),size}$.fn[\"inner\"+name]=function(size){return void 0===size?orig[\"inner\"+name].call(this):this.each(function(){$(this).css(type,reduce(this,size)+\"px\")})},$.fn[\"outer\"+name]=function(size,margin){return\"number\"!=typeof size?orig[\"outer\"+name].call(this,size):this.each(function(){$(this).css(type,reduce(this,size,!0,margin)+\"px\")})}}),$.fn.addBack||($.fn.addBack=function(selector){return this.add(null==selector?this.prevObject:this.prevObject.filter(selector))}),$(\"<a>\").data(\"a-b\",\"a\").removeData(\"a-b\").data(\"a-b\")&&($.fn.removeData=(removeData=$.fn.removeData,function(key){return arguments.length?removeData.call(this,$.camelCase(key)):removeData.call(this)})),$.ui.ie=!!/msie [\\w.]+/.exec(navigator.userAgent.toLowerCase()),$.support.selectstart=\"onselectstart\"in document.createElement(\"div\"),$.fn.extend({disableSelection:function(){return this.bind(($.support.selectstart?\"selectstart\":\"mousedown\")+\".ui-disableSelection\",function(event){event.preventDefault()})},enableSelection:function(){return this.unbind(\".ui-disableSelection\")}}),$.extend($.ui,{plugin:{add:function(module,option,set){var i,proto=$.ui[module].prototype;for(i in set)proto.plugins[i]=proto.plugins[i]||[],proto.plugins[i].push([option,set[i]])},call:function(instance,name,args){var i,set=instance.plugins[name];if(set&&instance.element[0].parentNode&&11!==instance.element[0].parentNode.nodeType)for(i=0;i<set.length;i++)instance.options[set[i][0]]&&set[i][1].apply(instance.element,args)}},hasScroll:function(el,a){if(\"hidden\"===$(el).css(\"overflow\"))return!1;var has,scroll=a&&\"left\"===a?\"scrollLeft\":\"scrollTop\";return el[scroll]>0||(el[scroll]=1,has=el[scroll]>0,el[scroll]=0,has)}})}(jQuery),function($,undefined){var uuid=0,slice=Array.prototype.slice,_cleanData=$.cleanData;$.cleanData=function(elems){for(var elem,i=0;null!=(elem=elems[i]);i++)try{$(elem).triggerHandler(\"remove\")}catch(e){}_cleanData(elems)},$.widget=function(name,base,prototype){var fullName,existingConstructor,constructor,basePrototype,proxiedPrototype={},namespace=name.split(\".\")[0];name=name.split(\".\")[1],fullName=namespace+\"-\"+name,prototype||(prototype=base,base=$.Widget),$.expr[\":\"][fullName.toLowerCase()]=function(elem){return!!$.data(elem,fullName)},$[namespace]=$[namespace]||{},existingConstructor=$[namespace][name],constructor=$[namespace][name]=function(options,element){if(!this._createWidget)return new constructor(options,element);arguments.length&&this._createWidget(options,element)},$.extend(constructor,existingConstructor,{version:prototype.version,_proto:$.extend({},prototype),_childConstructors:[]}),(basePrototype=new base).options=$.widget.extend({},basePrototype.options),$.each(prototype,function(prop,value){var _super,_superApply;$.isFunction(value)?proxiedPrototype[prop]=(_super=function(){return base.prototype[prop].apply(this,arguments)},_superApply=function(args){return base.prototype[prop].apply(this,args)},function(){var returnValue,__super=this._super,__superApply=this._superApply;return this._super=_super,this._superApply=_superApply,returnValue=value.apply(this,arguments),this._super=__super,this._superApply=__superApply,returnValue}):proxiedPrototype[prop]=value}),constructor.prototype=$.widget.extend(basePrototype,{widgetEventPrefix:existingConstructor&&basePrototype.widgetEventPrefix||name},proxiedPrototype,{constructor:constructor,namespace:namespace,widgetName:name,widgetFullName:fullName}),existingConstructor?($.each(existingConstructor._childConstructors,function(i,child){var childPrototype=child.prototype;$.widget(childPrototype.namespace+\".\"+childPrototype.widgetName,constructor,child._proto)}),delete existingConstructor._childConstructors):base._childConstructors.push(constructor),$.widget.bridge(name,constructor)},$.widget.extend=function(target){for(var key,value,input=slice.call(arguments,1),inputIndex=0,inputLength=input.length;inputIndex<inputLength;inputIndex++)for(key in input[inputIndex])value=input[inputIndex][key],input[inputIndex].hasOwnProperty(key)&&void 0!==value&&($.isPlainObject(value)?target[key]=$.isPlainObject(target[key])?$.widget.extend({},target[key],value):$.widget.extend({},value):target[key]=value);return target},$.widget.bridge=function(name,object){var fullName=object.prototype.widgetFullName||name;$.fn[name]=function(options){var isMethodCall=\"string\"==typeof options,args=slice.call(arguments,1),returnValue=this;return options=!isMethodCall&&args.length?$.widget.extend.apply(null,[options].concat(args)):options,isMethodCall?this.each(function(){var methodValue,instance=$.data(this,fullName);return instance?$.isFunction(instance[options])&&\"_\"!==options.charAt(0)?(methodValue=instance[options].apply(instance,args))!==instance&&void 0!==methodValue?(returnValue=methodValue&&methodValue.jquery?returnValue.pushStack(methodValue.get()):methodValue,!1):void 0:$.error(\"no such method '\"+options+\"' for \"+name+\" widget instance\"):$.error(\"cannot call methods on \"+name+\" prior to initialization; attempted to call method '\"+options+\"'\")}):this.each(function(){var instance=$.data(this,fullName);instance?instance.option(options||{})._init():$.data(this,fullName,new object(options,this))}),returnValue}},$.Widget=function(){},$.Widget._childConstructors=[],$.Widget.prototype={widgetName:\"widget\",widgetEventPrefix:\"\",defaultElement:\"<div>\",options:{disabled:!1,create:null},_createWidget:function(options,element){element=$(element||this.defaultElement||this)[0],this.element=$(element),this.uuid=uuid++,this.eventNamespace=\".\"+this.widgetName+this.uuid,this.options=$.widget.extend({},this.options,this._getCreateOptions(),options),this.bindings=$(),this.hoverable=$(),this.focusable=$(),element!==this&&($.data(element,this.widgetFullName,this),this._on(!0,this.element,{remove:function(event){event.target===element&&this.destroy()}}),this.document=$(element.style?element.ownerDocument:element.document||element),this.window=$(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger(\"create\",null,this._getCreateEventData()),this._init()},_getCreateOptions:$.noop,_getCreateEventData:$.noop,_create:$.noop,_init:$.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData($.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr(\"aria-disabled\").removeClass(this.widgetFullName+\"-disabled ui-state-disabled\"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass(\"ui-state-hover\"),this.focusable.removeClass(\"ui-state-focus\")},_destroy:$.noop,widget:function(){return this.element},option:function(key,value){var parts,curOption,i,options=key;if(0===arguments.length)return $.widget.extend({},this.options);if(\"string\"==typeof key)if(options={},key=(parts=key.split(\".\")).shift(),parts.length){for(curOption=options[key]=$.widget.extend({},this.options[key]),i=0;i<parts.length-1;i++)curOption[parts[i]]=curOption[parts[i]]||{},curOption=curOption[parts[i]];if(key=parts.pop(),1===arguments.length)return void 0===curOption[key]?null:curOption[key];curOption[key]=value}else{if(1===arguments.length)return void 0===this.options[key]?null:this.options[key];options[key]=value}return this._setOptions(options),this},_setOptions:function(options){var key;for(key in options)this._setOption(key,options[key]);return this},_setOption:function(key,value){return this.options[key]=value,\"disabled\"===key&&(this.widget().toggleClass(this.widgetFullName+\"-disabled ui-state-disabled\",!!value).attr(\"aria-disabled\",value),this.hoverable.removeClass(\"ui-state-hover\"),this.focusable.removeClass(\"ui-state-focus\")),this},enable:function(){return this._setOption(\"disabled\",!1)},disable:function(){return this._setOption(\"disabled\",!0)},_on:function(suppressDisabledCheck,element,handlers){var delegateElement,instance=this;\"boolean\"!=typeof suppressDisabledCheck&&(handlers=element,element=suppressDisabledCheck,suppressDisabledCheck=!1),handlers?(element=delegateElement=$(element),this.bindings=this.bindings.add(element)):(handlers=element,element=this.element,delegateElement=this.widget()),$.each(handlers,function(event,handler){function handlerProxy(){if(suppressDisabledCheck||!0!==instance.options.disabled&&!$(this).hasClass(\"ui-state-disabled\"))return(\"string\"==typeof handler?instance[handler]:handler).apply(instance,arguments)}\"string\"!=typeof handler&&(handlerProxy.guid=handler.guid=handler.guid||handlerProxy.guid||$.guid++);var match=event.match(/^(\\w+)\\s*(.*)$/),eventName=match[1]+instance.eventNamespace,selector=match[2];selector?delegateElement.delegate(selector,eventName,handlerProxy):element.bind(eventName,handlerProxy)})},_off:function(element,eventName){eventName=(eventName||\"\").split(\" \").join(this.eventNamespace+\" \")+this.eventNamespace,element.unbind(eventName).undelegate(eventName)},_delay:function(handler,delay){var instance=this;return setTimeout(function(){return(\"string\"==typeof handler?instance[handler]:handler).apply(instance,arguments)},delay||0)},_hoverable:function(element){this.hoverable=this.hoverable.add(element),this._on(element,{mouseenter:function(event){$(event.currentTarget).addClass(\"ui-state-hover\")},mouseleave:function(event){$(event.currentTarget).removeClass(\"ui-state-hover\")}})},_focusable:function(element){this.focusable=this.focusable.add(element),this._on(element,{focusin:function(event){$(event.currentTarget).addClass(\"ui-state-focus\")},focusout:function(event){$(event.currentTarget).removeClass(\"ui-state-focus\")}})},_trigger:function(type,event,data){var prop,orig,callback=this.options[type];if(data=data||{},(event=$.Event(event)).type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase(),event.target=this.element[0],orig=event.originalEvent)for(prop in orig)prop in event||(event[prop]=orig[prop]);return this.element.trigger(event,data),!($.isFunction(callback)&&!1===callback.apply(this.element[0],[event].concat(data))||event.isDefaultPrevented())}},$.each({show:\"fadeIn\",hide:\"fadeOut\"},function(method,defaultEffect){$.Widget.prototype[\"_\"+method]=function(element,options,callback){\"string\"==typeof options&&(options={effect:options});var hasOptions,effectName=options?!0===options||\"number\"==typeof options?defaultEffect:options.effect||defaultEffect:method;\"number\"==typeof(options=options||{})&&(options={duration:options}),hasOptions=!$.isEmptyObject(options),options.complete=callback,options.delay&&element.delay(options.delay),hasOptions&&$.effects&&$.effects.effect[effectName]?element[method](options):effectName!==method&&element[effectName]?element[effectName](options.duration,options.easing,callback):element.queue(function(next){$(this)[method](),callback&&callback.call(element[0]),next()})}})}(jQuery),function($,undefined){var mouseHandled=!1;$(document).mouseup(function(){mouseHandled=!1}),$.widget(\"ui.mouse\",{version:\"@VERSION\",options:{cancel:\"input,textarea,button,select,option\",distance:1,delay:0},_mouseInit:function(){var that=this;this.element.bind(\"mousedown.\"+this.widgetName,function(event){return that._mouseDown(event)}).bind(\"click.\"+this.widgetName,function(event){if(!0===$.data(event.target,that.widgetName+\".preventClickEvent\"))return $.removeData(event.target,that.widgetName+\".preventClickEvent\"),event.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind(\".\"+this.widgetName),this._mouseMoveDelegate&&$(document).unbind(\"mousemove.\"+this.widgetName,this._mouseMoveDelegate).unbind(\"mouseup.\"+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(event){if(!mouseHandled){this._mouseStarted&&this._mouseUp(event),this._mouseDownEvent=event;var that=this,btnIsLeft=1===event.which,elIsCancel=!(\"string\"!=typeof this.options.cancel||!event.target.nodeName)&&$(event.target).closest(this.options.cancel).length;return!(btnIsLeft&&!elIsCancel&&this._mouseCapture(event))||(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){that.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(event)&&this._mouseDelayMet(event)&&(this._mouseStarted=!1!==this._mouseStart(event),!this._mouseStarted)?(event.preventDefault(),!0):(!0===$.data(event.target,this.widgetName+\".preventClickEvent\")&&$.removeData(event.target,this.widgetName+\".preventClickEvent\"),this._mouseMoveDelegate=function(event){return that._mouseMove(event)},this._mouseUpDelegate=function(event){return that._mouseUp(event)},$(document).bind(\"mousemove.\"+this.widgetName,this._mouseMoveDelegate).bind(\"mouseup.\"+this.widgetName,this._mouseUpDelegate),event.preventDefault(),mouseHandled=!0,!0))}},_mouseMove:function(event){return $.ui.ie&&(!document.documentMode||document.documentMode<9)&&!event.button?this._mouseUp(event):this._mouseStarted?(this._mouseDrag(event),event.preventDefault()):(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,event),this._mouseStarted?this._mouseDrag(event):this._mouseUp(event)),!this._mouseStarted)},_mouseUp:function(event){return $(document).unbind(\"mousemove.\"+this.widgetName,this._mouseMoveDelegate).unbind(\"mouseup.\"+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,event.target===this._mouseDownEvent.target&&$.data(event.target,this.widgetName+\".preventClickEvent\",!0),this._mouseStop(event)),!1},_mouseDistanceMet:function(event){return Math.max(Math.abs(this._mouseDownEvent.pageX-event.pageX),Math.abs(this._mouseDownEvent.pageY-event.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function($,undefined){$.widget(\"ui.draggable\",$.ui.mouse,{version:\"@VERSION\",widgetEventPrefix:\"drag\",options:{addClasses:!0,appendTo:\"parent\",axis:!1,connectToSortable:!1,containment:!1,cursor:\"auto\",cursorAt:!1,grid:!1,handle:!1,helper:\"original\",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:\"default\",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:\"both\",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){\"original\"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css(\"position\"))||(this.element[0].style.position=\"relative\"),this.options.addClasses&&this.element.addClass(\"ui-draggable\"),this.options.disabled&&this.element.addClass(\"ui-draggable-disabled\"),this._mouseInit()},_destroy:function(){this.element.removeClass(\"ui-draggable ui-draggable-dragging ui-draggable-disabled\"),this._mouseDestroy()},_mouseCapture:function(event){var o=this.options;return!(this.helper||o.disabled||$(event.target).closest(\".ui-resizable-handle\").length>0)&&(this.handle=this._getHandle(event),!!this.handle&&($(!0===o.iframeFix?\"iframe\":o.iframeFix).each(function(){$(\"<div class='ui-draggable-iframeFix' style='background: #fff;'></div>\").css({width:this.offsetWidth+\"px\",height:this.offsetHeight+\"px\",position:\"absolute\",opacity:\"0.001\",zIndex:1e3}).css($(this).offset()).appendTo(\"body\")}),!0))},_mouseStart:function(event){var o=this.options;return this.helper=this._createHelper(event),this.helper.addClass(\"ui-draggable-dragging\"),this._cacheHelperProportions(),$.ui.ddmanager&&($.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css(\"position\"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css(\"position\"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(event),this.originalPageX=event.pageX,this.originalPageY=event.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this._setContainment(),!1===this._trigger(\"start\",event)?(this._clear(),!1):(this._cacheHelperProportions(),$.ui.ddmanager&&!o.dropBehaviour&&$.ui.ddmanager.prepareOffsets(this,event),this._mouseDrag(event,!0),$.ui.ddmanager&&$.ui.ddmanager.dragStart(this,event),!0)},_mouseDrag:function(event,noPropagation){if(\"fixed\"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(event),this.positionAbs=this._convertPositionTo(\"absolute\"),!noPropagation){var ui=this._uiHash();if(!1===this._trigger(\"drag\",event,ui))return this._mouseUp({}),!1;this.position=ui.position}return this.options.axis&&\"y\"===this.options.axis||(this.helper[0].style.left=this.position.left+\"px\"),this.options.axis&&\"x\"===this.options.axis||(this.helper[0].style.top=this.position.top+\"px\"),$.ui.ddmanager&&$.ui.ddmanager.drag(this,event),!1},_mouseStop:function(event){var that=this,dropped=!1;return $.ui.ddmanager&&!this.options.dropBehaviour&&(dropped=$.ui.ddmanager.drop(this,event)),this.dropped&&(dropped=this.dropped,this.dropped=!1),!(\"original\"===this.options.helper&&!$.contains(this.element[0].ownerDocument,this.element[0]))&&(\"invalid\"===this.options.revert&&!dropped||\"valid\"===this.options.revert&&dropped||!0===this.options.revert||$.isFunction(this.options.revert)&&this.options.revert.call(this.element,dropped)?$(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){!1!==that._trigger(\"stop\",event)&&that._clear()}):!1!==this._trigger(\"stop\",event)&&this._clear(),!1)},_mouseUp:function(event){return $(\"div.ui-draggable-iframeFix\").each(function(){this.parentNode.removeChild(this)}),$.ui.ddmanager&&$.ui.ddmanager.dragStop(this,event),$.ui.mouse.prototype._mouseUp.call(this,event)},cancel:function(){return this.helper.is(\".ui-draggable-dragging\")?this._mouseUp({}):this._clear(),this},_getHandle:function(event){return!this.options.handle||!!$(event.target).closest(this.element.find(this.options.handle)).length},_createHelper:function(event){var o=this.options,helper=$.isFunction(o.helper)?$(o.helper.apply(this.element[0],[event])):\"clone\"===o.helper?this.element.clone().removeAttr(\"id\"):this.element;return helper.parents(\"body\").length||helper.appendTo(\"parent\"===o.appendTo?this.element[0].parentNode:o.appendTo),helper[0]===this.element[0]||/(fixed|absolute)/.test(helper.css(\"position\"))||helper.css(\"position\",\"absolute\"),helper},_adjustOffsetFromHelper:function(obj){\"string\"==typeof obj&&(obj=obj.split(\" \")),$.isArray(obj)&&(obj={left:+obj[0],top:+obj[1]||0}),\"left\"in obj&&(this.offset.click.left=obj.left+this.margins.left),\"right\"in obj&&(this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left),\"top\"in obj&&(this.offset.click.top=obj.top+this.margins.top),\"bottom\"in obj&&(this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top)},_getParentOffset:function(){var po=this.offsetParent.offset();return\"absolute\"===this.cssPosition&&this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0])&&(po.left+=this.scrollParent.scrollLeft(),po.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&\"html\"===this.offsetParent[0].tagName.toLowerCase()&&$.ui.ie)&&(po={top:0,left:0}),{top:po.top+(parseInt(this.offsetParent.css(\"borderTopWidth\"),10)||0),left:po.left+(parseInt(this.offsetParent.css(\"borderLeftWidth\"),10)||0)}},_getRelativeOffset:function(){if(\"relative\"===this.cssPosition){var p=this.element.position();return{top:p.top-(parseInt(this.helper.css(\"top\"),10)||0)+this.scrollParent.scrollTop(),left:p.left-(parseInt(this.helper.css(\"left\"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css(\"marginLeft\"),10)||0,top:parseInt(this.element.css(\"marginTop\"),10)||0,right:parseInt(this.element.css(\"marginRight\"),10)||0,bottom:parseInt(this.element.css(\"marginBottom\"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var over,c,ce,o=this.options;o.containment?\"window\"!==o.containment?\"document\"!==o.containment?o.containment.constructor!==Array?(\"parent\"===o.containment&&(o.containment=this.helper[0].parentNode),(ce=(c=$(o.containment))[0])&&(over=\"hidden\"!==c.css(\"overflow\"),this.containment=[(parseInt(c.css(\"borderLeftWidth\"),10)||0)+(parseInt(c.css(\"paddingLeft\"),10)||0),(parseInt(c.css(\"borderTopWidth\"),10)||0)+(parseInt(c.css(\"paddingTop\"),10)||0),(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-(parseInt(c.css(\"borderRightWidth\"),10)||0)-(parseInt(c.css(\"paddingRight\"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-(parseInt(c.css(\"borderBottomWidth\"),10)||0)-(parseInt(c.css(\"paddingBottom\"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=c)):this.containment=o.containment:this.containment=[0,0,$(document).width()-this.helperProportions.width-this.margins.left,($(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]:this.containment=[$(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,$(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,$(window).scrollLeft()+$(window).width()-this.helperProportions.width-this.margins.left,$(window).scrollTop()+($(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]:this.containment=null},_convertPositionTo:function(d,pos){pos||(pos=this.position);var mod=\"absolute\"===d?1:-1,scroll=\"absolute\"!==this.cssPosition||this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;return this.offset.scroll||(this.offset.scroll={top:scroll.scrollTop(),left:scroll.scrollLeft()}),{top:pos.top+this.offset.relative.top*mod+this.offset.parent.top*mod-(\"fixed\"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top)*mod,left:pos.left+this.offset.relative.left*mod+this.offset.parent.left*mod-(\"fixed\"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)*mod}},_generatePosition:function(event){var containment,co,top,left,o=this.options,scroll=\"absolute\"!==this.cssPosition||this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,pageX=event.pageX,pageY=event.pageY;return this.offset.scroll||(this.offset.scroll={top:scroll.scrollTop(),left:scroll.scrollLeft()}),this.originalPosition&&(this.containment&&(this.relative_container?(co=this.relative_container.offset(),containment=[this.containment[0]+co.left,this.containment[1]+co.top,this.containment[2]+co.left,this.containment[3]+co.top]):containment=this.containment,event.pageX-this.offset.click.left<containment[0]&&(pageX=containment[0]+this.offset.click.left),event.pageY-this.offset.click.top<containment[1]&&(pageY=containment[1]+this.offset.click.top),event.pageX-this.offset.click.left>containment[2]&&(pageX=containment[2]+this.offset.click.left),event.pageY-this.offset.click.top>containment[3]&&(pageY=containment[3]+this.offset.click.top)),o.grid&&(top=o.grid[1]?this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,pageY=containment?top-this.offset.click.top>=containment[1]||top-this.offset.click.top>containment[3]?top:top-this.offset.click.top>=containment[1]?top-o.grid[1]:top+o.grid[1]:top,left=o.grid[0]?this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,pageX=containment?left-this.offset.click.left>=containment[0]||left-this.offset.click.left>containment[2]?left:left-this.offset.click.left>=containment[0]?left-o.grid[0]:left+o.grid[0]:left)),{top:pageY-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(\"fixed\"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top),left:pageX-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(\"fixed\"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass(\"ui-draggable-dragging\"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(type,event,ui){return ui=ui||this._uiHash(),$.ui.plugin.call(this,type,[event,ui]),\"drag\"===type&&(this.positionAbs=this._convertPositionTo(\"absolute\")),$.Widget.prototype._trigger.call(this,type,event,ui)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),$.ui.plugin.add(\"draggable\",\"connectToSortable\",{start:function(event,ui){var inst=$(this).data(\"ui-draggable\"),o=inst.options,uiSortable=$.extend({},ui,{item:inst.element});inst.sortables=[],$(o.connectToSortable).each(function(){var sortable=$.data(this,\"ui-sortable\");sortable&&!sortable.options.disabled&&(inst.sortables.push({instance:sortable,shouldRevert:sortable.options.revert}),sortable.refreshPositions(),sortable._trigger(\"activate\",event,uiSortable))})},stop:function(event,ui){var inst=$(this).data(\"ui-draggable\"),uiSortable=$.extend({},ui,{item:inst.element});$.each(inst.sortables,function(){this.instance.isOver?(this.instance.isOver=0,inst.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(event),this.instance.options.helper=this.instance.options._helper,\"original\"===inst.options.helper&&this.instance.currentItem.css({top:\"auto\",left:\"auto\"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger(\"deactivate\",event,uiSortable))})},drag:function(event,ui){var inst=$(this).data(\"ui-draggable\"),that=this;$.each(inst.sortables,function(){var innermostIntersecting=!1,thisSortable=this;this.instance.positionAbs=inst.positionAbs,this.instance.helperProportions=inst.helperProportions,this.instance.offset.click=inst.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(innermostIntersecting=!0,$.each(inst.sortables,function(){return this.instance.positionAbs=inst.positionAbs,this.instance.helperProportions=inst.helperProportions,this.instance.offset.click=inst.offset.click,this!==thisSortable&&this.instance._intersectsWith(this.instance.containerCache)&&$.contains(thisSortable.instance.element[0],this.instance.element[0])&&(innermostIntersecting=!1),innermostIntersecting})),innermostIntersecting?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=$(that).clone().removeAttr(\"id\").appendTo(this.instance.element).data(\"ui-sortable-item\",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return ui.helper[0]},event.target=this.instance.currentItem[0],this.instance._mouseCapture(event,!0),this.instance._mouseStart(event,!0,!0),this.instance.offset.click.top=inst.offset.click.top,this.instance.offset.click.left=inst.offset.click.left,this.instance.offset.parent.left-=inst.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=inst.offset.parent.top-this.instance.offset.parent.top,inst._trigger(\"toSortable\",event),inst.dropped=this.instance.element,inst.currentItem=inst.element,this.instance.fromOutside=inst),this.instance.currentItem&&this.instance._mouseDrag(event)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger(\"out\",event,this.instance._uiHash(this.instance)),this.instance._mouseStop(event,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),inst._trigger(\"fromSortable\",event),inst.dropped=!1)})}}),$.ui.plugin.add(\"draggable\",\"cursor\",{start:function(){var t=$(\"body\"),o=$(this).data(\"ui-draggable\").options;t.css(\"cursor\")&&(o._cursor=t.css(\"cursor\")),t.css(\"cursor\",o.cursor)},stop:function(){var o=$(this).data(\"ui-draggable\").options;o._cursor&&$(\"body\").css(\"cursor\",o._cursor)}}),$.ui.plugin.add(\"draggable\",\"opacity\",{start:function(event,ui){var t=$(ui.helper),o=$(this).data(\"ui-draggable\").options;t.css(\"opacity\")&&(o._opacity=t.css(\"opacity\")),t.css(\"opacity\",o.opacity)},stop:function(event,ui){var o=$(this).data(\"ui-draggable\").options;o._opacity&&$(ui.helper).css(\"opacity\",o._opacity)}}),$.ui.plugin.add(\"draggable\",\"scroll\",{start:function(){var i=$(this).data(\"ui-draggable\");i.scrollParent[0]!==document&&\"HTML\"!==i.scrollParent[0].tagName&&(i.overflowOffset=i.scrollParent.offset())},drag:function(event){var i=$(this).data(\"ui-draggable\"),o=i.options,scrolled=!1;i.scrollParent[0]!==document&&\"HTML\"!==i.scrollParent[0].tagName?(o.axis&&\"x\"===o.axis||(i.overflowOffset.top+i.scrollParent[0].offsetHeight-event.pageY<o.scrollSensitivity?i.scrollParent[0].scrollTop=scrolled=i.scrollParent[0].scrollTop+o.scrollSpeed:event.pageY-i.overflowOffset.top<o.scrollSensitivity&&(i.scrollParent[0].scrollTop=scrolled=i.scrollParent[0].scrollTop-o.scrollSpeed)),o.axis&&\"y\"===o.axis||(i.overflowOffset.left+i.scrollParent[0].offsetWidth-event.pageX<o.scrollSensitivity?i.scrollParent[0].scrollLeft=scrolled=i.scrollParent[0].scrollLeft+o.scrollSpeed:event.pageX-i.overflowOffset.left<o.scrollSensitivity&&(i.scrollParent[0].scrollLeft=scrolled=i.scrollParent[0].scrollLeft-o.scrollSpeed))):(o.axis&&\"x\"===o.axis||(event.pageY-$(document).scrollTop()<o.scrollSensitivity?scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed):$(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity&&(scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed))),o.axis&&\"y\"===o.axis||(event.pageX-$(document).scrollLeft()<o.scrollSensitivity?scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed):$(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity&&(scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed)))),!1!==scrolled&&$.ui.ddmanager&&!o.dropBehaviour&&$.ui.ddmanager.prepareOffsets(i,event)}}),$.ui.plugin.add(\"draggable\",\"snap\",{start:function(){var i=$(this).data(\"ui-draggable\"),o=i.options;i.snapElements=[],$(o.snap.constructor!==String?o.snap.items||\":data(ui-draggable)\":o.snap).each(function(){var $t=$(this),$o=$t.offset();this!==i.element[0]&&i.snapElements.push({item:this,width:$t.outerWidth(),height:$t.outerHeight(),top:$o.top,left:$o.left})})},drag:function(event,ui){var ts,bs,ls,rs,l,r,t,b,i,first,inst=$(this).data(\"ui-draggable\"),o=inst.options,d=o.snapTolerance,x1=ui.offset.left,x2=x1+inst.helperProportions.width,y1=ui.offset.top,y2=y1+inst.helperProportions.height;for(i=inst.snapElements.length-1;i>=0;i--)r=(l=inst.snapElements[i].left)+inst.snapElements[i].width,b=(t=inst.snapElements[i].top)+inst.snapElements[i].height,x2<l-d||x1>r+d||y2<t-d||y1>b+d||!$.contains(inst.snapElements[i].item.ownerDocument,inst.snapElements[i].item)?(inst.snapElements[i].snapping&&inst.options.snap.release&&inst.options.snap.release.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item})),inst.snapElements[i].snapping=!1):(\"inner\"!==o.snapMode&&(ts=Math.abs(t-y2)<=d,bs=Math.abs(b-y1)<=d,ls=Math.abs(l-x2)<=d,rs=Math.abs(r-x1)<=d,ts&&(ui.position.top=inst._convertPositionTo(\"relative\",{top:t-inst.helperProportions.height,left:0}).top-inst.margins.top),bs&&(ui.position.top=inst._convertPositionTo(\"relative\",{top:b,left:0}).top-inst.margins.top),ls&&(ui.position.left=inst._convertPositionTo(\"relative\",{top:0,left:l-inst.helperProportions.width}).left-inst.margins.left),rs&&(ui.position.left=inst._convertPositionTo(\"relative\",{top:0,left:r}).left-inst.margins.left)),first=ts||bs||ls||rs,\"outer\"!==o.snapMode&&(ts=Math.abs(t-y1)<=d,bs=Math.abs(b-y2)<=d,ls=Math.abs(l-x1)<=d,rs=Math.abs(r-x2)<=d,ts&&(ui.position.top=inst._convertPositionTo(\"relative\",{top:t,left:0}).top-inst.margins.top),bs&&(ui.position.top=inst._convertPositionTo(\"relative\",{top:b-inst.helperProportions.height,left:0}).top-inst.margins.top),ls&&(ui.position.left=inst._convertPositionTo(\"relative\",{top:0,left:l}).left-inst.margins.left),rs&&(ui.position.left=inst._convertPositionTo(\"relative\",{top:0,left:r-inst.helperProportions.width}).left-inst.margins.left)),!inst.snapElements[i].snapping&&(ts||bs||ls||rs||first)&&inst.options.snap.snap&&inst.options.snap.snap.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item})),inst.snapElements[i].snapping=ts||bs||ls||rs||first)}}),$.ui.plugin.add(\"draggable\",\"stack\",{start:function(){var min,o=this.data(\"ui-draggable\").options,group=$.makeArray($(o.stack)).sort(function(a,b){return(parseInt($(a).css(\"zIndex\"),10)||0)-(parseInt($(b).css(\"zIndex\"),10)||0)});group.length&&(min=parseInt($(group[0]).css(\"zIndex\"),10)||0,$(group).each(function(i){$(this).css(\"zIndex\",min+i)}),this.css(\"zIndex\",min+group.length))}}),$.ui.plugin.add(\"draggable\",\"zIndex\",{start:function(event,ui){var t=$(ui.helper),o=$(this).data(\"ui-draggable\").options;t.css(\"zIndex\")&&(o._zIndex=t.css(\"zIndex\")),t.css(\"zIndex\",o.zIndex)},stop:function(event,ui){var o=$(this).data(\"ui-draggable\").options;o._zIndex&&$(ui.helper).css(\"zIndex\",o._zIndex)}})}(jQuery),function($,undefined){function isOverAxis(x,reference,size){return x>reference&&x<reference+size}$.widget(\"ui.droppable\",{version:\"@VERSION\",widgetEventPrefix:\"drop\",options:{accept:\"*\",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:\"default\",tolerance:\"intersect\",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var proportions,o=this.options,accept=o.accept;this.isover=!1,this.isout=!0,this.accept=$.isFunction(accept)?accept:function(d){return d.is(accept)},this.proportions=function(){if(!arguments.length)return proportions||(proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight});proportions=arguments[0]},$.ui.ddmanager.droppables[o.scope]=$.ui.ddmanager.droppables[o.scope]||[],$.ui.ddmanager.droppables[o.scope].push(this),o.addClasses&&this.element.addClass(\"ui-droppable\")},_destroy:function(){for(var i=0,drop=$.ui.ddmanager.droppables[this.options.scope];i<drop.length;i++)drop[i]===this&&drop.splice(i,1);this.element.removeClass(\"ui-droppable ui-droppable-disabled\")},_setOption:function(key,value){\"accept\"===key&&(this.accept=$.isFunction(value)?value:function(d){return d.is(value)}),$.Widget.prototype._setOption.apply(this,arguments)},_activate:function(event){var draggable=$.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),draggable&&this._trigger(\"activate\",event,this.ui(draggable))},_deactivate:function(event){var draggable=$.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),draggable&&this._trigger(\"deactivate\",event,this.ui(draggable))},_over:function(event){var draggable=$.ui.ddmanager.current;draggable&&(draggable.currentItem||draggable.element)[0]!==this.element[0]&&this.accept.call(this.element[0],draggable.currentItem||draggable.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger(\"over\",event,this.ui(draggable)))},_out:function(event){var draggable=$.ui.ddmanager.current;draggable&&(draggable.currentItem||draggable.element)[0]!==this.element[0]&&this.accept.call(this.element[0],draggable.currentItem||draggable.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger(\"out\",event,this.ui(draggable)))},_drop:function(event,custom){var draggable=custom||$.ui.ddmanager.current,childrenIntersection=!1;return!(!draggable||(draggable.currentItem||draggable.element)[0]===this.element[0])&&(this.element.find(\":data(ui-droppable)\").not(\".ui-draggable-dragging\").each(function(){var inst=$.data(this,\"ui-droppable\");if(inst.options.greedy&&!inst.options.disabled&&inst.options.scope===draggable.options.scope&&inst.accept.call(inst.element[0],draggable.currentItem||draggable.element)&&$.ui.intersect(draggable,$.extend(inst,{offset:inst.element.offset()}),inst.options.tolerance))return childrenIntersection=!0,!1}),!childrenIntersection&&(!!this.accept.call(this.element[0],draggable.currentItem||draggable.element)&&(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger(\"drop\",event,this.ui(draggable)),this.element)))},ui:function(c){return{draggable:c.currentItem||c.element,helper:c.helper,position:c.position,offset:c.positionAbs}}}),$.ui.intersect=function(draggable,droppable,toleranceMode){if(!droppable.offset)return!1;var draggableLeft,x1=(draggable.positionAbs||draggable.position.absolute).left,y1=(draggable.positionAbs||draggable.position.absolute).top,x2=x1+draggable.helperProportions.width,y2=y1+draggable.helperProportions.height,l=droppable.offset.left,t=droppable.offset.top,r=l+droppable.proportions().width,b=t+droppable.proportions().height;switch(toleranceMode){case\"fit\":return l<=x1&&x2<=r&&t<=y1&&y2<=b;case\"intersect\":return l<x1+draggable.helperProportions.width/2&&x2-draggable.helperProportions.width/2<r&&t<y1+draggable.helperProportions.height/2&&y2-draggable.helperProportions.height/2<b;case\"pointer\":return draggableLeft=(draggable.positionAbs||draggable.position.absolute).left+(draggable.clickOffset||draggable.offset.click).left,isOverAxis((draggable.positionAbs||draggable.position.absolute).top+(draggable.clickOffset||draggable.offset.click).top,t,droppable.proportions().height)&&isOverAxis(draggableLeft,l,droppable.proportions().width);case\"touch\":return(y1>=t&&y1<=b||y2>=t&&y2<=b||y1<t&&y2>b)&&(x1>=l&&x1<=r||x2>=l&&x2<=r||x1<l&&x2>r);default:return!1}},$.ui.ddmanager={current:null,droppables:{default:[]},prepareOffsets:function(t,event){var i,j,m=$.ui.ddmanager.droppables[t.options.scope]||[],type=event?event.type:null,list=(t.currentItem||t.element).find(\":data(ui-droppable)\").addBack();droppablesLoop:for(i=0;i<m.length;i++)if(!(m[i].options.disabled||t&&!m[i].accept.call(m[i].element[0],t.currentItem||t.element))){for(j=0;j<list.length;j++)if(list[j]===m[i].element[0]){m[i].proportions().height=0;continue droppablesLoop}m[i].visible=\"none\"!==m[i].element.css(\"display\"),m[i].visible&&(\"mousedown\"===type&&m[i]._activate.call(m[i],event),m[i].offset=m[i].element.offset(),m[i].proportions({width:m[i].element[0].offsetWidth,height:m[i].element[0].offsetHeight}))}},drop:function(draggable,event){var dropped=!1;return $.each(($.ui.ddmanager.droppables[draggable.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&$.ui.intersect(draggable,this,this.options.tolerance)&&(dropped=this._drop.call(this,event)||dropped),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],draggable.currentItem||draggable.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,event)))}),dropped},dragStart:function(draggable,event){draggable.element.parentsUntil(\"body\").bind(\"scroll.droppable\",function(){draggable.options.refreshPositions||$.ui.ddmanager.prepareOffsets(draggable,event)})},drag:function(draggable,event){draggable.options.refreshPositions&&$.ui.ddmanager.prepareOffsets(draggable,event),$.each($.ui.ddmanager.droppables[draggable.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var parentInstance,scope,parent,intersects=$.ui.intersect(draggable,this,this.options.tolerance),c=!intersects&&this.isover?\"isout\":intersects&&!this.isover?\"isover\":null;c&&(this.options.greedy&&(scope=this.options.scope,(parent=this.element.parents(\":data(ui-droppable)\").filter(function(){return $.data(this,\"ui-droppable\").options.scope===scope})).length&&((parentInstance=$.data(parent[0],\"ui-droppable\")).greedyChild=\"isover\"===c)),parentInstance&&\"isover\"===c&&(parentInstance.isover=!1,parentInstance.isout=!0,parentInstance._out.call(parentInstance,event)),this[c]=!0,this[\"isout\"===c?\"isover\":\"isout\"]=!1,this[\"isover\"===c?\"_over\":\"_out\"].call(this,event),parentInstance&&\"isout\"===c&&(parentInstance.isout=!1,parentInstance.isover=!0,parentInstance._over.call(parentInstance,event)))}})},dragStop:function(draggable,event){draggable.element.parentsUntil(\"body\").unbind(\"scroll.droppable\"),draggable.options.refreshPositions||$.ui.ddmanager.prepareOffsets(draggable,event)}}}(jQuery),function($,undefined){function isOverAxis(x,reference,size){return x>reference&&x<reference+size}function isFloating(item){return/left|right/.test(item.css(\"float\"))||/inline|table-cell/.test(item.css(\"display\"))}$.widget(\"ui.sortable\",$.ui.mouse,{version:\"@VERSION\",widgetEventPrefix:\"sort\",ready:!1,options:{appendTo:\"parent\",axis:!1,connectWith:!1,containment:!1,cursor:\"auto\",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:\"original\",items:\"> *\",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:\"default\",tolerance:\"intersect\",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var o=this.options;this.containerCache={},this.element.addClass(\"ui-sortable\"),this.refresh(),this.floating=!!this.items.length&&(\"x\"===o.axis||isFloating(this.items[0].item)),this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass(\"ui-sortable ui-sortable-disabled\"),this._mouseDestroy();for(var i=this.items.length-1;i>=0;i--)this.items[i].item.removeData(this.widgetName+\"-item\");return this},_setOption:function(key,value){\"disabled\"===key?(this.options[key]=value,this.widget().toggleClass(\"ui-sortable-disabled\",!!value)):$.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(event,overrideHandle){var currentItem=null,validHandle=!1,that=this;return!this.reverting&&(!this.options.disabled&&\"static\"!==this.options.type&&(this._refreshItems(event),$(event.target).parents().each(function(){if($.data(this,that.widgetName+\"-item\")===that)return currentItem=$(this),!1}),$.data(event.target,that.widgetName+\"-item\")===that&&(currentItem=$(event.target)),!!currentItem&&(!(this.options.handle&&!overrideHandle&&($(this.options.handle,currentItem).find(\"*\").addBack().each(function(){this===event.target&&(validHandle=!0)}),!validHandle))&&(this.currentItem=currentItem,this._removeCurrentsFromItems(),!0))))},_mouseStart:function(event,overrideHandle,noActivation){var i,body,o=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(event),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css(\"position\",\"absolute\"),this.cssPosition=this.helper.css(\"position\"),this.originalPosition=this._generatePosition(event),this.originalPageX=event.pageX,this.originalPageY=event.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),o.containment&&this._setContainment(),o.cursor&&\"auto\"!==o.cursor&&(body=this.document.find(\"body\"),this.storedCursor=body.css(\"cursor\"),body.css(\"cursor\",o.cursor),this.storedStylesheet=$(\"<style>*{ cursor: \"+o.cursor+\" !important; }</style>\").appendTo(body)),o.opacity&&(this.helper.css(\"opacity\")&&(this._storedOpacity=this.helper.css(\"opacity\")),this.helper.css(\"opacity\",o.opacity)),o.zIndex&&(this.helper.css(\"zIndex\")&&(this._storedZIndex=this.helper.css(\"zIndex\")),this.helper.css(\"zIndex\",o.zIndex)),this.scrollParent[0]!==document&&\"HTML\"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger(\"start\",event,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!noActivation)for(i=this.containers.length-1;i>=0;i--)this.containers[i]._trigger(\"activate\",event,this._uiHash(this));return $.ui.ddmanager&&($.ui.ddmanager.current=this),$.ui.ddmanager&&!o.dropBehaviour&&$.ui.ddmanager.prepareOffsets(this,event),this.dragging=!0,this.helper.addClass(\"ui-sortable-helper\"),this._mouseDrag(event),!0},_mouseDrag:function(event){var i,item,itemElement,intersection,o=this.options,scrolled=!1;for(this.position=this._generatePosition(event),this.positionAbs=this._convertPositionTo(\"absolute\"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&\"HTML\"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-event.pageY<o.scrollSensitivity?this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop+o.scrollSpeed:event.pageY-this.overflowOffset.top<o.scrollSensitivity&&(this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop-o.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-event.pageX<o.scrollSensitivity?this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft+o.scrollSpeed:event.pageX-this.overflowOffset.left<o.scrollSensitivity&&(this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft-o.scrollSpeed)):(event.pageY-$(document).scrollTop()<o.scrollSensitivity?scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed):$(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity&&(scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed)),event.pageX-$(document).scrollLeft()<o.scrollSensitivity?scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed):$(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity&&(scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed))),!1!==scrolled&&$.ui.ddmanager&&!o.dropBehaviour&&$.ui.ddmanager.prepareOffsets(this,event)),this.positionAbs=this._convertPositionTo(\"absolute\"),this.options.axis&&\"y\"===this.options.axis||(this.helper[0].style.left=this.position.left+\"px\"),this.options.axis&&\"x\"===this.options.axis||(this.helper[0].style.top=this.position.top+\"px\"),i=this.items.length-1;i>=0;i--)if(itemElement=(item=this.items[i]).item[0],(intersection=this._intersectsWithPointer(item))&&item.instance===this.currentContainer&&!(itemElement===this.currentItem[0]||this.placeholder[1===intersection?\"next\":\"prev\"]()[0]===itemElement||$.contains(this.placeholder[0],itemElement)||\"semi-dynamic\"===this.options.type&&$.contains(this.element[0],itemElement))){if(this.direction=1===intersection?\"down\":\"up\",\"pointer\"!==this.options.tolerance&&!this._intersectsWithSides(item))break;this._rearrange(event,item),this._trigger(\"change\",event,this._uiHash());break}return this._contactContainers(event),$.ui.ddmanager&&$.ui.ddmanager.drag(this,event),this._trigger(\"sort\",event,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(event,noPropagation){if(event){if($.ui.ddmanager&&!this.options.dropBehaviour&&$.ui.ddmanager.drop(this,event),this.options.revert){var that=this,cur=this.placeholder.offset(),axis=this.options.axis,animation={};axis&&\"x\"!==axis||(animation.left=cur.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),axis&&\"y\"!==axis||(animation.top=cur.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,$(this.helper).animate(animation,parseInt(this.options.revert,10)||500,function(){that._clear(event)})}else this._clear(event,noPropagation);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),\"original\"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass(\"ui-sortable-helper\"):this.currentItem.show();for(var i=this.containers.length-1;i>=0;i--)this.containers[i]._trigger(\"deactivate\",null,this._uiHash(this)),this.containers[i].containerCache.over&&(this.containers[i]._trigger(\"out\",null,this._uiHash(this)),this.containers[i].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),\"original\"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),$.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?$(this.domPosition.prev).after(this.currentItem):$(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(o){var items=this._getItemsAsjQuery(o&&o.connected),str=[];return o=o||{},$(items).each(function(){var res=($(o.item||this).attr(o.attribute||\"id\")||\"\").match(o.expression||/(.+)[\\-=_](.+)/);res&&str.push((o.key||res[1]+\"[]\")+\"=\"+(o.key&&o.expression?res[1]:res[2]))}),!str.length&&o.key&&str.push(o.key+\"=\"),str.join(\"&\")},toArray:function(o){var items=this._getItemsAsjQuery(o&&o.connected),ret=[];return o=o||{},items.each(function(){ret.push($(o.item||this).attr(o.attribute||\"id\")||\"\")}),ret},_intersectsWith:function(item){var x1=this.positionAbs.left,x2=x1+this.helperProportions.width,y1=this.positionAbs.top,y2=y1+this.helperProportions.height,l=item.left,r=l+item.width,t=item.top,b=t+item.height,dyClick=this.offset.click.top,dxClick=this.offset.click.left,isOverElementHeight=\"x\"===this.options.axis||y1+dyClick>t&&y1+dyClick<b,isOverElementWidth=\"y\"===this.options.axis||x1+dxClick>l&&x1+dxClick<r,isOverElement=isOverElementHeight&&isOverElementWidth;return\"pointer\"===this.options.tolerance||this.options.forcePointerForContainers||\"pointer\"!==this.options.tolerance&&this.helperProportions[this.floating?\"width\":\"height\"]>item[this.floating?\"width\":\"height\"]?isOverElement:l<x1+this.helperProportions.width/2&&x2-this.helperProportions.width/2<r&&t<y1+this.helperProportions.height/2&&y2-this.helperProportions.height/2<b},_intersectsWithPointer:function(item){var isOverElementHeight=\"x\"===this.options.axis||isOverAxis(this.positionAbs.top+this.offset.click.top,item.top,item.height),isOverElementWidth=\"y\"===this.options.axis||isOverAxis(this.positionAbs.left+this.offset.click.left,item.left,item.width),isOverElement=isOverElementHeight&&isOverElementWidth,verticalDirection=this._getDragVerticalDirection(),horizontalDirection=this._getDragHorizontalDirection();return!!isOverElement&&(this.floating?horizontalDirection&&\"right\"===horizontalDirection||\"down\"===verticalDirection?2:1:verticalDirection&&(\"down\"===verticalDirection?2:1))},_intersectsWithSides:function(item){var isOverBottomHalf=isOverAxis(this.positionAbs.top+this.offset.click.top,item.top+item.height/2,item.height),isOverRightHalf=isOverAxis(this.positionAbs.left+this.offset.click.left,item.left+item.width/2,item.width),verticalDirection=this._getDragVerticalDirection(),horizontalDirection=this._getDragHorizontalDirection();return this.floating&&horizontalDirection?\"right\"===horizontalDirection&&isOverRightHalf||\"left\"===horizontalDirection&&!isOverRightHalf:verticalDirection&&(\"down\"===verticalDirection&&isOverBottomHalf||\"up\"===verticalDirection&&!isOverBottomHalf)},_getDragVerticalDirection:function(){var delta=this.positionAbs.top-this.lastPositionAbs.top;return 0!==delta&&(delta>0?\"down\":\"up\")},_getDragHorizontalDirection:function(){var delta=this.positionAbs.left-this.lastPositionAbs.left;return 0!==delta&&(delta>0?\"right\":\"left\")},refresh:function(event){return this._refreshItems(event),this.refreshPositions(),this},_connectWith:function(){var options=this.options;return options.connectWith.constructor===String?[options.connectWith]:options.connectWith},_getItemsAsjQuery:function(connected){var i,j,cur,inst,items=[],queries=[],connectWith=this._connectWith();if(connectWith&&connected)for(i=connectWith.length-1;i>=0;i--)for(j=(cur=$(connectWith[i])).length-1;j>=0;j--)(inst=$.data(cur[j],this.widgetFullName))&&inst!==this&&!inst.options.disabled&&queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element):$(inst.options.items,inst.element).not(\".ui-sortable-helper\").not(\".ui-sortable-placeholder\"),inst]);function addItems(){items.push(this)}for(queries.push([$.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):$(this.options.items,this.element).not(\".ui-sortable-helper\").not(\".ui-sortable-placeholder\"),this]),i=queries.length-1;i>=0;i--)queries[i][0].each(addItems);return $(items)},_removeCurrentsFromItems:function(){var list=this.currentItem.find(\":data(\"+this.widgetName+\"-item)\");this.items=$.grep(this.items,function(item){for(var j=0;j<list.length;j++)if(list[j]===item.item[0])return!1;return!0})},_refreshItems:function(event){this.items=[],this.containers=[this];var i,j,cur,inst,targetData,_queries,item,queriesLength,items=this.items,queries=[[$.isFunction(this.options.items)?this.options.items.call(this.element[0],event,{item:this.currentItem}):$(this.options.items,this.element),this]],connectWith=this._connectWith();if(connectWith&&this.ready)for(i=connectWith.length-1;i>=0;i--)for(j=(cur=$(connectWith[i])).length-1;j>=0;j--)(inst=$.data(cur[j],this.widgetFullName))&&inst!==this&&!inst.options.disabled&&(queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element[0],event,{item:this.currentItem}):$(inst.options.items,inst.element),inst]),this.containers.push(inst));for(i=queries.length-1;i>=0;i--)for(targetData=queries[i][1],j=0,queriesLength=(_queries=queries[i][0]).length;j<queriesLength;j++)(item=$(_queries[j])).data(this.widgetName+\"-item\",targetData),items.push({item:item,instance:targetData,width:0,height:0,left:0,top:0})},refreshPositions:function(fast){var i,item,t,p;for(this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset()),i=this.items.length-1;i>=0;i--)(item=this.items[i]).instance!==this.currentContainer&&this.currentContainer&&item.item[0]!==this.currentItem[0]||(t=this.options.toleranceElement?$(this.options.toleranceElement,item.item):item.item,fast||(item.width=t.outerWidth(),item.height=t.outerHeight()),p=t.offset(),item.left=p.left,item.top=p.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)p=this.containers[i].element.offset(),this.containers[i].containerCache.left=p.left,this.containers[i].containerCache.top=p.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(that){var className,o=(that=that||this).options;o.placeholder&&o.placeholder.constructor!==String||(className=o.placeholder,o.placeholder={element:function(){var nodeName=that.currentItem[0].nodeName.toLowerCase(),element=$(\"<\"+nodeName+\">\",that.document[0]).addClass(className||that.currentItem[0].className+\" ui-sortable-placeholder\").removeClass(\"ui-sortable-helper\");return\"tr\"===nodeName?that.currentItem.children().each(function(){$(\"<td>&#160;</td>\",that.document[0]).attr(\"colspan\",$(this).attr(\"colspan\")||1).appendTo(element)}):\"img\"===nodeName&&element.attr(\"src\",that.currentItem.attr(\"src\")),className||element.css(\"visibility\",\"hidden\"),element},update:function(container,p){className&&!o.forcePlaceholderSize||(p.height()||p.height(that.currentItem.innerHeight()-parseInt(that.currentItem.css(\"paddingTop\")||0,10)-parseInt(that.currentItem.css(\"paddingBottom\")||0,10)),p.width()||p.width(that.currentItem.innerWidth()-parseInt(that.currentItem.css(\"paddingLeft\")||0,10)-parseInt(that.currentItem.css(\"paddingRight\")||0,10)))}}),that.placeholder=$(o.placeholder.element.call(that.element,that.currentItem)),that.currentItem.after(that.placeholder),o.placeholder.update(that,that.placeholder)},_contactContainers:function(event){var i,j,dist,itemWithLeastDistance,posProperty,sizeProperty,base,cur,nearBottom,floating,innermostContainer=null,innermostIndex=null;for(i=this.containers.length-1;i>=0;i--)if(!$.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(innermostContainer&&$.contains(this.containers[i].element[0],innermostContainer.element[0]))continue;innermostContainer=this.containers[i],innermostIndex=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger(\"out\",event,this._uiHash(this)),this.containers[i].containerCache.over=0);if(innermostContainer)if(1===this.containers.length)this.containers[innermostIndex].containerCache.over||(this.containers[innermostIndex]._trigger(\"over\",event,this._uiHash(this)),this.containers[innermostIndex].containerCache.over=1);else{for(dist=1e4,itemWithLeastDistance=null,posProperty=(floating=innermostContainer.floating||isFloating(this.currentItem))?\"left\":\"top\",sizeProperty=floating?\"width\":\"height\",base=this.positionAbs[posProperty]+this.offset.click[posProperty],j=this.items.length-1;j>=0;j--)$.contains(this.containers[innermostIndex].element[0],this.items[j].item[0])&&this.items[j].item[0]!==this.currentItem[0]&&(floating&&!isOverAxis(this.positionAbs.top+this.offset.click.top,this.items[j].top,this.items[j].height)||(cur=this.items[j].item.offset()[posProperty],nearBottom=!1,Math.abs(cur-base)>Math.abs(cur+this.items[j][sizeProperty]-base)&&(nearBottom=!0,cur+=this.items[j][sizeProperty]),Math.abs(cur-base)<dist&&(dist=Math.abs(cur-base),itemWithLeastDistance=this.items[j],this.direction=nearBottom?\"up\":\"down\")));if(!itemWithLeastDistance&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[innermostIndex])return;itemWithLeastDistance?this._rearrange(event,itemWithLeastDistance,null,!0):this._rearrange(event,null,this.containers[innermostIndex].element,!0),this._trigger(\"change\",event,this._uiHash()),this.containers[innermostIndex]._trigger(\"change\",event,this._uiHash(this)),this.currentContainer=this.containers[innermostIndex],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[innermostIndex]._trigger(\"over\",event,this._uiHash(this)),this.containers[innermostIndex].containerCache.over=1}},_createHelper:function(event){var o=this.options,helper=$.isFunction(o.helper)?$(o.helper.apply(this.element[0],[event,this.currentItem])):\"clone\"===o.helper?this.currentItem.clone():this.currentItem;return helper.parents(\"body\").length||$(\"parent\"!==o.appendTo?o.appendTo:this.currentItem[0].parentNode)[0].appendChild(helper[0]),helper[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css(\"position\"),top:this.currentItem.css(\"top\"),left:this.currentItem.css(\"left\")}),helper[0].style.width&&!o.forceHelperSize||helper.width(this.currentItem.width()),helper[0].style.height&&!o.forceHelperSize||helper.height(this.currentItem.height()),helper},_adjustOffsetFromHelper:function(obj){\"string\"==typeof obj&&(obj=obj.split(\" \")),$.isArray(obj)&&(obj={left:+obj[0],top:+obj[1]||0}),\"left\"in obj&&(this.offset.click.left=obj.left+this.margins.left),\"right\"in obj&&(this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left),\"top\"in obj&&(this.offset.click.top=obj.top+this.margins.top),\"bottom\"in obj&&(this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var po=this.offsetParent.offset();return\"absolute\"===this.cssPosition&&this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0])&&(po.left+=this.scrollParent.scrollLeft(),po.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&\"html\"===this.offsetParent[0].tagName.toLowerCase()&&$.ui.ie)&&(po={top:0,left:0}),{top:po.top+(parseInt(this.offsetParent.css(\"borderTopWidth\"),10)||0),left:po.left+(parseInt(this.offsetParent.css(\"borderLeftWidth\"),10)||0)}},_getRelativeOffset:function(){if(\"relative\"===this.cssPosition){var p=this.currentItem.position();return{top:p.top-(parseInt(this.helper.css(\"top\"),10)||0)+this.scrollParent.scrollTop(),left:p.left-(parseInt(this.helper.css(\"left\"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css(\"marginLeft\"),10)||0,top:parseInt(this.currentItem.css(\"marginTop\"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var ce,co,over,o=this.options;\"parent\"===o.containment&&(o.containment=this.helper[0].parentNode),\"document\"!==o.containment&&\"window\"!==o.containment||(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,$(\"document\"===o.containment?document:window).width()-this.helperProportions.width-this.margins.left,($(\"document\"===o.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(o.containment)||(ce=$(o.containment)[0],co=$(o.containment).offset(),over=\"hidden\"!==$(ce).css(\"overflow\"),this.containment=[co.left+(parseInt($(ce).css(\"borderLeftWidth\"),10)||0)+(parseInt($(ce).css(\"paddingLeft\"),10)||0)-this.margins.left,co.top+(parseInt($(ce).css(\"borderTopWidth\"),10)||0)+(parseInt($(ce).css(\"paddingTop\"),10)||0)-this.margins.top,co.left+(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-(parseInt($(ce).css(\"borderLeftWidth\"),10)||0)-(parseInt($(ce).css(\"paddingRight\"),10)||0)-this.helperProportions.width-this.margins.left,co.top+(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-(parseInt($(ce).css(\"borderTopWidth\"),10)||0)-(parseInt($(ce).css(\"paddingBottom\"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(d,pos){pos||(pos=this.position);var mod=\"absolute\"===d?1:-1,scroll=\"absolute\"!==this.cssPosition||this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,scrollIsRootNode=/(html|body)/i.test(scroll[0].tagName);return{top:pos.top+this.offset.relative.top*mod+this.offset.parent.top*mod-(\"fixed\"===this.cssPosition?-this.scrollParent.scrollTop():scrollIsRootNode?0:scroll.scrollTop())*mod,left:pos.left+this.offset.relative.left*mod+this.offset.parent.left*mod-(\"fixed\"===this.cssPosition?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())*mod}},_generatePosition:function(event){var top,left,o=this.options,pageX=event.pageX,pageY=event.pageY,scroll=\"absolute\"!==this.cssPosition||this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,scrollIsRootNode=/(html|body)/i.test(scroll[0].tagName);return\"relative\"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(event.pageX-this.offset.click.left<this.containment[0]&&(pageX=this.containment[0]+this.offset.click.left),event.pageY-this.offset.click.top<this.containment[1]&&(pageY=this.containment[1]+this.offset.click.top),event.pageX-this.offset.click.left>this.containment[2]&&(pageX=this.containment[2]+this.offset.click.left),event.pageY-this.offset.click.top>this.containment[3]&&(pageY=this.containment[3]+this.offset.click.top)),o.grid&&(top=this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1],pageY=this.containment?top-this.offset.click.top>=this.containment[1]&&top-this.offset.click.top<=this.containment[3]?top:top-this.offset.click.top>=this.containment[1]?top-o.grid[1]:top+o.grid[1]:top,left=this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0],pageX=this.containment?left-this.offset.click.left>=this.containment[0]&&left-this.offset.click.left<=this.containment[2]?left:left-this.offset.click.left>=this.containment[0]?left-o.grid[0]:left+o.grid[0]:left)),{top:pageY-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(\"fixed\"===this.cssPosition?-this.scrollParent.scrollTop():scrollIsRootNode?0:scroll.scrollTop()),left:pageX-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(\"fixed\"===this.cssPosition?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())}},_rearrange:function(event,i,a,hardRefresh){a?a[0].appendChild(this.placeholder[0]):i.item[0].parentNode.insertBefore(this.placeholder[0],\"down\"===this.direction?i.item[0]:i.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var counter=this.counter;this._delay(function(){counter===this.counter&&this.refreshPositions(!hardRefresh)})},_clear:function(event,noPropagation){this.reverting=!1;var i,delayedTriggers=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(i in this._storedCSS)\"auto\"!==this._storedCSS[i]&&\"static\"!==this._storedCSS[i]||(this._storedCSS[i]=\"\");this.currentItem.css(this._storedCSS).removeClass(\"ui-sortable-helper\")}else this.currentItem.show();function delayEvent(type,instance,container){return function(event){container._trigger(type,event,instance._uiHash(instance))}}for(this.fromOutside&&!noPropagation&&delayedTriggers.push(function(event){this._trigger(\"receive\",event,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(\".ui-sortable-helper\")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||noPropagation||delayedTriggers.push(function(event){this._trigger(\"update\",event,this._uiHash())}),this!==this.currentContainer&&(noPropagation||(delayedTriggers.push(function(event){this._trigger(\"remove\",event,this._uiHash())}),delayedTriggers.push(function(c){return function(event){c._trigger(\"receive\",event,this._uiHash(this))}}.call(this,this.currentContainer)),delayedTriggers.push(function(c){return function(event){c._trigger(\"update\",event,this._uiHash(this))}}.call(this,this.currentContainer)))),i=this.containers.length-1;i>=0;i--)noPropagation||delayedTriggers.push(delayEvent(\"deactivate\",this,this.containers[i])),this.containers[i].containerCache.over&&(delayedTriggers.push(delayEvent(\"out\",this,this.containers[i])),this.containers[i].containerCache.over=0);if(this.storedCursor&&(this.document.find(\"body\").css(\"cursor\",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css(\"opacity\",this._storedOpacity),this._storedZIndex&&this.helper.css(\"zIndex\",\"auto\"===this._storedZIndex?\"\":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!noPropagation){for(this._trigger(\"beforeStop\",event,this._uiHash()),i=0;i<delayedTriggers.length;i++)delayedTriggers[i].call(this,event);this._trigger(\"stop\",event,this._uiHash())}return this.fromOutside=!1,!1}if(noPropagation||this._trigger(\"beforeStop\",event,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!noPropagation){for(i=0;i<delayedTriggers.length;i++)delayedTriggers[i].call(this,event);this._trigger(\"stop\",event,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){!1===$.Widget.prototype._trigger.apply(this,arguments)&&this.cancel()},_uiHash:function(_inst){var inst=_inst||this;return{helper:inst.helper,placeholder:inst.placeholder||$([]),position:inst.position,originalPosition:inst.originalPosition,offset:inst.positionAbs,item:inst.currentItem,sender:_inst?_inst.element:null}}})}(jQuery),function($){if($.support.touch=\"ontouchend\"in document,$.support.touch){var touchHandled,mouseProto=$.ui.mouse.prototype,_mouseInit=mouseProto._mouseInit,_mouseDestroy=mouseProto._mouseDestroy;mouseProto._touchStart=function(event){!touchHandled&&this._mouseCapture(event.originalEvent.changedTouches[0])&&(touchHandled=!0,this._touchMoved=!1,simulateMouseEvent(event,\"mouseover\"),simulateMouseEvent(event,\"mousemove\"),simulateMouseEvent(event,\"mousedown\"))},mouseProto._touchMove=function(event){touchHandled&&(this._touchMoved=!0,simulateMouseEvent(event,\"mousemove\"))},mouseProto._touchEnd=function(event){touchHandled&&(simulateMouseEvent(event,\"mouseup\"),simulateMouseEvent(event,\"mouseout\"),this._touchMoved||simulateMouseEvent(event,\"click\"),touchHandled=!1)},mouseProto._mouseInit=function(){this.element.bind({touchstart:$.proxy(this,\"_touchStart\"),touchmove:$.proxy(this,\"_touchMove\"),touchend:$.proxy(this,\"_touchEnd\")}),_mouseInit.call(this)},mouseProto._mouseDestroy=function(){this.element.unbind({touchstart:$.proxy(this,\"_touchStart\"),touchmove:$.proxy(this,\"_touchMove\"),touchend:$.proxy(this,\"_touchEnd\")}),_mouseDestroy.call(this)}}function simulateMouseEvent(event,simulatedType){if(!(event.originalEvent.touches.length>1)){event.preventDefault();var touch=event.originalEvent.changedTouches[0],simulatedEvent=document.createEvent(\"MouseEvents\");simulatedEvent.initMouseEvent(simulatedType,!0,!0,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,!1,!1,!1,!1,0,null),event.target.dispatchEvent(simulatedEvent)}}}(jQuery),function(window,document,undefined){!function(factory){\"use strict\";\"function\"==typeof define&&define.amd?define([\"jquery\"],factory):jQuery&&!jQuery.fn.qtip&&factory(jQuery)}(function($){\"use strict\";var QTIP,PROTOTYPE,CORNER,CHECKS,trackingBound,TRUE=!0,FALSE=!1,NULL=null,X=\"x\",Y=\"y\",WIDTH=\"width\",TOP=\"top\",LEFT=\"left\",RIGHT=\"right\",CENTER=\"center\",FLIPINVERT=\"flipinvert\",SHIFT=\"shift\",PLUGINS={},NAMESPACE=\"qtip\",ATTR_HAS=\"data-hasqtip\",ATTR_ID=\"data-qtip-id\",WIDGET=[\"ui-widget\",\"ui-tooltip\"],SELECTOR=\".\"+NAMESPACE,INACTIVE_EVENTS=\"click dblclick mousedown mouseup mousemove mouseleave mouseenter\".split(\" \"),CLASS_FIXED=NAMESPACE+\"-fixed\",CLASS_DEFAULT=NAMESPACE+\"-default\",CLASS_FOCUS=NAMESPACE+\"-focus\",CLASS_HOVER=NAMESPACE+\"-hover\",CLASS_DISABLED=NAMESPACE+\"-disabled\",oldtitle=\"oldtitle\",BROWSER={ie:function(){for(var v=4,i=document.createElement(\"div\");(i.innerHTML=\"\\x3c!--[if gt IE \"+v+\"]><i></i><![endif]--\\x3e\")&&i.getElementsByTagName(\"i\")[0];v+=1);return v>4?v:NaN}(),iOS:parseFloat((\"\"+(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,\"\"])[1]).replace(\"undefined\",\"3_2\").replace(\"_\",\".\").replace(\"_\",\"\"))||FALSE};function QTip(target,options,id,attr){this.id=id,this.target=target,this.tooltip=NULL,this.elements={target:target},this._id=NAMESPACE+\"-\"+id,this.timers={img:{}},this.options=options,this.plugins={},this.cache={event:{},target:$(),disabled:FALSE,attr:attr,onTooltip:FALSE,lastClass:\"\"},this.rendered=this.destroyed=this.disabled=this.waiting=this.hiddenDuringWait=this.positioning=this.triggering=FALSE}function invalidOpt(a){return a===NULL||\"object\"!==$.type(a)}function invalidContent(c){return!($.isFunction(c)||c&&c.attr||c.length||\"object\"===$.type(c)&&(c.jquery||c.then))}function sanitizeOptions(opts){var content,text,ajax,once;return invalidOpt(opts)?FALSE:(invalidOpt(opts.metadata)&&(opts.metadata={type:opts.metadata}),\"content\"in opts&&(invalidOpt(content=opts.content)||content.jquery||content.done?content=opts.content={text:text=invalidContent(content)?FALSE:content}:text=content.text,\"ajax\"in content&&(ajax=content.ajax,once=ajax&&ajax.once!==FALSE,delete content.ajax,content.text=function(event,api){var loading=text||$(this).attr(api.options.content.attr)||\"Loading...\",deferred=$.ajax($.extend({},ajax,{context:api})).then(ajax.success,NULL,ajax.error).then(function(content){return content&&once&&api.set(\"content.text\",content),content},function(xhr,status,error){api.destroyed||0===xhr.status||api.set(\"content.text\",status+\": \"+error)});return once?loading:(api.set(\"content.text\",loading),deferred)}),\"title\"in content&&($.isPlainObject(content.title)&&(content.button=content.title.button,content.title=content.title.text),invalidContent(content.title||FALSE)&&(content.title=FALSE))),\"position\"in opts&&invalidOpt(opts.position)&&(opts.position={my:opts.position,at:opts.position}),\"show\"in opts&&invalidOpt(opts.show)&&(opts.show=opts.show.jquery?{target:opts.show}:opts.show===TRUE?{ready:TRUE}:{event:opts.show}),\"hide\"in opts&&invalidOpt(opts.hide)&&(opts.hide=opts.hide.jquery?{target:opts.hide}:{event:opts.hide}),\"style\"in opts&&invalidOpt(opts.style)&&(opts.style={classes:opts.style}),$.each(PLUGINS,function(){this.sanitize&&this.sanitize(opts)}),opts)}function convertNotation(options,notation){for(var obj,i=0,option=options,levels=notation.split(\".\");option=option[levels[i++]];)i<levels.length&&(obj=option);return[obj||options,levels.pop()]}function setCallback(notation,args){var category,rule,match;for(category in this.checks)for(rule in this.checks[category])(match=new RegExp(rule,\"i\").exec(notation))&&(args.push(match),(\"builtin\"===category||this.plugins[category])&&this.checks[category][rule].apply(this.plugins[category]||this,args))}(PROTOTYPE=QTip.prototype)._when=function(deferreds){return $.when.apply($,deferreds)},PROTOTYPE.render=function(show){if(this.rendered||this.destroyed)return this;var self=this,options=this.options,cache=this.cache,elements=this.elements,text=options.content.text,title=options.content.title,button=options.content.button,posOptions=options.position,deferreds=(this._id,[]);return $.attr(this.target[0],\"aria-describedby\",this._id),cache.posClass=this._createPosClass((this.position={my:posOptions.my,at:posOptions.at}).my),this.tooltip=elements.tooltip=$(\"<div/>\",{id:this._id,class:[NAMESPACE,CLASS_DEFAULT,options.style.classes,cache.posClass].join(\" \"),width:options.style.width||\"\",height:options.style.height||\"\",tracking:\"mouse\"===posOptions.target&&posOptions.adjust.mouse,role:\"alert\",\"aria-live\":\"polite\",\"aria-atomic\":FALSE,\"aria-describedby\":this._id+\"-content\",\"aria-hidden\":TRUE}).toggleClass(CLASS_DISABLED,this.disabled).attr(ATTR_ID,this.id).data(NAMESPACE,this).appendTo(posOptions.container).append(elements.content=$(\"<div />\",{class:NAMESPACE+\"-content\",id:this._id+\"-content\",\"aria-atomic\":TRUE})),this.rendered=-1,this.positioning=TRUE,title&&(this._createTitle(),$.isFunction(title)||deferreds.push(this._updateTitle(title,FALSE))),button&&this._createButton(),$.isFunction(text)||deferreds.push(this._updateContent(text,FALSE)),this.rendered=TRUE,this._setWidget(),$.each(PLUGINS,function(name){var instance;\"render\"===this.initialize&&(instance=this(self))&&(self.plugins[name]=instance)}),this._unassignEvents(),this._assignEvents(),this._when(deferreds).then(function(){self._trigger(\"render\"),self.positioning=FALSE,self.hiddenDuringWait||!options.show.ready&&!show||self.toggle(TRUE,cache.event,FALSE),self.hiddenDuringWait=FALSE}),QTIP.api[this.id]=this,this},PROTOTYPE.destroy=function(immediate){if(this.destroyed)return this.target;function process(){if(!this.destroyed){this.destroyed=TRUE;var timer,target=this.target,title=target.attr(oldtitle);for(timer in this.rendered&&this.tooltip.stop(1,0).find(\"*\").remove().end().remove(),$.each(this.plugins,function(name){this.destroy&&this.destroy()}),this.timers)clearTimeout(this.timers[timer]);target.removeData(NAMESPACE).removeAttr(ATTR_ID).removeAttr(ATTR_HAS).removeAttr(\"aria-describedby\"),this.options.suppress&&title&&target.attr(\"title\",title).removeAttr(oldtitle),this._unassignEvents(),this.options=this.elements=this.cache=this.timers=this.plugins=this.mouse=NULL,delete QTIP.api[this.id]}}return immediate===TRUE&&\"hide\"!==this.triggering||!this.rendered?process.call(this):(this.tooltip.one(\"tooltiphidden\",$.proxy(process,this)),!this.triggering&&this.hide()),this.target},CHECKS=PROTOTYPE.checks={builtin:{\"^id$\":function(obj,o,v,prev){var id=v===TRUE?QTIP.nextid:v,new_id=NAMESPACE+\"-\"+id;id!==FALSE&&id.length>0&&!$(\"#\"+new_id).length?(this._id=new_id,this.rendered&&(this.tooltip[0].id=this._id,this.elements.content[0].id=this._id+\"-content\",this.elements.title[0].id=this._id+\"-title\")):obj[o]=prev},\"^prerender\":function(obj,o,v){v&&!this.rendered&&this.render(this.options.show.ready)},\"^content.text$\":function(obj,o,v){this._updateContent(v)},\"^content.attr$\":function(obj,o,v,prev){this.options.content.text===this.target.attr(prev)&&this._updateContent(this.target.attr(v))},\"^content.title$\":function(obj,o,v){if(!v)return this._removeTitle();v&&!this.elements.title&&this._createTitle(),this._updateTitle(v)},\"^content.button$\":function(obj,o,v){this._updateButton(v)},\"^content.title.(text|button)$\":function(obj,o,v){this.set(\"content.\"+o,v)},\"^position.(my|at)$\":function(obj,o,v){\"string\"==typeof v&&(this.position[o]=obj[o]=new CORNER(v,\"at\"===o))},\"^position.container$\":function(obj,o,v){this.rendered&&this.tooltip.appendTo(v)},\"^show.ready$\":function(obj,o,v){v&&(!this.rendered&&this.render(TRUE)||this.toggle(TRUE))},\"^style.classes$\":function(obj,o,v,p){this.rendered&&this.tooltip.removeClass(p).addClass(v)},\"^style.(width|height)\":function(obj,o,v){this.rendered&&this.tooltip.css(o,v)},\"^style.widget|content.title\":function(){this.rendered&&this._setWidget()},\"^style.def\":function(obj,o,v){this.rendered&&this.tooltip.toggleClass(CLASS_DEFAULT,!!v)},\"^events.(render|show|move|hide|focus|blur)$\":function(obj,o,v){this.rendered&&this.tooltip[($.isFunction(v)?\"\":\"un\")+\"bind\"](\"tooltip\"+o,v)},\"^(show|hide|position).(event|target|fixed|inactive|leave|distance|viewport|adjust)\":function(){if(this.rendered){var posOptions=this.options.position;this.tooltip.attr(\"tracking\",\"mouse\"===posOptions.target&&posOptions.adjust.mouse),this._unassignEvents(),this._assignEvents()}}}},PROTOTYPE.get=function(notation){if(this.destroyed)return this;var o=convertNotation(this.options,notation.toLowerCase()),result=o[0][o[1]];return result.precedance?result.string():result};var rmove=/^position\\.(my|at|adjust|target|container|viewport)|style|content|show\\.ready/i,rrender=/^prerender|show\\.ready/i;PROTOTYPE.set=function(option,value){if(this.destroyed)return this;var name,rendered=this.rendered,reposition=FALSE,options=this.options;this.checks;return\"string\"==typeof option?(name=option,(option={})[name]=value):option=$.extend({},option),$.each(option,function(notation,value){if(rendered&&rrender.test(notation))delete option[notation];else{var previous,obj=convertNotation(options,notation.toLowerCase());previous=obj[0][obj[1]],obj[0][obj[1]]=value&&value.nodeType?$(value):value,reposition=rmove.test(notation)||reposition,option[notation]=[obj[0],obj[1],value,previous]}}),sanitizeOptions(options),this.positioning=TRUE,$.each(option,$.proxy(setCallback,this)),this.positioning=FALSE,this.rendered&&this.tooltip[0].offsetWidth>0&&reposition&&this.reposition(\"mouse\"===options.position.target?NULL:this.cache.event),this},PROTOTYPE._update=function(content,element,reposition){var self=this,cache=this.cache;return this.rendered&&content?($.isFunction(content)&&(content=content.call(this.elements.target,cache.event,this)||\"\"),$.isFunction(content.then)?(cache.waiting=TRUE,content.then(function(c){return cache.waiting=FALSE,self._update(c,element)},NULL,function(e){return self._update(e,element)})):content===FALSE||!content&&\"\"!==content?FALSE:(content.jquery&&content.length>0?element.empty().append(content.css({display:\"block\",visibility:\"visible\"})):element.html(content),this._waitForContent(element).then(function(images){self.rendered&&self.tooltip[0].offsetWidth>0&&self.reposition(cache.event,!images.length)}))):FALSE},PROTOTYPE._waitForContent=function(element){var cache=this.cache;return cache.waiting=TRUE,($.fn.imagesLoaded?element.imagesLoaded():$.Deferred().resolve([])).done(function(){cache.waiting=FALSE}).promise()},PROTOTYPE._updateContent=function(content,reposition){this._update(content,this.elements.content,reposition)},PROTOTYPE._updateTitle=function(content,reposition){this._update(content,this.elements.title,reposition)===FALSE&&this._removeTitle(FALSE)},PROTOTYPE._createTitle=function(){var elements=this.elements,id=this._id+\"-title\";elements.titlebar&&this._removeTitle(),elements.titlebar=$(\"<div />\",{class:NAMESPACE+\"-titlebar \"+(this.options.style.widget?createWidgetClass(\"header\"):\"\")}).append(elements.title=$(\"<div />\",{id:id,class:NAMESPACE+\"-title\",\"aria-atomic\":TRUE})).insertBefore(elements.content).delegate(\".qtip-close\",\"mousedown keydown mouseup keyup mouseout\",function(event){$(this).toggleClass(\"ui-state-active ui-state-focus\",\"down\"===event.type.substr(-4))}).delegate(\".qtip-close\",\"mouseover mouseout\",function(event){$(this).toggleClass(\"ui-state-hover\",\"mouseover\"===event.type)}),this.options.content.button&&this._createButton()},PROTOTYPE._removeTitle=function(reposition){var elements=this.elements;elements.title&&(elements.titlebar.remove(),elements.titlebar=elements.title=elements.button=NULL,reposition!==FALSE&&this.reposition())},PROTOTYPE._createPosClass=function(my){return NAMESPACE+\"-pos-\"+(my||this.options.position.my).abbrev()},PROTOTYPE.reposition=function(event,effect){if(!this.rendered||this.positioning||this.destroyed)return this;this.positioning=TRUE;var pluginCalculations,offset,adjusted,newClass,cache=this.cache,tooltip=this.tooltip,posOptions=this.options.position,target=posOptions.target,my=posOptions.my,at=posOptions.at,viewport=posOptions.viewport,container=posOptions.container,adjust=posOptions.adjust,method=adjust.method.split(\" \"),tooltipWidth=tooltip.outerWidth(FALSE),tooltipHeight=tooltip.outerHeight(FALSE),targetWidth=0,targetHeight=0,type=tooltip.css(\"position\"),position={left:0,top:0},visible=tooltip[0].offsetWidth>0,isScroll=event&&\"scroll\"===event.type,win=$(window),doc=container[0].ownerDocument,mouse=this.mouse;if($.isArray(target)&&2===target.length)at={x:LEFT,y:TOP},position={left:target[0],top:target[1]};else if(\"mouse\"===target)at={x:LEFT,y:TOP},(!adjust.mouse||this.options.hide.distance)&&cache.origin&&cache.origin.pageX?event=cache.origin:!event||event&&(\"resize\"===event.type||\"scroll\"===event.type)?event=cache.event:mouse&&mouse.pageX&&(event=mouse),\"static\"!==type&&(position=container.offset()),doc.body.offsetWidth!==(window.innerWidth||doc.documentElement.clientWidth)&&(offset=$(document.body).offset()),position={left:event.pageX-position.left+(offset&&offset.left||0),top:event.pageY-position.top+(offset&&offset.top||0)},adjust.mouse&&isScroll&&mouse&&(position.left-=(mouse.scrollX||0)-win.scrollLeft(),position.top-=(mouse.scrollY||0)-win.scrollTop());else{if(\"event\"===target?event&&event.target&&\"scroll\"!==event.type&&\"resize\"!==event.type?cache.target=$(event.target):event.target||(cache.target=this.elements.target):\"event\"!==target&&(cache.target=$(target.jquery?target:this.elements.target)),target=cache.target,0===(target=$(target).eq(0)).length)return this;target[0]===document||target[0]===window?(targetWidth=BROWSER.iOS?window.innerWidth:target.width(),targetHeight=BROWSER.iOS?window.innerHeight:target.height(),target[0]===window&&(position={top:(viewport||target).scrollTop(),left:(viewport||target).scrollLeft()})):PLUGINS.imagemap&&target.is(\"area\")?pluginCalculations=PLUGINS.imagemap(this,target,at,PLUGINS.viewport?method:FALSE):PLUGINS.svg&&target&&target[0].ownerSVGElement?pluginCalculations=PLUGINS.svg(this,target,at,PLUGINS.viewport?method:FALSE):(targetWidth=target.outerWidth(FALSE),targetHeight=target.outerHeight(FALSE),position=target.offset()),pluginCalculations&&(targetWidth=pluginCalculations.width,targetHeight=pluginCalculations.height,offset=pluginCalculations.offset,position=pluginCalculations.position),position=this.reposition.offset(target,position,container),(BROWSER.iOS>3.1&&BROWSER.iOS<4.1||BROWSER.iOS>=4.3&&BROWSER.iOS<4.33||!BROWSER.iOS&&\"fixed\"===type)&&(position.left-=win.scrollLeft(),position.top-=win.scrollTop()),(!pluginCalculations||pluginCalculations&&pluginCalculations.adjustable!==FALSE)&&(position.left+=at.x===RIGHT?targetWidth:at.x===CENTER?targetWidth/2:0,position.top+=\"bottom\"===at.y?targetHeight:at.y===CENTER?targetHeight/2:0)}return position.left+=adjust.x+(my.x===RIGHT?-tooltipWidth:my.x===CENTER?-tooltipWidth/2:0),position.top+=adjust.y+(\"bottom\"===my.y?-tooltipHeight:my.y===CENTER?-tooltipHeight/2:0),PLUGINS.viewport?(adjusted=position.adjusted=PLUGINS.viewport(this,position,posOptions,targetWidth,targetHeight,tooltipWidth,tooltipHeight),offset&&adjusted.left&&(position.left+=offset.left),offset&&adjusted.top&&(position.top+=offset.top),adjusted.my&&(this.position.my=adjusted.my)):position.adjusted={left:0,top:0},cache.posClass!==(newClass=this._createPosClass(this.position.my))&&tooltip.removeClass(cache.posClass).addClass(cache.posClass=newClass),this._trigger(\"move\",[position,viewport.elem||viewport],event)?(delete position.adjusted,effect===FALSE||!visible||isNaN(position.left)||isNaN(position.top)||\"mouse\"===target||!$.isFunction(posOptions.effect)?tooltip.css(position):$.isFunction(posOptions.effect)&&(posOptions.effect.call(tooltip,this,$.extend({},position)),tooltip.queue(function(next){$(this).css({opacity:\"\",height:\"\"}),BROWSER.ie&&this.style.removeAttribute(\"filter\"),next()})),this.positioning=FALSE,this):this},PROTOTYPE.reposition.offset=function(elem,pos,container){if(!container[0])return pos;var scrolled,position,parentOffset,overflow,ownerDocument=$(elem[0].ownerDocument),quirks=!!BROWSER.ie&&\"CSS1Compat\"!==document.compatMode,parent=container[0];function scroll(e,i){pos.left+=i*e.scrollLeft(),pos.top+=i*e.scrollTop()}for(;\"static\"!==(position=$.css(parent,\"position\"))&&(\"fixed\"===position?(parentOffset=parent.getBoundingClientRect(),scroll(ownerDocument,-1)):((parentOffset=$(parent).position()).left+=parseFloat($.css(parent,\"borderLeftWidth\"))||0,parentOffset.top+=parseFloat($.css(parent,\"borderTopWidth\"))||0),pos.left-=parentOffset.left+(parseFloat($.css(parent,\"marginLeft\"))||0),pos.top-=parentOffset.top+(parseFloat($.css(parent,\"marginTop\"))||0),scrolled||\"hidden\"===(overflow=$.css(parent,\"overflow\"))||\"visible\"===overflow||(scrolled=$(parent))),parent=parent.offsetParent;);return scrolled&&(scrolled[0]!==ownerDocument[0]||quirks)&&scroll(scrolled,1),pos};var C=(CORNER=PROTOTYPE.reposition.Corner=function(corner,forceY){corner=(\"\"+corner).replace(/([A-Z])/,\" $1\").replace(/middle/gi,CENTER).toLowerCase(),this.x=(corner.match(/left|right/i)||corner.match(/center/)||[\"inherit\"])[0].toLowerCase(),this.y=(corner.match(/top|bottom|center/i)||[\"inherit\"])[0].toLowerCase(),this.forceY=!!forceY;var f=corner.charAt(0);this.precedance=\"t\"===f||\"b\"===f?Y:X}).prototype;function createWidgetClass(cls){return WIDGET.concat(\"\").join(cls?\"-\"+cls+\" \":\" \")}function delay(callback,duration){if(duration>0)return setTimeout($.proxy(callback,this),duration);callback.call(this)}function showMethod(event){this.tooltip.hasClass(CLASS_DISABLED)||(clearTimeout(this.timers.show),clearTimeout(this.timers.hide),this.timers.show=delay.call(this,function(){this.toggle(TRUE,event)},this.options.show.delay))}function hideMethod(event){if(!this.tooltip.hasClass(CLASS_DISABLED)&&!this.destroyed){var relatedTarget=$(event.relatedTarget),ontoTooltip=relatedTarget.closest(SELECTOR)[0]===this.tooltip[0],ontoTarget=relatedTarget[0]===this.options.show.target[0];if(clearTimeout(this.timers.show),clearTimeout(this.timers.hide),this!==relatedTarget[0]&&\"mouse\"===this.options.position.target&&ontoTooltip||this.options.hide.fixed&&/mouse(out|leave|move)/.test(event.type)&&(ontoTooltip||ontoTarget))try{event.preventDefault(),event.stopImmediatePropagation()}catch(e){}else this.timers.hide=delay.call(this,function(){this.toggle(FALSE,event)},this.options.hide.delay,this)}}function inactiveMethod(event){!this.tooltip.hasClass(CLASS_DISABLED)&&this.options.hide.inactive&&(clearTimeout(this.timers.inactive),this.timers.inactive=delay.call(this,function(){this.hide(event)},this.options.hide.inactive))}function repositionMethod(event){this.rendered&&this.tooltip[0].offsetWidth>0&&this.reposition(event)}function delegate(selector,events,method){$(document.body).delegate(selector,(events.split?events:events.join(\".\"+NAMESPACE+\" \"))+\".\"+NAMESPACE,function(){var api=QTIP.api[$.attr(this,ATTR_ID)];api&&!api.disabled&&method.apply(api,arguments)})}C.invert=function(z,center){this[z]=this[z]===LEFT?RIGHT:this[z]===RIGHT?LEFT:center||this[z]},C.string=function(join){var x=this.x,y=this.y,result=x!==y?\"center\"===x||\"center\"!==y&&(this.precedance===Y||this.forceY)?[y,x]:[x,y]:[x];return!1!==join?result.join(\" \"):result},C.abbrev=function(){var result=this.string(!1);return result[0].charAt(0)+(result[1]&&result[1].charAt(0)||\"\")},C.clone=function(){return new CORNER(this.string(),this.forceY)},PROTOTYPE.toggle=function(state,event){var cache=this.cache,options=this.options,tooltip=this.tooltip;if(event){if(/over|enter/.test(event.type)&&cache.event&&/out|leave/.test(cache.event.type)&&options.show.target.add(event.target).length===options.show.target.length&&tooltip.has(event.relatedTarget).length)return this;cache.event=$.event.fix(event)}if(this.waiting&&!state&&(this.hiddenDuringWait=TRUE),!this.rendered)return state?this.render(1):this;if(this.destroyed||this.disabled)return this;var identicalState,allow,after,type=state?\"show\":\"hide\",opts=this.options[type],posOptions=(this.options[state?\"hide\":\"show\"],this.options.position),contentOptions=this.options.content,width=this.tooltip.css(\"width\"),visible=this.tooltip.is(\":visible\"),animate=state||1===opts.target.length,sameTarget=!event||opts.target.length<2||cache.target[0]===event.target;return(typeof state).search(\"boolean|number\")&&(state=!visible),allow=(identicalState=!tooltip.is(\":animated\")&&visible===state&&sameTarget)?NULL:!!this._trigger(type,[90]),this.destroyed?this:(allow!==FALSE&&state&&this.focus(event),!allow||identicalState?this:($.attr(tooltip[0],\"aria-hidden\",!state),state?(this.mouse&&(cache.origin=$.event.fix(this.mouse)),$.isFunction(contentOptions.text)&&this._updateContent(contentOptions.text,FALSE),$.isFunction(contentOptions.title)&&this._updateTitle(contentOptions.title,FALSE),!trackingBound&&\"mouse\"===posOptions.target&&posOptions.adjust.mouse&&($(document).bind(\"mousemove.\"+NAMESPACE,this._storeMouse),trackingBound=TRUE),width||tooltip.css(\"width\",tooltip.outerWidth(FALSE)),this.reposition(event,arguments[2]),width||tooltip.css(\"width\",\"\"),opts.solo&&(\"string\"==typeof opts.solo?$(opts.solo):$(SELECTOR,opts.solo)).not(tooltip).not(opts.target).qtip(\"hide\",$.Event(\"tooltipsolo\"))):(clearTimeout(this.timers.show),delete cache.origin,trackingBound&&!$(SELECTOR+'[tracking=\"true\"]:visible',opts.solo).not(tooltip).length&&($(document).unbind(\"mousemove.\"+NAMESPACE),trackingBound=FALSE),this.blur(event)),after=$.proxy(function(){state?(BROWSER.ie&&tooltip[0].style.removeAttribute(\"filter\"),tooltip.css(\"overflow\",\"\"),\"string\"==typeof opts.autofocus&&$(this.options.show.autofocus,tooltip).focus(),this.options.show.target.trigger(\"qtip-\"+this.id+\"-inactive\")):tooltip.css({display:\"\",visibility:\"\",opacity:\"\",left:\"\",top:\"\"}),this._trigger(state?\"visible\":\"hidden\")},this),opts.effect===FALSE||animate===FALSE?(tooltip[type](),after()):$.isFunction(opts.effect)?(tooltip.stop(1,1),opts.effect.call(tooltip,this),tooltip.queue(\"fx\",function(n){after(),n()})):tooltip.fadeTo(90,state?1:0,after),state&&opts.target.trigger(\"qtip-\"+this.id+\"-inactive\"),this))},PROTOTYPE.show=function(event){return this.toggle(TRUE,event)},PROTOTYPE.hide=function(event){return this.toggle(FALSE,event)},PROTOTYPE.focus=function(event){if(!this.rendered||this.destroyed)return this;var qtips=$(SELECTOR),tooltip=this.tooltip,curIndex=parseInt(tooltip[0].style.zIndex,10),newIndex=QTIP.zindex+qtips.length;return tooltip.hasClass(CLASS_FOCUS)||this._trigger(\"focus\",[newIndex],event)&&(curIndex!==newIndex&&(qtips.each(function(){this.style.zIndex>curIndex&&(this.style.zIndex=this.style.zIndex-1)}),qtips.filter(\".\"+CLASS_FOCUS).qtip(\"blur\",event)),tooltip.addClass(CLASS_FOCUS)[0].style.zIndex=newIndex),this},PROTOTYPE.blur=function(event){return!this.rendered||this.destroyed?this:(this.tooltip.removeClass(CLASS_FOCUS),this._trigger(\"blur\",[this.tooltip.css(\"zIndex\")],event),this)},PROTOTYPE.disable=function(state){return this.destroyed?this:(\"toggle\"===state?state=!(this.rendered?this.tooltip.hasClass(CLASS_DISABLED):this.disabled):\"boolean\"!=typeof state&&(state=TRUE),this.rendered&&this.tooltip.toggleClass(CLASS_DISABLED,state).attr(\"aria-disabled\",state),this.disabled=!!state,this)},PROTOTYPE.enable=function(){return this.disable(FALSE)},PROTOTYPE._createButton=function(){var self=this,elements=this.elements,tooltip=elements.tooltip,button=this.options.content.button,close=\"string\"==typeof button?button:\"Close tooltip\";elements.button&&elements.button.remove(),button.jquery?elements.button=button:elements.button=$(\"<a />\",{class:\"qtip-close \"+(this.options.style.widget?\"\":NAMESPACE+\"-icon\"),title:close,\"aria-label\":close}).prepend($(\"<span />\",{class:\"ui-icon ui-icon-close\",html:\"&times;\"})),elements.button.appendTo(elements.titlebar||tooltip).attr(\"role\",\"button\").click(function(event){return tooltip.hasClass(CLASS_DISABLED)||self.hide(event),FALSE})},PROTOTYPE._updateButton=function(button){if(!this.rendered)return FALSE;var elem=this.elements.button;button?this._createButton():elem.remove()},PROTOTYPE._setWidget=function(){var on=this.options.style.widget,elements=this.elements,tooltip=elements.tooltip,disabled=tooltip.hasClass(CLASS_DISABLED);tooltip.removeClass(CLASS_DISABLED),CLASS_DISABLED=on?\"ui-state-disabled\":\"qtip-disabled\",tooltip.toggleClass(CLASS_DISABLED,disabled),tooltip.toggleClass(\"ui-helper-reset \"+createWidgetClass(),on).toggleClass(CLASS_DEFAULT,this.options.style.def&&!on),elements.content&&elements.content.toggleClass(createWidgetClass(\"content\"),on),elements.titlebar&&elements.titlebar.toggleClass(createWidgetClass(\"header\"),on),elements.button&&elements.button.toggleClass(NAMESPACE+\"-icon\",!on)},PROTOTYPE._storeMouse=function(event){return(this.mouse=$.event.fix(event)).type=\"mousemove\",this},PROTOTYPE._bind=function(targets,events,method,suffix,context){if(targets&&method&&events.length){var ns=\".\"+this._id+(suffix?\"-\"+suffix:\"\");return $(targets).bind((events.split?events:events.join(ns+\" \"))+ns,$.proxy(method,context||this)),this}},PROTOTYPE._unbind=function(targets,suffix){return targets&&$(targets).unbind(\".\"+this._id+(suffix?\"-\"+suffix:\"\")),this},PROTOTYPE._trigger=function(type,args,event){var callback=$.Event(\"tooltip\"+type);return callback.originalEvent=event&&$.extend({},event)||this.cache.event||NULL,this.triggering=type,this.tooltip.trigger(callback,[this].concat(args||[])),this.triggering=FALSE,!callback.isDefaultPrevented()},PROTOTYPE._bindEvents=function(showEvents,hideEvents,showTargets,hideTargets,showMethod,hideMethod){var similarTargets=showTargets.filter(hideTargets).add(hideTargets.filter(showTargets)),toggleEvents=[];similarTargets.length&&($.each(hideEvents,function(i,type){var showIndex=$.inArray(type,showEvents);showIndex>-1&&toggleEvents.push(showEvents.splice(showIndex,1)[0])}),toggleEvents.length&&(this._bind(similarTargets,toggleEvents,function(event){(!!this.rendered&&this.tooltip[0].offsetWidth>0?hideMethod:showMethod).call(this,event)}),showTargets=showTargets.not(similarTargets),hideTargets=hideTargets.not(similarTargets))),this._bind(showTargets,showEvents,showMethod),this._bind(hideTargets,hideEvents,hideMethod)},PROTOTYPE._assignInitialEvents=function(event){var options=this.options,showTarget=options.show.target,hideTarget=options.hide.target,showEvents=options.show.event?$.trim(\"\"+options.show.event).split(\" \"):[],hideEvents=options.hide.event?$.trim(\"\"+options.hide.event).split(\" \"):[];function hoverIntent(event){if(this.disabled||this.destroyed)return FALSE;this.cache.event=event&&$.event.fix(event),this.cache.target=event&&$(event.target),clearTimeout(this.timers.show),this.timers.show=delay.call(this,function(){this.render(\"object\"==typeof event||options.show.ready)},options.prerender?0:options.show.delay)}this._bind(this.elements.target,[\"remove\",\"removeqtip\"],function(event){this.destroy(!0)},\"destroy\"),/mouse(over|enter)/i.test(options.show.event)&&!/mouse(out|leave)/i.test(options.hide.event)&&hideEvents.push(\"mouseleave\"),this._bind(showTarget,\"mousemove\",function(event){this._storeMouse(event),this.cache.onTarget=TRUE}),this._bindEvents(showEvents,hideEvents,showTarget,hideTarget,hoverIntent,function(){if(!this.timers)return FALSE;clearTimeout(this.timers.show)}),(options.show.ready||options.prerender)&&hoverIntent.call(this,event)},PROTOTYPE._assignEvents=function(){var self=this,options=this.options,posOptions=options.position,tooltip=this.tooltip,showTarget=options.show.target,hideTarget=options.hide.target,containerTarget=posOptions.container,viewportTarget=posOptions.viewport,documentTarget=$(document),windowTarget=($(document.body),$(window)),showEvents=options.show.event?$.trim(\"\"+options.show.event).split(\" \"):[],hideEvents=options.hide.event?$.trim(\"\"+options.hide.event).split(\" \"):[];$.each(options.events,function(name,callback){self._bind(tooltip,\"toggle\"===name?[\"tooltipshow\",\"tooltiphide\"]:[\"tooltip\"+name],callback,null,tooltip)}),/mouse(out|leave)/i.test(options.hide.event)&&\"window\"===options.hide.leave&&this._bind(documentTarget,[\"mouseout\",\"blur\"],function(event){/select|option/.test(event.target.nodeName)||event.relatedTarget||this.hide(event)}),options.hide.fixed?hideTarget=hideTarget.add(tooltip.addClass(CLASS_FIXED)):/mouse(over|enter)/i.test(options.show.event)&&this._bind(hideTarget,\"mouseleave\",function(){clearTimeout(this.timers.show)}),(\"\"+options.hide.event).indexOf(\"unfocus\")>-1&&this._bind(containerTarget.closest(\"html\"),[\"mousedown\",\"touchstart\"],function(event){var elem=$(event.target),enabled=this.rendered&&!this.tooltip.hasClass(CLASS_DISABLED)&&this.tooltip[0].offsetWidth>0,isAncestor=elem.parents(SELECTOR).filter(this.tooltip[0]).length>0;elem[0]===this.target[0]||elem[0]===this.tooltip[0]||isAncestor||this.target.has(elem[0]).length||!enabled||this.hide(event)}),\"number\"==typeof options.hide.inactive&&(this._bind(showTarget,\"qtip-\"+this.id+\"-inactive\",inactiveMethod,\"inactive\"),this._bind(hideTarget.add(tooltip),QTIP.inactiveEvents,inactiveMethod)),this._bindEvents(showEvents,hideEvents,showTarget,hideTarget,showMethod,hideMethod),this._bind(showTarget.add(tooltip),\"mousemove\",function(event){if(\"number\"==typeof options.hide.distance){var origin=this.cache.origin||{},limit=this.options.hide.distance,abs=Math.abs;(abs(event.pageX-origin.pageX)>=limit||abs(event.pageY-origin.pageY)>=limit)&&this.hide(event)}this._storeMouse(event)}),\"mouse\"===posOptions.target&&posOptions.adjust.mouse&&(options.hide.event&&this._bind(showTarget,[\"mouseenter\",\"mouseleave\"],function(event){if(!this.cache)return FALSE;this.cache.onTarget=\"mouseenter\"===event.type}),this._bind(documentTarget,\"mousemove\",function(event){this.rendered&&this.cache.onTarget&&!this.tooltip.hasClass(CLASS_DISABLED)&&this.tooltip[0].offsetWidth>0&&this.reposition(event)})),(posOptions.adjust.resize||viewportTarget.length)&&this._bind($.event.special.resize?viewportTarget:windowTarget,\"resize\",repositionMethod),posOptions.adjust.scroll&&this._bind(windowTarget.add(posOptions.container),\"scroll\",repositionMethod)},PROTOTYPE._unassignEvents=function(){var options=this.options,showTargets=options.show.target,hideTargets=options.hide.target,targets=$.grep([this.elements.target[0],this.rendered&&this.tooltip[0],options.position.container[0],options.position.viewport[0],options.position.container.closest(\"html\")[0],window,document],function(i){return\"object\"==typeof i});showTargets&&showTargets.toArray&&(targets=targets.concat(showTargets.toArray())),hideTargets&&hideTargets.toArray&&(targets=targets.concat(hideTargets.toArray())),this._unbind(targets)._unbind(targets,\"destroy\")._unbind(targets,\"inactive\")},$(function(){delegate(SELECTOR,[\"mouseenter\",\"mouseleave\"],function(event){var state=\"mouseenter\"===event.type,tooltip=$(event.currentTarget),target=$(event.relatedTarget||event.target),options=this.options;state?(this.focus(event),tooltip.hasClass(CLASS_FIXED)&&!tooltip.hasClass(CLASS_DISABLED)&&clearTimeout(this.timers.hide)):\"mouse\"===options.position.target&&options.position.adjust.mouse&&options.hide.event&&options.show.target&&!target.closest(options.show.target[0]).length&&this.hide(event),tooltip.toggleClass(CLASS_HOVER,state)}),delegate(\"[\"+ATTR_ID+\"]\",INACTIVE_EVENTS,inactiveMethod)}),QTIP=$.fn.qtip=function(options,notation,newValue){var command=(\"\"+options).toLowerCase(),returned=NULL,args=$.makeArray(arguments).slice(1),event=args[args.length-1],opts=this[0]?$.data(this[0],NAMESPACE):NULL;return!arguments.length&&opts||\"api\"===command?opts:\"string\"==typeof options?(this.each(function(){var api=$.data(this,NAMESPACE);if(!api)return TRUE;if(event&&event.timeStamp&&(api.cache.event=event),!notation||\"option\"!==command&&\"options\"!==command)api[command]&&api[command].apply(api,args);else{if(newValue===undefined&&!$.isPlainObject(notation))return returned=api.get(notation),FALSE;api.set(notation,newValue)}}),returned!==NULL?returned:this):\"object\"!=typeof options&&arguments.length?void 0:(opts=sanitizeOptions($.extend(TRUE,{},options)),this.each(function(i){var api,id;if(id=!(id=$.isArray(opts.id)?opts.id[i]:opts.id)||id===FALSE||id.length<1||QTIP.api[id]?QTIP.nextid++:id,(api=function(elem,id,opts){var obj,posOptions,attr,config,title,docBody=$(document.body),newTarget=elem[0]===document?docBody:elem,metadata=elem.metadata?elem.metadata(opts.metadata):NULL,metadata5=\"html5\"===opts.metadata.type&&metadata?metadata[opts.metadata.name]:NULL,html5=elem.data(opts.metadata.name||\"qtipopts\");try{html5=\"string\"==typeof html5?$.parseJSON(html5):html5}catch(e){}if(posOptions=(config=$.extend(TRUE,{},QTIP.defaults,opts,\"object\"==typeof html5?sanitizeOptions(html5):NULL,sanitizeOptions(metadata5||metadata))).position,config.id=id,\"boolean\"==typeof config.content.text){if(attr=elem.attr(config.content.attr),config.content.attr===FALSE||!attr)return FALSE;config.content.text=attr}if(posOptions.container.length||(posOptions.container=docBody),posOptions.target===FALSE&&(posOptions.target=newTarget),config.show.target===FALSE&&(config.show.target=newTarget),config.show.solo===TRUE&&(config.show.solo=posOptions.container.closest(\"body\")),config.hide.target===FALSE&&(config.hide.target=newTarget),config.position.viewport===TRUE&&(config.position.viewport=posOptions.container),posOptions.container=posOptions.container.eq(0),posOptions.at=new CORNER(posOptions.at,TRUE),posOptions.my=new CORNER(posOptions.my),elem.data(NAMESPACE))if(config.overwrite)elem.qtip(\"destroy\",!0);else if(config.overwrite===FALSE)return FALSE;return elem.attr(ATTR_HAS,id),config.suppress&&(title=elem.attr(\"title\"))&&elem.removeAttr(\"title\").attr(oldtitle,title).attr(\"title\",\"\"),obj=new QTip(elem,config,id,!!attr),elem.data(NAMESPACE,obj),obj}($(this),id,opts))===FALSE)return TRUE;QTIP.api[id]=api,$.each(PLUGINS,function(){\"initialize\"===this.initialize&&this(api)}),api._assignInitialEvents(event)}))},$.qtip=QTip,QTIP.api={},$.each({attr:function(attr,val){if(this.length){var self=this[0],api=$.data(self,\"qtip\");if(\"title\"===attr&&api&&\"object\"==typeof api&&api.options.suppress)return arguments.length<2?$.attr(self,oldtitle):(api&&\"title\"===api.options.content.attr&&api.cache.attr&&api.set(\"content.text\",val),this.attr(oldtitle,val))}return $.fn.attr_replacedByqTip.apply(this,arguments)},clone:function(keepData){$([]);var elems=$.fn.clone_replacedByqTip.apply(this,arguments);return keepData||elems.filter(\"[\"+oldtitle+\"]\").attr(\"title\",function(){return $.attr(this,oldtitle)}).removeAttr(oldtitle),elems}},function(name,func){if(!func||$.fn[name+\"_replacedByqTip\"])return TRUE;var old=$.fn[name+\"_replacedByqTip\"]=$.fn[name];$.fn[name]=function(){return func.apply(this,arguments)||old.apply(this,arguments)}}),$.ui||($.cleanData_replacedByqTip=$.cleanData,$.cleanData=function(elems){for(var elem,i=0;(elem=$(elems[i])).length;i++)if(elem.attr(ATTR_HAS))try{elem.triggerHandler(\"removeqtip\")}catch(e){}$.cleanData_replacedByqTip.apply(this,arguments)}),QTIP.version=\"2.2.1\",QTIP.nextid=0,QTIP.inactiveEvents=INACTIVE_EVENTS,QTIP.zindex=15e3,QTIP.defaults={prerender:FALSE,id:FALSE,overwrite:TRUE,suppress:TRUE,content:{text:TRUE,attr:\"title\",title:FALSE,button:FALSE},position:{my:\"top left\",at:\"bottom right\",target:FALSE,container:FALSE,viewport:FALSE,adjust:{x:0,y:0,mouse:TRUE,scroll:TRUE,resize:TRUE,method:\"flipinvert flipinvert\"},effect:function(api,pos,viewport){$(this).animate(pos,{duration:200,queue:FALSE})}},show:{target:FALSE,event:\"mouseenter\",effect:TRUE,delay:90,solo:FALSE,ready:FALSE,autofocus:FALSE},hide:{target:FALSE,event:\"mouseleave\",effect:TRUE,delay:0,fixed:FALSE,inactive:FALSE,leave:\"window\",distance:FALSE},style:{classes:\"\",widget:FALSE,width:FALSE,height:FALSE,def:TRUE},events:{render:NULL,move:NULL,show:NULL,hide:NULL,toggle:NULL,visible:NULL,hidden:NULL,focus:NULL,blur:NULL}};var TIP,MARGIN=\"margin\",BG_COLOR=\"background-color\",HASCANVAS=!!document.createElement(\"canvas\").getContext,INVALID=/rgba?\\(0, 0, 0(, 0)?\\)|transparent|#123456/i;function camel(s){return s.charAt(0).toUpperCase()+s.slice(1)}var context,cssProps={},cssPrefixes=[\"Webkit\",\"O\",\"Moz\",\"ms\"];function intCss(elem,prop){return Math.ceil(parseFloat(function(elem,prop){var cur,val,ucProp=prop.charAt(0).toUpperCase()+prop.slice(1),props=(prop+\" \"+cssPrefixes.join(ucProp+\" \")+ucProp).split(\" \"),i=0;if(cssProps[prop])return elem.css(cssProps[prop]);for(;cur=props[i++];)if((val=elem.css(cur))!==undefined)return cssProps[prop]=cur,val}(elem,prop)))}if(HASCANVAS)var SCALE=(window.devicePixelRatio||1)/((context=document.createElement(\"canvas\").getContext(\"2d\")).backingStorePixelRatio||context.webkitBackingStorePixelRatio||context.mozBackingStorePixelRatio||context.msBackingStorePixelRatio||context.oBackingStorePixelRatio||1);else var createVML=function(tag,props,style){return\"<qtipvml:\"+tag+' xmlns=\"urn:schemas-microsoft.com:vml\" class=\"qtip-vml\" '+(props||\"\")+' style=\"behavior: url(#default#VML); '+(style||\"\")+'\" />'};function Tip(qtip,options){this._ns=\"tip\",this.options=options,this.offset=options.offset,this.size=[options.width,options.height],this.init(this.qtip=qtip)}$.extend(Tip.prototype,{init:function(qtip){var context,tip;tip=this.element=qtip.elements.tip=$(\"<div />\",{class:NAMESPACE+\"-tip\"}).prependTo(qtip.tooltip),HASCANVAS?((context=$(\"<canvas />\").appendTo(this.element)[0].getContext(\"2d\")).lineJoin=\"miter\",context.miterLimit=1e5,context.save()):(context=createVML(\"shape\",'coordorigin=\"0,0\"',\"position:absolute;\"),this.element.html(context+context),qtip._bind($(\"*\",tip).add(tip),[\"click\",\"mousedown\"],function(event){event.stopPropagation()},this._ns)),qtip._bind(qtip.tooltip,\"tooltipmove\",this.reposition,this._ns,this),this.create()},_swapDimensions:function(){this.size[0]=this.options.height,this.size[1]=this.options.width},_resetDimensions:function(){this.size[0]=this.options.width,this.size[1]=this.options.height},_useTitle:function(corner){var titlebar=this.qtip.elements.titlebar;return titlebar&&(corner.y===TOP||corner.y===CENTER&&this.element.position().top+this.size[1]/2+this.options.offset<titlebar.outerHeight(TRUE))},_parseCorner:function(corner){var my=this.qtip.options.position.my;return corner===FALSE||my===FALSE?corner=FALSE:corner===TRUE?corner=new CORNER(my.string()):corner.string||((corner=new CORNER(corner)).fixed=TRUE),corner},_parseWidth:function(corner,side,use){var elements=this.qtip.elements,prop=\"border\"+camel(side)+\"Width\";return(use?intCss(use,prop):intCss(elements.content,prop)||intCss(this._useTitle(corner)&&elements.titlebar||elements.content,prop)||intCss(elements.tooltip,prop))||0},_parseRadius:function(corner){var elements=this.qtip.elements,prop=\"border\"+camel(corner.y)+camel(corner.x)+\"Radius\";return BROWSER.ie<9?0:intCss(this._useTitle(corner)&&elements.titlebar||elements.content,prop)||intCss(elements.tooltip,prop)||0},_invalidColour:function(elem,prop,compare){var val=elem.css(prop);return!val||compare&&val===elem.css(compare)||INVALID.test(val)?FALSE:val},_parseColours:function(corner){var elements=this.qtip.elements,tip=this.element.css(\"cssText\",\"\"),borderSide=\"border\"+camel(corner[corner.precedance])+camel(\"color\"),colorElem=this._useTitle(corner)&&elements.titlebar||elements.content,css=this._invalidColour,color=[];return color[0]=css(tip,BG_COLOR)||css(colorElem,BG_COLOR)||css(elements.content,BG_COLOR)||css(elements.tooltip,BG_COLOR)||tip.css(BG_COLOR),color[1]=css(tip,borderSide,\"color\")||css(colorElem,borderSide,\"color\")||css(elements.content,borderSide,\"color\")||css(elements.tooltip,borderSide,\"color\")||elements.tooltip.css(borderSide),$(\"*\",tip).add(tip).css(\"cssText\",BG_COLOR+\":transparent !important;border:0 !important;\"),color},_calculateSize:function(corner){var ratio,result,y=corner.precedance===Y,width=this.options.width,height=this.options.height,isCenter=\"c\"===corner.abbrev(),base=(y?width:height)*(isCenter?.5:1),pow=Math.pow,round=Math.round,smallHyp=Math.sqrt(pow(base,2)+pow(height,2)),hyp=[this.border/base*smallHyp,this.border/height*smallHyp];return hyp[2]=Math.sqrt(pow(hyp[0],2)-pow(this.border,2)),hyp[3]=Math.sqrt(pow(hyp[1],2)-pow(this.border,2)),result=[round((ratio=(smallHyp+hyp[2]+hyp[3]+(isCenter?0:hyp[0]))/smallHyp)*width),round(ratio*height)],y?result:result.reverse()},_calculateTip:function(corner,size,scale){scale=scale||1;var width=(size=size||this.size)[0]*scale,height=size[1]*scale,width2=Math.ceil(width/2),height2=Math.ceil(height/2),tips={br:[0,0,width,height,width,0],bl:[0,0,width,0,0,height],tr:[0,height,width,0,width,height],tl:[0,0,0,height,width,height],tc:[0,height,width2,0,width,height],bc:[0,0,width,0,width2,height],rc:[0,0,width,height2,0,height],lc:[width,0,width,height,0,height2]};return tips.lt=tips.br,tips.rt=tips.bl,tips.lb=tips.tr,tips.rb=tips.tl,tips[corner.abbrev()]},_drawCoords:function(context,coords){context.beginPath(),context.moveTo(coords[0],coords[1]),context.lineTo(coords[2],coords[3]),context.lineTo(coords[4],coords[5]),context.closePath()},create:function(){var c=this.corner=(HASCANVAS||BROWSER.ie)&&this._parseCorner(this.options.corner);return(this.enabled=!!this.corner&&\"c\"!==this.corner.abbrev())&&(this.qtip.cache.corner=c.clone(),this.update()),this.element.toggle(this.enabled),this.corner},update:function(corner,position){if(!this.enabled)return this;var color,precedance,context,coords,bigCoords,translate,newSize,border,elements=this.qtip.elements,tip=this.element,inner=tip.children(),options=this.options,curSize=this.size,mimic=options.mimic,round=Math.round;corner||(corner=this.qtip.cache.corner||this.corner),mimic===FALSE?mimic=corner:((mimic=new CORNER(mimic)).precedance=corner.precedance,\"inherit\"===mimic.x?mimic.x=corner.x:\"inherit\"===mimic.y?mimic.y=corner.y:mimic.x===mimic.y&&(mimic[corner.precedance]=corner[corner.precedance])),precedance=mimic.precedance,corner.precedance===X?this._swapDimensions():this._resetDimensions(),\"transparent\"!==(color=this.color=this._parseColours(corner))[1]?(border=this.border=this._parseWidth(corner,corner[corner.precedance]),options.border&&border<1&&!INVALID.test(color[1])&&(color[0]=color[1]),this.border=border=options.border!==TRUE?options.border:border):this.border=border=0,newSize=this.size=this._calculateSize(corner),tip.css({width:newSize[0],height:newSize[1],lineHeight:newSize[1]+\"px\"}),translate=corner.precedance===Y?[round(mimic.x===LEFT?border:mimic.x===RIGHT?newSize[0]-curSize[0]-border:(newSize[0]-curSize[0])/2),round(mimic.y===TOP?newSize[1]-curSize[1]:0)]:[round(mimic.x===LEFT?newSize[0]-curSize[0]:0),round(mimic.y===TOP?border:\"bottom\"===mimic.y?newSize[1]-curSize[1]-border:(newSize[1]-curSize[1])/2)],HASCANVAS?((context=inner[0].getContext(\"2d\")).restore(),context.save(),context.clearRect(0,0,6e3,6e3),coords=this._calculateTip(mimic,curSize,SCALE),bigCoords=this._calculateTip(mimic,this.size,SCALE),inner.attr(WIDTH,newSize[0]*SCALE).attr(\"height\",newSize[1]*SCALE),inner.css(WIDTH,newSize[0]).css(\"height\",newSize[1]),this._drawCoords(context,bigCoords),context.fillStyle=color[1],context.fill(),context.translate(translate[0]*SCALE,translate[1]*SCALE),this._drawCoords(context,coords),context.fillStyle=color[0],context.fill()):(coords=\"m\"+(coords=this._calculateTip(mimic))[0]+\",\"+coords[1]+\" l\"+coords[2]+\",\"+coords[3]+\" \"+coords[4]+\",\"+coords[5]+\" xe\",translate[2]=border&&/^(r|b)/i.test(corner.string())?8===BROWSER.ie?2:1:0,inner.css({coordsize:newSize[0]+border+\" \"+(newSize[1]+border),antialias:\"\"+(mimic.string().indexOf(CENTER)>-1),left:translate[0]-translate[2]*Number(precedance===X),top:translate[1]-translate[2]*Number(precedance===Y),width:newSize[0]+border,height:newSize[1]+border}).each(function(i){var $this=$(this);$this[$this.prop?\"prop\":\"attr\"]({coordsize:newSize[0]+border+\" \"+(newSize[1]+border),path:coords,fillcolor:color[0],filled:!!i,stroked:!i}).toggle(!(!border&&!i)),!i&&$this.html(createVML(\"stroke\",'weight=\"'+2*border+'px\" color=\"'+color[1]+'\" miterlimit=\"1000\" joinstyle=\"miter\"'))})),window.opera&&setTimeout(function(){elements.tip.css({display:\"inline-block\",visibility:\"visible\"})},1),position!==FALSE&&this.calculate(corner,newSize)},calculate:function(corner,size){if(!this.enabled)return FALSE;var precedance,corners,self=this,elements=this.qtip.elements,tip=this.element,userOffset=this.options.offset,position=(elements.tooltip.hasClass(\"ui-widget\"),{});return corner=corner||this.corner,precedance=corner.precedance,size=size||this._calculateSize(corner),corners=[corner.x,corner.y],precedance===X&&corners.reverse(),$.each(corners,function(i,side){var b,bc,br;side===CENTER?(position[b=precedance===Y?LEFT:TOP]=\"50%\",position[MARGIN+\"-\"+b]=-Math.round(size[precedance===Y?0:1]/2)+userOffset):(b=self._parseWidth(corner,side,elements.tooltip),bc=self._parseWidth(corner,side,elements.content),br=self._parseRadius(corner),position[side]=Math.max(-self.border,i?bc:userOffset+(br>b?br:-b)))}),position[corner[precedance]]-=size[precedance===X?0:1],tip.css({margin:\"\",top:\"\",bottom:\"\",left:\"\",right:\"\"}).css(position),position},reposition:function(event,api,pos,viewport){if(this.enabled){var offset,props,cache=api.cache,newCorner=this.corner.clone(),adjust=pos.adjusted,method=api.options.position.adjust.method.split(\" \"),horizontal=method[0],vertical=method[1]||method[0],shift={left:FALSE,top:FALSE,x:0,y:0},css={};this.corner.fixed!==TRUE&&(shiftflip(horizontal,X,Y,LEFT,RIGHT),shiftflip(vertical,Y,X,TOP,\"bottom\"),newCorner.string()===cache.corner.string()&&cache.cornerTop===adjust.top&&cache.cornerLeft===adjust.left||this.update(newCorner,FALSE)),(offset=this.calculate(newCorner)).right!==undefined&&(offset.left=-offset.right),offset.bottom!==undefined&&(offset.top=-offset.bottom),offset.user=this.offset,(shift.left=horizontal===SHIFT&&!!adjust.left)&&shiftonly(X,LEFT,RIGHT),(shift.top=vertical===SHIFT&&!!adjust.top)&&shiftonly(Y,TOP,\"bottom\"),this.element.css(css).toggle(!(shift.x&&shift.y||newCorner.x===CENTER&&shift.y||newCorner.y===CENTER&&shift.x)),pos.left-=offset.left.charAt?offset.user:horizontal!==SHIFT||shift.top||!shift.left&&!shift.top?offset.left+this.border:0,pos.top-=offset.top.charAt?offset.user:vertical!==SHIFT||shift.left||!shift.left&&!shift.top?offset.top+this.border:0,cache.cornerLeft=adjust.left,cache.cornerTop=adjust.top,cache.corner=newCorner.clone()}function shiftflip(direction,precedance,popposite,side,opposite){direction===SHIFT&&newCorner.precedance===precedance&&adjust[side]&&newCorner[popposite]!==CENTER?newCorner.precedance=newCorner.precedance===X?Y:X:direction!==SHIFT&&adjust[side]&&(newCorner[precedance]=newCorner[precedance]===CENTER?adjust[side]>0?side:opposite:newCorner[precedance]===side?opposite:side)}function shiftonly(xy,side,opposite){newCorner[xy]===CENTER?css[MARGIN+\"-\"+side]=shift[xy]=offset[MARGIN+\"-\"+side]-adjust[side]:(props=offset[opposite]!==undefined?[adjust[side],-offset[side]]:[-adjust[side],offset[side]],(shift[xy]=Math.max(props[0],props[1]))>props[0]&&(pos[side]-=adjust[side],shift[side]=FALSE),css[offset[opposite]!==undefined?opposite:side]=shift[xy])}},destroy:function(){this.qtip._unbind(this.qtip.tooltip,this._ns),this.qtip.elements.tip&&this.qtip.elements.tip.find(\"*\").remove().end().remove()}}),(TIP=PLUGINS.tip=function(api){return new Tip(api,api.options.style.tip)}).initialize=\"render\",TIP.sanitize=function(options){if(options.style&&\"tip\"in options.style){var opts=options.style.tip;\"object\"!=typeof opts&&(opts=options.style.tip={corner:opts}),/string|boolean/i.test(typeof opts.corner)||(opts.corner=TRUE)}},CHECKS.tip={\"^position.my|style.tip.(corner|mimic|border)$\":function(){this.create(),this.qtip.reposition()},\"^style.tip.(height|width)$\":function(obj){this.size=[obj.width,obj.height],this.update(),this.qtip.reposition()},\"^content.title|style.(classes|widget)$\":function(){this.update()}},$.extend(TRUE,QTIP.defaults,{style:{tip:{corner:TRUE,mimic:FALSE,width:6,height:6,border:TRUE,offset:0}}});var MODAL,OVERLAY;function Modal(api,options){this.options=options,this._ns=\"-modal\",this.init(this.qtip=api)}OVERLAY=new(OVERLAY=function(){var current,prevState,elem,self=this,focusableElems={};function focusInputs(blurElems){focusableElems.length<1&&blurElems.length?blurElems.not(\"body\").blur():focusableElems.first().focus()}function stealFocus(event){if(elem.is(\":visible\")){var target=$(event.target),tooltip=current.tooltip,container=target.closest(SELECTOR);(container.length<1?FALSE:parseInt(container[0].style.zIndex,10)>parseInt(tooltip[0].style.zIndex,10))||target.closest(SELECTOR)[0]===tooltip[0]||focusInputs(target),event.target===focusableElems[focusableElems.length-1]}}$.extend(self,{init:function(){return elem=self.elem=$(\"<div />\",{id:\"qtip-overlay\",html:\"<div></div>\",mousedown:function(){return FALSE}}).hide(),$(document.body).bind(\"focusin.qtip-modal\",stealFocus),$(document).bind(\"keydown.qtip-modal\",function(event){current&&current.options.show.modal.escape&&27===event.keyCode&&current.hide(event)}),elem.bind(\"click.qtip-modal\",function(event){current&&current.options.show.modal.blur&&current.hide(event)}),self},update:function(api){current=api,focusableElems=api.options.show.modal.stealfocus!==FALSE?api.tooltip.find(\"*\").filter(function(){return function(element){if($.expr[\":\"].focusable)return $.expr[\":\"].focusable;var map,mapName,img,isTabIndexNotNaN=!isNaN($.attr(element,\"tabindex\")),nodeName=element.nodeName&&element.nodeName.toLowerCase();return\"area\"===nodeName?(mapName=(map=element.parentNode).name,!(!element.href||!mapName||\"map\"!==map.nodeName.toLowerCase())&&!!(img=$(\"img[usemap=#\"+mapName+\"]\")[0])&&img.is(\":visible\")):/input|select|textarea|button|object/.test(nodeName)?!element.disabled:\"a\"===nodeName&&element.href||isTabIndexNotNaN}(this)}):[]},toggle:function(api,state,duration){$(document.body);var tooltip=api.tooltip,options=api.options.show.modal,effect=options.effect,type=state?\"show\":\"hide\",visible=elem.is(\":visible\"),visibleModals=$(\".qtip-modal\").filter(\":visible:not(:animated)\").not(tooltip);return self.update(api),state&&options.stealfocus!==FALSE&&focusInputs($(\":focus\")),elem.toggleClass(\"blurs\",options.blur),state&&elem.appendTo(document.body),elem.is(\":animated\")&&visible===state&&prevState!==FALSE||!state&&visibleModals.length?self:(elem.stop(TRUE,FALSE),$.isFunction(effect)?effect.call(elem,state):effect===FALSE?elem[type]():elem.fadeTo(parseInt(duration,10)||90,state?1:0,function(){state||elem.hide()}),state||elem.queue(function(next){elem.css({left:\"\",top:\"\"}),$(\".qtip-modal\").length||elem.detach(),next()}),prevState=state,current.destroyed&&(current=NULL),self)}}),self.init()}),$.extend(Modal.prototype,{init:function(qtip){var tooltip=qtip.tooltip;if(!this.options.on)return this;qtip.elements.overlay=OVERLAY.elem,tooltip.addClass(\"qtip-modal\").css(\"z-index\",QTIP.modal_zindex+$(\".qtip-modal\").length),qtip._bind(tooltip,[\"tooltipshow\",\"tooltiphide\"],function(event,api,duration){var oEvent=event.originalEvent;if(event.target===tooltip[0])if(oEvent&&\"tooltiphide\"===event.type&&/mouse(leave|enter)/.test(oEvent.type)&&$(oEvent.relatedTarget).closest(OVERLAY.elem[0]).length)try{event.preventDefault()}catch(e){}else(!oEvent||oEvent&&\"tooltipsolo\"!==oEvent.type)&&this.toggle(event,\"tooltipshow\"===event.type,duration)},this._ns,this),qtip._bind(tooltip,\"tooltipfocus\",function(event,api){if(!event.isDefaultPrevented()&&event.target===tooltip[0]){var qtips=$(\".qtip-modal\"),newIndex=QTIP.modal_zindex+qtips.length,curIndex=parseInt(tooltip[0].style.zIndex,10);OVERLAY.elem[0].style.zIndex=newIndex-1,qtips.each(function(){this.style.zIndex>curIndex&&(this.style.zIndex-=1)}),qtips.filter(\".\"+CLASS_FOCUS).qtip(\"blur\",event.originalEvent),tooltip.addClass(CLASS_FOCUS)[0].style.zIndex=newIndex,OVERLAY.update(api);try{event.preventDefault()}catch(e){}}},this._ns,this),qtip._bind(tooltip,\"tooltiphide\",function(event){event.target===tooltip[0]&&$(\".qtip-modal\").filter(\":visible\").not(tooltip).last().qtip(\"focus\",event)},this._ns,this)},toggle:function(event,state,duration){if(event&&event.isDefaultPrevented())return this;OVERLAY.toggle(this.qtip,!!state,duration)},destroy:function(){this.qtip.tooltip.removeClass(\"qtip-modal\"),this.qtip._unbind(this.qtip.tooltip,this._ns),OVERLAY.toggle(this.qtip,FALSE),delete this.qtip.elements.overlay}}),(MODAL=PLUGINS.modal=function(api){return new Modal(api,api.options.show.modal)}).sanitize=function(opts){opts.show&&(\"object\"!=typeof opts.show.modal?opts.show.modal={on:!!opts.show.modal}:void 0===opts.show.modal.on&&(opts.show.modal.on=TRUE))},QTIP.modal_zindex=QTIP.zindex-200,MODAL.initialize=\"render\",CHECKS.modal={\"^show.modal.(on|blur)$\":function(){this.destroy(),this.init(),this.qtip.elems.overlay.toggle(this.qtip.tooltip[0].offsetWidth>0)}},$.extend(TRUE,QTIP.defaults,{show:{modal:{on:FALSE,effect:TRUE,blur:TRUE,stealfocus:TRUE,escape:TRUE}}}),PLUGINS.viewport=function(api,position,posOptions,targetWidth,targetHeight,elemWidth,elemHeight){var fixed,newMy,containerOffset,containerStatic,viewportWidth,viewportHeight,viewportScroll,viewportOffset,target=posOptions.target,tooltip=api.elements.tooltip,my=posOptions.my,at=posOptions.at,adjust=posOptions.adjust,method=adjust.method.split(\" \"),methodX=method[0],methodY=method[1]||method[0],viewport=posOptions.viewport,container=posOptions.container,adjusted=(api.cache,{left:0,top:0});if(!viewport.jquery||target[0]===window||target[0]===document.body||\"none\"===adjust.method)return adjusted;function calculate(side,otherSide,type,adjust,side1,side2,lengthName,targetLength,elemLength){var initialPos=position[side1],mySide=my[side],atSide=at[side],isShift=type===SHIFT,myLength=mySide===side1?elemLength:mySide===side2?-elemLength:-elemLength/2,atLength=atSide===side1?targetLength:atSide===side2?-targetLength:-targetLength/2,sideOffset=viewportScroll[side1]+viewportOffset[side1]-(containerStatic?0:containerOffset[side1]),overflow1=sideOffset-initialPos,overflow2=initialPos+elemLength-(lengthName===WIDTH?viewportWidth:viewportHeight)-sideOffset,offset=myLength-(my.precedance===side||mySide===my[otherSide]?atLength:0)-(atSide===CENTER?targetLength/2:0);return isShift?(offset=(mySide===side1?1:-1)*myLength,position[side1]+=overflow1>0?overflow1:overflow2>0?-overflow2:0,position[side1]=Math.max(-containerOffset[side1]+viewportOffset[side1],initialPos-offset,Math.min(Math.max(-containerOffset[side1]+viewportOffset[side1]+(lengthName===WIDTH?viewportWidth:viewportHeight),initialPos+offset),position[side1],\"center\"===mySide?initialPos-myLength:1e9))):(adjust*=type===FLIPINVERT?2:0,overflow1>0&&(mySide!==side1||overflow2>0)?(position[side1]-=offset+adjust,newMy.invert(side,side1)):overflow2>0&&(mySide!==side2||overflow1>0)&&(position[side1]-=(mySide===CENTER?-offset:offset)+adjust,newMy.invert(side,side2)),position[side1]<viewportScroll&&-position[side1]>overflow2&&(position[side1]=initialPos,newMy=my.clone())),position[side1]-initialPos}return containerOffset=container.offset()||adjusted,containerStatic=\"static\"===container.css(\"position\"),fixed=\"fixed\"===tooltip.css(\"position\"),viewportWidth=viewport[0]===window?viewport.width():viewport.outerWidth(FALSE),viewportHeight=viewport[0]===window?viewport.height():viewport.outerHeight(FALSE),viewportScroll={left:fixed?0:viewport.scrollLeft(),top:fixed?0:viewport.scrollTop()},viewportOffset=viewport.offset()||adjusted,\"shift\"===methodX&&\"shift\"===methodY||(newMy=my.clone()),adjusted={left:\"none\"!==methodX?calculate(X,Y,methodX,adjust.x,LEFT,RIGHT,WIDTH,targetWidth,elemWidth):0,top:\"none\"!==methodY?calculate(Y,X,methodY,adjust.y,TOP,\"bottom\",\"height\",targetHeight,elemHeight):0,my:newMy}},PLUGINS.polys={polygon:function(baseCoords,corner){var next,newWidth,newHeight,result={width:0,height:0,position:{top:1e10,right:0,bottom:0,left:1e10},adjustable:FALSE},i=0,coords=[],compareX=1,compareY=1,realX=0,realY=0;for(i=baseCoords.length;i--;)(next=[parseInt(baseCoords[--i],10),parseInt(baseCoords[i+1],10)])[0]>result.position.right&&(result.position.right=next[0]),next[0]<result.position.left&&(result.position.left=next[0]),next[1]>result.position.bottom&&(result.position.bottom=next[1]),next[1]<result.position.top&&(result.position.top=next[1]),coords.push(next);if(newWidth=result.width=Math.abs(result.position.right-result.position.left),newHeight=result.height=Math.abs(result.position.bottom-result.position.top),\"c\"===corner.abbrev())result.position={left:result.position.left+result.width/2,top:result.position.top+result.height/2};else{for(;newWidth>0&&newHeight>0&&compareX>0&&compareY>0;)for(newWidth=Math.floor(newWidth/2),newHeight=Math.floor(newHeight/2),corner.x===LEFT?compareX=newWidth:corner.x===RIGHT?compareX=result.width-newWidth:compareX+=Math.floor(newWidth/2),corner.y===TOP?compareY=newHeight:\"bottom\"===corner.y?compareY=result.height-newHeight:compareY+=Math.floor(newHeight/2),i=coords.length;i--&&!(coords.length<2);)realX=coords[i][0]-result.position.left,realY=coords[i][1]-result.position.top,(corner.x===LEFT&&realX>=compareX||corner.x===RIGHT&&realX<=compareX||corner.x===CENTER&&(realX<compareX||realX>result.width-compareX)||corner.y===TOP&&realY>=compareY||\"bottom\"===corner.y&&realY<=compareY||corner.y===CENTER&&(realY<compareY||realY>result.height-compareY))&&coords.splice(i,1);result.position={left:coords[0][0],top:coords[0][1]}}return result},rect:function(ax,ay,bx,by){return{width:Math.abs(bx-ax),height:Math.abs(by-ay),position:{left:Math.min(ax,bx),top:Math.min(ay,by)}}},_angles:{tc:1.5,tr:7/4,tl:5/4,bc:.5,br:.25,bl:.75,rc:2,lc:1,c:0},ellipse:function(cx,cy,rx,ry,corner){var c=PLUGINS.polys._angles[corner.abbrev()],rxc=0===c?0:rx*Math.cos(c*Math.PI),rys=ry*Math.sin(c*Math.PI);return{width:2*rx-Math.abs(rxc),height:2*ry-Math.abs(rys),position:{left:cx+rxc,top:cy+rys},adjustable:FALSE}},circle:function(cx,cy,r,corner){return PLUGINS.polys.ellipse(cx,cy,r,r,corner)}},PLUGINS.svg=function(api,svg,corner){$(document);for(var frameOffset,mtx,transformed,len,next,i,points,result,position,elem=svg[0],root=$(elem.ownerSVGElement),ownerDocument=elem.ownerDocument,strokeWidth2=(parseInt(svg.css(\"stroke-width\"),10)||0)/2;!elem.getBBox;)elem=elem.parentNode;if(!elem.getBBox||!elem.parentNode)return FALSE;switch(elem.nodeName){case\"ellipse\":case\"circle\":result=PLUGINS.polys.ellipse(elem.cx.baseVal.value,elem.cy.baseVal.value,(elem.rx||elem.r).baseVal.value+strokeWidth2,(elem.ry||elem.r).baseVal.value+strokeWidth2,corner);break;case\"line\":case\"polygon\":case\"polyline\":for(result=[],i=-1,len=(points=elem.points||[{x:elem.x1.baseVal.value,y:elem.y1.baseVal.value},{x:elem.x2.baseVal.value,y:elem.y2.baseVal.value}]).numberOfItems||points.length;++i<len;)next=points.getItem?points.getItem(i):points[i],result.push.apply(result,[next.x,next.y]);result=PLUGINS.polys.polygon(result,corner);break;default:result={width:(result=elem.getBBox()).width,height:result.height,position:{left:result.x,top:result.y}}}return position=result.position,(root=root[0]).createSVGPoint&&(mtx=elem.getScreenCTM(),(points=root.createSVGPoint()).x=position.left,points.y=position.top,transformed=points.matrixTransform(mtx),position.left=transformed.x,position.top=transformed.y),ownerDocument!==document&&\"mouse\"!==api.position.target&&(frameOffset=$((ownerDocument.defaultView||ownerDocument.parentWindow).frameElement).offset())&&(position.left+=frameOffset.left,position.top+=frameOffset.top),ownerDocument=$(ownerDocument),position.left+=ownerDocument.scrollLeft(),position.top+=ownerDocument.scrollTop(),result},PLUGINS.imagemap=function(api,area,corner,adjustMethod){area.jquery||(area=$(area));var imageOffset,coords,i,result,len,shape=(area.attr(\"shape\")||\"rect\").toLowerCase().replace(\"poly\",\"polygon\"),image=$('img[usemap=\"#'+area.parent(\"map\").attr(\"name\")+'\"]'),coordsArray=$.trim(area.attr(\"coords\")).replace(/,$/,\"\").split(\",\");if(!image.length)return FALSE;if(\"polygon\"===shape)result=PLUGINS.polys.polygon(coordsArray,corner);else{if(!PLUGINS.polys[shape])return FALSE;for(i=-1,len=coordsArray.length,coords=[];++i<len;)coords.push(parseInt(coordsArray[i],10));result=PLUGINS.polys[shape].apply(this,coords.concat(corner))}return(imageOffset=image.offset()).left+=Math.ceil((image.outerWidth(FALSE)-image.width())/2),imageOffset.top+=Math.ceil((image.outerHeight(FALSE)-image.height())/2),result.position.left+=imageOffset.left,result.position.top+=imageOffset.top,result};function Ie6(api,qtip){this._ns=\"ie6\",this.init(this.qtip=api)}$.extend(Ie6.prototype,{_scroll:function(){var overlay=this.qtip.elements.overlay;overlay&&(overlay[0].style.top=$(window).scrollTop()+\"px\")},init:function(qtip){var tooltip=qtip.tooltip;$(\"select, object\").length<1&&(this.bgiframe=qtip.elements.bgiframe=$('<iframe class=\"qtip-bgiframe\" frameborder=\"0\" tabindex=\"-1\" src=\"javascript:\\'\\';\"  style=\"display:block; position:absolute; z-index:-1; filter:alpha(opacity=0); -ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)\";\"></iframe>').appendTo(tooltip),qtip._bind(tooltip,\"tooltipmove\",this.adjustBGIFrame,this._ns,this)),this.redrawContainer=$(\"<div/>\",{id:NAMESPACE+\"-rcontainer\"}).appendTo(document.body),qtip.elements.overlay&&qtip.elements.overlay.addClass(\"qtipmodal-ie6fix\")&&(qtip._bind(window,[\"scroll\",\"resize\"],this._scroll,this._ns,this),qtip._bind(tooltip,[\"tooltipshow\"],this._scroll,this._ns,this)),this.redraw()},adjustBGIFrame:function(){var tipAdjust,offset,tooltip=this.qtip.tooltip,dimensions={height:tooltip.outerHeight(FALSE),width:tooltip.outerWidth(FALSE)},plugin=this.qtip.plugins.tip,tip=this.qtip.elements.tip;offset={left:-(offset=parseInt(tooltip.css(\"borderLeftWidth\"),10)||0),top:-offset},plugin&&tip&&(offset[(tipAdjust=\"x\"===plugin.corner.precedance?[WIDTH,LEFT]:[\"height\",TOP])[1]]-=tip[tipAdjust[0]]()),this.bgiframe.css(offset).css(dimensions)},redraw:function(){if(this.qtip.rendered<1||this.drawing)return this;var perc,width,max,min,tooltip=this.qtip.tooltip,style=this.qtip.options.style,container=this.qtip.options.position.container;return this.qtip.drawing=1,style.height&&tooltip.css(\"height\",style.height),style.width?tooltip.css(WIDTH,style.width):(tooltip.css(WIDTH,\"\").appendTo(this.redrawContainer),(width=tooltip.width())%2<1&&(width+=1),perc=((max=tooltip.css(\"maxWidth\")||\"\")+(min=tooltip.css(\"minWidth\")||\"\")).indexOf(\"%\")>-1?container.width()/100:0,width=(max=(max.indexOf(\"%\")>-1?perc:1)*parseInt(max,10)||width)+(min=(min.indexOf(\"%\")>-1?perc:1)*parseInt(min,10)||0)?Math.min(Math.max(width,min),max):width,tooltip.css(WIDTH,Math.round(width)).appendTo(container)),this.drawing=0,this},destroy:function(){this.bgiframe&&this.bgiframe.remove(),this.qtip._unbind([window,this.qtip.tooltip],this._ns)}}),(PLUGINS.ie6=function(api){return 6===BROWSER.ie?new Ie6(api):FALSE}).initialize=\"render\",CHECKS.ie6={\"^content|style$\":function(){this.redraw()}}})}(window,document),function($){$.fn.slugify=function(source,options){return this.each(function(){var $target=$(this),$source=$(source);$target.on(\"keyup change\",function(){\"\"!==$target.val()&&void 0!==$target.val()?$target.data(\"locked\",!0):$target.data(\"locked\",!1)}),$source.on(\"keyup change\",function(){!0!==$target.data(\"locked\")&&($target.is(\"input\")||$target.is(\"textarea\")?$target.val($.slugify($source.val(),options)):$target.text($.slugify($source.val(),options)))})})},$.slugify=function(sourceString,options){return\"function\"==typeof(options=$.extend({},$.slugify.options,options)).preSlug&&(sourceString=options.preSlug(sourceString)),sourceString=(sourceString=$.trim(sourceString)).toLowerCase(),$.each(options.replaceMap,function(key,value){sourceString=sourceString.replace(new RegExp(key,\"g\"),value)}),sourceString=(sourceString=sourceString.replace(/\\s+/g,options.whitespace).replace(new RegExp(\"[^a-z0-9 \"+options.whitespace+\"]\",\"g\"),options.invalid)).replace(new RegExp(\"\\\\\"+options.invalid+\"+\",\"g\"),options.invalid).replace(new RegExp(\"(^\\\\\"+options.invalid+\"+|\\\\\"+options.invalid+\"+$)\",\"g\"),\"\"),\"function\"==typeof options.postSlug&&(sourceString=options.postSlug(sourceString)),sourceString},$.slugify.options={whitespace:\"-\",invalid:\"\",preSlug:null,postSlug:null,replaceMap:{\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"ae\",\"\":\"a\",\"\":\"ae\",\"\":\"c\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"oe\",\"\":\"o\",\"\":\"oe\",\"\":\"ss\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"ue\",\"\":\"u\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"b\",\"\":\"b\",\"\":\"b\",\"\":\"b\",\"\":\"b\",\"\":\"b\",\"\":\"b\",\"\":\"b\",\"\":\"b\",\"\":\"c\",\"\":\"c\",\"\":\"c\",\"\":\"c\",\"\":\"c\",\"\":\"c\",\"\":\"c\",\"\":\"c\",\"\":\"d\",\"\":\"d\",\"\":\"d\",\"\":\"d\",\"\":\"d\",\"\":\"d\",\"\":\"d\",\"\":\"d\",\"\":\"d\",\"\":\"d\",\"\":\"d\",\"\":\"d\",\"\":\"d\",\"\":\"d\",\"\":\"d\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"f\",\"\":\"f\",\"\":\"f\",\"\":\"f\",\"\":\"g\",\"\":\"g\",\"\":\"g\",\"\":\"g\",\"\":\"g\",\"\":\"g\",\"\":\"g\",\"\":\"g\",\"\":\"g\",\"\":\"g\",\"\":\"h\",\"\":\"h\",\"\":\"h\",\"\":\"h\",\"\":\"h\",\"\":\"h\",\"\":\"h\",\"\":\"h\",\"\":\"h\",\"\":\"h\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",i:\"i\",\"\":\"i\",\"\":\"j\",\"\":\"j\",\"\":\"j\",\"\":\"j\",\"\":\"j\",\"\":\"j\",\"\":\"j\",\"\":\"k\",\"\":\"k\",\"\":\"k\",\"\":\"k\",\"\":\"k\",\"\":\"k\",\"\":\"k\",\"\":\"k\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"m\",\"\":\"m\",\"\":\"m\",\"\":\"m\",\"\":\"m\",\"\":\"m\",\"\":\"n\",\"\":\"n\",\"\":\"n\",\"\":\"n\",\"\":\"n\",\"\":\"n\",\"\":\"n\",\"\":\"n\",\"\":\"n\",\"n\":\"n\",\"\":\"n\",\"\":\"n\",\"\":\"n\",\"\":\"n\",\"\":\"n\",\"\":\"n\",\"\":\"n\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"o\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"p\",\"\":\"p\",\"\":\"p\",\"\":\"p\",\"p\":\"p\",\"\":\"p\",\"\":\"p\",\"\":\"q\",\"\":\"q\",\"\":\"q\",\"\":\"r\",\"\":\"r\",\"\":\"r\",\"\":\"r\",\"\":\"r\",\"\":\"r\",\"\":\"r\",\"\":\"r\",\"\":\"r\",\"\":\"r\",\"\":\"r\",\"\":\"r\",\"\":\"r\",\"\":\"r\",\"\":\"r\",\"\":\"r\",\"\":\"s\",\"\":\"s\",\"\":\"s\",\"\":\"s\",\"\":\"s\",\"\":\"s\",\"\":\"s\",\"\":\"s\",\"\":\"s\",\"\":\"s\",\"s\":\"s\",\"\":\"s\",\"\":\"s\",\"\":\"s\",\"\":\"s\",\"\":\"t\",\"\":\"t\",\"\":\"t\",\"\":\"t\",\"\":\"t\",\"\":\"t\",\"\":\"t\",\"\":\"t\",\"\":\"t\",\"\":\"t\",\"\":\"t\",\"\":\"t\",\"\":\"t\",\"\":\"t\",\"\":\"t\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"v\",\"\":\"v\",\"\":\"v\",\"\":\"v\",\"\":\"v\",\"\":\"w\",\"\":\"w\",\"\":\"w\",\"\":\"w\",\"\":\"w\",\"\":\"w\",\"\":\"w\",\"\":\"x\",\"\":\"x\",\"\":\"x\",\"\":\"y\",\"\":\"y\",\"\":\"y\",\"\":\"y\",\"\":\"y\",\"\":\"y\",\"\":\"y\",\"\":\"y\",\"\":\"y\",\"\":\"y\",\"\":\"y\",\"\":\"y\",\"\":\"y\",\"\":\"z\",\"\":\"z\",\"\":\"z\",\"\":\"z\",\"\":\"z\",\"\":\"z\",\"\":\"z\",\"\":\"z\",\"\":\"z\",\"\":\"z\",\"\":\"z\",\"\":\"z\",\"\":\"z\",\"\":\"z\",\"\":\"a\",\"\":\"b\",\"\":\"g\",\"\":\"g\",\"\":\"d\",\"\":\"d\",\"\":\"e\",\"\":\"z\",\"\":\"i\",\"\":\"th\",\"\":\"i\",\"\":\"k\",\"\":\"l\",\"\":\"m\",\"\":\"m\",\"\":\"n\",\"\":\"x\",\"\":\"o\",\"\":\"p\",\"\":\"r\",\"\":\"s\",\"\":\"s\",\"\":\"t\",\"\":\"u\",\"\":\"f\",\"\":\"ch\",\"\":\"ps\",\"\":\"o\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"r\",\"\":\"r\",\"\":\"a\",\"\":\"b\",\"\":\"v\",\"\":\"g\",\"\":\"d\",\"\":\"e\",\"\":\"e\",\"\":\"zh\",\"\":\"z\",\"\":\"i\",\"\":\"j\",\"\":\"k\",\"\":\"l\",\"\":\"m\",\"\":\"n\",\"\":\"o\",\"\":\"p\",\"\":\"r\",\"\":\"s\",\"\":\"t\",\"\":\"u\",\"\":\"f\",\"\":\"h\",\"\":\"ts\",\"\":\"ch\",\"\":\"sh\",\"\":\"sh\",\"\":\"i\",\"\":\"\",\"\":\"\",\"\":\"e\",\"\":\"yu\",\"\":\"ya\",\"\":\"j\",\"\":\"f\",\"\":\"e\",\"\":\"i\",\"\":\"z\",\"\":\"ks\",\"\":\"ps\",\"\":\"o\",\"\":\"yu\",\"\":\"ya\",\"\":\"yu\",\"\":\"ya\",\"\":\"ye\",\"\":\"yi\",\"\":\"g\",\"\":\"a\",\"\":\"a\",\"\":\"i\",\"\":\"aa\",\"\":\"u\",\"\":\"e\",\"\":\"a\",\"\":\"b\",\"\":\"t\",\"\":\"th\",\"\":\"j\",\"\":\"h\",\"\":\"kh\",\"\":\"d\",\"\":\"th\",\"\":\"r\",\"\":\"z\",\"\":\"s\",\"\":\"sh\",\"\":\"s\",\"\":\"dh\",\"\":\"t\",\"\":\"z\",\"\":\"a\",\"\":\"gh\",\"\":\"f\",\"\":\"q\",\"\":\"k\",\"\":\"l\",\"\":\"m\",\"\":\"n\",\"\":\"h\",\"\":\"w\",\"\":\"y\",\"\":\"a\",\"\":\"h\",\"\":\"la\",\"\":\"laa\",\"\":\"lai\",\"\":\"laa\",\"\":\"0\",\"\":\"1\",\"\":\"2\",\"\":\"3\",\"\":\"4\",\"\":\"5\",\"\":\"6\",\"\":\"7\",\"\":\"8\",\"\":\"9\",\"\\\\$\":\"usd\",\"\":\"eur\",\"\":\"brn\",\"\":\"frf\",\"\":\"gbp\",\"\":\"itl\",\"\":\"ngn\",\"\":\"esp\",\"\":\"krw\",\"\":\"ils\",\"\":\"vnd\",\"\":\"lak\",\"\":\"mnt\",\"\":\"grd\",\"\":\"ars\",\"\":\"pyg\",\"\":\"ara\",\"\":\"uah\",\"\":\"ghs\",\"\":\"cent\",\"\":\"cny\",\"\":\"cny\",\"\":\"yes\",\"\":\"irr\",\"\":\"ewe\",\"\":\"thb\",\"\":\"inr\",\"\":\"inr\",\"\":\"pf\"}}}(jQuery),function($){var _=function(){\"use strict\";return{isMsie:function(){return!!/(msie|trident)/i.test(navigator.userAgent)&&navigator.userAgent.match(/(msie |rv:)(\\d+(.\\d+)?)/i)[2]},isBlankString:function(str){return!str||/^\\s*$/.test(str)},escapeRegExChars:function(str){return str.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g,\"\\\\$&\")},isString:function(obj){return\"string\"==typeof obj},isNumber:function(obj){return\"number\"==typeof obj},isArray:$.isArray,isFunction:$.isFunction,isObject:$.isPlainObject,isUndefined:function(obj){return void 0===obj},toStr:function(s){return _.isUndefined(s)||null===s?\"\":s+\"\"},bind:$.proxy,each:function(collection,cb){$.each(collection,function(index,value){return cb(value,index)})},map:$.map,filter:$.grep,every:function(obj,test){var result=!0;return obj?($.each(obj,function(key,val){if(!(result=test.call(null,val,key,obj)))return!1}),!!result):result},some:function(obj,test){var result=!1;return obj?($.each(obj,function(key,val){if(result=test.call(null,val,key,obj))return!1}),!!result):result},mixin:$.extend,getUniqueId:(counter=0,function(){return counter++}),templatify:function(obj){return $.isFunction(obj)?obj:function(){return String(obj)}},defer:function(fn){setTimeout(fn,0)},debounce:function(func,wait,immediate){var timeout,result;return function(){var later,callNow,context=this,args=arguments;return later=function(){timeout=null,immediate||(result=func.apply(context,args))},callNow=immediate&&!timeout,clearTimeout(timeout),timeout=setTimeout(later,wait),callNow&&(result=func.apply(context,args)),result}},throttle:function(func,wait){var context,args,timeout,result,previous,later;return previous=0,later=function(){previous=new Date,timeout=null,result=func.apply(context,args)},function(){var now=new Date,remaining=wait-(now-previous);return context=this,args=arguments,remaining<=0?(clearTimeout(timeout),timeout=null,previous=now,result=func.apply(context,args)):timeout||(timeout=setTimeout(later,remaining)),result}},noop:function(){}};var counter}(),html={wrapper:'<span class=\"twitter-typeahead\"></span>',dropdown:'<span class=\"tt-dropdown-menu\"></span>',dataset:'<div class=\"tt-dataset-%CLASS%\"></div>',suggestions:'<span class=\"tt-suggestions\"></span>',suggestion:'<div class=\"tt-suggestion\"></div>'},css=function(){\"use strict\";var css={wrapper:{position:\"relative\",display:\"inline-block\"},hint:{position:\"absolute\",top:\"0\",left:\"0\",borderColor:\"transparent\",boxShadow:\"none\",opacity:\"1\"},input:{position:\"relative\",verticalAlign:\"top\",backgroundColor:\"transparent\"},inputWithNoHint:{position:\"relative\",verticalAlign:\"top\"},dropdown:{position:\"absolute\",top:\"100%\",left:\"0\",zIndex:\"100\",display:\"none\"},suggestions:{display:\"block\"},suggestion:{whiteSpace:\"nowrap\",cursor:\"pointer\"},suggestionChild:{whiteSpace:\"normal\"},ltr:{left:\"0\",right:\"auto\"},rtl:{left:\"auto\",right:\" 0\"}};return _.isMsie()&&_.mixin(css.input,{backgroundImage:\"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)\"}),_.isMsie()&&_.isMsie()<=7&&_.mixin(css.input,{marginTop:\"-1px\"}),css}(),EventBus=function(){\"use strict\";function EventBus(o){o&&o.el||$.error(\"EventBus initialized without el\"),this.$el=$(o.el)}return _.mixin(EventBus.prototype,{trigger:function(type){var args=[].slice.call(arguments,1);this.$el.trigger(\"typeahead:\"+type,args)}}),EventBus}(),EventEmitter=function(){\"use strict\";var splitter=/\\s+/,nextTick=function(){var nextTickFn;nextTickFn=window.setImmediate?function(fn){setImmediate(function(){fn()})}:function(fn){setTimeout(function(){fn()},0)};return nextTickFn}();return{onSync:function(types,cb,context){return on.call(this,\"sync\",types,cb,context)},onAsync:function(types,cb,context){return on.call(this,\"async\",types,cb,context)},off:function(types){var type;if(!this._callbacks)return this;types=types.split(splitter);for(;type=types.shift();)delete this._callbacks[type];return this},trigger:function(types){var type,callbacks,args,syncFlush,asyncFlush;if(!this._callbacks)return this;types=types.split(splitter),args=[].slice.call(arguments,1);for(;(type=types.shift())&&(callbacks=this._callbacks[type]);)syncFlush=getFlush(callbacks.sync,this,[type].concat(args)),asyncFlush=getFlush(callbacks.async,this,[type].concat(args)),syncFlush()&&nextTick(asyncFlush);return this}};function on(method,types,cb,context){var type;if(!cb)return this;for(types=types.split(splitter),cb=context?function(fn,context){return fn.bind?fn.bind(context):function(){fn.apply(context,[].slice.call(arguments,0))}}(cb,context):cb,this._callbacks=this._callbacks||{};type=types.shift();)this._callbacks[type]=this._callbacks[type]||{sync:[],async:[]},this._callbacks[type][method].push(cb);return this}function getFlush(callbacks,context,args){return function(){for(var cancelled,i=0,len=callbacks.length;!cancelled&&i<len;i+=1)cancelled=!1===callbacks[i].apply(context,args);return!cancelled}}}(),highlight=function(doc){\"use strict\";var defaults={node:null,pattern:null,tagName:\"strong\",className:null,wordsOnly:!1,caseSensitive:!1};return function(o){var regex;(o=_.mixin({},defaults,o)).node&&o.pattern&&(o.pattern=_.isArray(o.pattern)?o.pattern:[o.pattern],regex=function(patterns,caseSensitive,wordsOnly){for(var regexStr,escapedPatterns=[],i=0,len=patterns.length;i<len;i++)escapedPatterns.push(_.escapeRegExChars(patterns[i]));return regexStr=wordsOnly?\"\\\\b(\"+escapedPatterns.join(\"|\")+\")\\\\b\":\"(\"+escapedPatterns.join(\"|\")+\")\",caseSensitive?new RegExp(regexStr):new RegExp(regexStr,\"i\")}(o.pattern,o.caseSensitive,o.wordsOnly),function traverse(el,hightlightTextNode){var childNode;for(var i=0;i<el.childNodes.length;i++)3===(childNode=el.childNodes[i]).nodeType?i+=hightlightTextNode(childNode)?1:0:traverse(childNode,hightlightTextNode)}(o.node,function(textNode){var match,patternNode,wrapperNode;(match=regex.exec(textNode.data))&&(wrapperNode=doc.createElement(o.tagName),o.className&&(wrapperNode.className=o.className),(patternNode=textNode.splitText(match.index)).splitText(match[0].length),wrapperNode.appendChild(patternNode.cloneNode(!0)),textNode.parentNode.replaceChild(wrapperNode,patternNode));return!!match}))}}(window.document),Input=function(){\"use strict\";var specialKeyCodeMap;function Input(o){var onBlur,onFocus,onKeydown,onInput,$input,that=this;(o=o||{}).input||$.error(\"input is missing\"),onBlur=_.bind(this._onBlur,this),onFocus=_.bind(this._onFocus,this),onKeydown=_.bind(this._onKeydown,this),onInput=_.bind(this._onInput,this),this.$hint=$(o.hint),this.$input=$(o.input).on(\"blur.tt\",onBlur).on(\"focus.tt\",onFocus).on(\"keydown.tt\",onKeydown),0===this.$hint.length&&(this.setHint=this.getHint=this.clearHint=this.clearHintIfInvalid=_.noop),_.isMsie()?this.$input.on(\"keydown.tt keypress.tt cut.tt paste.tt\",function($e){specialKeyCodeMap[$e.which||$e.keyCode]||_.defer(_.bind(that._onInput,that,$e))}):this.$input.on(\"input.tt\",onInput),this.query=this.$input.val(),this.$overflowHelper=($input=this.$input,$('<pre aria-hidden=\"true\"></pre>').css({position:\"absolute\",visibility:\"hidden\",whiteSpace:\"pre\",fontFamily:$input.css(\"font-family\"),fontSize:$input.css(\"font-size\"),fontStyle:$input.css(\"font-style\"),fontVariant:$input.css(\"font-variant\"),fontWeight:$input.css(\"font-weight\"),wordSpacing:$input.css(\"word-spacing\"),letterSpacing:$input.css(\"letter-spacing\"),textIndent:$input.css(\"text-indent\"),textRendering:$input.css(\"text-rendering\"),textTransform:$input.css(\"text-transform\")}).insertAfter($input))}return specialKeyCodeMap={9:\"tab\",27:\"esc\",37:\"left\",39:\"right\",13:\"enter\",38:\"up\",40:\"down\"},Input.normalizeQuery=function(str){return(str||\"\").replace(/^\\s*/g,\"\").replace(/\\s{2,}/g,\" \")},_.mixin(Input.prototype,EventEmitter,{_onBlur:function(){this.resetInputValue(),this.trigger(\"blurred\")},_onFocus:function(){this.trigger(\"focused\")},_onKeydown:function($e){var keyName=specialKeyCodeMap[$e.which||$e.keyCode];this._managePreventDefault(keyName,$e),keyName&&this._shouldTrigger(keyName,$e)&&this.trigger(keyName+\"Keyed\",$e)},_onInput:function(){this._checkInputValue()},_managePreventDefault:function(keyName,$e){var preventDefault,hintValue,inputValue;switch(keyName){case\"tab\":hintValue=this.getHint(),inputValue=this.getInputValue(),preventDefault=hintValue&&hintValue!==inputValue&&!withModifier($e);break;case\"up\":case\"down\":preventDefault=!withModifier($e);break;default:preventDefault=!1}preventDefault&&$e.preventDefault()},_shouldTrigger:function(keyName,$e){var trigger;switch(keyName){case\"tab\":trigger=!withModifier($e);break;default:trigger=!0}return trigger},_checkInputValue:function(){var inputValue,areEquivalent,hasDifferentWhitespace,a,b;inputValue=this.getInputValue(),a=inputValue,b=this.query,hasDifferentWhitespace=!!(areEquivalent=Input.normalizeQuery(a)===Input.normalizeQuery(b))&&this.query.length!==inputValue.length,this.query=inputValue,areEquivalent?hasDifferentWhitespace&&this.trigger(\"whitespaceChanged\",this.query):this.trigger(\"queryChanged\",this.query)},focus:function(){this.$input.focus()},blur:function(){this.$input.blur()},getQuery:function(){return this.query},setQuery:function(query){this.query=query},getInputValue:function(){return this.$input.val()},setInputValue:function(value,silent){this.$input.val(value),silent?this.clearHint():this._checkInputValue()},resetInputValue:function(){this.setInputValue(this.query,!0)},getHint:function(){return this.$hint.val()},setHint:function(value){this.$hint.val(value)},clearHint:function(){this.setHint(\"\")},clearHintIfInvalid:function(){var val,hint,valIsPrefixOfHint;valIsPrefixOfHint=(val=this.getInputValue())!==(hint=this.getHint())&&0===hint.indexOf(val),!(\"\"!==val&&valIsPrefixOfHint&&!this.hasOverflow())&&this.clearHint()},getLanguageDirection:function(){return(this.$input.css(\"direction\")||\"ltr\").toLowerCase()},hasOverflow:function(){var constraint=this.$input.width()-2;return this.$overflowHelper.text(this.getInputValue()),this.$overflowHelper.width()>=constraint},isCursorAtEnd:function(){var valueLength,selectionStart,range;return valueLength=this.$input.val().length,selectionStart=this.$input[0].selectionStart,_.isNumber(selectionStart)?selectionStart===valueLength:!document.selection||((range=document.selection.createRange()).moveStart(\"character\",-valueLength),valueLength===range.text.length)},destroy:function(){this.$hint.off(\".tt\"),this.$input.off(\".tt\"),this.$hint=this.$input=this.$overflowHelper=null}}),Input;function withModifier($e){return $e.altKey||$e.ctrlKey||$e.metaKey||$e.shiftKey}}(),Dataset=function(){\"use strict\";var datasetKey=\"ttDataset\",valueKey=\"ttValue\",datumKey=\"ttDatum\";function Dataset(o){var str;(o=o||{}).templates=o.templates||{},o.source||$.error(\"missing source\"),o.name&&(str=o.name,!/^[_a-zA-Z0-9-]+$/.test(str))&&$.error(\"invalid dataset name: \"+o.name),this.query=null,this.highlight=!!o.highlight,this.name=o.name||_.getUniqueId(),this.source=o.source,this.displayFn=function(display){return display=display||\"value\",_.isFunction(display)?display:function(obj){return obj[display]}}(o.display||o.displayKey),this.templates=function(templates,displayFn){return{empty:templates.empty&&_.templatify(templates.empty),header:templates.header&&_.templatify(templates.header),footer:templates.footer&&_.templatify(templates.footer),suggestion:templates.suggestion||function(context){return\"<p>\"+displayFn(context)+\"</p>\"}}}(o.templates,this.displayFn),this.$el=$(html.dataset.replace(\"%CLASS%\",this.name))}return Dataset.extractDatasetName=function(el){return $(el).data(datasetKey)},Dataset.extractValue=function(el){return $(el).data(valueKey)},Dataset.extractDatum=function(el){return $(el).data(datumKey)},_.mixin(Dataset.prototype,EventEmitter,{_render:function(query,suggestions){if(this.$el){var hasSuggestions,that=this;this.$el.empty(),!(hasSuggestions=suggestions&&suggestions.length)&&this.templates.empty?this.$el.html(that.templates.empty({query:query,isEmpty:!0})).prepend(that.templates.header?getHeaderHtml():null).append(that.templates.footer?getFooterHtml():null):hasSuggestions&&this.$el.html(function(){var $suggestions,nodes;return $suggestions=$(html.suggestions).css(css.suggestions),nodes=_.map(suggestions,function(suggestion){var $el;return($el=$(html.suggestion).append(that.templates.suggestion(suggestion)).data(datasetKey,that.name).data(valueKey,that.displayFn(suggestion)).data(datumKey,suggestion)).children().each(function(){$(this).css(css.suggestionChild)}),$el}),$suggestions.append.apply($suggestions,nodes),that.highlight&&highlight({className:\"tt-highlight\",node:$suggestions[0],pattern:query}),$suggestions}()).prepend(that.templates.header?getHeaderHtml():null).append(that.templates.footer?getFooterHtml():null),this.trigger(\"rendered\")}function getHeaderHtml(){return that.templates.header({query:query,isEmpty:!hasSuggestions})}function getFooterHtml(){return that.templates.footer({query:query,isEmpty:!hasSuggestions})}},getRoot:function(){return this.$el},update:function(query){var that=this;this.query=query,this.canceled=!1,this.source(query,function(suggestions){that.canceled||query!==that.query||that._render(query,suggestions)})},cancel:function(){this.canceled=!0},clear:function(){this.cancel(),this.$el.empty(),this.trigger(\"rendered\")},isEmpty:function(){return this.$el.is(\":empty\")},destroy:function(){this.$el=null}}),Dataset}(),Dropdown=function(){\"use strict\";function Dropdown(o){var onSuggestionClick,onSuggestionMouseEnter,onSuggestionMouseLeave,that=this;(o=o||{}).menu||$.error(\"menu is required\"),this.isOpen=!1,this.isEmpty=!0,this.datasets=_.map(o.datasets,initializeDataset),onSuggestionClick=_.bind(this._onSuggestionClick,this),onSuggestionMouseEnter=_.bind(this._onSuggestionMouseEnter,this),onSuggestionMouseLeave=_.bind(this._onSuggestionMouseLeave,this),this.$menu=$(o.menu).on(\"click.tt\",\".tt-suggestion\",onSuggestionClick).on(\"mouseenter.tt\",\".tt-suggestion\",onSuggestionMouseEnter).on(\"mouseleave.tt\",\".tt-suggestion\",onSuggestionMouseLeave),_.each(this.datasets,function(dataset){that.$menu.append(dataset.getRoot()),dataset.onSync(\"rendered\",that._onRendered,that)})}return _.mixin(Dropdown.prototype,EventEmitter,{_onSuggestionClick:function($e){this.trigger(\"suggestionClicked\",$($e.currentTarget))},_onSuggestionMouseEnter:function($e){this._removeCursor(),this._setCursor($($e.currentTarget),!0)},_onSuggestionMouseLeave:function(){this._removeCursor()},_onRendered:function(){this.isEmpty=_.every(this.datasets,function(dataset){return dataset.isEmpty()}),this.isEmpty?this._hide():this.isOpen&&this._show(),this.trigger(\"datasetRendered\")},_hide:function(){this.$menu.hide()},_show:function(){this.$menu.css(\"display\",\"block\")},_getSuggestions:function(){return this.$menu.find(\".tt-suggestion\")},_getCursor:function(){return this.$menu.find(\".tt-cursor\").first()},_setCursor:function($el,silent){$el.first().addClass(\"tt-cursor\"),!silent&&this.trigger(\"cursorMoved\")},_removeCursor:function(){this._getCursor().removeClass(\"tt-cursor\")},_moveCursor:function(increment){var $suggestions,$oldCursor,newCursorIndex,$newCursor;this.isOpen&&($oldCursor=this._getCursor(),$suggestions=this._getSuggestions(),this._removeCursor(),-1!==(newCursorIndex=((newCursorIndex=$suggestions.index($oldCursor)+increment)+1)%($suggestions.length+1)-1)?(newCursorIndex<-1&&(newCursorIndex=$suggestions.length-1),this._setCursor($newCursor=$suggestions.eq(newCursorIndex)),this._ensureVisible($newCursor)):this.trigger(\"cursorRemoved\"))},_ensureVisible:function($el){var elTop,elBottom,menuScrollTop,menuHeight;elBottom=(elTop=$el.position().top)+$el.outerHeight(!0),menuScrollTop=this.$menu.scrollTop(),menuHeight=this.$menu.height()+parseInt(this.$menu.css(\"paddingTop\"),10)+parseInt(this.$menu.css(\"paddingBottom\"),10),elTop<0?this.$menu.scrollTop(menuScrollTop+elTop):menuHeight<elBottom&&this.$menu.scrollTop(menuScrollTop+(elBottom-menuHeight))},close:function(){this.isOpen&&(this.isOpen=!1,this._removeCursor(),this._hide(),this.trigger(\"closed\"))},open:function(){this.isOpen||(this.isOpen=!0,!this.isEmpty&&this._show(),this.trigger(\"opened\"))},setLanguageDirection:function(dir){this.$menu.css(\"ltr\"===dir?css.ltr:css.rtl)},moveCursorUp:function(){this._moveCursor(-1)},moveCursorDown:function(){this._moveCursor(1)},getDatumForSuggestion:function($el){var datum=null;return $el.length&&(datum={raw:Dataset.extractDatum($el),value:Dataset.extractValue($el),datasetName:Dataset.extractDatasetName($el)}),datum},getDatumForCursor:function(){return this.getDatumForSuggestion(this._getCursor().first())},getDatumForTopSuggestion:function(){return this.getDatumForSuggestion(this._getSuggestions().first())},update:function(query){_.each(this.datasets,function(dataset){dataset.update(query)})},empty:function(){_.each(this.datasets,function(dataset){dataset.clear()}),this.isEmpty=!0},isVisible:function(){return this.isOpen&&!this.isEmpty},destroy:function(){this.$menu.off(\".tt\"),this.$menu=null,_.each(this.datasets,function(dataset){dataset.destroy()})}}),Dropdown;function initializeDataset(oDataset){return new Dataset(oDataset)}}(),Typeahead=function(){\"use strict\";var attrsKey=\"ttAttrs\";function Typeahead(o){var $menu,$input,$hint;(o=o||{}).input||$.error(\"missing input\"),this.isActivated=!1,this.autoselect=!!o.autoselect,this.minLength=_.isNumber(o.minLength)?o.minLength:1,this.$node=function(input,withHint){var $input,$wrapper,$dropdown,$hint;$input=$(input),$wrapper=$(html.wrapper).css(css.wrapper),$dropdown=$(html.dropdown).css(css.dropdown),($hint=$input.clone().css(css.hint).css(($el=$input,{backgroundAttachment:$el.css(\"background-attachment\"),backgroundClip:$el.css(\"background-clip\"),backgroundColor:$el.css(\"background-color\"),backgroundImage:$el.css(\"background-image\"),backgroundOrigin:$el.css(\"background-origin\"),backgroundPosition:$el.css(\"background-position\"),backgroundRepeat:$el.css(\"background-repeat\"),backgroundSize:$el.css(\"background-size\")}))).val(\"\").removeData().addClass(\"tt-hint\").removeAttr(\"id name placeholder required\").prop(\"readonly\",!0).attr({autocomplete:\"off\",spellcheck:\"false\",tabindex:-1}),$input.data(attrsKey,{dir:$input.attr(\"dir\"),autocomplete:$input.attr(\"autocomplete\"),spellcheck:$input.attr(\"spellcheck\"),style:$input.attr(\"style\")}),$input.addClass(\"tt-input\").attr({autocomplete:\"off\",spellcheck:!1}).css(withHint?css.input:css.inputWithNoHint);var $el;try{!$input.attr(\"dir\")&&$input.attr(\"dir\",\"auto\")}catch(e){}return $input.wrap($wrapper).parent().prepend(withHint?$hint:null).append($dropdown)}(o.input,o.withHint),$menu=this.$node.find(\".tt-dropdown-menu\"),$input=this.$node.find(\".tt-input\"),$hint=this.$node.find(\".tt-hint\"),$input.on(\"blur.tt\",function($e){var active,isActive,hasActive;active=document.activeElement,isActive=$menu.is(active),hasActive=$menu.has(active).length>0,_.isMsie()&&(isActive||hasActive)&&($e.preventDefault(),$e.stopImmediatePropagation(),_.defer(function(){$input.focus()}))}),$menu.on(\"mousedown.tt\",function($e){$e.preventDefault()}),this.eventBus=o.eventBus||new EventBus({el:$input}),this.dropdown=new Dropdown({menu:$menu,datasets:o.datasets}).onSync(\"suggestionClicked\",this._onSuggestionClicked,this).onSync(\"cursorMoved\",this._onCursorMoved,this).onSync(\"cursorRemoved\",this._onCursorRemoved,this).onSync(\"opened\",this._onOpened,this).onSync(\"closed\",this._onClosed,this).onAsync(\"datasetRendered\",this._onDatasetRendered,this),this.input=new Input({input:$input,hint:$hint}).onSync(\"focused\",this._onFocused,this).onSync(\"blurred\",this._onBlurred,this).onSync(\"enterKeyed\",this._onEnterKeyed,this).onSync(\"tabKeyed\",this._onTabKeyed,this).onSync(\"escKeyed\",this._onEscKeyed,this).onSync(\"upKeyed\",this._onUpKeyed,this).onSync(\"downKeyed\",this._onDownKeyed,this).onSync(\"leftKeyed\",this._onLeftKeyed,this).onSync(\"rightKeyed\",this._onRightKeyed,this).onSync(\"queryChanged\",this._onQueryChanged,this).onSync(\"whitespaceChanged\",this._onWhitespaceChanged,this),this._setLanguageDirection()}return _.mixin(Typeahead.prototype,{_onSuggestionClicked:function(type,$el){var datum;(datum=this.dropdown.getDatumForSuggestion($el))&&this._select(datum)},_onCursorMoved:function(){var datum=this.dropdown.getDatumForCursor();this.input.setInputValue(datum.value,!0),this.eventBus.trigger(\"cursorchanged\",datum.raw,datum.datasetName)},_onCursorRemoved:function(){this.input.resetInputValue(),this._updateHint()},_onDatasetRendered:function(){this._updateHint()},_onOpened:function(){this._updateHint(),this.eventBus.trigger(\"opened\")},_onClosed:function(){this.input.clearHint(),this.eventBus.trigger(\"closed\")},_onFocused:function(){this.isActivated=!0,this.dropdown.open()},_onBlurred:function(){this.isActivated=!1,this.dropdown.empty(),this.dropdown.close()},_onEnterKeyed:function(type,$e){var cursorDatum,topSuggestionDatum;cursorDatum=this.dropdown.getDatumForCursor(),topSuggestionDatum=this.dropdown.getDatumForTopSuggestion(),cursorDatum?(this._select(cursorDatum),$e.preventDefault()):this.autoselect&&topSuggestionDatum&&(this._select(topSuggestionDatum),$e.preventDefault())},_onTabKeyed:function(type,$e){var datum;(datum=this.dropdown.getDatumForCursor())?(this._select(datum),$e.preventDefault()):this._autocomplete(!0)},_onEscKeyed:function(){this.dropdown.close(),this.input.resetInputValue()},_onUpKeyed:function(){var query=this.input.getQuery();this.dropdown.isEmpty&&query.length>=this.minLength?this.dropdown.update(query):this.dropdown.moveCursorUp(),this.dropdown.open()},_onDownKeyed:function(){var query=this.input.getQuery();this.dropdown.isEmpty&&query.length>=this.minLength?this.dropdown.update(query):this.dropdown.moveCursorDown(),this.dropdown.open()},_onLeftKeyed:function(){\"rtl\"===this.dir&&this._autocomplete()},_onRightKeyed:function(){\"ltr\"===this.dir&&this._autocomplete()},_onQueryChanged:function(e,query){this.input.clearHintIfInvalid(),query.length>=this.minLength?this.dropdown.update(query):this.dropdown.empty(),this.dropdown.open(),this._setLanguageDirection()},_onWhitespaceChanged:function(){this._updateHint(),this.dropdown.open()},_setLanguageDirection:function(){var dir;this.dir!==(dir=this.input.getLanguageDirection())&&(this.dir=dir,this.$node.css(\"direction\",dir),this.dropdown.setLanguageDirection(dir))},_updateHint:function(){var datum,val,query,escapedQuery,match;(datum=this.dropdown.getDatumForTopSuggestion())&&this.dropdown.isVisible()&&!this.input.hasOverflow()?(val=this.input.getInputValue(),query=Input.normalizeQuery(val),escapedQuery=_.escapeRegExChars(query),(match=new RegExp(\"^(?:\"+escapedQuery+\")(.+$)\",\"i\").exec(datum.value))?this.input.setHint(val+match[1]):this.input.clearHint()):this.input.clearHint()},_autocomplete:function(laxCursor){var hint,query,isCursorAtEnd,datum;hint=this.input.getHint(),query=this.input.getQuery(),isCursorAtEnd=laxCursor||this.input.isCursorAtEnd(),hint&&query!==hint&&isCursorAtEnd&&((datum=this.dropdown.getDatumForTopSuggestion())&&this.input.setInputValue(datum.value),this.eventBus.trigger(\"autocompleted\",datum.raw,datum.datasetName))},_select:function(datum){this.input.setQuery(datum.value),this.input.setInputValue(datum.value,!0),this._setLanguageDirection(),this.eventBus.trigger(\"selected\",datum.raw,datum.datasetName),this.dropdown.close(),_.defer(_.bind(this.dropdown.empty,this.dropdown))},open:function(){this.dropdown.open()},close:function(){this.dropdown.close()},setVal:function(val){val=_.toStr(val),this.isActivated?this.input.setInputValue(val):(this.input.setQuery(val),this.input.setInputValue(val,!0)),this._setLanguageDirection()},getVal:function(){return this.input.getQuery()},destroy:function(){var $node,$input;this.input.destroy(),this.dropdown.destroy(),$node=this.$node,$input=$node.find(\".tt-input\"),_.each($input.data(attrsKey),function(val,key){_.isUndefined(val)?$input.removeAttr(key):$input.attr(key,val)}),$input.detach().removeData(attrsKey).removeClass(\"tt-input\").insertAfter($node),$node.remove(),this.$node=null}}),Typeahead}();!function(){\"use strict\";var old,typeaheadKey,methods;old=$.fn.typeahead,typeaheadKey=\"ttTypeahead\",methods={initialize:function(o,datasets){return datasets=_.isArray(datasets)?datasets:[].slice.call(arguments,1),o=o||{},this.each(function(){var typeahead,$input=$(this);_.each(datasets,function(d){d.highlight=!!o.highlight}),typeahead=new Typeahead({input:$input,eventBus:new EventBus({el:$input}),withHint:!!_.isUndefined(o.hint)||!!o.hint,minLength:o.minLength,autoselect:o.autoselect,datasets:datasets}),$input.data(typeaheadKey,typeahead)})},open:function(){return this.each(function(){var typeahead,$input=$(this);(typeahead=$input.data(typeaheadKey))&&typeahead.open()})},close:function(){return this.each(function(){var typeahead,$input=$(this);(typeahead=$input.data(typeaheadKey))&&typeahead.close()})},val:function(newVal){return arguments.length?this.each(function(){var typeahead,$input=$(this);(typeahead=$input.data(typeaheadKey))&&typeahead.setVal(newVal)}):function($input){var typeahead,query;(typeahead=$input.data(typeaheadKey))&&(query=typeahead.getVal());return query}(this.first())},destroy:function(){return this.each(function(){var typeahead,$input=$(this);(typeahead=$input.data(typeaheadKey))&&(typeahead.destroy(),$input.removeData(typeaheadKey))})}},$.fn.typeahead=function(method){var tts;return methods[method]&&\"initialize\"!==method?(tts=this.filter(function(){return!!$(this).data(typeaheadKey)}),methods[method].apply(tts,[].slice.call(arguments,1))):methods.initialize.apply(this,arguments)},$.fn.typeahead.noConflict=function(){return $.fn.typeahead=old,this}}()}(window.jQuery),function($){\"use strict\";var backdrop=\".dropdown-backdrop\",toggle='[data-toggle=\"dropdown\"]',Dropdown=function(element){$(element).on(\"click.bs.dropdown\",this.toggle)};function getParent($this){var selector=$this.attr(\"data-target\");selector||(selector=(selector=$this.attr(\"href\"))&&/#[A-Za-z]/.test(selector)&&selector.replace(/.*(?=#[^\\s]*$)/,\"\"));var $parent=selector&&$(selector);return $parent&&$parent.length?$parent:$this.parent()}function clearMenus(e){e&&3===e.which||($(backdrop).remove(),$(toggle).each(function(){var $this=$(this),$parent=getParent($this),relatedTarget={relatedTarget:this};$parent.hasClass(\"open\")&&(e&&\"click\"==e.type&&/input|textarea/i.test(e.target.tagName)&&$.contains($parent[0],e.target)||($parent.trigger(e=$.Event(\"hide.bs.dropdown\",relatedTarget)),e.isDefaultPrevented()||($this.attr(\"aria-expanded\",\"false\"),$parent.removeClass(\"open\").trigger($.Event(\"hidden.bs.dropdown\",relatedTarget)))))}))}Dropdown.VERSION=\"3.3.7\",Dropdown.prototype.toggle=function(e){var $this=$(this);if(!$this.is(\".disabled, :disabled\")){var $parent=getParent($this),isActive=$parent.hasClass(\"open\");if(clearMenus(),!isActive){\"ontouchstart\"in document.documentElement&&!$parent.closest(\".navbar-nav\").length&&$(document.createElement(\"div\")).addClass(\"dropdown-backdrop\").insertAfter($(this)).on(\"click\",clearMenus);var relatedTarget={relatedTarget:this};if($parent.trigger(e=$.Event(\"show.bs.dropdown\",relatedTarget)),e.isDefaultPrevented())return;$this.trigger(\"focus\").attr(\"aria-expanded\",\"true\"),$parent.toggleClass(\"open\").trigger($.Event(\"shown.bs.dropdown\",relatedTarget))}return!1}},Dropdown.prototype.keydown=function(e){if(/(38|40|27|32)/.test(e.which)&&!/input|textarea/i.test(e.target.tagName)){var $this=$(this);if(e.preventDefault(),e.stopPropagation(),!$this.is(\".disabled, :disabled\")){var $parent=getParent($this),isActive=$parent.hasClass(\"open\");if(!isActive&&27!=e.which||isActive&&27==e.which)return 27==e.which&&$parent.find(toggle).trigger(\"focus\"),$this.trigger(\"click\");var $items=$parent.find(\".dropdown-menu li:not(.disabled):visible a\");if($items.length){var index=$items.index(e.target);38==e.which&&index>0&&index--,40==e.which&&index<$items.length-1&&index++,~index||(index=0),$items.eq(index).trigger(\"focus\")}}}};var old=$.fn.dropdown;$.fn.dropdown=function(option){return this.each(function(){var $this=$(this),data=$this.data(\"bs.dropdown\");data||$this.data(\"bs.dropdown\",data=new Dropdown(this)),\"string\"==typeof option&&data[option].call($this)})},$.fn.dropdown.Constructor=Dropdown,$.fn.dropdown.noConflict=function(){return $.fn.dropdown=old,this},$(document).on(\"click.bs.dropdown.data-api\",clearMenus).on(\"click.bs.dropdown.data-api\",\".dropdown form\",function(e){e.stopPropagation()}).on(\"click.bs.dropdown.data-api\",toggle,Dropdown.prototype.toggle).on(\"keydown.bs.dropdown.data-api\",toggle,Dropdown.prototype.keydown).on(\"keydown.bs.dropdown.data-api\",\".dropdown-menu\",Dropdown.prototype.keydown)}(jQuery),function($){\"use strict\";var Modal=function(element,options){this.options=options,this.$body=$(document.body),this.$element=$(element),this.$dialog=this.$element.find(\".modal-dialog\"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.options.remote&&this.$element.find(\".modal-content\").load(this.options.remote,$.proxy(function(){this.$element.trigger(\"loaded.bs.modal\")},this))};function Plugin(option,_relatedTarget){return this.each(function(){var $this=$(this),data=$this.data(\"bs.modal\"),options=$.extend({},Modal.DEFAULTS,$this.data(),\"object\"==typeof option&&option);data||$this.data(\"bs.modal\",data=new Modal(this,options)),\"string\"==typeof option?data[option](_relatedTarget):options.show&&data.show(_relatedTarget)})}Modal.VERSION=\"3.3.7\",Modal.TRANSITION_DURATION=300,Modal.BACKDROP_TRANSITION_DURATION=150,Modal.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},Modal.prototype.toggle=function(_relatedTarget){return this.isShown?this.hide():this.show(_relatedTarget)},Modal.prototype.show=function(_relatedTarget){var that=this,e=$.Event(\"show.bs.modal\",{relatedTarget:_relatedTarget});this.$element.trigger(e),this.isShown||e.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass(\"modal-open\"),this.escape(),this.resize(),this.$element.on(\"click.dismiss.bs.modal\",'[data-dismiss=\"modal\"]',$.proxy(this.hide,this)),this.$dialog.on(\"mousedown.dismiss.bs.modal\",function(){that.$element.one(\"mouseup.dismiss.bs.modal\",function(e){$(e.target).is(that.$element)&&(that.ignoreBackdropClick=!0)})}),this.backdrop(function(){var transition=$.support.transition&&that.$element.hasClass(\"fade\");that.$element.parent().length||that.$element.appendTo(that.$body),that.$element.show().scrollTop(0),that.adjustDialog(),transition&&that.$element[0].offsetWidth,that.$element.addClass(\"in\"),that.enforceFocus();var e=$.Event(\"shown.bs.modal\",{relatedTarget:_relatedTarget});transition?that.$dialog.one(\"bsTransitionEnd\",function(){that.$element.trigger(\"focus\").trigger(e)}).emulateTransitionEnd(Modal.TRANSITION_DURATION):that.$element.trigger(\"focus\").trigger(e)}))},Modal.prototype.hide=function(e){e&&e.preventDefault(),e=$.Event(\"hide.bs.modal\"),this.$element.trigger(e),this.isShown&&!e.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),$(document).off(\"focusin.bs.modal\"),this.$element.removeClass(\"in\").off(\"click.dismiss.bs.modal\").off(\"mouseup.dismiss.bs.modal\"),this.$dialog.off(\"mousedown.dismiss.bs.modal\"),$.support.transition&&this.$element.hasClass(\"fade\")?this.$element.one(\"bsTransitionEnd\",$.proxy(this.hideModal,this)).emulateTransitionEnd(Modal.TRANSITION_DURATION):this.hideModal())},Modal.prototype.enforceFocus=function(){$(document).off(\"focusin.bs.modal\").on(\"focusin.bs.modal\",$.proxy(function(e){document===e.target||this.$element[0]===e.target||this.$element.has(e.target).length||this.$element.trigger(\"focus\")},this))},Modal.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on(\"keydown.dismiss.bs.modal\",$.proxy(function(e){27==e.which&&this.hide()},this)):this.isShown||this.$element.off(\"keydown.dismiss.bs.modal\")},Modal.prototype.resize=function(){this.isShown?$(window).on(\"resize.bs.modal\",$.proxy(this.handleUpdate,this)):$(window).off(\"resize.bs.modal\")},Modal.prototype.hideModal=function(){var that=this;this.$element.hide(),this.backdrop(function(){that.$body.removeClass(\"modal-open\"),that.resetAdjustments(),that.resetScrollbar(),that.$element.trigger(\"hidden.bs.modal\")})},Modal.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},Modal.prototype.backdrop=function(callback){var that=this,animate=this.$element.hasClass(\"fade\")?\"fade\":\"\";if(this.isShown&&this.options.backdrop){var doAnimate=$.support.transition&&animate;if(this.$backdrop=$(document.createElement(\"div\")).addClass(\"modal-backdrop \"+animate).appendTo(this.$body),this.$element.on(\"click.dismiss.bs.modal\",$.proxy(function(e){this.ignoreBackdropClick?this.ignoreBackdropClick=!1:e.target===e.currentTarget&&(\"static\"==this.options.backdrop?this.$element[0].focus():this.hide())},this)),doAnimate&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass(\"in\"),!callback)return;doAnimate?this.$backdrop.one(\"bsTransitionEnd\",callback).emulateTransitionEnd(Modal.BACKDROP_TRANSITION_DURATION):callback()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass(\"in\");var callbackRemove=function(){that.removeBackdrop(),callback&&callback()};$.support.transition&&this.$element.hasClass(\"fade\")?this.$backdrop.one(\"bsTransitionEnd\",callbackRemove).emulateTransitionEnd(Modal.BACKDROP_TRANSITION_DURATION):callbackRemove()}else callback&&callback()},Modal.prototype.handleUpdate=function(){this.adjustDialog()},Modal.prototype.adjustDialog=function(){var modalIsOverflowing=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&modalIsOverflowing?this.scrollbarWidth:\"\",paddingRight:this.bodyIsOverflowing&&!modalIsOverflowing?this.scrollbarWidth:\"\"})},Modal.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:\"\",paddingRight:\"\"})},Modal.prototype.checkScrollbar=function(){var fullWindowWidth=window.innerWidth;if(!fullWindowWidth){var documentElementRect=document.documentElement.getBoundingClientRect();fullWindowWidth=documentElementRect.right-Math.abs(documentElementRect.left)}this.bodyIsOverflowing=document.body.clientWidth<fullWindowWidth,this.scrollbarWidth=this.measureScrollbar()},Modal.prototype.setScrollbar=function(){var bodyPad=parseInt(this.$body.css(\"padding-right\")||0,10);this.originalBodyPad=document.body.style.paddingRight||\"\",this.bodyIsOverflowing&&this.$body.css(\"padding-right\",bodyPad+this.scrollbarWidth)},Modal.prototype.resetScrollbar=function(){this.$body.css(\"padding-right\",this.originalBodyPad)},Modal.prototype.measureScrollbar=function(){var scrollDiv=document.createElement(\"div\");scrollDiv.className=\"modal-scrollbar-measure\",this.$body.append(scrollDiv);var scrollbarWidth=scrollDiv.offsetWidth-scrollDiv.clientWidth;return this.$body[0].removeChild(scrollDiv),scrollbarWidth};var old=$.fn.modal;$.fn.modal=Plugin,$.fn.modal.Constructor=Modal,$.fn.modal.noConflict=function(){return $.fn.modal=old,this},$(document).on(\"click.bs.modal.data-api\",'[data-toggle=\"modal\"]',function(e){var $this=$(this),href=$this.attr(\"href\"),$target=$($this.attr(\"data-target\")||href&&href.replace(/.*(?=#[^\\s]+$)/,\"\")),option=$target.data(\"bs.modal\")?\"toggle\":$.extend({remote:!/#/.test(href)&&href},$target.data(),$this.data());$this.is(\"a\")&&e.preventDefault(),$target.one(\"show.bs.modal\",function(showEvent){showEvent.isDefaultPrevented()||$target.one(\"hidden.bs.modal\",function(){$this.is(\":visible\")&&$this.trigger(\"focus\")})}),Plugin.call($target,option,this)})}(jQuery),function(){function require(path,parent,orig){var resolved=require.resolve(path);if(null==resolved){orig=orig||path,parent=parent||\"root\";var err=new Error('Failed to require \"'+orig+'\" from \"'+parent+'\"');throw err.path=orig,err.parent=parent,err.require=!0,err}var module=require.modules[resolved];if(!module._resolving&&!module.exports){var mod={exports:{}};mod.client=mod.component=!0,module._resolving=!0,module.call(this,mod.exports,require.relative(resolved),mod),delete module._resolving,module.exports=mod.exports}return module.exports}require.modules={},require.aliases={},require.resolve=function(path){\"/\"===path.charAt(0)&&(path=path.slice(1));for(var paths=[path,path+\".js\",path+\".json\",path+\"/index.js\",path+\"/index.json\"],i=0;i<paths.length;i++){path=paths[i];if(require.modules.hasOwnProperty(path))return path;if(require.aliases.hasOwnProperty(path))return require.aliases[path]}},require.normalize=function(curr,path){var segs=[];if(\".\"!=path.charAt(0))return path;curr=curr.split(\"/\"),path=path.split(\"/\");for(var i=0;i<path.length;++i)\"..\"==path[i]?curr.pop():\".\"!=path[i]&&\"\"!=path[i]&&segs.push(path[i]);return curr.concat(segs).join(\"/\")},require.register=function(path,definition){require.modules[path]=definition},require.alias=function(from,to){if(!require.modules.hasOwnProperty(from))throw new Error('Failed to alias \"'+from+'\", it does not exist');require.aliases[to]=from},require.relative=function(parent){var p=require.normalize(parent,\"..\");function localRequire(path){return require(localRequire.resolve(path),parent,path)}return localRequire.resolve=function(path){var c=path.charAt(0);if(\"/\"==c)return path.slice(1);if(\".\"==c)return require.normalize(p,path);var segs=parent.split(\"/\"),i=function(arr,obj){for(var i=arr.length;i--;)if(arr[i]===obj)return i;return-1}(segs,\"deps\")+1;return i||(i=0),path=segs.slice(0,i+1).join(\"/\")+\"/deps/\"+path},localRequire.exists=function(path){return require.modules.hasOwnProperty(localRequire.resolve(path))},localRequire},require.register(\"component-classes/index.js\",function(exports,require,module){var index=require(\"indexof\"),re=/\\s+/,toString=Object.prototype.toString;function ClassList(el){if(!el)throw new Error(\"A DOM element reference is required\");this.el=el,this.list=el.classList}module.exports=function(el){return new ClassList(el)},ClassList.prototype.add=function(name){if(this.list)return this.list.add(name),this;var arr=this.array();return~index(arr,name)||arr.push(name),this.el.className=arr.join(\" \"),this},ClassList.prototype.remove=function(name){if(\"[object RegExp]\"==toString.call(name))return this.removeMatching(name);if(this.list)return this.list.remove(name),this;var arr=this.array(),i=index(arr,name);return~i&&arr.splice(i,1),this.el.className=arr.join(\" \"),this},ClassList.prototype.removeMatching=function(re){for(var arr=this.array(),i=0;i<arr.length;i++)re.test(arr[i])&&this.remove(arr[i]);return this},ClassList.prototype.toggle=function(name,force){return this.list?(void 0!==force?force!==this.list.toggle(name,force)&&this.list.toggle(name):this.list.toggle(name),this):(void 0!==force?force?this.add(name):this.remove(name):this.has(name)?this.remove(name):this.add(name),this)},ClassList.prototype.array=function(){var arr=this.el.className.replace(/^\\s+|\\s+$/g,\"\").split(re);return\"\"===arr[0]&&arr.shift(),arr},ClassList.prototype.has=ClassList.prototype.contains=function(name){return this.list?this.list.contains(name):!!~index(this.array(),name)}}),require.register(\"segmentio-extend/index.js\",function(exports,require,module){module.exports=function(object){for(var source,args=Array.prototype.slice.call(arguments,1),i=0;source=args[i];i++)if(source)for(var property in source)object[property]=source[property];return object}}),require.register(\"component-indexof/index.js\",function(exports,require,module){module.exports=function(arr,obj){if(arr.indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i)if(arr[i]===obj)return i;return-1}}),require.register(\"component-event/index.js\",function(exports,require,module){var bind=window.addEventListener?\"addEventListener\":\"attachEvent\",unbind=window.removeEventListener?\"removeEventListener\":\"detachEvent\",prefix=\"addEventListener\"!==bind?\"on\":\"\";exports.bind=function(el,type,fn,capture){return el[bind](prefix+type,fn,capture||!1),fn},exports.unbind=function(el,type,fn,capture){return el[unbind](prefix+type,fn,capture||!1),fn}}),require.register(\"timoxley-to-array/index.js\",function(exports,require,module){module.exports=function(collection){if(void 0===collection)return[];if(null===collection)return[null];if(collection===window)return[window];if(\"string\"==typeof collection)return[collection];if(function(arr){return\"[object Array]\"===Object.prototype.toString.call(arr)}(collection))return collection;if(\"number\"!=typeof collection.length)return[collection];if(\"function\"==typeof collection&&collection instanceof Function)return[collection];for(var arr=[],i=0;i<collection.length;i++)(Object.prototype.hasOwnProperty.call(collection,i)||i in collection)&&arr.push(collection[i]);return arr.length?arr:[]}}),require.register(\"javve-events/index.js\",function(exports,require,module){var events=require(\"event\"),toArray=require(\"to-array\");exports.bind=function(el,type,fn,capture){el=toArray(el);for(var i=0;i<el.length;i++)events.bind(el[i],type,fn,capture)},exports.unbind=function(el,type,fn,capture){el=toArray(el);for(var i=0;i<el.length;i++)events.unbind(el[i],type,fn,capture)}}),require.register(\"javve-get-by-class/index.js\",function(exports,require,module){module.exports=document.getElementsByClassName?function(container,className,single){return single?container.getElementsByClassName(className)[0]:container.getElementsByClassName(className)}:document.querySelector?function(container,className,single){return className=\".\"+className,single?container.querySelector(className):container.querySelectorAll(className)}:function(container,className,single){var classElements=[];null==container&&(container=document);for(var els=container.getElementsByTagName(\"*\"),elsLen=els.length,pattern=new RegExp(\"(^|\\\\s)\"+className+\"(\\\\s|$)\"),i=0,j=0;i<elsLen;i++)if(pattern.test(els[i].className)){if(single)return els[i];classElements[j]=els[i],j++}return classElements}}),require.register(\"javve-get-attribute/index.js\",function(exports,require,module){module.exports=function(el,attr){var result=el.getAttribute&&el.getAttribute(attr)||null;if(!result)for(var length=el.attributes.length,i=0;i<length;i++)void 0!==attr[i]&&attr[i].nodeName===attr&&(result=attr[i].nodeValue);return result}}),require.register(\"javve-natural-sort/index.js\",function(exports,require,module){module.exports=function(a,b,options){var oFxNcL,oFyNcL,re=/(^-?[0-9]+(\\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,sre=/(^[ ]*|[ ]*$)/g,dre=/(^([\\w ]+,?[\\w ]+)?[\\w ]+,?[\\w ]+\\d+:\\d+(:\\d+)?[\\w ]?|^\\d{1,4}[\\/\\-]\\d{1,4}[\\/\\-]\\d{1,4}|^\\w+, \\w+ \\d+, \\d{4})/,hre=/^0x[0-9a-f]+$/i,ore=/^0/,i=(options=options||{},function(s){return options.insensitive&&(\"\"+s).toLowerCase()||\"\"+s}),x=i(a).replace(sre,\"\")||\"\",y=i(b).replace(sre,\"\")||\"\",xN=x.replace(re,\"\\0$1\\0\").replace(/\\0$/,\"\").replace(/^\\0/,\"\").split(\"\\0\"),yN=y.replace(re,\"\\0$1\\0\").replace(/\\0$/,\"\").replace(/^\\0/,\"\").split(\"\\0\"),xD=parseInt(x.match(hre))||1!=xN.length&&x.match(dre)&&Date.parse(x),yD=parseInt(y.match(hre))||xD&&y.match(dre)&&Date.parse(y)||null,mult=options.desc?-1:1;if(yD){if(xD<yD)return-1*mult;if(xD>yD)return 1*mult}for(var cLoc=0,numS=Math.max(xN.length,yN.length);cLoc<numS;cLoc++){if(oFxNcL=!(xN[cLoc]||\"\").match(ore)&&parseFloat(xN[cLoc])||xN[cLoc]||0,oFyNcL=!(yN[cLoc]||\"\").match(ore)&&parseFloat(yN[cLoc])||yN[cLoc]||0,isNaN(oFxNcL)!==isNaN(oFyNcL))return isNaN(oFxNcL)?1:-1;if(typeof oFxNcL!=typeof oFyNcL&&(oFxNcL+=\"\",oFyNcL+=\"\"),oFxNcL<oFyNcL)return-1*mult;if(oFxNcL>oFyNcL)return 1*mult}return 0}}),require.register(\"javve-to-string/index.js\",function(exports,require,module){module.exports=function(s){return s=(s=null===(s=void 0===s?\"\":s)?\"\":s).toString()}}),require.register(\"component-type/index.js\",function(exports,require,module){var toString=Object.prototype.toString;module.exports=function(val){switch(toString.call(val)){case\"[object Date]\":return\"date\";case\"[object RegExp]\":return\"regexp\";case\"[object Arguments]\":return\"arguments\";case\"[object Array]\":return\"array\";case\"[object Error]\":return\"error\"}return null===val?\"null\":void 0===val?\"undefined\":val!=val?\"nan\":val&&1===val.nodeType?\"element\":typeof val.valueOf()}}),require.register(\"list.js/index.js\",function(exports,require,module){!function(window,undefined){\"use strict\";var document=window.document,getByClass=require(\"get-by-class\"),extend=require(\"extend\"),indexOf=require(\"indexof\");module.exports=function(id,options,values){var init,self=this,Item=require(\"./src/item\")(self),addAsync=require(\"./src/add-async\")(self),parse=require(\"./src/parse\")(self);init={start:function(){self.listClass=\"list\",self.searchClass=\"search\",self.sortClass=\"sort\",self.page=200,self.i=1,self.items=[],self.visibleItems=[],self.matchingItems=[],self.searched=!1,self.filtered=!1,self.handlers={updated:[]},self.plugins={},self.helpers={getByClass:getByClass,extend:extend,indexOf:indexOf},extend(self,options),self.listContainer=\"string\"==typeof id?document.getElementById(id):id,self.listContainer&&(self.list=getByClass(self.listContainer,self.listClass,!0),self.templater=require(\"./src/templater\")(self),self.search=require(\"./src/search\")(self),self.filter=require(\"./src/filter\")(self),self.sort=require(\"./src/sort\")(self),this.items(),self.update(),this.plugins())},items:function(){parse(self.list),void 0!==values&&self.add(values)},plugins:function(){for(var i=0;i<self.plugins.length;i++){var plugin=self.plugins[i];self[plugin.name]=plugin,plugin.init(self)}}},this.add=function(values,callback){if(!callback){var added=[],notCreate=!1;void 0===values[0]&&(values=[values]);for(var i=0,il=values.length;i<il;i++){var item=null;values[i]instanceof Item?(item=values[i]).reload():(notCreate=self.items.length>self.page,item=new Item(values[i],void 0,notCreate)),self.items.push(item),added.push(item)}return self.update(),added}addAsync(values,callback)},this.show=function(i,page){return this.i=i,this.page=page,self.update(),self},this.remove=function(valueName,value,options){for(var found=0,i=0,il=self.items.length;i<il;i++)self.items[i].values()[valueName]==value&&(self.templater.remove(self.items[i],options),self.items.splice(i,1),il--,i--,found++);return self.update(),found},this.get=function(valueName,value){for(var matchedItems=[],i=0,il=self.items.length;i<il;i++){var item=self.items[i];item.values()[valueName]==value&&matchedItems.push(item)}return matchedItems},this.size=function(){return self.items.length},this.clear=function(){return self.templater.clear(),self.items=[],self},this.on=function(event,callback){return self.handlers[event].push(callback),self},this.off=function(event,callback){var e=self.handlers[event],index=indexOf(e,callback);return index>-1&&e.splice(index,1),self},this.trigger=function(event){for(var i=self.handlers[event].length;i--;)self.handlers[event][i](self);return self},this.reset={filter:function(){for(var is=self.items,il=is.length;il--;)is[il].filtered=!1;return self},search:function(){for(var is=self.items,il=is.length;il--;)is[il].found=!1;return self}},this.update=function(){var is=self.items,il=is.length;self.visibleItems=[],self.matchingItems=[],self.templater.clear();for(var i=0;i<il;i++)is[i].matching()&&self.matchingItems.length+1>=self.i&&self.visibleItems.length<self.page?(is[i].show(),self.visibleItems.push(is[i]),self.matchingItems.push(is[i])):is[i].matching()?(self.matchingItems.push(is[i]),is[i].hide()):is[i].hide();return self.trigger(\"updated\"),self},init.start()}}(window)}),require.register(\"list.js/src/search.js\",function(exports,require,module){var events=require(\"events\"),getByClass=require(\"get-by-class\"),toString=require(\"to-string\");module.exports=function(list){var text,columns,searchString,customSearch,prepare={resetList:function(){list.i=1,list.templater.clear(),customSearch=void 0},setOptions:function(args){2==args.length&&args[1]instanceof Array?columns=args[1]:2==args.length&&\"function\"==typeof args[1]?customSearch=args[1]:3==args.length&&(columns=args[1],customSearch=args[2])},setColumns:function(){columns=void 0===columns?prepare.toArray(list.items[0].values()):columns},setSearchString:function(s){s=(s=toString(s).toLowerCase()).replace(/[-[\\]{}()*+?.,\\\\^$|#]/g,\"\\\\$&\"),searchString=s},toArray:function(values){var tmpColumn=[];for(var name in values)tmpColumn.push(name);return tmpColumn}},search={list:function(){for(var k=0,kl=list.items.length;k<kl;k++)search.item(list.items[k])},item:function(item){item.found=!1;for(var j=0,jl=columns.length;j<jl;j++)if(search.values(item.values(),columns[j]))return void(item.found=!0)},values:function(values,column){return!!(values.hasOwnProperty(column)&&(text=toString(values[column]).toLowerCase(),\"\"!==searchString&&text.search(searchString)>-1))},reset:function(){list.reset.search(),list.searched=!1}},searchMethod=function(str){return list.trigger(\"searchStart\"),prepare.resetList(),prepare.setSearchString(str),prepare.setOptions(arguments),prepare.setColumns(),\"\"===searchString?search.reset():(list.searched=!0,customSearch?customSearch(searchString,columns):search.list()),list.update(),list.trigger(\"searchComplete\"),list.visibleItems};return list.handlers.searchStart=list.handlers.searchStart||[],list.handlers.searchComplete=list.handlers.searchComplete||[],events.bind(getByClass(list.listContainer,list.searchClass),\"keyup\",function(e){var target=e.target||e.srcElement;\"\"===target.value&&!list.searched||searchMethod(target.value)}),events.bind(getByClass(list.listContainer,list.searchClass),\"input\",function(e){\"\"===(e.target||e.srcElement).value&&searchMethod(\"\")}),list.helpers.toString=toString,searchMethod}}),require.register(\"list.js/src/sort.js\",function(exports,require,module){var naturalSort=require(\"natural-sort\"),classes=require(\"classes\"),events=require(\"events\"),getByClass=require(\"get-by-class\"),getAttribute=require(\"get-attribute\");module.exports=function(list){list.sortFunction=list.sortFunction||function(itemA,itemB,options){return options.desc=\"desc\"==options.order,naturalSort(itemA.values()[options.valueName],itemB.values()[options.valueName],options)};var buttons={els:void 0,clear:function(){for(var i=0,il=buttons.els.length;i<il;i++)classes(buttons.els[i]).remove(\"asc\"),classes(buttons.els[i]).remove(\"desc\")},getOrder:function(btn){var predefinedOrder=getAttribute(btn,\"data-order\");return\"asc\"==predefinedOrder||\"desc\"==predefinedOrder?predefinedOrder:classes(btn).has(\"desc\")?\"asc\":classes(btn).has(\"asc\")?\"desc\":\"asc\"},getInSensitive:function(btn,options){var insensitive=getAttribute(btn,\"data-insensitive\");options.insensitive=\"true\"===insensitive},setOrder:function(options){for(var i=0,il=buttons.els.length;i<il;i++){var btn=buttons.els[i];if(getAttribute(btn,\"data-sort\")===options.valueName){var predefinedOrder=getAttribute(btn,\"data-order\");\"asc\"==predefinedOrder||\"desc\"==predefinedOrder?predefinedOrder==options.order&&classes(btn).add(options.order):classes(btn).add(options.order)}}}},sort=function(){list.trigger(\"sortStart\"),options={};var target=arguments[0].currentTarget||arguments[0].srcElement||void 0;target?(options.valueName=getAttribute(target,\"data-sort\"),buttons.getInSensitive(target,options),options.order=buttons.getOrder(target)):(options=arguments[1]||options,options.valueName=arguments[0],options.order=options.order||\"asc\",options.insensitive=void 0===options.insensitive||options.insensitive),buttons.clear(),buttons.setOrder(options),options.sortFunction=options.sortFunction||list.sortFunction,list.items.sort(function(a,b){return options.sortFunction(a,b,options)}),list.update(),list.trigger(\"sortComplete\")};return list.handlers.sortStart=list.handlers.sortStart||[],list.handlers.sortComplete=list.handlers.sortComplete||[],buttons.els=getByClass(list.listContainer,list.sortClass),events.bind(buttons.els,\"click\",sort),list.on(\"searchStart\",buttons.clear),list.on(\"filterStart\",buttons.clear),list.helpers.classes=classes,list.helpers.naturalSort=naturalSort,list.helpers.events=events,list.helpers.getAttribute=getAttribute,sort}}),require.register(\"list.js/src/item.js\",function(exports,require,module){module.exports=function(list){return function(initValues,element,notCreate){var item=this;this._values={},this.found=!1,this.filtered=!1;this.values=function(newValues,notCreate){if(void 0===newValues)return item._values;for(var name in newValues)item._values[name]=newValues[name];!0!==notCreate&&list.templater.set(item,item.values())},this.show=function(){list.templater.show(item)},this.hide=function(){list.templater.hide(item)},this.matching=function(){return list.filtered&&list.searched&&item.found&&item.filtered||list.filtered&&!list.searched&&item.filtered||!list.filtered&&list.searched&&item.found||!list.filtered&&!list.searched},this.visible=function(){return item.elm.parentNode==list.list},function(initValues,element,notCreate){if(void 0===element)notCreate?item.values(initValues,notCreate):item.values(initValues);else{item.elm=element;var values=list.templater.get(item,initValues);item.values(values)}}(initValues,element,notCreate)}}}),require.register(\"list.js/src/templater.js\",function(exports,require,module){var getByClass=require(\"get-by-class\");module.exports=function(list){return new function(list){var itemSource=function(item){if(void 0===item){for(var nodes=list.list.childNodes,i=0,il=nodes.length;i<il;i++)if(void 0===nodes[i].data)return nodes[i];return null}if(-1!==item.indexOf(\"<\")){var div=document.createElement(\"div\");return div.innerHTML=item,div.firstChild}return document.getElementById(list.item)}(list.item),templater=this;this.get=function(item,valueNames){templater.create(item);for(var values={},i=0,il=valueNames.length;i<il;i++){var elm=getByClass(item.elm,valueNames[i],!0);values[valueNames[i]]=elm?elm.innerHTML:\"\"}return values},this.set=function(item,values){if(!templater.create(item))for(var v in values)if(values.hasOwnProperty(v)){var elm=getByClass(item.elm,v,!0);elm&&(\"IMG\"===elm.tagName&&\"\"!==values[v]?elm.src=values[v]:elm.innerHTML=values[v])}},this.create=function(item){if(void 0!==item.elm)return!1;var newItem=itemSource.cloneNode(!0);return newItem.removeAttribute(\"id\"),item.elm=newItem,templater.set(item,item.values()),!0},this.remove=function(item){list.list.removeChild(item.elm)},this.show=function(item){templater.create(item),list.list.appendChild(item.elm)},this.hide=function(item){void 0!==item.elm&&item.elm.parentNode===list.list&&list.list.removeChild(item.elm)},this.clear=function(){if(list.list.hasChildNodes())for(;list.list.childNodes.length>=1;)list.list.removeChild(list.list.firstChild)}}(list)}}),require.register(\"list.js/src/filter.js\",function(exports,require,module){module.exports=function(list){return list.handlers.filterStart=list.handlers.filterStart||[],list.handlers.filterComplete=list.handlers.filterComplete||[],function(filterFunction){if(list.trigger(\"filterStart\"),list.i=1,list.reset.filter(),void 0===filterFunction)list.filtered=!1;else{list.filtered=!0;for(var is=list.items,i=0,il=is.length;i<il;i++){var item=is[i];filterFunction(item)?item.filtered=!0:item.filtered=!1}}return list.update(),list.trigger(\"filterComplete\"),list.visibleItems}}}),require.register(\"list.js/src/add-async.js\",function(exports,require,module){module.exports=function(list){return function(values,callback,items){var valuesToAdd=values.splice(0,100);items=(items=items||[]).concat(list.add(valuesToAdd)),values.length>0?setTimeout(function(){addAsync(values,callback,items)},10):(list.update(),callback(items))}}}),require.register(\"list.js/src/parse.js\",function(exports,require,module){module.exports=function(list){var Item=require(\"./item\")(list),parse=function(itemElements,valueNames){for(var i=0,il=itemElements.length;i<il;i++)list.items.push(new Item(valueNames,itemElements[i]))};return function(){var itemsToIndex=function(parent){for(var nodes=parent.childNodes,items=[],i=0,il=nodes.length;i<il;i++)void 0===nodes[i].data&&items.push(nodes[i]);return items}(list.list),valueNames=list.valueNames;list.indexAsync?function(itemElements,valueNames){var itemsToIndex=itemElements.splice(0,100);parse(itemsToIndex,valueNames),itemElements.length>0?setTimeout(function(){init.items.indexAsync(itemElements,valueNames)},10):list.update()}(itemsToIndex,valueNames):parse(itemsToIndex,valueNames)}}}),require.alias(\"component-classes/index.js\",\"list.js/deps/classes/index.js\"),require.alias(\"component-classes/index.js\",\"classes/index.js\"),require.alias(\"component-indexof/index.js\",\"component-classes/deps/indexof/index.js\"),require.alias(\"segmentio-extend/index.js\",\"list.js/deps/extend/index.js\"),require.alias(\"segmentio-extend/index.js\",\"extend/index.js\"),require.alias(\"component-indexof/index.js\",\"list.js/deps/indexof/index.js\"),require.alias(\"component-indexof/index.js\",\"indexof/index.js\"),require.alias(\"javve-events/index.js\",\"list.js/deps/events/index.js\"),require.alias(\"javve-events/index.js\",\"events/index.js\"),require.alias(\"component-event/index.js\",\"javve-events/deps/event/index.js\"),require.alias(\"timoxley-to-array/index.js\",\"javve-events/deps/to-array/index.js\"),require.alias(\"javve-get-by-class/index.js\",\"list.js/deps/get-by-class/index.js\"),require.alias(\"javve-get-by-class/index.js\",\"get-by-class/index.js\"),require.alias(\"javve-get-attribute/index.js\",\"list.js/deps/get-attribute/index.js\"),require.alias(\"javve-get-attribute/index.js\",\"get-attribute/index.js\"),require.alias(\"javve-natural-sort/index.js\",\"list.js/deps/natural-sort/index.js\"),require.alias(\"javve-natural-sort/index.js\",\"natural-sort/index.js\"),require.alias(\"javve-to-string/index.js\",\"list.js/deps/to-string/index.js\"),require.alias(\"javve-to-string/index.js\",\"list.js/deps/to-string/index.js\"),require.alias(\"javve-to-string/index.js\",\"to-string/index.js\"),require.alias(\"javve-to-string/index.js\",\"javve-to-string/index.js\"),require.alias(\"component-type/index.js\",\"list.js/deps/type/index.js\"),require.alias(\"component-type/index.js\",\"type/index.js\"),\"object\"==typeof exports?module.exports=require(\"list.js\"):\"function\"==typeof define&&define.amd?define(function(){return require(\"list.js\")}):this.List=require(\"list.js\")}(),function(){var Favico=function(opt){\"use strict\";opt=opt||{};var _opt,_orig,_h,_w,_canvas,_context,_img,_ready,_lastBadge,_running,_readyCb,_stop,_browser,_animTimeout,_drawTimeout,_doc,_def={bgColor:\"#d00\",textColor:\"#fff\",fontFamily:\"sans-serif\",fontStyle:\"bold\",type:\"circle\",position:\"down\",animation:\"slide\",elementId:!1,dataUrl:!1,win:window};(_browser={}).ff=\"undefined\"!=typeof InstallTrigger,_browser.chrome=!!window.chrome,_browser.opera=!!window.opera||navigator.userAgent.indexOf(\"Opera\")>=0,_browser.ie=!1,_browser.safari=Object.prototype.toString.call(window.HTMLElement).indexOf(\"Constructor\")>0,_browser.supported=_browser.chrome||_browser.ff||_browser.opera;var _queue=[];_readyCb=function(){},_ready=_stop=!1;var icon={ready:function(){_ready=!0,icon.reset(),_readyCb()},reset:function(){_ready&&(_queue=[],_lastBadge=!1,_running=!1,_context.clearRect(0,0,_w,_h),_context.drawImage(_img,0,0,_w,_h),link.setIcon(_canvas),window.clearTimeout(_animTimeout),window.clearTimeout(_drawTimeout))}};icon.start=function(){if(_ready&&!_running){if(_queue.length>0){_running=!0;var run=function(){[\"type\",\"animation\",\"bgColor\",\"textColor\",\"fontFamily\",\"fontStyle\"].forEach(function(a){a in _queue[0].options&&(_opt[a]=_queue[0].options[a])}),animation.run(_queue[0].options,function(){_lastBadge=_queue[0],_running=!1,_queue.length>0&&(_queue.shift(),icon.start())},!1)};_lastBadge?animation.run(_lastBadge.options,function(){run()},!0):run()}}};var type={},options=function(opt){return opt.n=\"number\"==typeof opt.n?Math.abs(0|opt.n):opt.n,opt.x=_w*opt.x,opt.y=_h*opt.y,opt.w=_w*opt.w,opt.h=_h*opt.h,opt.len=(\"\"+opt.n).length,opt};type.circle=function(opt){var more=!1;2===(opt=options(opt)).len?(opt.x=opt.x-.4*opt.w,opt.w=1.4*opt.w,more=!0):opt.len>=3&&(opt.x=opt.x-.65*opt.w,opt.w=1.65*opt.w,more=!0),_context.clearRect(0,0,_w,_h),_context.drawImage(_img,0,0,_w,_h),_context.beginPath(),_context.font=_opt.fontStyle+\" \"+Math.floor(opt.h*(opt.n>99?.85:1))+\"px \"+_opt.fontFamily,_context.textAlign=\"center\",more?(_context.moveTo(opt.x+opt.w/2,opt.y),_context.lineTo(opt.x+opt.w-opt.h/2,opt.y),_context.quadraticCurveTo(opt.x+opt.w,opt.y,opt.x+opt.w,opt.y+opt.h/2),_context.lineTo(opt.x+opt.w,opt.y+opt.h-opt.h/2),_context.quadraticCurveTo(opt.x+opt.w,opt.y+opt.h,opt.x+opt.w-opt.h/2,opt.y+opt.h),_context.lineTo(opt.x+opt.h/2,opt.y+opt.h),_context.quadraticCurveTo(opt.x,opt.y+opt.h,opt.x,opt.y+opt.h-opt.h/2),_context.lineTo(opt.x,opt.y+opt.h/2),_context.quadraticCurveTo(opt.x,opt.y,opt.x+opt.h/2,opt.y)):_context.arc(opt.x+opt.w/2,opt.y+opt.h/2,opt.h/2,0,2*Math.PI),_context.fillStyle=\"rgba(\"+_opt.bgColor.r+\",\"+_opt.bgColor.g+\",\"+_opt.bgColor.b+\",\"+opt.o+\")\",_context.fill(),_context.closePath(),_context.beginPath(),_context.stroke(),_context.fillStyle=\"rgba(\"+_opt.textColor.r+\",\"+_opt.textColor.g+\",\"+_opt.textColor.b+\",\"+opt.o+\")\",\"number\"==typeof opt.n&&opt.n>999?_context.fillText((opt.n>9999?9:Math.floor(opt.n/1e3))+\"k+\",Math.floor(opt.x+opt.w/2),Math.floor(opt.y+opt.h-.2*opt.h)):_context.fillText(opt.n,Math.floor(opt.x+opt.w/2),Math.floor(opt.y+opt.h-.15*opt.h)),_context.closePath()},type.rectangle=function(opt){2===(opt=options(opt)).len?(opt.x=opt.x-.4*opt.w,opt.w=1.4*opt.w):opt.len>=3&&(opt.x=opt.x-.65*opt.w,opt.w=1.65*opt.w),_context.clearRect(0,0,_w,_h),_context.drawImage(_img,0,0,_w,_h),_context.beginPath(),_context.font=_opt.fontStyle+\" \"+Math.floor(opt.h*(opt.n>99?.9:1))+\"px \"+_opt.fontFamily,_context.textAlign=\"center\",_context.fillStyle=\"rgba(\"+_opt.bgColor.r+\",\"+_opt.bgColor.g+\",\"+_opt.bgColor.b+\",\"+opt.o+\")\",_context.fillRect(opt.x,opt.y,opt.w,opt.h),_context.fillStyle=\"rgba(\"+_opt.textColor.r+\",\"+_opt.textColor.g+\",\"+_opt.textColor.b+\",\"+opt.o+\")\",\"number\"==typeof opt.n&&opt.n>999?_context.fillText((opt.n>9999?9:Math.floor(opt.n/1e3))+\"k+\",Math.floor(opt.x+opt.w/2),Math.floor(opt.y+opt.h-.2*opt.h)):_context.fillText(opt.n,Math.floor(opt.x+opt.w/2),Math.floor(opt.y+opt.h-.15*opt.h)),_context.closePath()};function drawVideo(video){if(video.paused||video.ended||_stop)return!1;try{_context.clearRect(0,0,_w,_h),_context.drawImage(video,0,0,_w,_h)}catch(e){}_drawTimeout=setTimeout(function(){drawVideo(video)},animation.duration),link.setIcon(_canvas)}var link={};function hexToRgb(hex){hex=hex.replace(/^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i,function(m,r,g,b){return r+r+g+g+b+b});var result=/^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);return!!result&&{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}}function merge(def,opt){var attrname,mergedOpt={};for(attrname in def)mergedOpt[attrname]=def[attrname];for(attrname in opt)mergedOpt[attrname]=opt[attrname];return mergedOpt}link.getIcon=function(){var elm=!1;return _opt.element?elm=_opt.element:_opt.elementId?(elm=_doc.getElementById(_opt.elementId)).setAttribute(\"href\",elm.getAttribute(\"src\")):!1===(elm=function(){for(var link=_doc.getElementsByTagName(\"head\")[0].getElementsByTagName(\"link\"),i=link.length-1;i>=0;i--)if(/(^|\\s)icon(\\s|$)/i.test(link[i].getAttribute(\"rel\")))return link[i];return!1}())&&((elm=_doc.createElement(\"link\")).setAttribute(\"rel\",\"icon\"),_doc.getElementsByTagName(\"head\")[0].appendChild(elm)),elm.setAttribute(\"type\",\"image/png\"),elm},link.setIcon=function(canvas){var url=canvas.toDataURL(\"image/png\");if(_opt.dataUrl&&_opt.dataUrl(url),_opt.element)_opt.element.setAttribute(\"href\",url),_opt.element.setAttribute(\"src\",url);else if(_opt.elementId){var elm=_doc.getElementById(_opt.elementId);elm.setAttribute(\"href\",url),elm.setAttribute(\"src\",url)}else if(_browser.ff||_browser.opera){var old=_orig;_orig=_doc.createElement(\"link\"),_browser.opera&&_orig.setAttribute(\"rel\",\"icon\"),_orig.setAttribute(\"rel\",\"icon\"),_orig.setAttribute(\"type\",\"image/png\"),_doc.getElementsByTagName(\"head\")[0].appendChild(_orig),_orig.setAttribute(\"href\",url),old.parentNode&&old.parentNode.removeChild(old)}else _orig.setAttribute(\"href\",url)};var animation={duration:40,types:{}};return animation.types.fade=[{x:.4,y:.4,w:.6,h:.6,o:0},{x:.4,y:.4,w:.6,h:.6,o:.1},{x:.4,y:.4,w:.6,h:.6,o:.2},{x:.4,y:.4,w:.6,h:.6,o:.3},{x:.4,y:.4,w:.6,h:.6,o:.4},{x:.4,y:.4,w:.6,h:.6,o:.5},{x:.4,y:.4,w:.6,h:.6,o:.6},{x:.4,y:.4,w:.6,h:.6,o:.7},{x:.4,y:.4,w:.6,h:.6,o:.8},{x:.4,y:.4,w:.6,h:.6,o:.9},{x:.4,y:.4,w:.6,h:.6,o:1}],animation.types.none=[{x:.4,y:.4,w:.6,h:.6,o:1}],animation.types.pop=[{x:1,y:1,w:0,h:0,o:1},{x:.9,y:.9,w:.1,h:.1,o:1},{x:.8,y:.8,w:.2,h:.2,o:1},{x:.7,y:.7,w:.3,h:.3,o:1},{x:.6,y:.6,w:.4,h:.4,o:1},{x:.5,y:.5,w:.5,h:.5,o:1},{x:.4,y:.4,w:.6,h:.6,o:1}],animation.types.popFade=[{x:.75,y:.75,w:0,h:0,o:0},{x:.65,y:.65,w:.1,h:.1,o:.2},{x:.6,y:.6,w:.2,h:.2,o:.4},{x:.55,y:.55,w:.3,h:.3,o:.6},{x:.5,y:.5,w:.4,h:.4,o:.8},{x:.45,y:.45,w:.5,h:.5,o:.9},{x:.4,y:.4,w:.6,h:.6,o:1}],animation.types.slide=[{x:.4,y:1,w:.6,h:.6,o:1},{x:.4,y:.9,w:.6,h:.6,o:1},{x:.4,y:.9,w:.6,h:.6,o:1},{x:.4,y:.8,w:.6,h:.6,o:1},{x:.4,y:.7,w:.6,h:.6,o:1},{x:.4,y:.6,w:.6,h:.6,o:1},{x:.4,y:.5,w:.6,h:.6,o:1},{x:.4,y:.4,w:.6,h:.6,o:1}],animation.run=function(opt,cb,revert,step){var animationType=animation.types[_doc.hidden||_doc.msHidden||_doc.webkitHidden||_doc.mozHidden?\"none\":_opt.animation];step=!0===revert?void 0!==step?step:animationType.length-1:void 0!==step?step:0,cb=cb||function(){},step<animationType.length&&step>=0?(type[_opt.type](merge(opt,animationType[step])),_animTimeout=setTimeout(function(){revert?step-=1:step+=1,animation.run(opt,cb,revert,step)},animation.duration),link.setIcon(_canvas)):cb()},function(){(_opt=merge(_def,opt)).bgColor=hexToRgb(_opt.bgColor),_opt.textColor=hexToRgb(_opt.textColor),_opt.position=_opt.position.toLowerCase(),_opt.animation=animation.types[\"\"+_opt.animation]?_opt.animation:_def.animation,_doc=_opt.win.document;var isUp=_opt.position.indexOf(\"up\")>-1,isLeft=_opt.position.indexOf(\"left\")>-1;if(isUp||isLeft)for(var i=0;i<animation.types[\"\"+_opt.animation].length;i++){var step=animation.types[\"\"+_opt.animation][i];isUp&&(step.y<.6?step.y=step.y-.4:step.y=step.y-2*step.y+(1-step.w)),isLeft&&(step.x<.6?step.x=step.x-.4:step.x=step.x-2*step.x+(1-step.h)),animation.types[\"\"+_opt.animation][i]=step}_opt.type=type[\"\"+_opt.type]?_opt.type:_def.type,_orig=link.getIcon(),_canvas=document.createElement(\"canvas\"),_img=document.createElement(\"img\"),_orig.hasAttribute(\"href\")?(_img.setAttribute(\"crossOrigin\",\"anonymous\"),_img.onload=function(){_h=_img.height>0?_img.height:32,_w=_img.width>0?_img.width:32,_canvas.height=_h,_canvas.width=_w,_context=_canvas.getContext(\"2d\"),icon.ready()},_img.setAttribute(\"src\",_orig.getAttribute(\"href\"))):(_img.onload=function(){_h=32,_w=32,_img.height=_h,_img.width=_w,_canvas.height=_h,_canvas.width=_w,_context=_canvas.getContext(\"2d\"),icon.ready()},_img.setAttribute(\"src\",\"\"))}(),{badge:function(number,opts){opts=(\"string\"==typeof opts?{animation:opts}:opts)||{},_readyCb=function(){try{if(\"number\"==typeof number?number>0:\"\"!==number){var q={type:\"badge\",options:{n:number}};if(\"animation\"in opts&&animation.types[\"\"+opts.animation]&&(q.options.animation=\"\"+opts.animation),\"type\"in opts&&type[\"\"+opts.type]&&(q.options.type=\"\"+opts.type),[\"bgColor\",\"textColor\"].forEach(function(o){o in opts&&(q.options[o]=hexToRgb(opts[o]))}),[\"fontStyle\",\"fontFamily\"].forEach(function(o){o in opts&&(q.options[o]=opts[o])}),_queue.push(q),_queue.length>100)throw new Error(\"Too many badges requests in queue.\");icon.start()}else icon.reset()}catch(e){throw new Error(\"Error setting badge. Message: \"+e.message)}},_ready&&_readyCb()},video:function(videoElement){_readyCb=function(){try{if(\"stop\"===videoElement)return _stop=!0,icon.reset(),void(_stop=!1);videoElement.addEventListener(\"play\",function(){drawVideo(this)},!1)}catch(e){throw new Error(\"Error setting video. Message: \"+e.message)}},_ready&&_readyCb()},image:function(imageElement){_readyCb=function(){try{var w=imageElement.width,h=imageElement.height,newImg=document.createElement(\"img\"),ratio=w/_w<h/_h?w/_w:h/_h;newImg.setAttribute(\"crossOrigin\",\"anonymous\"),newImg.onload=function(){_context.clearRect(0,0,_w,_h),_context.drawImage(newImg,0,0,_w,_h),link.setIcon(_canvas)},newImg.setAttribute(\"src\",imageElement.getAttribute(\"src\")),newImg.height=h/ratio,newImg.width=w/ratio}catch(e){throw new Error(\"Error setting image. Message: \"+e.message)}},_ready&&_readyCb()},webcam:function(action){if(window.URL&&window.URL.createObjectURL||(window.URL=window.URL||{},window.URL.createObjectURL=function(obj){return obj}),_browser.supported){var newVideo=!1;navigator.getUserMedia=navigator.getUserMedia||navigator.oGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia,_readyCb=function(){try{if(\"stop\"===action)return _stop=!0,icon.reset(),void(_stop=!1);(newVideo=document.createElement(\"video\")).width=_w,newVideo.height=_h,navigator.getUserMedia({video:!0,audio:!1},function(stream){newVideo.src=URL.createObjectURL(stream),newVideo.play(),drawVideo(newVideo)},function(){})}catch(e){throw new Error(\"Error setting webcam. Message: \"+e.message)}},_ready&&_readyCb()}},reset:icon.reset,browser:{supported:_browser.supported}}};\"undefined\"!=typeof define&&define.amd?define([],function(){return Favico}):\"undefined\"!=typeof module&&module.exports?module.exports=Favico:this.Favico=Favico}(),function($){void 0===$.fn.each2&&$.extend($.fn,{each2:function(c){for(var j=$([0]),i=-1,l=this.length;++i<l&&(j.context=j[0]=this[i])&&!1!==c.call(j[0],i,j););return this}})}(jQuery),function($,undefined){\"use strict\";if(window.Select2===undefined){var AbstractSelect2,SingleSelect2,MultiSelect2,nextUid,sizer,$document,scrollBarDimensions,counter,lastMousePosition={x:0,y:0},KEY={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(k){switch(k=k.which?k.which:k){case KEY.LEFT:case KEY.RIGHT:case KEY.UP:case KEY.DOWN:return!0}return!1},isControl:function(e){switch(e.which){case KEY.SHIFT:case KEY.CTRL:case KEY.ALT:return!0}return!!e.metaKey},isFunctionKey:function(k){return(k=k.which?k.which:k)>=112&&k<=123}},MEASURE_SCROLLBAR_TEMPLATE=\"<div class='select2-measure-scrollbar'></div>\",DIACRITICS={\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"A\",\"\":\"AA\",\"\":\"AE\",\"\":\"AE\",\"\":\"AE\",\"\":\"AO\",\"\":\"AU\",\"\":\"AV\",\"\":\"AV\",\"\":\"AY\",\"\":\"B\",\"\":\"B\",\"\":\"B\",\"\":\"B\",\"\":\"B\",\"\":\"B\",\"\":\"B\",\"\":\"B\",\"\":\"C\",\"\":\"C\",\"\":\"C\",\"\":\"C\",\"\":\"C\",\"\":\"C\",\"\":\"C\",\"\":\"C\",\"\":\"C\",\"\":\"C\",\"\":\"C\",\"\":\"D\",\"\":\"D\",\"\":\"D\",\"\":\"D\",\"\":\"D\",\"\":\"D\",\"\":\"D\",\"\":\"D\",\"\":\"D\",\"\":\"D\",\"\":\"D\",\"\":\"D\",\"\":\"D\",\"\":\"DZ\",\"\":\"DZ\",\"\":\"Dz\",\"\":\"Dz\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"E\",\"\":\"F\",\"\":\"F\",\"\":\"F\",\"\":\"F\",\"\":\"F\",\"\":\"G\",\"\":\"G\",\"\":\"G\",\"\":\"G\",\"\":\"G\",\"\":\"G\",\"\":\"G\",\"\":\"G\",\"\":\"G\",\"\":\"G\",\"\":\"G\",\"\":\"G\",\"\":\"G\",\"\":\"G\",\"\":\"H\",\"\":\"H\",\"\":\"H\",\"\":\"H\",\"\":\"H\",\"\":\"H\",\"\":\"H\",\"\":\"H\",\"\":\"H\",\"\":\"H\",\"\":\"H\",\"\":\"H\",\"\":\"H\",\"\":\"I\",\"\":\"I\",\"\":\"I\",\"\":\"I\",\"\":\"I\",\"\":\"I\",\"\":\"I\",\"\":\"I\",\"\":\"I\",\"\":\"I\",\"\":\"I\",\"\":\"I\",\"\":\"I\",\"\":\"I\",\"\":\"I\",\"\":\"I\",\"\":\"I\",\"\":\"I\",\"\":\"I\",\"\":\"J\",\"\":\"J\",\"\":\"J\",\"\":\"J\",\"\":\"K\",\"\":\"K\",\"\":\"K\",\"\":\"K\",\"\":\"K\",\"\":\"K\",\"\":\"K\",\"\":\"K\",\"\":\"K\",\"\":\"K\",\"\":\"K\",\"\":\"K\",\"\":\"K\",\"\":\"L\",\"\":\"L\",\"\":\"L\",\"\":\"L\",\"\":\"L\",\"\":\"L\",\"\":\"L\",\"\":\"L\",\"\":\"L\",\"\":\"L\",\"\":\"L\",\"\":\"L\",\"\":\"L\",\"\":\"L\",\"\":\"L\",\"\":\"L\",\"\":\"L\",\"\":\"LJ\",\"\":\"Lj\",\"\":\"M\",\"\":\"M\",\"\":\"M\",\"\":\"M\",\"\":\"M\",\"\":\"M\",\"\":\"M\",\"\":\"N\",\"\":\"N\",\"\":\"N\",\"\":\"N\",\"\":\"N\",\"\":\"N\",\"\":\"N\",\"\":\"N\",\"\":\"N\",\"\":\"N\",\"\":\"N\",\"\":\"N\",\"\":\"N\",\"\":\"N\",\"\":\"N\",\"\":\"NJ\",\"\":\"Nj\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"O\",\"\":\"OI\",\"\":\"OO\",\"\":\"OU\",\"\":\"P\",\"\":\"P\",\"\":\"P\",\"\":\"P\",\"\":\"P\",\"\":\"P\",\"\":\"P\",\"\":\"P\",\"\":\"P\",\"\":\"Q\",\"\":\"Q\",\"\":\"Q\",\"\":\"Q\",\"\":\"Q\",\"\":\"R\",\"\":\"R\",\"\":\"R\",\"\":\"R\",\"\":\"R\",\"\":\"R\",\"\":\"R\",\"\":\"R\",\"\":\"R\",\"\":\"R\",\"\":\"R\",\"\":\"R\",\"\":\"R\",\"\":\"R\",\"\":\"R\",\"\":\"R\",\"\":\"S\",\"\":\"S\",\"\":\"S\",\"\":\"S\",\"\":\"S\",\"\":\"S\",\"\":\"S\",\"\":\"S\",\"\":\"S\",\"\":\"S\",\"\":\"S\",\"\":\"S\",\"\":\"S\",\"\":\"S\",\"\":\"S\",\"\":\"S\",\"\":\"T\",\"\":\"T\",\"\":\"T\",\"\":\"T\",\"\":\"T\",\"\":\"T\",\"\":\"T\",\"\":\"T\",\"\":\"T\",\"\":\"T\",\"\":\"T\",\"\":\"T\",\"\":\"T\",\"\":\"T\",\"\":\"TZ\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"U\",\"\":\"V\",\"\":\"V\",\"\":\"V\",\"\":\"V\",\"\":\"V\",\"\":\"V\",\"\":\"V\",\"\":\"VY\",\"\":\"W\",\"\":\"W\",\"\":\"W\",\"\":\"W\",\"\":\"W\",\"\":\"W\",\"\":\"W\",\"\":\"W\",\"\":\"W\",\"\":\"X\",\"\":\"X\",\"\":\"X\",\"\":\"X\",\"\":\"Y\",\"\":\"Y\",\"\":\"Y\",\"\":\"Y\",\"\":\"Y\",\"\":\"Y\",\"\":\"Y\",\"\":\"Y\",\"\":\"Y\",\"\":\"Y\",\"\":\"Y\",\"\":\"Y\",\"\":\"Y\",\"\":\"Y\",\"\":\"Z\",\"\":\"Z\",\"\":\"Z\",\"\":\"Z\",\"\":\"Z\",\"\":\"Z\",\"\":\"Z\",\"\":\"Z\",\"\":\"Z\",\"\":\"Z\",\"\":\"Z\",\"\":\"Z\",\"\":\"Z\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"a\",\"\":\"aa\",\"\":\"ae\",\"\":\"ae\",\"\":\"ae\",\"\":\"ao\",\"\":\"au\",\"\":\"av\",\"\":\"av\",\"\":\"ay\",\"\":\"b\",\"\":\"b\",\"\":\"b\",\"\":\"b\",\"\":\"b\",\"\":\"b\",\"\":\"b\",\"\":\"b\",\"\":\"c\",\"\":\"c\",\"\":\"c\",\"\":\"c\",\"\":\"c\",\"\":\"c\",\"\":\"c\",\"\":\"c\",\"\":\"c\",\"\":\"c\",\"\":\"c\",\"\":\"c\",\"\":\"d\",\"\":\"d\",\"\":\"d\",\"\":\"d\",\"\":\"d\",\"\":\"d\",\"\":\"d\",\"\":\"d\",\"\":\"d\",\"\":\"d\",\"\":\"d\",\"\":\"d\",\"\":\"d\",\"\":\"dz\",\"\":\"dz\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"e\",\"\":\"f\",\"\":\"f\",\"\":\"f\",\"\":\"f\",\"\":\"f\",\"\":\"g\",\"\":\"g\",\"\":\"g\",\"\":\"g\",\"\":\"g\",\"\":\"g\",\"\":\"g\",\"\":\"g\",\"\":\"g\",\"\":\"g\",\"\":\"g\",\"\":\"g\",\"\":\"g\",\"\":\"g\",\"\":\"h\",\"\":\"h\",\"\":\"h\",\"\":\"h\",\"\":\"h\",\"\":\"h\",\"\":\"h\",\"\":\"h\",\"\":\"h\",\"\":\"h\",\"\":\"h\",\"\":\"h\",\"\":\"h\",\"\":\"h\",\"\":\"hv\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"i\",\"\":\"j\",\"\":\"j\",\"\":\"j\",\"\":\"j\",\"\":\"j\",\"\":\"k\",\"\":\"k\",\"\":\"k\",\"\":\"k\",\"\":\"k\",\"\":\"k\",\"\":\"k\",\"\":\"k\",\"\":\"k\",\"\":\"k\",\"\":\"k\",\"\":\"k\",\"\":\"k\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"l\",\"\":\"lj\",\"\":\"m\",\"\":\"m\",\"\":\"m\",\"\":\"m\",\"\":\"m\",\"\":\"m\",\"\":\"m\",\"\":\"n\",\"\":\"n\",\"\":\"n\",\"\":\"n\",\"\":\"n\",\"\":\"n\",\"\":\"n\",\"\":\"n\",\"\":\"n\",\"\":\"n\",\"\":\"n\",\"\":\"n\",\"\":\"n\",\"\":\"n\",\"\":\"n\",\"\":\"n\",\"\":\"nj\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"o\",\"\":\"oi\",\"\":\"ou\",\"\":\"oo\",\"\":\"p\",\"\":\"p\",\"\":\"p\",\"\":\"p\",\"\":\"p\",\"\":\"p\",\"\":\"p\",\"\":\"p\",\"\":\"p\",\"\":\"q\",\"\":\"q\",\"\":\"q\",\"\":\"q\",\"\":\"q\",\"\":\"r\",\"\":\"r\",\"\":\"r\",\"\":\"r\",\"\":\"r\",\"\":\"r\",\"\":\"r\",\"\":\"r\",\"\":\"r\",\"\":\"r\",\"\":\"r\",\"\":\"r\",\"\":\"r\",\"\":\"r\",\"\":\"r\",\"\":\"r\",\"\":\"s\",\"\":\"s\",\"\":\"s\",\"\":\"s\",\"\":\"s\",\"\":\"s\",\"\":\"s\",\"\":\"s\",\"\":\"s\",\"\":\"s\",\"\":\"s\",\"\":\"s\",\"\":\"s\",\"\":\"s\",\"\":\"s\",\"\":\"s\",\"\":\"s\",\"\":\"t\",\"\":\"t\",\"\":\"t\",\"\":\"t\",\"\":\"t\",\"\":\"t\",\"\":\"t\",\"\":\"t\",\"\":\"t\",\"\":\"t\",\"\":\"t\",\"\":\"t\",\"\":\"t\",\"\":\"t\",\"\":\"t\",\"\":\"tz\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"u\",\"\":\"v\",\"\":\"v\",\"\":\"v\",\"\":\"v\",\"\":\"v\",\"\":\"v\",\"\":\"v\",\"\":\"vy\",\"\":\"w\",\"\":\"w\",\"\":\"w\",\"\":\"w\",\"\":\"w\",\"\":\"w\",\"\":\"w\",\"\":\"w\",\"\":\"w\",\"\":\"w\",\"\":\"x\",\"\":\"x\",\"\":\"x\",\"\":\"x\",\"\":\"y\",\"\":\"y\",\"\":\"y\",\"\":\"y\",\"\":\"y\",\"\":\"y\",\"\":\"y\",\"\":\"y\",\"\":\"y\",\"\":\"y\",\"\":\"y\",\"\":\"y\",\"\":\"y\",\"\":\"y\",\"\":\"y\",\"\":\"z\",\"\":\"z\",\"\":\"z\",\"\":\"z\",\"\":\"z\",\"\":\"z\",\"\":\"z\",\"\":\"z\",\"\":\"z\",\"\":\"z\",\"\":\"z\",\"\":\"z\",\"\":\"z\"};$document=$(document),counter=1,nextUid=function(){return counter++},$document.on(\"mousemove\",function(e){lastMousePosition.x=e.pageX,lastMousePosition.y=e.pageY}),SingleSelect2=clazz(AbstractSelect2=clazz(Object,{bind:function(func){var self=this;return function(){func.apply(self,arguments)}},init:function(opts){var results,search;this.opts=opts=this.prepareOpts(opts),this.id=opts.id,opts.element.data(\"select2\")!==undefined&&null!==opts.element.data(\"select2\")&&opts.element.data(\"select2\").destroy(),this.container=this.createContainer(),this.liveRegion=$(\"<span>\",{role:\"status\",\"aria-live\":\"polite\"}).addClass(\"select2-hidden-accessible\").appendTo(document.body),this.containerId=\"s2id_\"+(opts.element.attr(\"id\")||\"autogen\"+nextUid()),this.containerEventName=this.containerId.replace(/([.])/g,\"_\").replace(/([;&,\\-\\.\\+\\*\\~':\"\\!\\^#$%@\\[\\]\\(\\)=>\\|])/g,\"\\\\$1\"),this.container.attr(\"id\",this.containerId),this.container.attr(\"title\",opts.element.attr(\"title\")),this.body=$(\"body\"),syncCssClasses(this.container,this.opts.element,this.opts.adaptContainerCssClass),this.container.attr(\"style\",opts.element.attr(\"style\")),this.container.css(evaluate(opts.containerCss)),this.container.addClass(evaluate(opts.containerCssClass)),this.elementTabIndex=this.opts.element.attr(\"tabindex\"),this.opts.element.data(\"select2\",this).attr(\"tabindex\",\"-1\").before(this.container).on(\"click.select2\",killEvent),this.container.data(\"select2\",this),this.dropdown=this.container.find(\".select2-drop\"),syncCssClasses(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass),this.dropdown.addClass(evaluate(opts.dropdownCssClass)),this.dropdown.data(\"select2\",this),this.dropdown.on(\"click\",killEvent),this.results=results=this.container.find(\".select2-results\"),this.search=search=this.container.find(\"input.select2-input\"),this.queryCount=0,this.resultsPage=0,this.context=null,this.initContainer(),this.container.on(\"click\",killEvent),this.results.on(\"mousemove\",function(e){var lastpos=lastMousePosition;lastpos!==undefined&&lastpos.x===e.pageX&&lastpos.y===e.pageY||$(e.target).trigger(\"mousemove-filtered\",e)}),this.dropdown.on(\"mousemove-filtered\",\".select2-results\",this.bind(this.highlightUnderEvent)),this.dropdown.on(\"touchstart touchmove touchend\",\".select2-results\",this.bind(function(event){this._touchEvent=!0,this.highlightUnderEvent(event)})),this.dropdown.on(\"touchmove\",\".select2-results\",this.bind(this.touchMoved)),this.dropdown.on(\"touchstart touchend\",\".select2-results\",this.bind(this.clearTouchMoved)),this.dropdown.on(\"click\",this.bind(function(event){this._touchEvent&&(this._touchEvent=!1,this.selectHighlighted())})),function(threshold,element){var notify=debounce(threshold,function(e){element.trigger(\"scroll-debounced\",e)});element.on(\"scroll\",function(e){indexOf(e.target,element.get())>=0&&notify(e)})}(80,this.results),this.dropdown.on(\"scroll-debounced\",\".select2-results\",this.bind(this.loadMoreIfNeeded)),$(this.container).on(\"change\",\".select2-input\",function(e){e.stopPropagation()}),$(this.dropdown).on(\"change\",\".select2-input\",function(e){e.stopPropagation()}),$.fn.mousewheel&&results.mousewheel(function(e,delta,deltaX,deltaY){var top=results.scrollTop();deltaY>0&&top-deltaY<=0?(results.scrollTop(0),killEvent(e)):deltaY<0&&results.get(0).scrollHeight-results.scrollTop()+deltaY<=results.height()&&(results.scrollTop(results.get(0).scrollHeight-results.height()),killEvent(e))}),installKeyUpChangeEvent(search),search.on(\"keyup-change input paste\",this.bind(this.updateResults)),search.on(\"focus\",function(){search.addClass(\"select2-focused\")}),search.on(\"blur\",function(){search.removeClass(\"select2-focused\")}),this.dropdown.on(\"mouseup\",\".select2-results\",this.bind(function(e){$(e.target).closest(\".select2-result-selectable\").length>0&&(this.highlightUnderEvent(e),this.selectHighlighted(e))})),this.dropdown.on(\"click mouseup mousedown touchstart touchend focusin\",function(e){e.stopPropagation()}),this.nextSearchTerm=undefined,$.isFunction(this.opts.initSelection)&&(this.initSelection(),this.monitorSource()),null!==opts.maximumInputLength&&this.search.attr(\"maxlength\",opts.maximumInputLength);var disabled=opts.element.prop(\"disabled\");disabled===undefined&&(disabled=!1),this.enable(!disabled);var readonly=opts.element.prop(\"readonly\");readonly===undefined&&(readonly=!1),this.readonly(readonly),scrollBarDimensions=scrollBarDimensions||function(){var $template=$(MEASURE_SCROLLBAR_TEMPLATE);$template.appendTo(\"body\");var dim={width:$template.width()-$template[0].clientWidth,height:$template.height()-$template[0].clientHeight};return $template.remove(),dim}(),this.autofocus=opts.element.prop(\"autofocus\"),opts.element.prop(\"autofocus\",!1),this.autofocus&&this.focus(),this.search.attr(\"placeholder\",opts.searchInputPlaceholder)},destroy:function(){var element=this.opts.element,select2=element.data(\"select2\");this.close(),this.propertyObserver&&(this.propertyObserver.disconnect(),this.propertyObserver=null),select2!==undefined&&(select2.container.remove(),select2.liveRegion.remove(),select2.dropdown.remove(),element.removeClass(\"select2-offscreen\").removeData(\"select2\").off(\".select2\").prop(\"autofocus\",this.autofocus||!1),this.elementTabIndex?element.attr({tabindex:this.elementTabIndex}):element.removeAttr(\"tabindex\"),element.show()),cleanupJQueryElements.call(this,\"container\",\"liveRegion\",\"dropdown\",\"results\",\"search\")},optionToData:function(element){return element.is(\"option\")?{id:element.prop(\"value\"),text:element.text(),element:element.get(),css:element.attr(\"class\"),disabled:element.prop(\"disabled\"),locked:equal(element.attr(\"locked\"),\"locked\")||equal(element.data(\"locked\"),!0)}:element.is(\"optgroup\")?{text:element.attr(\"label\"),children:[],element:element.get(),css:element.attr(\"class\")}:void 0},prepareOpts:function(opts){var element,select,idKey,ajaxUrl,self=this;if(\"select\"===(element=opts.element).get(0).tagName.toLowerCase()&&(this.select=select=opts.element),select&&$.each([\"id\",\"multiple\",\"ajax\",\"query\",\"createSearchChoice\",\"initSelection\",\"data\",\"tags\"],function(){if(this in opts)throw new Error(\"Option '\"+this+\"' is not allowed for Select2 when attached to a <select> element.\")}),\"function\"!=typeof(opts=$.extend({},{populateResults:function(container,results,query){var populate,id=this.opts.id,liveRegion=this.liveRegion;(populate=function(results,container,depth){var i,l,result,selectable,disabled,compound,node,label,innerContainer,formatted;for(i=0,l=(results=opts.sortResults(results,container,query)).length;i<l;i+=1)selectable=!(disabled=!0===(result=results[i]).disabled)&&id(result)!==undefined,compound=result.children&&result.children.length>0,(node=$(\"<li></li>\")).addClass(\"select2-results-dept-\"+depth),node.addClass(\"select2-result\"),node.addClass(selectable?\"select2-result-selectable\":\"select2-result-unselectable\"),disabled&&node.addClass(\"select2-disabled\"),compound&&node.addClass(\"select2-result-with-children\"),node.addClass(self.opts.formatResultCssClass(result)),node.attr(\"role\",\"presentation\"),(label=$(document.createElement(\"div\"))).addClass(\"select2-result-label\"),label.attr(\"id\",\"select2-result-label-\"+nextUid()),label.attr(\"role\",\"option\"),(formatted=opts.formatResult(result,label,query,self.opts.escapeMarkup))!==undefined&&(label.html(formatted),node.append(label)),compound&&((innerContainer=$(\"<ul></ul>\")).addClass(\"select2-result-sub\"),populate(result.children,innerContainer,depth+1),node.append(innerContainer)),node.data(\"select2-data\",result),container.append(node);liveRegion.text(opts.formatMatches(results.length))})(results,container,0)}},$.fn.select2.defaults,opts)).id&&(idKey=opts.id,opts.id=function(e){return e[idKey]}),$.isArray(opts.element.data(\"select2Tags\"))){if(\"tags\"in opts)throw\"tags specified as both an attribute 'data-select2-tags' and in options of Select2 \"+opts.element.attr(\"id\");opts.tags=opts.element.data(\"select2Tags\")}if(select?(opts.query=this.bind(function(query){var children,placeholderOption,process,data={results:[],more:!1},term=query.term;process=function(element,collection){var group;element.is(\"option\")?query.matcher(term,element.text(),element)&&collection.push(self.optionToData(element)):element.is(\"optgroup\")&&(group=self.optionToData(element),element.children().each2(function(i,elm){process(elm,group.children)}),group.children.length>0&&collection.push(group))},children=element.children(),this.getPlaceholder()!==undefined&&children.length>0&&(placeholderOption=this.getPlaceholderOption())&&(children=children.not(placeholderOption)),children.each2(function(i,elm){process(elm,data.results)}),query.callback(data)}),opts.id=function(e){return e.id}):\"query\"in opts||(\"ajax\"in opts?((ajaxUrl=opts.element.data(\"ajax-url\"))&&ajaxUrl.length>0&&(opts.ajax.url=ajaxUrl),opts.query=ajax.call(opts.element,opts.ajax)):\"data\"in opts?opts.query=local(opts.data):\"tags\"in opts&&(opts.query=tags(opts.tags),opts.createSearchChoice===undefined&&(opts.createSearchChoice=function(term){return{id:$.trim(term),text:$.trim(term)}}),opts.initSelection===undefined&&(opts.initSelection=function(element,callback){var data=[];$(splitVal(element.val(),opts.separator)).each(function(){var obj={id:this,text:this},tags=opts.tags;$.isFunction(tags)&&(tags=tags()),$(tags).each(function(){if(equal(this.id,obj.id))return obj=this,!1}),data.push(obj)}),callback(data)}))),\"function\"!=typeof opts.query)throw\"query function not defined for Select2 \"+opts.element.attr(\"id\");if(\"top\"===opts.createSearchChoicePosition)opts.createSearchChoicePosition=function(list,item){list.unshift(item)};else if(\"bottom\"===opts.createSearchChoicePosition)opts.createSearchChoicePosition=function(list,item){list.push(item)};else if(\"function\"!=typeof opts.createSearchChoicePosition)throw\"invalid createSearchChoicePosition option must be 'top', 'bottom' or a custom function\";return opts},monitorSource:function(){var sync,observer,el=this.opts.element;el.on(\"change.select2\",this.bind(function(e){!0!==this.opts.element.data(\"select2-change-triggered\")&&this.initSelection()})),sync=this.bind(function(){var disabled=el.prop(\"disabled\");disabled===undefined&&(disabled=!1),this.enable(!disabled);var readonly=el.prop(\"readonly\");readonly===undefined&&(readonly=!1),this.readonly(readonly),syncCssClasses(this.container,this.opts.element,this.opts.adaptContainerCssClass),this.container.addClass(evaluate(this.opts.containerCssClass)),syncCssClasses(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass),this.dropdown.addClass(evaluate(this.opts.dropdownCssClass))}),el.length&&el[0].attachEvent&&el.each(function(){this.attachEvent(\"onpropertychange\",sync)}),(observer=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver)!==undefined&&(this.propertyObserver&&(delete this.propertyObserver,this.propertyObserver=null),this.propertyObserver=new observer(function(mutations){mutations.forEach(sync)}),this.propertyObserver.observe(el.get(0),{attributes:!0,subtree:!1}))},triggerSelect:function(data){var evt=$.Event(\"select2-selecting\",{val:this.id(data),object:data});return this.opts.element.trigger(evt),!evt.isDefaultPrevented()},triggerChange:function(details){details=details||{},details=$.extend({},details,{type:\"change\",val:this.val()}),this.opts.element.data(\"select2-change-triggered\",!0),this.opts.element.trigger(details),this.opts.element.data(\"select2-change-triggered\",!1),this.opts.element.click(),this.opts.blurOnChange&&this.opts.element.blur()},isInterfaceEnabled:function(){return!0===this.enabledInterface},enableInterface:function(){var enabled=this._enabled&&!this._readonly,disabled=!enabled;return enabled!==this.enabledInterface&&(this.container.toggleClass(\"select2-container-disabled\",disabled),this.close(),this.enabledInterface=enabled,!0)},enable:function(enabled){enabled===undefined&&(enabled=!0),this._enabled!==enabled&&(this._enabled=enabled,this.opts.element.prop(\"disabled\",!enabled),this.enableInterface())},disable:function(){this.enable(!1)},readonly:function(enabled){enabled===undefined&&(enabled=!1),this._readonly!==enabled&&(this._readonly=enabled,this.opts.element.prop(\"readonly\",enabled),this.enableInterface())},opened:function(){return this.container.hasClass(\"select2-dropdown-open\")},positionDropdown:function(){var bodyOffset,above,changeDirection,css,resultsListNode,$dropdown=this.dropdown,offset=this.container.offset(),height=this.container.outerHeight(!1),width=this.container.outerWidth(!1),dropHeight=$dropdown.outerHeight(!1),$window=$(window),windowWidth=$window.width(),windowHeight=$window.height(),viewPortRight=$window.scrollLeft()+windowWidth,viewportBottom=$window.scrollTop()+windowHeight,dropTop=offset.top+height,dropLeft=offset.left,enoughRoomBelow=dropTop+dropHeight<=viewportBottom,enoughRoomAbove=offset.top-dropHeight>=$window.scrollTop(),dropWidth=$dropdown.outerWidth(!1),enoughRoomOnRight=dropLeft+dropWidth<=viewPortRight;$dropdown.hasClass(\"select2-drop-above\")?(above=!0,!enoughRoomAbove&&enoughRoomBelow&&(changeDirection=!0,above=!1)):(above=!1,!enoughRoomBelow&&enoughRoomAbove&&(changeDirection=!0,above=!0)),changeDirection&&($dropdown.hide(),offset=this.container.offset(),height=this.container.outerHeight(!1),width=this.container.outerWidth(!1),dropHeight=$dropdown.outerHeight(!1),viewPortRight=$window.scrollLeft()+windowWidth,viewportBottom=$window.scrollTop()+windowHeight,dropTop=offset.top+height,enoughRoomOnRight=(dropLeft=offset.left)+(dropWidth=$dropdown.outerWidth(!1))<=viewPortRight,$dropdown.show(),this.focusSearch()),this.opts.dropdownAutoWidth?(resultsListNode=$(\".select2-results\",$dropdown)[0],$dropdown.addClass(\"select2-drop-auto-width\"),$dropdown.css(\"width\",\"\"),(dropWidth=$dropdown.outerWidth(!1)+(resultsListNode.scrollHeight===resultsListNode.clientHeight?0:scrollBarDimensions.width))>width?width=dropWidth:dropWidth=width,dropHeight=$dropdown.outerHeight(!1),enoughRoomOnRight=dropLeft+dropWidth<=viewPortRight):this.container.removeClass(\"select2-drop-auto-width\"),\"static\"!==this.body.css(\"position\")&&(dropTop-=(bodyOffset=this.body.offset()).top,dropLeft-=bodyOffset.left),enoughRoomOnRight||(dropLeft=offset.left+this.container.outerWidth(!1)-dropWidth),css={left:dropLeft,width:width},above?(css.top=offset.top-dropHeight,css.bottom=\"auto\",this.container.addClass(\"select2-drop-above\"),$dropdown.addClass(\"select2-drop-above\")):(css.top=dropTop,css.bottom=\"auto\",this.container.removeClass(\"select2-drop-above\"),$dropdown.removeClass(\"select2-drop-above\")),css=$.extend(css,evaluate(this.opts.dropdownCss)),$dropdown.css(css)},shouldOpen:function(){var event;return!this.opened()&&(!1!==this._enabled&&!0!==this._readonly&&(event=$.Event(\"select2-opening\"),this.opts.element.trigger(event),!event.isDefaultPrevented()))},clearDropdownAlignmentPreference:function(){this.container.removeClass(\"select2-drop-above\"),this.dropdown.removeClass(\"select2-drop-above\")},open:function(){return!!this.shouldOpen()&&(this.opening(),!0)},opening:function(){var mask,cid=this.containerEventName,scroll=\"scroll.\"+cid,resize=\"resize.\"+cid,orient=\"orientationchange.\"+cid;this.container.addClass(\"select2-dropdown-open\").addClass(\"select2-container-active\"),this.clearDropdownAlignmentPreference(),this.dropdown[0]!==this.body.children().last()[0]&&this.dropdown.detach().appendTo(this.body),0==(mask=$(\"#select2-drop-mask\")).length&&((mask=$(document.createElement(\"div\"))).attr(\"id\",\"select2-drop-mask\").attr(\"class\",\"select2-drop-mask\"),mask.hide(),mask.appendTo(this.body),mask.on(\"mousedown touchstart click\",function(e){reinsertElement(mask);var self,dropdown=$(\"#select2-drop\");dropdown.length>0&&((self=dropdown.data(\"select2\")).opts.selectOnBlur&&self.selectHighlighted({noFocus:!0}),self.close(),e.preventDefault(),e.stopPropagation())})),this.dropdown.prev()[0]!==mask[0]&&this.dropdown.before(mask),$(\"#select2-drop\").removeAttr(\"id\"),this.dropdown.attr(\"id\",\"select2-drop\"),mask.show(),this.positionDropdown(),this.dropdown.show(),this.positionDropdown(),this.dropdown.addClass(\"select2-drop-active\");var that=this;this.container.parents().add(window).each(function(){$(this).on(resize+\" \"+scroll+\" \"+orient,function(e){that.opened()&&that.positionDropdown()})})},close:function(){if(this.opened()){var cid=this.containerEventName,scroll=\"scroll.\"+cid,resize=\"resize.\"+cid,orient=\"orientationchange.\"+cid;this.container.parents().add(window).each(function(){$(this).off(scroll).off(resize).off(orient)}),this.clearDropdownAlignmentPreference(),$(\"#select2-drop-mask\").hide(),this.dropdown.removeAttr(\"id\"),this.dropdown.hide(),this.container.removeClass(\"select2-dropdown-open\").removeClass(\"select2-container-active\"),this.results.empty(),this.clearSearch(),this.search.removeClass(\"select2-active\"),this.opts.element.trigger($.Event(\"select2-close\"))}},externalSearch:function(term){this.open(),this.search.val(term),this.updateResults(!1)},clearSearch:function(){},getMaximumSelectionSize:function(){return evaluate(this.opts.maximumSelectionSize)},ensureHighlightVisible:function(){var children,index,child,hb,rb,y,more,results=this.results;(index=this.highlight())<0||(0!=index?(children=this.findHighlightableChoices().find(\".select2-result-label\"),hb=(child=$(children[index])).offset().top+child.outerHeight(!0),index===children.length-1&&(more=results.find(\"li.select2-more-results\")).length>0&&(hb=more.offset().top+more.outerHeight(!0)),hb>(rb=results.offset().top+results.outerHeight(!0))&&results.scrollTop(results.scrollTop()+(hb-rb)),(y=child.offset().top-results.offset().top)<0&&\"none\"!=child.css(\"display\")&&results.scrollTop(results.scrollTop()+y)):results.scrollTop(0))},findHighlightableChoices:function(){return this.results.find(\".select2-result-selectable:not(.select2-disabled):not(.select2-selected)\")},moveHighlight:function(delta){for(var choices=this.findHighlightableChoices(),index=this.highlight();index>-1&&index<choices.length;){var choice=$(choices[index+=delta]);if(choice.hasClass(\"select2-result-selectable\")&&!choice.hasClass(\"select2-disabled\")&&!choice.hasClass(\"select2-selected\")){this.highlight(index);break}}},highlight:function(index){var choice,data,choices=this.findHighlightableChoices();if(0===arguments.length)return indexOf(choices.filter(\".select2-highlighted\")[0],choices.get());index>=choices.length&&(index=choices.length-1),index<0&&(index=0),this.removeHighlight(),(choice=$(choices[index])).addClass(\"select2-highlighted\"),this.search.attr(\"aria-activedescendant\",choice.find(\".select2-result-label\").attr(\"id\")),this.ensureHighlightVisible(),this.liveRegion.text(choice.text()),(data=choice.data(\"select2-data\"))&&this.opts.element.trigger({type:\"select2-highlight\",val:this.id(data),choice:data})},removeHighlight:function(){this.results.find(\".select2-highlighted\").removeClass(\"select2-highlighted\")},touchMoved:function(){this._touchMoved=!0},clearTouchMoved:function(){this._touchMoved=!1},countSelectableResults:function(){return this.findHighlightableChoices().length},highlightUnderEvent:function(event){var el=$(event.target).closest(\".select2-result-selectable\");if(el.length>0&&!el.is(\".select2-highlighted\")){var choices=this.findHighlightableChoices();this.highlight(choices.index(el))}else 0==el.length&&this.removeHighlight()},loadMoreIfNeeded:function(){var results=this.results,more=results.find(\"li.select2-more-results\"),page=this.resultsPage+1,self=this,term=this.search.val(),context=this.context;0!==more.length&&more.offset().top-results.offset().top-results.height()<=this.opts.loadMorePadding&&(more.addClass(\"select2-active\"),this.opts.query({element:this.opts.element,term:term,page:page,context:context,matcher:this.opts.matcher,callback:this.bind(function(data){self.opened()&&(self.opts.populateResults.call(this,results,data.results,{term:term,page:page,context:context}),self.postprocessResults(data,!1,!1),!0===data.more?(more.detach().appendTo(results).text(evaluate(self.opts.formatLoadMore,page+1)),window.setTimeout(function(){self.loadMoreIfNeeded()},10)):more.remove(),self.positionDropdown(),self.resultsPage=page,self.context=data.context,this.opts.element.trigger({type:\"select2-loaded\",items:data}))})}))},tokenize:function(){},updateResults:function(initial){var data,input,queryNumber,search=this.search,results=this.results,opts=this.opts,self=this,term=search.val(),lastTerm=$.data(this.container,\"select2-last-term\");if((!0===initial||!lastTerm||!equal(term,lastTerm))&&($.data(this.container,\"select2-last-term\",term),!0===initial||!1!==this.showSearchInput&&this.opened())){queryNumber=++this.queryCount;var maxSelSize=this.getMaximumSelectionSize();if(!(maxSelSize>=1&&(data=this.data(),$.isArray(data)&&data.length>=maxSelSize&&checkFormatter(opts.formatSelectionTooBig,\"formatSelectionTooBig\"))))return search.val().length<opts.minimumInputLength?(checkFormatter(opts.formatInputTooShort,\"formatInputTooShort\")?render(\"<li class='select2-no-results'>\"+evaluate(opts.formatInputTooShort,search.val(),opts.minimumInputLength)+\"</li>\"):render(\"\"),void(initial&&this.showSearch&&this.showSearch(!0))):void(opts.maximumInputLength&&search.val().length>opts.maximumInputLength?checkFormatter(opts.formatInputTooLong,\"formatInputTooLong\")?render(\"<li class='select2-no-results'>\"+evaluate(opts.formatInputTooLong,search.val(),opts.maximumInputLength)+\"</li>\"):render(\"\"):(opts.formatSearching&&0===this.findHighlightableChoices().length&&render(\"<li class='select2-searching'>\"+evaluate(opts.formatSearching)+\"</li>\"),search.addClass(\"select2-active\"),this.removeHighlight(),(input=this.tokenize())!=undefined&&null!=input&&search.val(input),this.resultsPage=1,opts.query({element:opts.element,term:search.val(),page:this.resultsPage,context:null,matcher:opts.matcher,callback:this.bind(function(data){var def;queryNumber==this.queryCount&&(this.opened()?(this.context=data.context===undefined?null:data.context,this.opts.createSearchChoice&&\"\"!==search.val()&&(def=this.opts.createSearchChoice.call(self,search.val(),data.results))!==undefined&&null!==def&&self.id(def)!==undefined&&null!==self.id(def)&&0===$(data.results).filter(function(){return equal(self.id(this),self.id(def))}).length&&this.opts.createSearchChoicePosition(data.results,def),0===data.results.length&&checkFormatter(opts.formatNoMatches,\"formatNoMatches\")?render(\"<li class='select2-no-results'>\"+evaluate(opts.formatNoMatches,search.val())+\"</li>\"):(results.empty(),self.opts.populateResults.call(this,results,data.results,{term:search.val(),page:this.resultsPage,context:null}),!0===data.more&&checkFormatter(opts.formatLoadMore,\"formatLoadMore\")&&(results.append(\"<li class='select2-more-results'>\"+self.opts.escapeMarkup(evaluate(opts.formatLoadMore,this.resultsPage))+\"</li>\"),window.setTimeout(function(){self.loadMoreIfNeeded()},10)),this.postprocessResults(data,initial),postRender(),this.opts.element.trigger({type:\"select2-loaded\",items:data}))):this.search.removeClass(\"select2-active\"))})})));render(\"<li class='select2-selection-limit'>\"+evaluate(opts.formatSelectionTooBig,maxSelSize)+\"</li>\")}function postRender(){search.removeClass(\"select2-active\"),self.positionDropdown(),results.find(\".select2-no-results,.select2-selection-limit,.select2-searching\").length?self.liveRegion.text(results.text()):self.liveRegion.text(self.opts.formatMatches(results.find(\".select2-result-selectable\").length))}function render(html){results.html(html),postRender()}},cancel:function(){this.close()},blur:function(){this.opts.selectOnBlur&&this.selectHighlighted({noFocus:!0}),this.close(),this.container.removeClass(\"select2-container-active\"),this.search[0]===document.activeElement&&this.search.blur(),this.clearSearch(),this.selection.find(\".select2-search-choice-focus\").removeClass(\"select2-search-choice-focus\")},focusSearch:function(){var $el;($el=this.search)[0]!==document.activeElement&&window.setTimeout(function(){var range,el=$el[0],pos=$el.val().length;$el.focus(),(el.offsetWidth>0||el.offsetHeight>0)&&el===document.activeElement&&(el.setSelectionRange?el.setSelectionRange(pos,pos):el.createTextRange&&((range=el.createTextRange()).collapse(!1),range.select()))},0)},selectHighlighted:function(options){if(this._touchMoved)this.clearTouchMoved();else{var index=this.highlight(),data=this.results.find(\".select2-highlighted\").closest(\".select2-result\").data(\"select2-data\");data?(this.highlight(index),this.onSelect(data,options)):options&&options.noFocus&&this.close()}},getPlaceholder:function(){var placeholderOption;return this.opts.element.attr(\"placeholder\")||this.opts.element.attr(\"data-placeholder\")||this.opts.element.data(\"placeholder\")||this.opts.placeholder||((placeholderOption=this.getPlaceholderOption())!==undefined?placeholderOption.text():undefined)},getPlaceholderOption:function(){if(this.select){var firstOption=this.select.children(\"option\").first();if(this.opts.placeholderOption!==undefined)return\"first\"===this.opts.placeholderOption&&firstOption||\"function\"==typeof this.opts.placeholderOption&&this.opts.placeholderOption(this.select);if(\"\"===$.trim(firstOption.text())&&\"\"===firstOption.val())return firstOption}},initContainerWidth:function(){var width=function(){var style,attrs,matches,i,l;if(\"off\"===this.opts.width)return null;if(\"element\"===this.opts.width)return 0===this.opts.element.outerWidth(!1)?\"auto\":this.opts.element.outerWidth(!1)+\"px\";if(\"copy\"===this.opts.width||\"resolve\"===this.opts.width){if((style=this.opts.element.attr(\"style\"))!==undefined)for(i=0,l=(attrs=style.split(\";\")).length;i<l;i+=1)if(null!==(matches=attrs[i].replace(/\\s/g,\"\").match(/^width:(([-+]?([0-9]*\\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i))&&matches.length>=1)return matches[1];return\"resolve\"===this.opts.width?(style=this.opts.element.css(\"width\")).indexOf(\"%\")>0?style:0===this.opts.element.outerWidth(!1)?\"auto\":this.opts.element.outerWidth(!1)+\"px\":null}return $.isFunction(this.opts.width)?this.opts.width():this.opts.width}.call(this);null!==width&&this.container.css(\"width\",width)}}),{createContainer:function(){return $(document.createElement(\"div\")).attr({class:\"select2-container\"}).html([\"<a href='javascript:void(0)' class='select2-choice' tabindex='-1'>\",\"   <span class='select2-chosen'>&#160;</span><abbr class='select2-search-choice-close'></abbr>\",\"   <span class='select2-arrow' role='presentation'><b role='presentation'></b></span>\",\"</a>\",\"<label for='' class='select2-offscreen'></label>\",\"<input class='select2-focusser select2-offscreen' type='text' aria-haspopup='true' role='button' />\",\"<div class='select2-drop select2-display-none'>\",\"   <div class='select2-search'>\",\"       <label for='' class='select2-offscreen'></label>\",\"       <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input' role='combobox' aria-expanded='true'\",\"       aria-autocomplete='list' />\",\"   </div>\",\"   <ul class='select2-results' role='listbox'>\",\"   </ul>\",\"</div>\"].join(\"\"))},enableInterface:function(){this.parent.enableInterface.apply(this,arguments)&&this.focusser.prop(\"disabled\",!this.isInterfaceEnabled())},opening:function(){var el,range,len;this.opts.minimumResultsForSearch>=0&&this.showSearch(!0),this.parent.opening.apply(this,arguments),!1!==this.showSearchInput&&this.search.val(this.focusser.val()),this.opts.shouldFocusInput(this)&&(this.search.focus(),(el=this.search.get(0)).createTextRange?((range=el.createTextRange()).collapse(!1),range.select()):el.setSelectionRange&&(len=this.search.val().length,el.setSelectionRange(len,len))),\"\"===this.search.val()&&this.nextSearchTerm!=undefined&&(this.search.val(this.nextSearchTerm),this.search.select()),this.focusser.prop(\"disabled\",!0).val(\"\"),this.updateResults(!0),this.opts.element.trigger($.Event(\"select2-open\"))},close:function(){this.opened()&&(this.parent.close.apply(this,arguments),this.focusser.prop(\"disabled\",!1),this.opts.shouldFocusInput(this)&&this.focusser.focus())},focus:function(){this.opened()?this.close():(this.focusser.prop(\"disabled\",!1),this.opts.shouldFocusInput(this)&&this.focusser.focus())},isFocused:function(){return this.container.hasClass(\"select2-container-active\")},cancel:function(){this.parent.cancel.apply(this,arguments),this.focusser.prop(\"disabled\",!1),this.opts.shouldFocusInput(this)&&this.focusser.focus()},destroy:function(){$(\"label[for='\"+this.focusser.attr(\"id\")+\"']\").attr(\"for\",this.opts.element.attr(\"id\")),this.parent.destroy.apply(this,arguments),cleanupJQueryElements.call(this,\"selection\",\"focusser\")},initContainer:function(){var selection,elementLabel,container=this.container,dropdown=this.dropdown,idSuffix=nextUid();this.opts.minimumResultsForSearch<0?this.showSearch(!1):this.showSearch(!0),this.selection=selection=container.find(\".select2-choice\"),this.focusser=container.find(\".select2-focusser\"),selection.find(\".select2-chosen\").attr(\"id\",\"select2-chosen-\"+idSuffix),this.focusser.attr(\"aria-labelledby\",\"select2-chosen-\"+idSuffix),this.results.attr(\"id\",\"select2-results-\"+idSuffix),this.search.attr(\"aria-owns\",\"select2-results-\"+idSuffix),this.focusser.attr(\"id\",\"s2id_autogen\"+idSuffix),elementLabel=$(\"label[for='\"+this.opts.element.attr(\"id\")+\"']\"),this.focusser.prev().text(elementLabel.text()).attr(\"for\",this.focusser.attr(\"id\"));var originalTitle=this.opts.element.attr(\"title\");this.opts.element.attr(\"title\",originalTitle||elementLabel.text()),this.focusser.attr(\"tabindex\",this.elementTabIndex),this.search.attr(\"id\",this.focusser.attr(\"id\")+\"_search\"),this.search.prev().text($(\"label[for='\"+this.focusser.attr(\"id\")+\"']\").text()).attr(\"for\",this.search.attr(\"id\")),this.search.on(\"keydown\",this.bind(function(e){if(this.isInterfaceEnabled())if(e.which!==KEY.PAGE_UP&&e.which!==KEY.PAGE_DOWN)switch(e.which){case KEY.UP:case KEY.DOWN:return this.moveHighlight(e.which===KEY.UP?-1:1),void killEvent(e);case KEY.ENTER:return this.selectHighlighted(),void killEvent(e);case KEY.TAB:return void this.selectHighlighted({noFocus:!0});case KEY.ESC:return this.cancel(e),void killEvent(e)}else killEvent(e)})),this.search.on(\"blur\",this.bind(function(e){document.activeElement===this.body.get(0)&&window.setTimeout(this.bind(function(){this.opened()&&this.search.focus()}),0)})),this.focusser.on(\"keydown\",this.bind(function(e){if(this.isInterfaceEnabled()&&e.which!==KEY.TAB&&!KEY.isControl(e)&&!KEY.isFunctionKey(e)&&e.which!==KEY.ESC){if(!1!==this.opts.openOnEnter||e.which!==KEY.ENTER){if(e.which==KEY.DOWN||e.which==KEY.UP||e.which==KEY.ENTER&&this.opts.openOnEnter){if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey)return;return this.open(),void killEvent(e)}return e.which==KEY.DELETE||e.which==KEY.BACKSPACE?(this.opts.allowClear&&this.clear(),void killEvent(e)):void 0}killEvent(e)}})),installKeyUpChangeEvent(this.focusser),this.focusser.on(\"keyup-change input\",this.bind(function(e){if(this.opts.minimumResultsForSearch>=0){if(e.stopPropagation(),this.opened())return;this.open()}})),selection.on(\"mousedown touchstart\",\"abbr\",this.bind(function(e){var event;this.isInterfaceEnabled()&&(this.clear(),(event=e).preventDefault(),event.stopImmediatePropagation(),this.close(),this.selection.focus())})),selection.on(\"mousedown touchstart\",this.bind(function(e){reinsertElement(selection),this.container.hasClass(\"select2-container-active\")||this.opts.element.trigger($.Event(\"select2-focus\")),this.opened()?this.close():this.isInterfaceEnabled()&&this.open(),killEvent(e)})),dropdown.on(\"mousedown touchstart\",this.bind(function(){this.opts.shouldFocusInput(this)&&this.search.focus()})),selection.on(\"focus\",this.bind(function(e){killEvent(e)})),this.focusser.on(\"focus\",this.bind(function(){this.container.hasClass(\"select2-container-active\")||this.opts.element.trigger($.Event(\"select2-focus\")),this.container.addClass(\"select2-container-active\")})).on(\"blur\",this.bind(function(){this.opened()||(this.container.removeClass(\"select2-container-active\"),this.opts.element.trigger($.Event(\"select2-blur\")))})),this.search.on(\"focus\",this.bind(function(){this.container.hasClass(\"select2-container-active\")||this.opts.element.trigger($.Event(\"select2-focus\")),this.container.addClass(\"select2-container-active\")})),this.initContainerWidth(),this.opts.element.addClass(\"select2-offscreen\"),this.setPlaceholder()},clear:function(triggerChange){var data=this.selection.data(\"select2-data\");if(data){var evt=$.Event(\"select2-clearing\");if(this.opts.element.trigger(evt),evt.isDefaultPrevented())return;var placeholderOption=this.getPlaceholderOption();this.opts.element.val(placeholderOption?placeholderOption.val():\"\"),this.selection.find(\".select2-chosen\").empty(),this.selection.removeData(\"select2-data\"),this.setPlaceholder(),!1!==triggerChange&&(this.opts.element.trigger({type:\"select2-removed\",val:this.id(data),choice:data}),this.triggerChange({removed:data}))}},initSelection:function(){if(this.isPlaceholderOptionSelected())this.updateSelection(null),this.close(),this.setPlaceholder();else{var self=this;this.opts.initSelection.call(null,this.opts.element,function(selected){selected!==undefined&&null!==selected&&(self.updateSelection(selected),self.close(),self.setPlaceholder(),self.nextSearchTerm=self.opts.nextSearchTerm(selected,self.search.val()))})}},isPlaceholderOptionSelected:function(){var placeholderOption;return this.getPlaceholder()!==undefined&&((placeholderOption=this.getPlaceholderOption())!==undefined&&placeholderOption.prop(\"selected\")||\"\"===this.opts.element.val()||this.opts.element.val()===undefined||null===this.opts.element.val())},prepareOpts:function(){var opts=this.parent.prepareOpts.apply(this,arguments),self=this;return\"select\"===opts.element.get(0).tagName.toLowerCase()?opts.initSelection=function(element,callback){var selected=element.find(\"option\").filter(function(){return this.selected&&!this.disabled});callback(self.optionToData(selected))}:\"data\"in opts&&(opts.initSelection=opts.initSelection||function(element,callback){var id=element.val(),match=null;opts.query({matcher:function(term,text,el){var is_match=equal(id,opts.id(el));return is_match&&(match=el),is_match},callback:$.isFunction(callback)?function(){callback(match)}:$.noop})}),opts},getPlaceholder:function(){return this.select&&this.getPlaceholderOption()===undefined?undefined:this.parent.getPlaceholder.apply(this,arguments)},setPlaceholder:function(){var placeholder=this.getPlaceholder();if(this.isPlaceholderOptionSelected()&&placeholder!==undefined){if(this.select&&this.getPlaceholderOption()===undefined)return;this.selection.find(\".select2-chosen\").html(this.opts.escapeMarkup(placeholder)),this.selection.addClass(\"select2-default\"),this.container.removeClass(\"select2-allowclear\")}},postprocessResults:function(data,initial,noHighlightUpdate){var selected=0,self=this;if(this.findHighlightableChoices().each2(function(i,elm){if(equal(self.id(elm.data(\"select2-data\")),self.opts.element.val()))return selected=i,!1}),!1!==noHighlightUpdate&&(!0===initial&&selected>=0?this.highlight(selected):this.highlight(0)),!0===initial){var min=this.opts.minimumResultsForSearch;min>=0&&this.showSearch(function countResults(results){var count=0;return $.each(results,function(i,item){item.children?count+=countResults(item.children):count++}),count}(data.results)>=min)}},showSearch:function(showSearchInput){this.showSearchInput!==showSearchInput&&(this.showSearchInput=showSearchInput,this.dropdown.find(\".select2-search\").toggleClass(\"select2-search-hidden\",!showSearchInput),this.dropdown.find(\".select2-search\").toggleClass(\"select2-offscreen\",!showSearchInput),$(this.dropdown,this.container).toggleClass(\"select2-with-searchbox\",showSearchInput))},onSelect:function(data,options){if(this.triggerSelect(data)){var old=this.opts.element.val(),oldData=this.data();this.opts.element.val(this.id(data)),this.updateSelection(data),this.opts.element.trigger({type:\"select2-selected\",val:this.id(data),choice:data}),this.nextSearchTerm=this.opts.nextSearchTerm(data,this.search.val()),this.close(),options&&options.noFocus||!this.opts.shouldFocusInput(this)||this.focusser.focus(),equal(old,this.id(data))||this.triggerChange({added:data,removed:oldData})}},updateSelection:function(data){var formatted,cssClass,container=this.selection.find(\".select2-chosen\");this.selection.data(\"select2-data\",data),container.empty(),null!==data&&(formatted=this.opts.formatSelection(data,container,this.opts.escapeMarkup)),formatted!==undefined&&container.append(formatted),(cssClass=this.opts.formatSelectionCssClass(data,container))!==undefined&&container.addClass(cssClass),this.selection.removeClass(\"select2-default\"),this.opts.allowClear&&this.getPlaceholder()!==undefined&&this.container.addClass(\"select2-allowclear\")},val:function(){var val,triggerChange=!1,data=null,self=this,oldData=this.data();if(0===arguments.length)return this.opts.element.val();if(val=arguments[0],arguments.length>1&&(triggerChange=arguments[1]),this.select)this.select.val(val).find(\"option\").filter(function(){return this.selected}).each2(function(i,elm){return data=self.optionToData(elm),!1}),this.updateSelection(data),this.setPlaceholder(),triggerChange&&this.triggerChange({added:data,removed:oldData});else{if(!val&&0!==val)return void this.clear(triggerChange);if(this.opts.initSelection===undefined)throw new Error(\"cannot call val() if initSelection() is not defined\");this.opts.element.val(val),this.opts.initSelection(this.opts.element,function(data){self.opts.element.val(data?self.id(data):\"\"),self.updateSelection(data),self.setPlaceholder(),triggerChange&&self.triggerChange({added:data,removed:oldData})})}},clearSearch:function(){this.search.val(\"\"),this.focusser.val(\"\")},data:function(value){var data,triggerChange=!1;if(0===arguments.length)return(data=this.selection.data(\"select2-data\"))==undefined&&(data=null),data;arguments.length>1&&(triggerChange=arguments[1]),value?(data=this.data(),this.opts.element.val(value?this.id(value):\"\"),this.updateSelection(value),triggerChange&&this.triggerChange({added:value,removed:data})):this.clear(triggerChange)}}),MultiSelect2=clazz(AbstractSelect2,{createContainer:function(){return $(document.createElement(\"div\")).attr({class:\"select2-container select2-container-multi\"}).html([\"<ul class='select2-choices'>\",\"  <li class='select2-search-field'>\",\"    <label for='' class='select2-offscreen'></label>\",\"    <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input'>\",\"  </li>\",\"</ul>\",\"<div class='select2-drop select2-drop-multi select2-display-none'>\",\"   <ul class='select2-results'>\",\"   </ul>\",\"</div>\"].join(\"\"))},prepareOpts:function(){var opts=this.parent.prepareOpts.apply(this,arguments),self=this;return\"select\"===opts.element.get(0).tagName.toLowerCase()?opts.initSelection=function(element,callback){var data=[];element.find(\"option\").filter(function(){return this.selected&&!this.disabled}).each2(function(i,elm){data.push(self.optionToData(elm))}),callback(data)}:\"data\"in opts&&(opts.initSelection=opts.initSelection||function(element,callback){var ids=splitVal(element.val(),opts.separator),matches=[];opts.query({matcher:function(term,text,el){var is_match=$.grep(ids,function(id){return equal(id,opts.id(el))}).length;return is_match&&matches.push(el),is_match},callback:$.isFunction(callback)?function(){for(var ordered=[],i=0;i<ids.length;i++)for(var id=ids[i],j=0;j<matches.length;j++){var match=matches[j];if(equal(id,opts.id(match))){ordered.push(match),matches.splice(j,1);break}}callback(ordered)}:$.noop})}),opts},selectChoice:function(choice){var selected=this.container.find(\".select2-search-choice-focus\");selected.length&&choice&&choice[0]==selected[0]||(selected.length&&this.opts.element.trigger(\"choice-deselected\",selected),selected.removeClass(\"select2-search-choice-focus\"),choice&&choice.length&&(this.close(),choice.addClass(\"select2-search-choice-focus\"),this.opts.element.trigger(\"choice-selected\",choice)))},destroy:function(){$(\"label[for='\"+this.search.attr(\"id\")+\"']\").attr(\"for\",this.opts.element.attr(\"id\")),this.parent.destroy.apply(this,arguments),cleanupJQueryElements.call(this,\"searchContainer\",\"selection\")},initContainer:function(){var selection,selector=\".select2-choices\";this.searchContainer=this.container.find(\".select2-search-field\"),this.selection=selection=this.container.find(selector);var _this=this;this.selection.on(\"click\",\".select2-search-choice:not(.select2-locked)\",function(e){_this.search[0].focus(),_this.selectChoice($(this))}),this.search.attr(\"id\",\"s2id_autogen\"+nextUid()),this.search.prev().text($(\"label[for='\"+this.opts.element.attr(\"id\")+\"']\").text()).attr(\"for\",this.search.attr(\"id\")),this.search.on(\"input paste\",this.bind(function(){this.isInterfaceEnabled()&&(this.opened()||this.open())})),this.search.attr(\"tabindex\",this.elementTabIndex),this.keydowns=0,this.search.on(\"keydown\",this.bind(function(e){if(this.isInterfaceEnabled()){++this.keydowns;var selected=selection.find(\".select2-search-choice-focus\"),prev=selected.prev(\".select2-search-choice:not(.select2-locked)\"),next=selected.next(\".select2-search-choice:not(.select2-locked)\"),pos=function(el){var offset=0,length=0;if(\"selectionStart\"in(el=$(el)[0]))offset=el.selectionStart,length=el.selectionEnd-offset;else if(\"selection\"in document){el.focus();var sel=document.selection.createRange();length=document.selection.createRange().text.length,sel.moveStart(\"character\",-el.value.length),offset=sel.text.length-length}return{offset:offset,length:length}}(this.search);if(selected.length&&(e.which==KEY.LEFT||e.which==KEY.RIGHT||e.which==KEY.BACKSPACE||e.which==KEY.DELETE||e.which==KEY.ENTER)){var selectedChoice=selected;return e.which==KEY.LEFT&&prev.length?selectedChoice=prev:e.which==KEY.RIGHT?selectedChoice=next.length?next:null:e.which===KEY.BACKSPACE?this.unselect(selected.first())&&(this.search.width(10),selectedChoice=prev.length?prev:next):e.which==KEY.DELETE?this.unselect(selected.first())&&(this.search.width(10),selectedChoice=next.length?next:null):e.which==KEY.ENTER&&(selectedChoice=null),this.selectChoice(selectedChoice),killEvent(e),void(selectedChoice&&selectedChoice.length||this.open())}if((e.which===KEY.BACKSPACE&&1==this.keydowns||e.which==KEY.LEFT)&&0==pos.offset&&!pos.length)return this.selectChoice(selection.find(\".select2-search-choice:not(.select2-locked)\").last()),void killEvent(e);if(this.selectChoice(null),this.opened())switch(e.which){case KEY.UP:case KEY.DOWN:return this.moveHighlight(e.which===KEY.UP?-1:1),void killEvent(e);case KEY.ENTER:return this.selectHighlighted(),void killEvent(e);case KEY.TAB:return this.selectHighlighted({noFocus:!0}),void this.close();case KEY.ESC:return this.cancel(e),void killEvent(e)}if(e.which!==KEY.TAB&&!KEY.isControl(e)&&!KEY.isFunctionKey(e)&&e.which!==KEY.BACKSPACE&&e.which!==KEY.ESC){if(e.which===KEY.ENTER){if(!1===this.opts.openOnEnter)return;if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey)return}this.open(),e.which!==KEY.PAGE_UP&&e.which!==KEY.PAGE_DOWN||killEvent(e),e.which===KEY.ENTER&&killEvent(e)}}})),this.search.on(\"keyup\",this.bind(function(e){this.keydowns=0,this.resizeSearch()})),this.search.on(\"blur\",this.bind(function(e){this.container.removeClass(\"select2-container-active\"),this.search.removeClass(\"select2-focused\"),this.selectChoice(null),this.opened()||this.clearSearch(),e.stopImmediatePropagation(),this.opts.element.trigger($.Event(\"select2-blur\"))})),this.container.on(\"click\",selector,this.bind(function(e){this.isInterfaceEnabled()&&($(e.target).closest(\".select2-search-choice\").length>0||(this.selectChoice(null),this.clearPlaceholder(),this.container.hasClass(\"select2-container-active\")||this.opts.element.trigger($.Event(\"select2-focus\")),this.open(),this.focusSearch(),e.preventDefault()))})),this.container.on(\"focus\",selector,this.bind(function(){this.isInterfaceEnabled()&&(this.container.hasClass(\"select2-container-active\")||this.opts.element.trigger($.Event(\"select2-focus\")),this.container.addClass(\"select2-container-active\"),this.dropdown.addClass(\"select2-drop-active\"),this.clearPlaceholder())})),this.initContainerWidth(),this.opts.element.addClass(\"select2-offscreen\"),this.clearSearch()},enableInterface:function(){this.parent.enableInterface.apply(this,arguments)&&this.search.prop(\"disabled\",!this.isInterfaceEnabled())},initSelection:function(){if(\"\"===this.opts.element.val()&&\"\"===this.opts.element.text()&&(this.updateSelection([]),this.close(),this.clearSearch()),this.select||\"\"!==this.opts.element.val()){var self=this;this.opts.initSelection.call(null,this.opts.element,function(data){data!==undefined&&null!==data&&(self.updateSelection(data),self.close(),self.clearSearch())})}},clearSearch:function(){var placeholder=this.getPlaceholder(),maxWidth=this.getMaxSearchWidth();placeholder!==undefined&&0===this.getVal().length&&!1===this.search.hasClass(\"select2-focused\")?(this.search.val(placeholder).addClass(\"select2-default\"),this.search.width(maxWidth>0?maxWidth:this.container.css(\"width\"))):this.search.val(\"\").width(10)},clearPlaceholder:function(){this.search.hasClass(\"select2-default\")&&this.search.val(\"\").removeClass(\"select2-default\")},opening:function(){this.clearPlaceholder(),this.resizeSearch(),this.parent.opening.apply(this,arguments),this.focusSearch(),\"\"===this.search.val()&&this.nextSearchTerm!=undefined&&(this.search.val(this.nextSearchTerm),this.search.select()),this.updateResults(!0),this.opts.shouldFocusInput(this)&&this.search.focus(),this.opts.element.trigger($.Event(\"select2-open\"))},close:function(){this.opened()&&this.parent.close.apply(this,arguments)},focus:function(){this.close(),this.search.focus()},isFocused:function(){return this.search.hasClass(\"select2-focused\")},updateSelection:function(data){var ids=[],filtered=[],self=this;$(data).each(function(){indexOf(self.id(this),ids)<0&&(ids.push(self.id(this)),filtered.push(this))}),data=filtered,this.selection.find(\".select2-search-choice\").remove(),$(data).each(function(){self.addSelectedChoice(this)}),self.postprocessResults()},tokenize:function(){var input=this.search.val();null!=(input=this.opts.tokenizer.call(this,input,this.data(),this.bind(this.onSelect),this.opts))&&input!=undefined&&(this.search.val(input),input.length>0&&this.open())},onSelect:function(data,options){this.triggerSelect(data)&&(this.addSelectedChoice(data),this.opts.element.trigger({type:\"selected\",val:this.id(data),choice:data}),this.nextSearchTerm=this.opts.nextSearchTerm(data,this.search.val()),this.clearSearch(),this.updateResults(),!this.select&&this.opts.closeOnSelect||this.postprocessResults(data,!1,!0===this.opts.closeOnSelect),this.opts.closeOnSelect?(this.close(),this.search.width(10)):this.countSelectableResults()>0?(this.search.width(10),this.resizeSearch(),this.getMaximumSelectionSize()>0&&this.val().length>=this.getMaximumSelectionSize()?this.updateResults(!0):this.nextSearchTerm!=undefined&&(this.search.val(this.nextSearchTerm),this.updateResults(),this.search.select()),this.positionDropdown()):(this.close(),this.search.width(10)),this.triggerChange({added:data}),options&&options.noFocus||this.focusSearch())},cancel:function(){this.close(),this.focusSearch()},addSelectedChoice:function(data){var formatted,cssClass,enableChoice=!data.locked,enabledItem=$(\"<li class='select2-search-choice'>    <div></div>    <a href='#' class='select2-search-choice-close' tabindex='-1'></a></li>\"),disabledItem=$(\"<li class='select2-search-choice select2-locked'><div></div></li>\"),choice=enableChoice?enabledItem:disabledItem,id=this.id(data),val=this.getVal();(formatted=this.opts.formatSelection(data,choice.find(\"div\"),this.opts.escapeMarkup))!=undefined&&choice.find(\"div\").replaceWith(\"<div>\"+formatted+\"</div>\"),(cssClass=this.opts.formatSelectionCssClass(data,choice.find(\"div\")))!=undefined&&choice.addClass(cssClass),enableChoice&&choice.find(\".select2-search-choice-close\").on(\"mousedown\",killEvent).on(\"click dblclick\",this.bind(function(e){this.isInterfaceEnabled()&&(this.unselect($(e.target)),this.selection.find(\".select2-search-choice-focus\").removeClass(\"select2-search-choice-focus\"),killEvent(e),this.close(),this.focusSearch())})).on(\"focus\",this.bind(function(){this.isInterfaceEnabled()&&(this.container.addClass(\"select2-container-active\"),this.dropdown.addClass(\"select2-drop-active\"))})),choice.data(\"select2-data\",data),choice.insertBefore(this.searchContainer),val.push(id),this.setVal(val)},unselect:function(selected){var data,index,val=this.getVal();if(0===(selected=selected.closest(\".select2-search-choice\")).length)throw\"Invalid argument: \"+selected+\". Must be .select2-search-choice\";if(data=selected.data(\"select2-data\")){var evt=$.Event(\"select2-removing\");if(evt.val=this.id(data),evt.choice=data,this.opts.element.trigger(evt),evt.isDefaultPrevented())return!1;for(;(index=indexOf(this.id(data),val))>=0;)val.splice(index,1),this.setVal(val),this.select&&this.postprocessResults();return selected.remove(),this.opts.element.trigger({type:\"select2-removed\",val:this.id(data),choice:data}),this.triggerChange({removed:data}),!0}},postprocessResults:function(data,initial,noHighlightUpdate){var val=this.getVal(),choices=this.results.find(\".select2-result\"),compound=this.results.find(\".select2-result-with-children\"),self=this;choices.each2(function(i,choice){indexOf(self.id(choice.data(\"select2-data\")),val)>=0&&(choice.addClass(\"select2-selected\"),choice.find(\".select2-result-selectable\").addClass(\"select2-selected\"))}),compound.each2(function(i,choice){choice.is(\".select2-result-selectable\")||0!==choice.find(\".select2-result-selectable:not(.select2-selected)\").length||choice.addClass(\"select2-selected\")}),-1==this.highlight()&&!1!==noHighlightUpdate&&self.highlight(0),!this.opts.createSearchChoice&&!choices.filter(\".select2-result:not(.select2-selected)\").length>0&&(!data||data&&!data.more&&0===this.results.find(\".select2-no-results\").length)&&checkFormatter(self.opts.formatNoMatches,\"formatNoMatches\")&&this.results.append(\"<li class='select2-no-results'>\"+evaluate(self.opts.formatNoMatches,self.search.val())+\"</li>\")},getMaxSearchWidth:function(){return this.selection.width()-getSideBorderPadding(this.search)},resizeSearch:function(){var minimumWidth,left,maxWidth,searchWidth,sideBorderPadding=getSideBorderPadding(this.search);minimumWidth=function(e){if(!sizer){var style=e[0].currentStyle||window.getComputedStyle(e[0],null);(sizer=$(document.createElement(\"div\")).css({position:\"absolute\",left:\"-10000px\",top:\"-10000px\",display:\"none\",fontSize:style.fontSize,fontFamily:style.fontFamily,fontStyle:style.fontStyle,fontWeight:style.fontWeight,letterSpacing:style.letterSpacing,textTransform:style.textTransform,whiteSpace:\"nowrap\"})).attr(\"class\",\"select2-sizer\"),$(\"body\").append(sizer)}return sizer.text(e.val()),sizer.width()}(this.search)+10,left=this.search.offset().left,(searchWidth=(maxWidth=this.selection.width())-(left-this.selection.offset().left)-sideBorderPadding)<minimumWidth&&(searchWidth=maxWidth-sideBorderPadding),searchWidth<40&&(searchWidth=maxWidth-sideBorderPadding),searchWidth<=0&&(searchWidth=minimumWidth),this.search.width(Math.floor(searchWidth))},getVal:function(){var val;return this.select?null===(val=this.select.val())?[]:val:splitVal(val=this.opts.element.val(),this.opts.separator)},setVal:function(val){var unique;this.select?this.select.val(val):(unique=[],$(val).each(function(){indexOf(this,unique)<0&&unique.push(this)}),this.opts.element.val(0===unique.length?\"\":unique.join(this.opts.separator)))},buildChangeDetails:function(old,current){current=current.slice(0),old=old.slice(0);for(var i=0;i<current.length;i++)for(var j=0;j<old.length;j++)equal(this.opts.id(current[i]),this.opts.id(old[j]))&&(current.splice(i,1),i>0&&i--,old.splice(j,1),j--);return{added:current,removed:old}},val:function(val,triggerChange){var oldData,self=this;if(0===arguments.length)return this.getVal();if((oldData=this.data()).length||(oldData=[]),!val&&0!==val)return this.opts.element.val(\"\"),this.updateSelection([]),this.clearSearch(),void(triggerChange&&this.triggerChange({added:this.data(),removed:oldData}));if(this.setVal(val),this.select)this.opts.initSelection(this.select,this.bind(this.updateSelection)),triggerChange&&this.triggerChange(this.buildChangeDetails(oldData,this.data()));else{if(this.opts.initSelection===undefined)throw new Error(\"val() cannot be called if initSelection() is not defined\");this.opts.initSelection(this.opts.element,function(data){var ids=$.map(data,self.id);self.setVal(ids),self.updateSelection(data),self.clearSearch(),triggerChange&&self.triggerChange(self.buildChangeDetails(oldData,self.data()))})}this.clearSearch()},onSortStart:function(){if(this.select)throw new Error(\"Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.\");this.search.width(0),this.searchContainer.hide()},onSortEnd:function(){var val=[],self=this;this.searchContainer.show(),this.searchContainer.appendTo(this.searchContainer.parent()),this.resizeSearch(),this.selection.find(\".select2-search-choice\").each(function(){val.push(self.opts.id($(this).data(\"select2-data\")))}),this.setVal(val),this.triggerChange()},data:function(values,triggerChange){var ids,old,self=this;if(0===arguments.length)return this.selection.children(\".select2-search-choice\").map(function(){return $(this).data(\"select2-data\")}).get();old=this.data(),values||(values=[]),ids=$.map(values,function(e){return self.opts.id(e)}),this.setVal(ids),this.updateSelection(values),this.clearSearch(),triggerChange&&this.triggerChange(this.buildChangeDetails(old,this.data()))}}),$.fn.select2=function(){var opts,select2,method,value,multiple,args=Array.prototype.slice.call(arguments,0),allowedMethods=[\"val\",\"destroy\",\"opened\",\"open\",\"close\",\"focus\",\"isFocused\",\"container\",\"dropdown\",\"onSortStart\",\"onSortEnd\",\"enable\",\"disable\",\"readonly\",\"positionDropdown\",\"data\",\"search\"],valueMethods=[\"opened\",\"isFocused\",\"container\",\"dropdown\"],propertyMethods=[\"val\",\"data\"],methodsMap={search:\"externalSearch\"};return this.each(function(){if(0===args.length||\"object\"==typeof args[0])(opts=0===args.length?{}:$.extend({},args[0])).element=$(this),\"select\"===opts.element.get(0).tagName.toLowerCase()?multiple=opts.element.prop(\"multiple\"):(multiple=opts.multiple||!1,\"tags\"in opts&&(opts.multiple=multiple=!0)),(select2=multiple?new window.Select2.class.multi:new window.Select2.class.single).init(opts);else{if(\"string\"!=typeof args[0])throw\"Invalid arguments to select2 plugin: \"+args;if(indexOf(args[0],allowedMethods)<0)throw\"Unknown method: \"+args[0];if(value=undefined,(select2=$(this).data(\"select2\"))===undefined)return;if(\"container\"===(method=args[0])?value=select2.container:\"dropdown\"===method?value=select2.dropdown:(methodsMap[method]&&(method=methodsMap[method]),value=select2[method].apply(select2,args.slice(1))),indexOf(args[0],valueMethods)>=0||indexOf(args[0],propertyMethods)>=0&&1==args.length)return!1}}),value===undefined?this:value},$.fn.select2.defaults={width:\"copy\",loadMorePadding:0,closeOnSelect:!0,openOnEnter:!0,containerCss:{},dropdownCss:{},containerCssClass:\"\",dropdownCssClass:\"\",formatResult:function(result,container,query,escapeMarkup){var markup=[];return markMatch(result.text,query.term,markup,escapeMarkup),markup.join(\"\")},formatSelection:function(data,container,escapeMarkup){return data?escapeMarkup(data.text):undefined},sortResults:function(results,container,query){return results},formatResultCssClass:function(data){return data.css},formatSelectionCssClass:function(data,container){return undefined},formatMatches:function(matches){return matches+\" results are available, use up and down arrow keys to navigate.\"},formatNoMatches:function(){return\"No matches found\"},formatInputTooShort:function(input,min){var n=min-input.length;return\"Please enter \"+n+\" or more character\"+(1==n?\"\":\"s\")},formatInputTooLong:function(input,max){var n=input.length-max;return\"Please delete \"+n+\" character\"+(1==n?\"\":\"s\")},formatSelectionTooBig:function(limit){return\"You can only select \"+limit+\" item\"+(1==limit?\"\":\"s\")},formatLoadMore:function(pageNumber){return\"Loading more results\"},formatSearching:function(){return\"Searching\"},minimumResultsForSearch:0,minimumInputLength:0,maximumInputLength:null,maximumSelectionSize:0,id:function(e){return e==undefined?null:e.id},matcher:function(term,text){return stripDiacritics(\"\"+text).toUpperCase().indexOf(stripDiacritics(\"\"+term).toUpperCase())>=0},separator:\",\",tokenSeparators:[],tokenizer:function(input,selection,selectCallback,opts){var token,index,i,l,separator,original=input,dupe=!1;if(!opts.createSearchChoice||!opts.tokenSeparators||opts.tokenSeparators.length<1)return undefined;for(;;){for(index=-1,i=0,l=opts.tokenSeparators.length;i<l&&(separator=opts.tokenSeparators[i],!((index=input.indexOf(separator))>=0));i++);if(index<0)break;if(token=input.substring(0,index),input=input.substring(index+separator.length),token.length>0&&(token=opts.createSearchChoice.call(this,token,selection))!==undefined&&null!==token&&opts.id(token)!==undefined&&null!==opts.id(token)){for(dupe=!1,i=0,l=selection.length;i<l;i++)if(equal(opts.id(token),opts.id(selection[i]))){dupe=!0;break}dupe||selectCallback(token)}}return original!==input?input:void 0},escapeMarkup:defaultEscapeMarkup,blurOnChange:!1,selectOnBlur:!1,adaptContainerCssClass:function(c){return c},adaptDropdownCssClass:function(c){return null},nextSearchTerm:function(selectedObject,currentSearchTerm){return undefined},searchInputPlaceholder:\"\",createSearchChoicePosition:\"top\",shouldFocusInput:function(instance){return!(\"ontouchstart\"in window||navigator.msMaxTouchPoints>0)||!(instance.opts.minimumResultsForSearch<0)}},$.fn.select2.ajaxDefaults={transport:$.ajax,params:{type:\"GET\",cache:!1,dataType:\"json\"}},window.Select2={query:{ajax:ajax,local:local,tags:tags},util:{debounce:debounce,markMatch:markMatch,escapeMarkup:defaultEscapeMarkup,stripDiacritics:stripDiacritics},class:{abstract:AbstractSelect2,single:SingleSelect2,multi:MultiSelect2}}}function reinsertElement(element){var placeholder=$(document.createTextNode(\"\"));element.before(placeholder),placeholder.before(element),placeholder.remove()}function stripDiacritics(str){return str.replace(/[^\\u0000-\\u007E]/g,function(a){return DIACRITICS[a]||a})}function indexOf(value,array){for(var i=0,l=array.length;i<l;i+=1)if(equal(value,array[i]))return i;return-1}function equal(a,b){return a===b||a!==undefined&&b!==undefined&&(null!==a&&null!==b&&(a.constructor===String?a+\"\"==b+\"\":b.constructor===String&&b+\"\"==a+\"\"))}function splitVal(string,separator){var val,i,l;if(null===string||string.length<1)return[];for(i=0,l=(val=string.split(separator)).length;i<l;i+=1)val[i]=$.trim(val[i]);return val}function getSideBorderPadding(element){return element.outerWidth(!1)-element.width()}function installKeyUpChangeEvent(element){var key=\"keyup-change-value\";element.on(\"keydown\",function(){$.data(element,key)===undefined&&$.data(element,key,element.val())}),element.on(\"keyup\",function(){var val=$.data(element,key);val!==undefined&&element.val()!==val&&($.removeData(element,key),element.trigger(\"keyup-change\"))})}function debounce(quietMillis,fn,ctx){var timeout;return ctx=ctx||undefined,function(){var args=arguments;window.clearTimeout(timeout),timeout=window.setTimeout(function(){fn.apply(ctx,args)},quietMillis)}}function killEvent(event){event.preventDefault(),event.stopPropagation()}function syncCssClasses(dest,src,adapter){var classes,adapted,replacements=[];(classes=dest.attr(\"class\"))&&$((classes=\"\"+classes).split(\" \")).each2(function(){0===this.indexOf(\"select2-\")&&replacements.push(this)}),(classes=src.attr(\"class\"))&&$((classes=\"\"+classes).split(\" \")).each2(function(){0!==this.indexOf(\"select2-\")&&(adapted=adapter(this))&&replacements.push(adapted)}),dest.attr(\"class\",replacements.join(\" \"))}function markMatch(text,term,markup,escapeMarkup){var match=stripDiacritics(text.toUpperCase()).indexOf(stripDiacritics(term.toUpperCase())),tl=term.length;match<0?markup.push(escapeMarkup(text)):(markup.push(escapeMarkup(text.substring(0,match))),markup.push(\"<span class='select2-match'>\"),markup.push(escapeMarkup(text.substring(match,match+tl))),markup.push(\"</span>\"),markup.push(escapeMarkup(text.substring(match+tl,text.length))))}function defaultEscapeMarkup(markup){var replace_map={\"\\\\\":\"&#92;\",\"&\":\"&amp;\",\"<\":\"&lt;\",\">\":\"&gt;\",'\"':\"&quot;\",\"'\":\"&#39;\",\"/\":\"&#47;\"};return String(markup).replace(/[&<>\"'\\/\\\\]/g,function(match){return replace_map[match]})}function ajax(options){var timeout,handler=null,quietMillis=options.quietMillis||100,ajaxUrl=options.url,self=this;return function(query){window.clearTimeout(timeout),timeout=window.setTimeout(function(){var data=options.data,url=ajaxUrl,transport=options.transport||$.fn.select2.ajaxDefaults.transport,deprecated={type:options.type||\"GET\",cache:options.cache||!1,jsonpCallback:options.jsonpCallback||undefined,dataType:options.dataType||\"json\"},params=$.extend({},$.fn.select2.ajaxDefaults.params,deprecated);data=data?data.call(self,query.term,query.page,query.context):null,url=\"function\"==typeof url?url.call(self,query.term,query.page,query.context):url,handler&&\"function\"==typeof handler.abort&&handler.abort(),options.params&&($.isFunction(options.params)?$.extend(params,options.params.call(self)):$.extend(params,options.params)),$.extend(params,{url:url,dataType:options.dataType,data:data,success:function(data){var results=options.results(data,query.page);query.callback(results)}}),handler=transport.call(self,params)},quietMillis)}}function local(options){var dataText,tmp,data=options,text=function(item){return\"\"+item.text};$.isArray(data)&&(data={results:tmp=data}),!1===$.isFunction(data)&&(tmp=data,data=function(){return tmp});var dataItem=data();return dataItem.text&&(text=dataItem.text,$.isFunction(text)||(dataText=dataItem.text,text=function(item){return item[dataText]})),function(query){var process,t=query.term,filtered={results:[]};\"\"!==t?(process=function(datum,collection){var group,attr;if((datum=datum[0]).children){for(attr in group={},datum)datum.hasOwnProperty(attr)&&(group[attr]=datum[attr]);group.children=[],$(datum.children).each2(function(i,childDatum){process(childDatum,group.children)}),(group.children.length||query.matcher(t,text(group),datum))&&collection.push(group)}else query.matcher(t,text(datum),datum)&&collection.push(datum)},$(data().results).each2(function(i,datum){process(datum,filtered.results)}),query.callback(filtered)):query.callback(data())}}function tags(data){var isFunc=$.isFunction(data);return function(query){var t=query.term,filtered={results:[]},result=$(isFunc?data(query):data);$.isArray(result)&&($(isFunc?data():data).each(function(){var isObject=this.text!==undefined,text=isObject?this.text:this;(\"\"===t||query.matcher(t,text))&&filtered.results.push(isObject?this:{id:this,text:this})}),query.callback(filtered))}}function checkFormatter(formatter,formatterName){if($.isFunction(formatter))return!0;if(!formatter)return!1;if(\"string\"==typeof formatter)return!0;throw new Error(formatterName+\" must be a string, function, or falsy value\")}function evaluate(val){if($.isFunction(val)){var args=Array.prototype.slice.call(arguments,1);return val.apply(null,args)}return val}function cleanupJQueryElements(){var self=this;Array.prototype.forEach.call(arguments,function(element){self[element].remove(),self[element]=null})}function clazz(SuperClass,methods){var constructor=function(){};return(constructor.prototype=new SuperClass).constructor=constructor,constructor.prototype.parent=SuperClass.prototype,constructor.prototype=$.extend(constructor.prototype,methods),constructor}}(jQuery);var MXI_DEBUG=!0;!function(exports,undefined){\"use strict\";var modules={};function define(id,dependencies,definition){if(\"string\"!=typeof id)throw\"invalid module definition, module id must be defined and be a string\";if(dependencies===undefined)throw\"invalid module definition, dependencies must be specified\";if(definition===undefined)throw\"invalid module definition, definition function must be specified\";!function(ids,callback){for(var module,defs=[],i=0;i<ids.length;++i){if(!(module=modules[ids[i]]||resolve(ids[i])))throw\"module definition dependecy not found: \"+ids[i];defs.push(module)}callback.apply(null,defs)}(dependencies,function(){modules[id]=definition.apply(null,arguments)})}function resolve(id){for(var target=exports,fragments=id.split(/[.\\/]/),fi=0;fi<fragments.length;++fi){if(!target[fragments[fi]])return;target=target[fragments[fi]]}return target}define(\"moxie/core/utils/Basic\",[],function(){var counter,typeOf=function(o){return void 0===o?\"undefined\":null===o?\"null\":o.nodeType?\"node\":{}.toString.call(o).match(/\\s([a-z|A-Z]+)/)[1].toLowerCase()},extend=function(target){return each(arguments,function(arg,i){i>0&&each(arg,function(value,key){void 0!==value&&(typeOf(target[key])===typeOf(value)&&~inArray(typeOf(value),[\"array\",\"object\"])?extend(target[key],value):target[key]=value)})}),target},each=function(obj,callback){var length,key,i;if(obj)if(\"number\"===typeOf(obj.length)){for(i=0,length=obj.length;i<length;i++)if(!1===callback(obj[i],i))return}else if(\"object\"===typeOf(obj))for(key in obj)if(obj.hasOwnProperty(key)&&!1===callback(obj[key],key))return},inArray=function(needle,array){if(array){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(array,needle);for(var i=0,length=array.length;i<length;i++)if(array[i]===needle)return i}return-1};return{guid:(counter=0,function(prefix){var i,guid=(new Date).getTime().toString(32);for(i=0;i<5;i++)guid+=Math.floor(65535*Math.random()).toString(32);return(prefix||\"o_\")+guid+(counter++).toString(32)}),typeOf:typeOf,extend:extend,each:each,isEmptyObj:function(obj){var prop;if(!obj||\"object\"!==typeOf(obj))return!0;for(prop in obj)return!1;return!0},inSeries:function(queue,cb){var length=queue.length;\"function\"!==typeOf(cb)&&(cb=function(){}),queue&&queue.length||cb(),function callNext(i){\"function\"===typeOf(queue[i])&&queue[i](function(error){++i<length&&!error?callNext(i):cb(error)})}(0)},inParallel:function(queue,cb){var count=0,num=queue.length,cbArgs=new Array(num);each(queue,function(fn,i){fn(function(error){if(error)return cb(error);var args=[].slice.call(arguments);args.shift(),cbArgs[i]=args,++count===num&&(cbArgs.unshift(null),cb.apply(this,cbArgs))})})},inArray:inArray,arrayDiff:function(needles,array){var diff=[];for(var i in\"array\"!==typeOf(needles)&&(needles=[needles]),\"array\"!==typeOf(array)&&(array=[array]),needles)-1===inArray(needles[i],array)&&diff.push(needles[i]);return!!diff.length&&diff},arrayIntersect:function(array1,array2){var result=[];return each(array1,function(item){-1!==inArray(item,array2)&&result.push(item)}),result.length?result:null},toArray:function(obj){var i,arr=[];for(i=0;i<obj.length;i++)arr[i]=obj[i];return arr},trim:function(str){return str?String.prototype.trim?String.prototype.trim.call(str):str.toString().replace(/^\\s*/,\"\").replace(/\\s*$/,\"\"):str},sprintf:function(str){var args=[].slice.call(arguments,1);return str.replace(/%[a-z]/g,function(){var value=args.shift();return\"undefined\"!==typeOf(value)?value:\"\"})},parseSizeStr:function(size){if(\"string\"!=typeof size)return size;var mul,muls={t:1099511627776,g:1073741824,m:1048576,k:1024};return mul=(size=/^([0-9\\.]+)([tmgk]?)$/.exec(size.toLowerCase().replace(/[^0-9\\.tmkg]/g,\"\")))[2],size=+size[1],muls.hasOwnProperty(mul)&&(size*=muls[mul]),Math.floor(size)}}}),define(\"moxie/core/utils/Env\",[\"moxie/core/utils/Basic\"],function(Basic){var NAME,VERSION,util_has,mapper,maps,regexes,UAParser=(util_has=function(str1,str2){return-1!==str2.toLowerCase().indexOf(str1.toLowerCase())},regexes={browser:[[/(opera\\smini)\\/([\\w\\.-]+)/i,/(opera\\s[mobiletab]+).+version\\/([\\w\\.-]+)/i,/(opera).+version\\/([\\w\\.]+)/i,/(opera)[\\/\\s]+([\\w\\.]+)/i],[NAME=\"name\",VERSION=\"version\"],[/\\s(opr)\\/([\\w\\.]+)/i],[[NAME,\"Opera\"],VERSION],[/(kindle)\\/([\\w\\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\\/\\s]?([\\w\\.]+)*/i,/(avant\\s|iemobile|slim|baidu)(?:browser)?[\\/\\s]?([\\w\\.]*)/i,/(?:ms|\\()(ie)\\s([\\w\\.]+)/i,/(rekonq)\\/([\\w\\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi)\\/([\\w\\.-]+)/i],[NAME,VERSION],[/(trident).+rv[:\\s]([\\w\\.]+).+like\\sgecko/i],[[NAME,\"IE\"],VERSION],[/(edge)\\/((\\d+)?[\\w\\.]+)/i],[NAME,VERSION],[/(yabrowser)\\/([\\w\\.]+)/i],[[NAME,\"Yandex\"],VERSION],[/(comodo_dragon)\\/([\\w\\.]+)/i],[[NAME,/_/g,\" \"],VERSION],[/(chrome|omniweb|arora|[tizenoka]{5}\\s?browser)\\/v?([\\w\\.]+)/i,/(uc\\s?browser|qqbrowser)[\\/\\s]?([\\w\\.]+)/i],[NAME,VERSION],[/(dolfin)\\/([\\w\\.]+)/i],[[NAME,\"Dolphin\"],VERSION],[/((?:android.+)crmo|crios)\\/([\\w\\.]+)/i],[[NAME,\"Chrome\"],VERSION],[/XiaoMi\\/MiuiBrowser\\/([\\w\\.]+)/i],[VERSION,[NAME,\"MIUI Browser\"]],[/android.+version\\/([\\w\\.]+)\\s+(?:mobile\\s?safari|safari)/i],[VERSION,[NAME,\"Android Browser\"]],[/FBAV\\/([\\w\\.]+);/i],[VERSION,[NAME,\"Facebook\"]],[/version\\/([\\w\\.]+).+?mobile\\/\\w+\\s(safari)/i],[VERSION,[NAME,\"Mobile Safari\"]],[/version\\/([\\w\\.]+).+?(mobile\\s?safari|safari)/i],[VERSION,NAME],[/webkit.+?(mobile\\s?safari|safari)(\\/[\\w\\.]+)/i],[NAME,[VERSION,(mapper={rgx:function(){for(var result,j,k,p,q,matches,match,i=0,args=arguments;i<args.length;i+=2){var regex=args[i],props=args[i+1];if(void 0===result)for(p in result={},props)\"object\"==typeof(q=props[p])?result[q[0]]=void 0:result[q]=void 0;for(j=k=0;j<regex.length;j++)if(matches=regex[j].exec(this.getUA())){for(p=0;p<props.length;p++)match=matches[++k],\"object\"==typeof(q=props[p])&&q.length>0?2==q.length?\"function\"==typeof q[1]?result[q[0]]=q[1].call(this,match):result[q[0]]=q[1]:3==q.length?\"function\"!=typeof q[1]||q[1].exec&&q[1].test?result[q[0]]=match?match.replace(q[1],q[2]):void 0:result[q[0]]=match?q[1].call(this,match,q[2]):void 0:4==q.length&&(result[q[0]]=match?q[3].call(this,match.replace(q[1],q[2])):void 0):result[q]=match||void 0;break}if(matches)break}return result},str:function(str,map){for(var i in map)if(\"object\"==typeof map[i]&&map[i].length>0){for(var j=0;j<map[i].length;j++)if(util_has(map[i][j],str))return\"?\"===i?void 0:i}else if(util_has(map[i],str))return\"?\"===i?void 0:i;return str}}).str,(maps={browser:{oldsafari:{major:{1:[\"/8\",\"/1\",\"/3\"],2:\"/4\",\"?\":\"/\"},version:{\"1.0\":\"/8\",1.2:\"/1\",1.3:\"/3\",\"2.0\":\"/412\",\"2.0.2\":\"/416\",\"2.0.3\":\"/417\",\"2.0.4\":\"/419\",\"?\":\"/\"}}},device:{sprint:{model:{\"Evo Shift 4G\":\"7373KT\"},vendor:{HTC:\"APA\",Sprint:\"Sprint\"}}},os:{windows:{version:{ME:\"4.90\",\"NT 3.11\":\"NT3.51\",\"NT 4.0\":\"NT4.0\",2000:\"NT 5.0\",XP:[\"NT 5.1\",\"NT 5.2\"],Vista:\"NT 6.0\",7:\"NT 6.1\",8:\"NT 6.2\",8.1:\"NT 6.3\",RT:\"ARM\"}}}}).browser.oldsafari.version]],[/(konqueror)\\/([\\w\\.]+)/i,/(webkit|khtml)\\/([\\w\\.]+)/i],[NAME,VERSION],[/(navigator|netscape)\\/([\\w\\.-]+)/i],[[NAME,\"Netscape\"],VERSION],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\\sbrowser|minimo|conkeror)[\\/\\s]?([\\w\\.\\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\\/([\\w\\.-]+)/i,/(mozilla)\\/([\\w\\.]+).+rv\\:.+gecko\\/\\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf)[\\/\\s]?([\\w\\.]+)/i,/(links)\\s\\(([\\w\\.]+)/i,/(gobrowser)\\/?([\\w\\.]+)*/i,/(ice\\s?browser)\\/v?([\\w\\._]+)/i,/(mosaic)[\\/\\s]([\\w\\.]+)/i],[NAME,VERSION]],engine:[[/windows.+\\sedge\\/([\\w\\.]+)/i],[VERSION,[NAME,\"EdgeHTML\"]],[/(presto)\\/([\\w\\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\\/([\\w\\.]+)/i,/(khtml|tasman|links)[\\/\\s]\\(?([\\w\\.]+)/i,/(icab)[\\/\\s]([23]\\.[\\d\\.]+)/i],[NAME,VERSION],[/rv\\:([\\w\\.]+).*(gecko)/i],[VERSION,NAME]],os:[[/microsoft\\s(windows)\\s(vista|xp)/i],[NAME,VERSION],[/(windows)\\snt\\s6\\.2;\\s(arm)/i,/(windows\\sphone(?:\\sos)*|windows\\smobile|windows)[\\s\\/]?([ntce\\d\\.\\s]+\\w)/i],[NAME,[VERSION,mapper.str,maps.os.windows.version]],[/(win(?=3|9|n)|win\\s9x\\s)([nt\\d\\.]+)/i],[[NAME,\"Windows\"],[VERSION,mapper.str,maps.os.windows.version]],[/\\((bb)(10);/i],[[NAME,\"BlackBerry\"],VERSION],[/(blackberry)\\w*\\/?([\\w\\.]+)*/i,/(tizen)[\\/\\s]([\\w\\.]+)/i,/(android|webos|palm\\os|qnx|bada|rim\\stablet\\sos|meego|contiki)[\\/\\s-]?([\\w\\.]+)*/i,/linux;.+(sailfish);/i],[NAME,VERSION],[/(symbian\\s?os|symbos|s60(?=;))[\\/\\s-]?([\\w\\.]+)*/i],[[NAME,\"Symbian\"],VERSION],[/\\((series40);/i],[NAME],[/mozilla.+\\(mobile;.+gecko.+firefox/i],[[NAME,\"Firefox OS\"],VERSION],[/(nintendo|playstation)\\s([wids3portablevu]+)/i,/(mint)[\\/\\s\\(]?(\\w+)*/i,/(mageia|vectorlinux)[;\\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\\/\\s-]?([\\w\\.-]+)*/i,/(hurd|linux)\\s?([\\w\\.]+)*/i,/(gnu)\\s?([\\w\\.]+)*/i],[NAME,VERSION],[/(cros)\\s[\\w]+\\s([\\w\\.]+\\w)/i],[[NAME,\"Chromium OS\"],VERSION],[/(sunos)\\s?([\\w\\.]+\\d)*/i],[[NAME,\"Solaris\"],VERSION],[/\\s([frentopc-]{0,4}bsd|dragonfly)\\s?([\\w\\.]+)*/i],[NAME,VERSION],[/(ip[honead]+)(?:.*os\\s*([\\w]+)*\\slike\\smac|;\\sopera)/i],[[NAME,\"iOS\"],[VERSION,/_/g,\".\"]],[/(mac\\sos\\sx)\\s?([\\w\\s\\.]+\\w)*/i,/(macintosh|mac(?=_powerpc)\\s)/i],[[NAME,\"Mac OS\"],[VERSION,/_/g,\".\"]],[/((?:open)?solaris)[\\/\\s-]?([\\w\\.]+)*/i,/(haiku)\\s(\\w+)/i,/(aix)\\s((\\d)(?=\\.|\\)|\\s)[\\w\\.]*)*/i,/(plan\\s9|minix|beos|os\\/2|amigaos|morphos|risc\\sos|openvms)/i,/(unix)\\s?([\\w\\.]+)*/i],[NAME,VERSION]]},function(uastring){var ua=uastring||(window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:\"\");this.getBrowser=function(){return mapper.rgx.apply(this,regexes.browser)},this.getEngine=function(){return mapper.rgx.apply(this,regexes.engine)},this.getOS=function(){return mapper.rgx.apply(this,regexes.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS()}},this.getUA=function(){return ua},this.setUA=function(uastring){return ua=uastring,this},this.setUA(ua)});var du,el,caps,can=(caps={define_property:!1,create_canvas:(el=document.createElement(\"canvas\"),!(!el.getContext||!el.getContext(\"2d\"))),return_response_type:function(responseType){try{if(-1!==Basic.inArray(responseType,[\"\",\"text\",\"document\"]))return!0;if(window.XMLHttpRequest){var xhr=new XMLHttpRequest;if(xhr.open(\"get\",\"/\"),\"responseType\"in xhr)return xhr.responseType=responseType,xhr.responseType===responseType}}catch(ex){}return!1},use_data_uri:(du=new Image,du.onload=function(){caps.use_data_uri=1===du.width&&1===du.height},setTimeout(function(){du.src=\"data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==\"},1),!1),use_data_uri_over32kb:function(){return caps.use_data_uri&&(\"IE\"!==Env.browser||Env.version>=9)},use_data_uri_of:function(bytes){return caps.use_data_uri&&bytes<33e3||caps.use_data_uri_over32kb()},use_fileinput:function(){if(navigator.userAgent.match(/(Android (1.0|1.1|1.5|1.6|2.0|2.1))|(Windows Phone (OS 7|8.0))|(XBLWP)|(ZuneWP)|(w(eb)?OSBrowser)|(webOS)|(Kindle\\/(1.0|2.0|2.5|3.0))/))return!1;var el=document.createElement(\"input\");return el.setAttribute(\"type\",\"file\"),!el.disabled}},function(cap){var args=[].slice.call(arguments);return args.shift(),\"function\"===Basic.typeOf(caps[cap])?caps[cap].apply(this,args):!!caps[cap]}),uaResult=(new UAParser).getResult(),Env={can:can,uaParser:UAParser,browser:uaResult.browser.name,version:uaResult.browser.version,os:uaResult.os.name,osVersion:uaResult.os.version,verComp:function(v1,v2,operator){var x,i=0,compare=0,vm={dev:-6,alpha:-5,a:-5,beta:-4,b:-4,RC:-3,rc:-3,\"#\":-2,p:1,pl:1},prepVersion=function(v){return(v=(v=(\"\"+v).replace(/[_\\-+]/g,\".\")).replace(/([^.\\d]+)/g,\".$1.\").replace(/\\.{2,}/g,\".\")).length?v.split(\".\"):[-8]},numVersion=function(v){return v?isNaN(v)?vm[v]||-7:parseInt(v,10):0};for(v1=prepVersion(v1),v2=prepVersion(v2),x=Math.max(v1.length,v2.length),i=0;i<x;i++)if(v1[i]!=v2[i]){if(v1[i]=numVersion(v1[i]),v2[i]=numVersion(v2[i]),v1[i]<v2[i]){compare=-1;break}if(v1[i]>v2[i]){compare=1;break}}if(!operator)return compare;switch(operator){case\">\":case\"gt\":return compare>0;case\">=\":case\"ge\":return compare>=0;case\"<=\":case\"le\":return compare<=0;case\"==\":case\"=\":case\"eq\":return 0===compare;case\"<>\":case\"!=\":case\"ne\":return 0!==compare;case\"\":case\"<\":case\"lt\":return compare<0;default:return null}},swf_url:\"../flash/Moxie.swf\",xap_url:\"../silverlight/Moxie.xap\",global_event_dispatcher:\"moxie.core.EventTarget.instance.dispatchEvent\"};return Env.OS=Env.os,MXI_DEBUG&&(Env.debug={runtime:!0,events:!1},Env.log=function(){var data=arguments[0];if(\"string\"===Basic.typeOf(data)&&(data=Basic.sprintf.apply(this,arguments)),window&&window.console&&window.console.log)window.console.log(data);else if(document){var console=document.getElementById(\"moxie-console\");console||((console=document.createElement(\"pre\")).id=\"moxie-console\",document.body.appendChild(console)),-1!==Basic.inArray(Basic.typeOf(data),[\"object\",\"array\"])?function(data){console.appendChild(document.createTextNode(data+\"\\n\"))}(data):console.appendChild(document.createTextNode(data+\"\\n\"))}}),Env}),define(\"moxie/core/I18n\",[\"moxie/core/utils/Basic\"],function(Basic){var i18n={};return{addI18n:function(pack){return Basic.extend(i18n,pack)},translate:function(str){return i18n[str]||str},_:function(str){return this.translate(str)},sprintf:function(str){var args=[].slice.call(arguments,1);return str.replace(/%[a-z]/g,function(){var value=args.shift();return\"undefined\"!==Basic.typeOf(value)?value:\"\"})}}}),define(\"moxie/core/utils/Mime\",[\"moxie/core/utils/Basic\",\"moxie/core/I18n\"],function(Basic,I18n){var Mime={mimes:{},extensions:{},addMimeType:function(mimeData){var i,ii,ext,items=mimeData.split(/,/);for(i=0;i<items.length;i+=2){for(ext=items[i+1].split(/ /),ii=0;ii<ext.length;ii++)this.mimes[ext[ii]]=items[i];this.extensions[items[i]]=ext}},extList2mimes:function(filters,addMissingExtensions){var ext,i,ii,type,mimes=[];for(i=0;i<filters.length;i++)for(ext=filters[i].extensions.split(/\\s*,\\s*/),ii=0;ii<ext.length;ii++){if(\"*\"===ext[ii])return[];if((type=this.mimes[ext[ii]])&&-1===Basic.inArray(type,mimes)&&mimes.push(type),addMissingExtensions&&/^\\w+$/.test(ext[ii]))mimes.push(\".\"+ext[ii]);else if(!type)return[]}return mimes},mimes2exts:function(mimes){var self=this,exts=[];return Basic.each(mimes,function(mime){if(\"*\"===mime)return exts=[],!1;var m=mime.match(/^(\\w+)\\/(\\*|\\w+)$/);m&&(\"*\"===m[2]?Basic.each(self.extensions,function(arr,mime){new RegExp(\"^\"+m[1]+\"/\").test(mime)&&[].push.apply(exts,self.extensions[mime])}):self.extensions[mime]&&[].push.apply(exts,self.extensions[mime]))}),exts},mimes2extList:function(mimes){var accept=[],exts=[];return\"string\"===Basic.typeOf(mimes)&&(mimes=Basic.trim(mimes).split(/\\s*,\\s*/)),exts=this.mimes2exts(mimes),accept.push({title:I18n.translate(\"Files\"),extensions:exts.length?exts.join(\",\"):\"*\"}),accept.mimes=mimes,accept},getFileExtension:function(fileName){var matches=fileName&&fileName.match(/\\.([^.]+)$/);return matches?matches[1].toLowerCase():\"\"},getFileMime:function(fileName){return this.mimes[this.getFileExtension(fileName)]||\"\"}};return Mime.addMimeType(\"application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mp3 mpga mpega mp2,audio/x-wav,wav,audio/x-m4a,m4a,audio/ogg,oga ogg,audio/aiff,aiff aif,audio/flac,flac,audio/aac,aac,audio/ac3,ac3,audio/x-ms-wma,wma,image/bmp,bmp,image/gif,gif,image/jpeg,jpg jpeg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gpp 3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,video/ogg,ogv,video/x-matroska,mkv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe\"),Mime}),define(\"moxie/core/utils/Dom\",[\"moxie/core/utils/Env\"],function(Env){var hasClass=function(obj,name){return!!obj.className&&new RegExp(\"(^|\\\\s+)\"+name+\"(\\\\s+|$)\").test(obj.className)};return{get:function(id){return\"string\"!=typeof id?id:document.getElementById(id)},hasClass:hasClass,addClass:function(obj,name){hasClass(obj,name)||(obj.className=obj.className?obj.className.replace(/\\s+$/,\"\")+\" \"+name:name)},removeClass:function(obj,name){if(obj.className){var regExp=new RegExp(\"(^|\\\\s+)\"+name+\"(\\\\s+|$)\");obj.className=obj.className.replace(regExp,function($0,$1,$2){return\" \"===$1&&\" \"===$2?\" \":\"\"})}},getStyle:function(obj,name){return obj.currentStyle?obj.currentStyle[name]:window.getComputedStyle?window.getComputedStyle(obj,null)[name]:void 0},getPos:function(node,root){var parent,nodeRect,rootRect,x=0,y=0,doc=document;function getIEPos(node){var bodyElm,rect,x=0,y=0;return node&&(rect=node.getBoundingClientRect(),bodyElm=\"CSS1Compat\"===doc.compatMode?doc.documentElement:doc.body,x=rect.left+bodyElm.scrollLeft,y=rect.top+bodyElm.scrollTop),{x:x,y:y}}if(node=node,root=root||doc.body,node&&node.getBoundingClientRect&&\"IE\"===Env.browser&&(!doc.documentMode||doc.documentMode<8))return nodeRect=getIEPos(node),rootRect=getIEPos(root),{x:nodeRect.x-rootRect.x,y:nodeRect.y-rootRect.y};for(parent=node;parent&&parent!=root&&parent.nodeType;)x+=parent.offsetLeft||0,y+=parent.offsetTop||0,parent=parent.offsetParent;for(parent=node.parentNode;parent&&parent!=root&&parent.nodeType;)x-=parent.scrollLeft||0,y-=parent.scrollTop||0,parent=parent.parentNode;return{x:x,y:y}},getSize:function(node){return{w:node.offsetWidth||node.clientWidth,h:node.offsetHeight||node.clientHeight}}}}),define(\"moxie/core/Exceptions\",[\"moxie/core/utils/Basic\"],function(Basic){function _findKey(obj,value){var key;for(key in obj)if(obj[key]===value)return key;return null}return{RuntimeError:function(){var namecodes={NOT_INIT_ERR:1,NOT_SUPPORTED_ERR:9,JS_ERR:4};function RuntimeError(code){this.code=code,this.name=_findKey(namecodes,code),this.message=this.name+\": RuntimeError \"+this.code}return Basic.extend(RuntimeError,namecodes),RuntimeError.prototype=Error.prototype,RuntimeError}(),OperationNotAllowedException:function(){function OperationNotAllowedException(code){this.code=code,this.name=\"OperationNotAllowedException\"}return Basic.extend(OperationNotAllowedException,{NOT_ALLOWED_ERR:1}),OperationNotAllowedException.prototype=Error.prototype,OperationNotAllowedException}(),ImageError:function(){var namecodes={WRONG_FORMAT:1,MAX_RESOLUTION_ERR:2,INVALID_META_ERR:3};function ImageError(code){this.code=code,this.name=_findKey(namecodes,code),this.message=this.name+\": ImageError \"+this.code}return Basic.extend(ImageError,namecodes),ImageError.prototype=Error.prototype,ImageError}(),FileException:function(){var namecodes={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,SYNTAX_ERR:8};function FileException(code){this.code=code,this.name=_findKey(namecodes,code),this.message=this.name+\": FileException \"+this.code}return Basic.extend(FileException,namecodes),FileException.prototype=Error.prototype,FileException}(),DOMException:function(){var namecodes={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};function DOMException(code){this.code=code,this.name=_findKey(namecodes,code),this.message=this.name+\": DOMException \"+this.code}return Basic.extend(DOMException,namecodes),DOMException.prototype=Error.prototype,DOMException}(),EventException:function(){function EventException(code){this.code=code,this.name=\"EventException\"}return Basic.extend(EventException,{UNSPECIFIED_EVENT_TYPE_ERR:0}),EventException.prototype=Error.prototype,EventException}()}}),define(\"moxie/core/EventTarget\",[\"moxie/core/utils/Env\",\"moxie/core/Exceptions\",\"moxie/core/utils/Basic\"],function(Env,x,Basic){function EventTarget(){var eventpool={};Basic.extend(this,{uid:null,init:function(){this.uid||(this.uid=Basic.guid(\"uid_\"))},addEventListener:function(type,fn,priority,scope){var list,self=this;this.hasOwnProperty(\"uid\")||(this.uid=Basic.guid(\"uid_\")),type=Basic.trim(type),/\\s/.test(type)?Basic.each(type.split(/\\s+/),function(type){self.addEventListener(type,fn,priority,scope)}):(type=type.toLowerCase(),priority=parseInt(priority,10)||0,(list=eventpool[this.uid]&&eventpool[this.uid][type]||[]).push({fn:fn,priority:priority,scope:scope||this}),eventpool[this.uid]||(eventpool[this.uid]={}),eventpool[this.uid][type]=list)},hasEventListener:function(type){var list=type?eventpool[this.uid]&&eventpool[this.uid][type]:eventpool[this.uid];return list||!1},removeEventListener:function(type,fn){type=type.toLowerCase();var i,list=eventpool[this.uid]&&eventpool[this.uid][type];if(list){if(fn){for(i=list.length-1;i>=0;i--)if(list[i].fn===fn){list.splice(i,1);break}}else list=[];list.length||(delete eventpool[this.uid][type],Basic.isEmptyObj(eventpool[this.uid])&&delete eventpool[this.uid])}},removeAllEventListeners:function(){eventpool[this.uid]&&delete eventpool[this.uid]},dispatchEvent:function(type){var uid,list,args,tmpEvt,arr,evt={},result=!0;if(\"string\"!==Basic.typeOf(type)){if(tmpEvt=type,\"string\"!==Basic.typeOf(tmpEvt.type))throw new x.EventException(x.EventException.UNSPECIFIED_EVENT_TYPE_ERR);type=tmpEvt.type,void 0!==tmpEvt.total&&void 0!==tmpEvt.loaded&&(evt.total=tmpEvt.total,evt.loaded=tmpEvt.loaded),evt.async=tmpEvt.async||!1}if(-1!==type.indexOf(\"::\")?(arr=type.split(\"::\"),uid=arr[0],type=arr[1]):uid=this.uid,type=type.toLowerCase(),list=eventpool[uid]&&eventpool[uid][type]){list.sort(function(a,b){return b.priority-a.priority}),(args=[].slice.call(arguments)).shift(),evt.type=type,args.unshift(evt),MXI_DEBUG&&Env.debug.events&&Env.log(\"Event '%s' fired on %u\",evt.type,uid);var queue=[];Basic.each(list,function(handler){args[0].target=handler.scope,evt.async?queue.push(function(cb){setTimeout(function(){cb(!1===handler.fn.apply(handler.scope,args))},1)}):queue.push(function(cb){cb(!1===handler.fn.apply(handler.scope,args))})}),queue.length&&Basic.inSeries(queue,function(err){result=!err})}return result},bind:function(){this.addEventListener.apply(this,arguments)},unbind:function(){this.removeEventListener.apply(this,arguments)},unbindAll:function(){this.removeAllEventListeners.apply(this,arguments)},trigger:function(){return this.dispatchEvent.apply(this,arguments)},handleEventProps:function(dispatches){var self=this;this.bind(dispatches.join(\" \"),function(e){var prop=\"on\"+e.type.toLowerCase();\"function\"===Basic.typeOf(this[prop])&&this[prop].apply(this,arguments)}),Basic.each(dispatches,function(prop){prop=\"on\"+prop.toLowerCase(prop),\"undefined\"===Basic.typeOf(self[prop])&&(self[prop]=null)})}})}return EventTarget.instance=new EventTarget,EventTarget}),define(\"moxie/runtime/Runtime\",[\"moxie/core/utils/Env\",\"moxie/core/utils/Basic\",\"moxie/core/utils/Dom\",\"moxie/core/EventTarget\"],function(Env,Basic,Dom,EventTarget){var runtimeConstructors={},runtimes={};function Runtime(options,type,caps,modeCaps,preferredMode){var _shim,objpool,self=this,_uid=Basic.guid(type+\"_\"),defaultMode=preferredMode||\"browser\";options=options||{},runtimes[_uid]=this,caps=Basic.extend({access_binary:!1,access_image_binary:!1,display_media:!1,do_cors:!1,drag_and_drop:!1,filter_by_extension:!0,resize_image:!1,report_upload_progress:!1,return_response_headers:!1,return_response_type:!1,return_status_code:!0,send_custom_headers:!1,select_file:!1,select_folder:!1,select_multiple:!0,send_binary_string:!1,send_browser_cookies:!0,send_multipart:!0,slice_blob:!1,stream_upload:!1,summon_file_dialog:!1,upload_filesize:!0,use_http_method:!0},caps),options.preferred_caps&&(defaultMode=Runtime.getMode(modeCaps,options.preferred_caps,defaultMode)),MXI_DEBUG&&Env.debug.runtime&&Env.log(\"\\tdefault mode: %s\",defaultMode),objpool={},_shim={exec:function(uid,comp,fn,args){if(_shim[comp]&&(objpool[uid]||(objpool[uid]={context:this,instance:new _shim[comp]}),objpool[uid].instance[fn]))return objpool[uid].instance[fn].apply(this,args)},removeInstance:function(uid){delete objpool[uid]},removeAllInstances:function(){var self=this;Basic.each(objpool,function(obj,uid){\"function\"===Basic.typeOf(obj.instance.destroy)&&obj.instance.destroy.call(obj.context),self.removeInstance(uid)})}},Basic.extend(this,{initialized:!1,uid:_uid,type:type,mode:Runtime.getMode(modeCaps,options.required_caps,defaultMode),shimid:_uid+\"_container\",clients:0,options:options,can:function(cap,value){var refCaps=arguments[2]||caps;if(\"string\"===Basic.typeOf(cap)&&\"undefined\"===Basic.typeOf(value)&&(cap=Runtime.parseCaps(cap)),\"object\"===Basic.typeOf(cap)){for(var key in cap)if(!this.can(key,cap[key],refCaps))return!1;return!0}return\"function\"===Basic.typeOf(refCaps[cap])?refCaps[cap].call(this,value):value===refCaps[cap]},getShimContainer:function(){var container,shimContainer=Dom.get(this.shimid);return shimContainer||(container=this.options.container?Dom.get(this.options.container):document.body,(shimContainer=document.createElement(\"div\")).id=this.shimid,shimContainer.className=\"moxie-shim moxie-shim-\"+this.type,Basic.extend(shimContainer.style,{position:\"absolute\",top:\"0px\",left:\"0px\",width:\"1px\",height:\"1px\",overflow:\"hidden\"}),container.appendChild(shimContainer),container=null),shimContainer},getShim:function(){return _shim},shimExec:function(component,action){var args=[].slice.call(arguments,2);return self.getShim().exec.call(this,this.uid,component,action,args)},exec:function(component,action){var args=[].slice.call(arguments,2);return self[component]&&self[component][action]?self[component][action].apply(this,args):self.shimExec.apply(this,arguments)},destroy:function(){if(self){var shimContainer=Dom.get(this.shimid);shimContainer&&shimContainer.parentNode.removeChild(shimContainer),_shim&&_shim.removeAllInstances(),this.unbindAll(),delete runtimes[this.uid],this.uid=null,_uid=self=_shim=shimContainer=null}}}),this.mode&&options.required_caps&&!this.can(options.required_caps)&&(this.mode=!1)}return Runtime.order=\"html5,flash,silverlight,html4\",Runtime.getRuntime=function(uid){return!!runtimes[uid]&&runtimes[uid]},Runtime.addConstructor=function(type,constructor){constructor.prototype=EventTarget.instance,runtimeConstructors[type]=constructor},Runtime.getConstructor=function(type){return runtimeConstructors[type]||null},Runtime.getInfo=function(uid){var runtime=Runtime.getRuntime(uid);return runtime?{uid:runtime.uid,type:runtime.type,mode:runtime.mode,can:function(){return runtime.can.apply(runtime,arguments)}}:null},Runtime.parseCaps=function(capStr){var capObj={};return\"string\"!==Basic.typeOf(capStr)?capStr||{}:(Basic.each(capStr.split(\",\"),function(key){capObj[key]=!0}),capObj)},Runtime.can=function(type,caps){var runtime,mode,constructor=Runtime.getConstructor(type);return!!constructor&&(mode=(runtime=new constructor({required_caps:caps})).mode,runtime.destroy(),!!mode)},Runtime.thatCan=function(caps,runtimeOrder){var types=(runtimeOrder||Runtime.order).split(/\\s*,\\s*/);for(var i in types)if(Runtime.can(types[i],caps))return types[i];return null},Runtime.getMode=function(modeCaps,requiredCaps,defaultMode){var mode=null;if(\"undefined\"===Basic.typeOf(defaultMode)&&(defaultMode=\"browser\"),requiredCaps&&!Basic.isEmptyObj(modeCaps)){if(Basic.each(requiredCaps,function(value,cap){if(modeCaps.hasOwnProperty(cap)){var capMode=modeCaps[cap](value);if(\"string\"==typeof capMode&&(capMode=[capMode]),mode){if(!(mode=Basic.arrayIntersect(mode,capMode)))return MXI_DEBUG&&Env.debug.runtime&&Env.log(\"\\t\\t%c: %v (conflicting mode requested: %s)\",cap,value,capMode),mode=!1}else mode=capMode}MXI_DEBUG&&Env.debug.runtime&&Env.log(\"\\t\\t%c: %v (compatible modes: %s)\",cap,value,mode)}),mode)return-1!==Basic.inArray(defaultMode,mode)?defaultMode:mode[0];if(!1===mode)return!1}return defaultMode},Runtime.capTrue=function(){return!0},Runtime.capFalse=function(){return!1},Runtime.capTest=function(expr){return function(){return!!expr}},Runtime}),define(\"moxie/runtime/RuntimeClient\",[\"moxie/core/utils/Env\",\"moxie/core/Exceptions\",\"moxie/core/utils/Basic\",\"moxie/runtime/Runtime\"],function(Env,x,Basic,Runtime){return function(){var runtime;Basic.extend(this,{connectRuntime:function(options){var ruid,comp=this;if(\"string\"===Basic.typeOf(options)?ruid=options:\"string\"===Basic.typeOf(options.ruid)&&(ruid=options.ruid),ruid){if(runtime=Runtime.getRuntime(ruid))return runtime.clients++,runtime;throw new x.RuntimeError(x.RuntimeError.NOT_INIT_ERR)}!function initialize(items){var type,constructor;if(!items.length)return comp.trigger(\"RuntimeError\",new x.RuntimeError(x.RuntimeError.NOT_INIT_ERR)),void(runtime=null);type=items.shift().toLowerCase(),(constructor=Runtime.getConstructor(type))?(MXI_DEBUG&&Env.debug.runtime&&(Env.log(\"Trying runtime: %s\",type),Env.log(options)),(runtime=new constructor(options)).bind(\"Init\",function(){runtime.initialized=!0,MXI_DEBUG&&Env.debug.runtime&&Env.log(\"Runtime '%s' initialized\",runtime.type),setTimeout(function(){runtime.clients++,comp.trigger(\"RuntimeInit\",runtime)},1)}),runtime.bind(\"Error\",function(){MXI_DEBUG&&Env.debug.runtime&&Env.log(\"Runtime '%s' failed to initialize\",runtime.type),runtime.destroy(),initialize(items)}),MXI_DEBUG&&Env.debug.runtime&&Env.log(\"\\tselected mode: %s\",runtime.mode),runtime.mode?runtime.init():runtime.trigger(\"Error\")):initialize(items)}((options.runtime_order||Runtime.order).split(/\\s*,\\s*/))},disconnectRuntime:function(){runtime&&--runtime.clients<=0&&runtime.destroy(),runtime=null},getRuntime:function(){return runtime&&runtime.uid?runtime:runtime=null},exec:function(){return runtime?runtime.exec.apply(this,arguments):null}})}}),define(\"moxie/file/FileInput\",[\"moxie/core/utils/Basic\",\"moxie/core/utils/Env\",\"moxie/core/utils/Mime\",\"moxie/core/utils/Dom\",\"moxie/core/Exceptions\",\"moxie/core/EventTarget\",\"moxie/core/I18n\",\"moxie/runtime/Runtime\",\"moxie/runtime/RuntimeClient\"],function(Basic,Env,Mime,Dom,x,EventTarget,I18n,Runtime,RuntimeClient){var dispatches=[\"ready\",\"change\",\"cancel\",\"mouseenter\",\"mouseleave\",\"mousedown\",\"mouseup\"];function FileInput(options){MXI_DEBUG&&Env.log(\"Instantiating FileInput...\");var container,browseButton,defaults,self=this;if(-1!==Basic.inArray(Basic.typeOf(options),[\"string\",\"node\"])&&(options={browse_button:options}),!(browseButton=Dom.get(options.browse_button)))throw new x.DOMException(x.DOMException.NOT_FOUND_ERR);defaults={accept:[{title:I18n.translate(\"All Files\"),extensions:\"*\"}],name:\"file\",multiple:!1,required_caps:!1,container:browseButton.parentNode||document.body},\"string\"==typeof(options=Basic.extend({},defaults,options)).required_caps&&(options.required_caps=Runtime.parseCaps(options.required_caps)),\"string\"==typeof options.accept&&(options.accept=Mime.mimes2extList(options.accept)),(container=Dom.get(options.container))||(container=document.body),\"static\"===Dom.getStyle(container,\"position\")&&(container.style.position=\"relative\"),container=browseButton=null,RuntimeClient.call(self),Basic.extend(self,{uid:Basic.guid(\"uid_\"),ruid:null,shimid:null,files:null,init:function(){self.bind(\"RuntimeInit\",function(e,runtime){self.ruid=runtime.uid,self.shimid=runtime.shimid,self.bind(\"Ready\",function(){self.trigger(\"Refresh\")},999),self.bind(\"Refresh\",function(){var pos,size,browseButton,shimContainer;browseButton=Dom.get(options.browse_button),shimContainer=Dom.get(runtime.shimid),browseButton&&(pos=Dom.getPos(browseButton,Dom.get(options.container)),size=Dom.getSize(browseButton),shimContainer&&Basic.extend(shimContainer.style,{top:pos.y+\"px\",left:pos.x+\"px\",width:size.w+\"px\",height:size.h+\"px\"})),shimContainer=browseButton=null}),runtime.exec.call(self,\"FileInput\",\"init\",options)}),self.connectRuntime(Basic.extend({},options,{required_caps:{select_file:!0}}))},disable:function(state){var runtime=this.getRuntime();runtime&&runtime.exec.call(this,\"FileInput\",\"disable\",\"undefined\"===Basic.typeOf(state)||state)},refresh:function(){self.trigger(\"Refresh\")},destroy:function(){var runtime=this.getRuntime();runtime&&(runtime.exec.call(this,\"FileInput\",\"destroy\"),this.disconnectRuntime()),\"array\"===Basic.typeOf(this.files)&&Basic.each(this.files,function(file){file.destroy()}),this.files=null,this.unbindAll()}}),this.handleEventProps(dispatches)}return FileInput.prototype=EventTarget.instance,FileInput}),define(\"moxie/core/utils/Encode\",[],function(){var utf8_encode=function(str){return unescape(encodeURIComponent(str))},utf8_decode=function(str_data){return decodeURIComponent(escape(str_data))};return{utf8_encode:utf8_encode,utf8_decode:utf8_decode,atob:function(data,utf8){if(\"function\"==typeof window.atob)return utf8?utf8_decode(window.atob(data)):window.atob(data);var o1,o2,o3,h3,h4,bits,dec,b64=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",i=0,ac=0,tmp_arr=[];if(!data)return data;for(data+=\"\";o1=(bits=b64.indexOf(data.charAt(i++))<<18|b64.indexOf(data.charAt(i++))<<12|(h3=b64.indexOf(data.charAt(i++)))<<6|(h4=b64.indexOf(data.charAt(i++))))>>16&255,o2=bits>>8&255,o3=255&bits,tmp_arr[ac++]=64==h3?String.fromCharCode(o1):64==h4?String.fromCharCode(o1,o2):String.fromCharCode(o1,o2,o3),i<data.length;);return dec=tmp_arr.join(\"\"),utf8?utf8_decode(dec):dec},btoa:function(data,utf8){if(utf8&&(data=utf8_encode(data)),\"function\"==typeof window.btoa)return window.btoa(data);var h1,h2,h3,h4,bits,b64=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",i=0,ac=0,enc=\"\",tmp_arr=[];if(!data)return data;for(;h1=(bits=data.charCodeAt(i++)<<16|data.charCodeAt(i++)<<8|data.charCodeAt(i++))>>18&63,h2=bits>>12&63,h3=bits>>6&63,h4=63&bits,tmp_arr[ac++]=b64.charAt(h1)+b64.charAt(h2)+b64.charAt(h3)+b64.charAt(h4),i<data.length;);enc=tmp_arr.join(\"\");var r=data.length%3;return(r?enc.slice(0,r-3):enc)+\"===\".slice(r||3)}}}),define(\"moxie/file/Blob\",[\"moxie/core/utils/Basic\",\"moxie/core/utils/Encode\",\"moxie/runtime/RuntimeClient\"],function(Basic,Encode,RuntimeClient){var blobpool={};return function Blob(ruid,blob){RuntimeClient.call(this),ruid&&this.connectRuntime(ruid),blob?\"string\"===Basic.typeOf(blob)&&(blob={data:blob}):blob={},Basic.extend(this,{uid:blob.uid||Basic.guid(\"uid_\"),ruid:ruid,size:blob.size||0,type:blob.type||\"\",slice:function(start,end,type){return this.isDetached()?function(start,end,type){var blob,data=blobpool[this.uid];return\"string\"===Basic.typeOf(data)&&data.length?((blob=new Blob(null,{type:type,size:end-start})).detach(data.substr(start,blob.size)),blob):null}.apply(this,arguments):this.getRuntime().exec.call(this,\"Blob\",\"slice\",this.getSource(),start,end,type)},getSource:function(){return blobpool[this.uid]?blobpool[this.uid]:null},detach:function(data){if(this.ruid&&(this.getRuntime().exec.call(this,\"Blob\",\"destroy\"),this.disconnectRuntime(),this.ruid=null),\"data:\"==(data=data||\"\").substr(0,5)){var base64Offset=data.indexOf(\";base64,\");this.type=data.substring(5,base64Offset),data=Encode.atob(data.substring(base64Offset+8))}this.size=data.length,blobpool[this.uid]=data},isDetached:function(){return!this.ruid&&\"string\"===Basic.typeOf(blobpool[this.uid])},destroy:function(){this.detach(),delete blobpool[this.uid]}}),blob.data?this.detach(blob.data):blobpool[this.uid]=blob}}),define(\"moxie/file/File\",[\"moxie/core/utils/Basic\",\"moxie/core/utils/Mime\",\"moxie/file/Blob\"],function(Basic,Mime,Blob){function File(ruid,file){var name;if(file||(file={}),Blob.apply(this,arguments),this.type||(this.type=Mime.getFileMime(file.name)),file.name)name=(name=file.name.replace(/\\\\/g,\"/\")).substr(name.lastIndexOf(\"/\")+1);else if(this.type){var prefix=this.type.split(\"/\")[0];name=Basic.guid((\"\"!==prefix?prefix:\"file\")+\"_\"),Mime.extensions[this.type]&&(name+=\".\"+Mime.extensions[this.type][0])}Basic.extend(this,{name:name||Basic.guid(\"file_\"),relativePath:\"\",lastModifiedDate:file.lastModifiedDate||(new Date).toLocaleString()})}return File.prototype=Blob.prototype,File}),define(\"moxie/file/FileDrop\",[\"moxie/core/I18n\",\"moxie/core/utils/Dom\",\"moxie/core/Exceptions\",\"moxie/core/utils/Basic\",\"moxie/core/utils/Env\",\"moxie/file/File\",\"moxie/runtime/RuntimeClient\",\"moxie/core/EventTarget\",\"moxie/core/utils/Mime\"],function(I18n,Dom,x,Basic,Env,File,RuntimeClient,EventTarget,Mime){var dispatches=[\"ready\",\"dragenter\",\"dragleave\",\"drop\",\"error\"];function FileDrop(options){MXI_DEBUG&&Env.log(\"Instantiating FileDrop...\");var defaults,self=this;\"string\"==typeof options&&(options={drop_zone:options}),defaults={accept:[{title:I18n.translate(\"All Files\"),extensions:\"*\"}],required_caps:{drag_and_drop:!0}},(options=\"object\"==typeof options?Basic.extend({},defaults,options):defaults).container=Dom.get(options.drop_zone)||document.body,\"static\"===Dom.getStyle(options.container,\"position\")&&(options.container.style.position=\"relative\"),\"string\"==typeof options.accept&&(options.accept=Mime.mimes2extList(options.accept)),RuntimeClient.call(self),Basic.extend(self,{uid:Basic.guid(\"uid_\"),ruid:null,files:null,init:function(){self.bind(\"RuntimeInit\",function(e,runtime){self.ruid=runtime.uid,runtime.exec.call(self,\"FileDrop\",\"init\",options),self.dispatchEvent(\"ready\")}),self.connectRuntime(options)},destroy:function(){var runtime=this.getRuntime();runtime&&(runtime.exec.call(this,\"FileDrop\",\"destroy\"),this.disconnectRuntime()),this.files=null,this.unbindAll()}}),this.handleEventProps(dispatches)}return FileDrop.prototype=EventTarget.instance,FileDrop}),define(\"moxie/file/FileReader\",[\"moxie/core/utils/Basic\",\"moxie/core/utils/Encode\",\"moxie/core/Exceptions\",\"moxie/core/EventTarget\",\"moxie/file/Blob\",\"moxie/runtime/RuntimeClient\"],function(Basic,Encode,x,EventTarget,Blob,RuntimeClient){var dispatches=[\"loadstart\",\"progress\",\"load\",\"abort\",\"error\",\"loadend\"];function FileReader(){function _read(op,blob){if(this.trigger(\"loadstart\"),this.readyState===FileReader.LOADING)return this.trigger(\"error\",new x.DOMException(x.DOMException.INVALID_STATE_ERR)),void this.trigger(\"loadend\");if(!(blob instanceof Blob))return this.trigger(\"error\",new x.DOMException(x.DOMException.NOT_FOUND_ERR)),void this.trigger(\"loadend\");if(this.result=null,this.readyState=FileReader.LOADING,blob.isDetached()){var src=blob.getSource();switch(op){case\"readAsText\":case\"readAsBinaryString\":this.result=src;break;case\"readAsDataURL\":this.result=\"data:\"+blob.type+\";base64,\"+Encode.btoa(src)}this.readyState=FileReader.DONE,this.trigger(\"load\"),this.trigger(\"loadend\")}else this.connectRuntime(blob.ruid),this.exec(\"FileReader\",\"read\",op,blob)}RuntimeClient.call(this),Basic.extend(this,{uid:Basic.guid(\"uid_\"),readyState:FileReader.EMPTY,result:null,error:null,readAsBinaryString:function(blob){_read.call(this,\"readAsBinaryString\",blob)},readAsDataURL:function(blob){_read.call(this,\"readAsDataURL\",blob)},readAsText:function(blob){_read.call(this,\"readAsText\",blob)},abort:function(){this.result=null,-1===Basic.inArray(this.readyState,[FileReader.EMPTY,FileReader.DONE])&&(this.readyState===FileReader.LOADING&&(this.readyState=FileReader.DONE),this.exec(\"FileReader\",\"abort\"),this.trigger(\"abort\"),this.trigger(\"loadend\"))},destroy:function(){this.abort(),this.exec(\"FileReader\",\"destroy\"),this.disconnectRuntime(),this.unbindAll()}}),this.handleEventProps(dispatches),this.bind(\"Error\",function(e,err){this.readyState=FileReader.DONE,this.error=err},999),this.bind(\"Load\",function(e){this.readyState=FileReader.DONE},999)}return FileReader.EMPTY=0,FileReader.LOADING=1,FileReader.DONE=2,FileReader.prototype=EventTarget.instance,FileReader}),define(\"moxie/core/utils/Url\",[],function(){var parseUrl=function(url,currentUrl){for(var key=[\"source\",\"scheme\",\"authority\",\"userInfo\",\"user\",\"pass\",\"host\",\"port\",\"relative\",\"path\",\"directory\",\"file\",\"query\",\"fragment\"],i=key.length,uri={},m=/^(?:([^:\\/?#]+):)?(?:\\/\\/()(?:(?:()(?:([^:@\\/]*):?([^:@\\/]*))?@)?([^:\\/?#]*)(?::(\\d*))?))?()(?:(()(?:(?:[^?#\\/]*\\/)*)()(?:[^?#]*))(?:\\\\?([^#]*))?(?:#(.*))?)/.exec(url||\"\");i--;)m[i]&&(uri[key[i]]=m[i]);if(!uri.scheme){currentUrl&&\"string\"!=typeof currentUrl||(currentUrl=parseUrl(currentUrl||document.location.href)),uri.scheme=currentUrl.scheme,uri.host=currentUrl.host,uri.port=currentUrl.port;var path=\"\";/^[^\\/]/.test(uri.path)&&(path=currentUrl.path,path=/\\/[^\\/]*\\.[^\\/]*$/.test(path)?path.replace(/\\/[^\\/]+$/,\"/\"):path.replace(/\\/?$/,\"/\")),uri.path=path+(uri.path||\"\")}return uri.port||(uri.port={http:80,https:443}[uri.scheme]||80),uri.port=parseInt(uri.port,10),uri.path||(uri.path=\"/\"),delete uri.source,uri};return{parseUrl:parseUrl,resolveUrl:function(url){var urlp=\"object\"==typeof url?url:parseUrl(url);return urlp.scheme+\"://\"+urlp.host+(urlp.port!=={http:80,https:443}[urlp.scheme]?\":\"+urlp.port:\"\")+urlp.path+(urlp.query?urlp.query:\"\")},hasSameOrigin:function(url){function origin(url){return[url.scheme,url.host,url.port].join(\"/\")}return\"string\"==typeof url&&(url=parseUrl(url)),origin(parseUrl())===origin(url)}}}),define(\"moxie/runtime/RuntimeTarget\",[\"moxie/core/utils/Basic\",\"moxie/runtime/RuntimeClient\",\"moxie/core/EventTarget\"],function(Basic,RuntimeClient,EventTarget){function RuntimeTarget(){this.uid=Basic.guid(\"uid_\"),RuntimeClient.call(this),this.destroy=function(){this.disconnectRuntime(),this.unbindAll()}}return RuntimeTarget.prototype=EventTarget.instance,RuntimeTarget}),define(\"moxie/file/FileReaderSync\",[\"moxie/core/utils/Basic\",\"moxie/runtime/RuntimeClient\",\"moxie/core/utils/Encode\"],function(Basic,RuntimeClient,Encode){return function(){function _read(op,blob){if(!blob.isDetached()){var result=this.connectRuntime(blob.ruid).exec.call(this,\"FileReaderSync\",\"read\",op,blob);return this.disconnectRuntime(),result}var src=blob.getSource();switch(op){case\"readAsBinaryString\":return src;case\"readAsDataURL\":return\"data:\"+blob.type+\";base64,\"+Encode.btoa(src);case\"readAsText\":for(var txt=\"\",i=0,length=src.length;i<length;i++)txt+=String.fromCharCode(src[i]);return txt}}RuntimeClient.call(this),Basic.extend(this,{uid:Basic.guid(\"uid_\"),readAsBinaryString:function(blob){return _read.call(this,\"readAsBinaryString\",blob)},readAsDataURL:function(blob){return _read.call(this,\"readAsDataURL\",blob)},readAsText:function(blob){return _read.call(this,\"readAsText\",blob)}})}}),define(\"moxie/xhr/FormData\",[\"moxie/core/Exceptions\",\"moxie/core/utils/Basic\",\"moxie/file/Blob\"],function(x,Basic,Blob){return function(){var _blob,_fields=[];Basic.extend(this,{append:function(name,value){var self=this,valueType=Basic.typeOf(value);value instanceof Blob?_blob={name:name,value:value}:\"array\"===valueType?(name+=\"[]\",Basic.each(value,function(value){self.append(name,value)})):\"object\"===valueType?Basic.each(value,function(value,key){self.append(name+\"[\"+key+\"]\",value)}):\"null\"===valueType||\"undefined\"===valueType||\"number\"===valueType&&isNaN(value)?self.append(name,\"false\"):_fields.push({name:name,value:value.toString()})},hasBlob:function(){return!!this.getBlob()},getBlob:function(){return _blob&&_blob.value||null},getBlobName:function(){return _blob&&_blob.name||null},each:function(cb){Basic.each(_fields,function(field){cb(field.value,field.name)}),_blob&&cb(_blob.value,_blob.name)},destroy:function(){_blob=null,_fields=[]}})}}),define(\"moxie/xhr/XMLHttpRequest\",[\"moxie/core/utils/Basic\",\"moxie/core/Exceptions\",\"moxie/core/EventTarget\",\"moxie/core/utils/Encode\",\"moxie/core/utils/Url\",\"moxie/runtime/Runtime\",\"moxie/runtime/RuntimeTarget\",\"moxie/file/Blob\",\"moxie/file/FileReaderSync\",\"moxie/xhr/FormData\",\"moxie/core/utils/Env\",\"moxie/core/utils/Mime\"],function(Basic,x,EventTarget,Encode,Url,Runtime,RuntimeTarget,Blob,FileReaderSync,FormData,Env,Mime){var httpCode={100:\"Continue\",101:\"Switching Protocols\",102:\"Processing\",200:\"OK\",201:\"Created\",202:\"Accepted\",203:\"Non-Authoritative Information\",204:\"No Content\",205:\"Reset Content\",206:\"Partial Content\",207:\"Multi-Status\",226:\"IM Used\",300:\"Multiple Choices\",301:\"Moved Permanently\",302:\"Found\",303:\"See Other\",304:\"Not Modified\",305:\"Use Proxy\",306:\"Reserved\",307:\"Temporary Redirect\",400:\"Bad Request\",401:\"Unauthorized\",402:\"Payment Required\",403:\"Forbidden\",404:\"Not Found\",405:\"Method Not Allowed\",406:\"Not Acceptable\",407:\"Proxy Authentication Required\",408:\"Request Timeout\",409:\"Conflict\",410:\"Gone\",411:\"Length Required\",412:\"Precondition Failed\",413:\"Request Entity Too Large\",414:\"Request-URI Too Long\",415:\"Unsupported Media Type\",416:\"Requested Range Not Satisfiable\",417:\"Expectation Failed\",422:\"Unprocessable Entity\",423:\"Locked\",424:\"Failed Dependency\",426:\"Upgrade Required\",500:\"Internal Server Error\",501:\"Not Implemented\",502:\"Bad Gateway\",503:\"Service Unavailable\",504:\"Gateway Timeout\",505:\"HTTP Version Not Supported\",506:\"Variant Also Negotiates\",507:\"Insufficient Storage\",510:\"Not Extended\"};function XMLHttpRequestUpload(){this.uid=Basic.guid(\"uid_\")}XMLHttpRequestUpload.prototype=EventTarget.instance;var dispatches=[\"loadstart\",\"progress\",\"abort\",\"error\",\"load\",\"timeout\",\"loadend\"];function XMLHttpRequest(){var _url,_method,_user,_password,_xhr,_responseHeadersBag,self=this,props={timeout:0,readyState:XMLHttpRequest.UNSENT,withCredentials:!1,status:0,statusText:\"\",responseType:\"\",responseXML:null,responseText:null,response:null},_async=!0,_headers={},_encoding=null,_mimeType=null,_sync_flag=!1,_send_flag=!1,_upload_events_flag=!1,_upload_complete_flag=!1,_error_flag=!1,_same_origin_flag=!1,_options={},_responseHeaders=\"\";function _p(prop,value){if(props.hasOwnProperty(prop))return 1===arguments.length?Env.can(\"define_property\")?props[prop]:self[prop]:void(Env.can(\"define_property\")?props[prop]=value:self[prop]=value)}Basic.extend(this,props,{uid:Basic.guid(\"uid_\"),upload:new XMLHttpRequestUpload,open:function(method,url,async,user,password){var urlp;if(!method||!url)throw new x.DOMException(x.DOMException.SYNTAX_ERR);if(/[\\u0100-\\uffff]/.test(method)||Encode.utf8_encode(method)!==method)throw new x.DOMException(x.DOMException.SYNTAX_ERR);if(~Basic.inArray(method.toUpperCase(),[\"CONNECT\",\"DELETE\",\"GET\",\"HEAD\",\"OPTIONS\",\"POST\",\"PUT\",\"TRACE\",\"TRACK\"])&&(_method=method.toUpperCase()),~Basic.inArray(_method,[\"CONNECT\",\"TRACE\",\"TRACK\"]))throw new x.DOMException(x.DOMException.SECURITY_ERR);if(url=Encode.utf8_encode(url),urlp=Url.parseUrl(url),_same_origin_flag=Url.hasSameOrigin(urlp),_url=Url.resolveUrl(url),(user||password)&&!_same_origin_flag)throw new x.DOMException(x.DOMException.INVALID_ACCESS_ERR);if(_user=user||urlp.user,_password=password||urlp.pass,!1===(_async=async||!0)&&(_p(\"timeout\")||_p(\"withCredentials\")||\"\"!==_p(\"responseType\")))throw new x.DOMException(x.DOMException.INVALID_ACCESS_ERR);_sync_flag=!_async,_send_flag=!1,_headers={},function(){_p(\"responseText\",\"\"),_p(\"responseXML\",null),_p(\"response\",null),_p(\"status\",0),_p(\"statusText\",\"\"),null}.call(this),_p(\"readyState\",XMLHttpRequest.OPENED),this.dispatchEvent(\"readystatechange\")},setRequestHeader:function(header,value){if(_p(\"readyState\")!==XMLHttpRequest.OPENED||_send_flag)throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);if(/[\\u0100-\\uffff]/.test(header)||Encode.utf8_encode(header)!==header)throw new x.DOMException(x.DOMException.SYNTAX_ERR);return header=Basic.trim(header).toLowerCase(),!~Basic.inArray(header,[\"accept-charset\",\"accept-encoding\",\"access-control-request-headers\",\"access-control-request-method\",\"connection\",\"content-length\",\"cookie\",\"cookie2\",\"content-transfer-encoding\",\"date\",\"expect\",\"host\",\"keep-alive\",\"origin\",\"referer\",\"te\",\"trailer\",\"transfer-encoding\",\"upgrade\",\"user-agent\",\"via\"])&&!/^(proxy\\-|sec\\-)/.test(header)&&(_headers[header]?_headers[header]+=\", \"+value:_headers[header]=value,!0)},getAllResponseHeaders:function(){return _responseHeaders||\"\"},getResponseHeader:function(header){return header=header.toLowerCase(),_error_flag||~Basic.inArray(header,[\"set-cookie\",\"set-cookie2\"])?null:_responseHeaders&&\"\"!==_responseHeaders&&(_responseHeadersBag||(_responseHeadersBag={},Basic.each(_responseHeaders.split(/\\r\\n/),function(line){var pair=line.split(/:\\s+/);2===pair.length&&(pair[0]=Basic.trim(pair[0]),_responseHeadersBag[pair[0].toLowerCase()]={header:pair[0],value:Basic.trim(pair[1])})})),_responseHeadersBag.hasOwnProperty(header))?_responseHeadersBag[header].header+\": \"+_responseHeadersBag[header].value:null},overrideMimeType:function(mime){var matches,charset;if(~Basic.inArray(_p(\"readyState\"),[XMLHttpRequest.LOADING,XMLHttpRequest.DONE]))throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);if(mime=Basic.trim(mime.toLowerCase()),/;/.test(mime)&&(matches=mime.match(/^([^;]+)(?:;\\scharset\\=)?(.*)$/))&&(mime=matches[1],matches[2]&&(charset=matches[2])),!Mime.mimes[mime])throw new x.DOMException(x.DOMException.SYNTAX_ERR);mime,charset},send:function(data,options){if(_options=\"string\"===Basic.typeOf(options)?{ruid:options}:options||{},this.readyState!==XMLHttpRequest.OPENED||_send_flag)throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);if(data instanceof Blob)_options.ruid=data.ruid,_mimeType=data.type||\"application/octet-stream\";else if(data instanceof FormData){if(data.hasBlob()){var blob=data.getBlob();_options.ruid=blob.ruid,_mimeType=blob.type||\"application/octet-stream\"}}else\"string\"==typeof data&&(_encoding=\"UTF-8\",_mimeType=\"text/plain;charset=UTF-8\",data=Encode.utf8_encode(data));this.withCredentials||(this.withCredentials=_options.required_caps&&_options.required_caps.send_browser_cookies&&!_same_origin_flag),_upload_events_flag=!_sync_flag&&this.upload.hasEventListener(),_error_flag=!1,_upload_complete_flag=!data,_sync_flag||(_send_flag=!0),function(data){var self=this;function loadEnd(){_xhr&&(_xhr.destroy(),_xhr=null),self.dispatchEvent(\"loadend\"),self=null}function exec(runtime){_xhr.bind(\"LoadStart\",function(e){_p(\"readyState\",XMLHttpRequest.LOADING),self.dispatchEvent(\"readystatechange\"),self.dispatchEvent(e),_upload_events_flag&&self.upload.dispatchEvent(e)}),_xhr.bind(\"Progress\",function(e){_p(\"readyState\")!==XMLHttpRequest.LOADING&&(_p(\"readyState\",XMLHttpRequest.LOADING),self.dispatchEvent(\"readystatechange\")),self.dispatchEvent(e)}),_xhr.bind(\"UploadProgress\",function(e){_upload_events_flag&&self.upload.dispatchEvent({type:\"progress\",lengthComputable:!1,total:e.total,loaded:e.loaded})}),_xhr.bind(\"Load\",function(e){_p(\"readyState\",XMLHttpRequest.DONE),_p(\"status\",Number(runtime.exec.call(_xhr,\"XMLHttpRequest\",\"getStatus\")||0)),_p(\"statusText\",httpCode[_p(\"status\")]||\"\"),_p(\"response\",runtime.exec.call(_xhr,\"XMLHttpRequest\",\"getResponse\",_p(\"responseType\"))),~Basic.inArray(_p(\"responseType\"),[\"text\",\"\"])?_p(\"responseText\",_p(\"response\")):\"document\"===_p(\"responseType\")&&_p(\"responseXML\",_p(\"response\")),_responseHeaders=runtime.exec.call(_xhr,\"XMLHttpRequest\",\"getAllResponseHeaders\"),self.dispatchEvent(\"readystatechange\"),_p(\"status\")>0?(_upload_events_flag&&self.upload.dispatchEvent(e),self.dispatchEvent(e)):(_error_flag=!0,self.dispatchEvent(\"error\")),loadEnd()}),_xhr.bind(\"Abort\",function(e){self.dispatchEvent(e),loadEnd()}),_xhr.bind(\"Error\",function(e){_error_flag=!0,_p(\"readyState\",XMLHttpRequest.DONE),self.dispatchEvent(\"readystatechange\"),_upload_complete_flag=!0,self.dispatchEvent(e),loadEnd()}),runtime.exec.call(_xhr,\"XMLHttpRequest\",\"send\",{url:_url,method:_method,async:_async,user:_user,password:_password,headers:_headers,mimeType:_mimeType,encoding:_encoding,responseType:self.responseType,withCredentials:self.withCredentials,options:_options},data)}(new Date).getTime(),_xhr=new RuntimeTarget,\"string\"==typeof _options.required_caps&&(_options.required_caps=Runtime.parseCaps(_options.required_caps));_options.required_caps=Basic.extend({},_options.required_caps,{return_response_type:self.responseType}),data instanceof FormData&&(_options.required_caps.send_multipart=!0);Basic.isEmptyObj(_headers)||(_options.required_caps.send_custom_headers=!0);_same_origin_flag||(_options.required_caps.do_cors=!0);_options.ruid?exec(_xhr.connectRuntime(_options)):(_xhr.bind(\"RuntimeInit\",function(e,runtime){exec(runtime)}),_xhr.bind(\"RuntimeError\",function(e,err){self.dispatchEvent(\"RuntimeError\",err)}),_xhr.connectRuntime(_options))}.call(this,data)},abort:function(){if(_error_flag=!0,_sync_flag=!1,~Basic.inArray(_p(\"readyState\"),[XMLHttpRequest.UNSENT,XMLHttpRequest.OPENED,XMLHttpRequest.DONE]))_p(\"readyState\",XMLHttpRequest.UNSENT);else{if(_p(\"readyState\",XMLHttpRequest.DONE),_send_flag=!1,!_xhr)throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);_xhr.getRuntime().exec.call(_xhr,\"XMLHttpRequest\",\"abort\",_upload_complete_flag),_upload_complete_flag=!0}},destroy:function(){_xhr&&(\"function\"===Basic.typeOf(_xhr.destroy)&&_xhr.destroy(),_xhr=null),this.unbindAll(),this.upload&&(this.upload.unbindAll(),this.upload=null)}}),this.handleEventProps(dispatches.concat([\"readystatechange\"])),this.upload.handleEventProps(dispatches)}return XMLHttpRequest.UNSENT=0,XMLHttpRequest.OPENED=1,XMLHttpRequest.HEADERS_RECEIVED=2,XMLHttpRequest.LOADING=3,XMLHttpRequest.DONE=4,XMLHttpRequest.prototype=EventTarget.instance,XMLHttpRequest}),define(\"moxie/runtime/Transporter\",[\"moxie/core/utils/Basic\",\"moxie/core/utils/Encode\",\"moxie/runtime/RuntimeClient\",\"moxie/core/EventTarget\"],function(Basic,Encode,RuntimeClient,EventTarget){function Transporter(){var mod,_runtime,_data,_size,_pos,_chunk_size;function _reset(){_size=_pos=0,_data=this.result=null}function _run(type,runtime){var self=this;_runtime=runtime,self.bind(\"TransportingProgress\",function(e){(_pos=e.loaded)<_size&&-1===Basic.inArray(self.state,[Transporter.IDLE,Transporter.DONE])&&_transport.call(self)},999),self.bind(\"TransportingComplete\",function(){_pos=_size,self.state=Transporter.DONE,_data=null,self.result=_runtime.exec.call(self,\"Transporter\",\"getAsBlob\",type||\"\")},999),self.state=Transporter.BUSY,self.trigger(\"TransportingStarted\"),_transport.call(self)}function _transport(){var chunk,bytesLeft=_size-_pos;_chunk_size>bytesLeft&&(_chunk_size=bytesLeft),chunk=Encode.btoa(_data.substr(_pos,_chunk_size)),_runtime.exec.call(this,\"Transporter\",\"receive\",chunk,_size)}RuntimeClient.call(this),Basic.extend(this,{uid:Basic.guid(\"uid_\"),state:Transporter.IDLE,result:null,transport:function(data,type,options){var self=this;if(options=Basic.extend({chunk_size:204798},options),(mod=options.chunk_size%3)&&(options.chunk_size+=3-mod),_chunk_size=options.chunk_size,_reset.call(this),_data=data,_size=data.length,\"string\"===Basic.typeOf(options)||options.ruid)_run.call(self,type,this.connectRuntime(options));else{var cb=function(e,runtime){self.unbind(\"RuntimeInit\",cb),_run.call(self,type,runtime)};this.bind(\"RuntimeInit\",cb),this.connectRuntime(options)}},abort:function(){this.state=Transporter.IDLE,_runtime&&(_runtime.exec.call(this,\"Transporter\",\"clear\"),this.trigger(\"TransportingAborted\")),_reset.call(this)},destroy:function(){this.unbindAll(),_runtime=null,this.disconnectRuntime(),_reset.call(this)}})}return Transporter.IDLE=0,Transporter.BUSY=1,Transporter.DONE=2,Transporter.prototype=EventTarget.instance,Transporter}),define(\"moxie/image/Image\",[\"moxie/core/utils/Basic\",\"moxie/core/utils/Dom\",\"moxie/core/Exceptions\",\"moxie/file/FileReaderSync\",\"moxie/xhr/XMLHttpRequest\",\"moxie/runtime/Runtime\",\"moxie/runtime/RuntimeClient\",\"moxie/runtime/Transporter\",\"moxie/core/utils/Env\",\"moxie/core/EventTarget\",\"moxie/file/Blob\",\"moxie/file/File\",\"moxie/core/utils/Encode\"],function(Basic,Dom,x,FileReaderSync,XMLHttpRequest,Runtime,RuntimeClient,Transporter,Env,EventTarget,Blob,File,Encode){var dispatches=[\"progress\",\"load\",\"error\",\"resize\",\"embedded\"];function Image(){function _loadFromBlob(blob,options){var self=this;function exec(runtime){self.ruid=runtime.uid,runtime.exec.call(self,\"Image\",\"loadFromBlob\",blob)}self.name=blob.name||\"\",blob.isDetached()?(this.bind(\"RuntimeInit\",function(e,runtime){exec(runtime)}),options&&\"string\"==typeof options.required_caps&&(options.required_caps=Runtime.parseCaps(options.required_caps)),this.connectRuntime(Basic.extend({required_caps:{access_image_binary:!0,resize_image:!0}},options))):exec(this.connectRuntime(blob.ruid))}RuntimeClient.call(this),Basic.extend(this,{uid:Basic.guid(\"uid_\"),ruid:null,name:\"\",size:0,width:0,height:0,type:\"\",meta:{},clone:function(){this.load.apply(this,arguments)},load:function(){(function _load(src){var srcType=Basic.typeOf(src);try{if(src instanceof Image){if(!src.size)throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);(function(img,exact){var runtime=this.connectRuntime(img.ruid);this.ruid=runtime.uid,runtime.exec.call(this,\"Image\",\"loadFromImage\",img,\"undefined\"===Basic.typeOf(exact)||exact)}).apply(this,arguments)}else if(src instanceof Blob){if(!~Basic.inArray(src.type,[\"image/jpeg\",\"image/png\"]))throw new x.ImageError(x.ImageError.WRONG_FORMAT);_loadFromBlob.apply(this,arguments)}else if(-1!==Basic.inArray(srcType,[\"blob\",\"file\"]))_load.call(this,new File(null,src),arguments[1]);else if(\"string\"===srcType)\"data:\"===src.substr(0,5)?_load.call(this,new Blob(null,{data:src}),arguments[1]):function(url,options){var xhr,self=this;(xhr=new XMLHttpRequest).open(\"get\",url),xhr.responseType=\"blob\",xhr.onprogress=function(e){self.trigger(e)},xhr.onload=function(){_loadFromBlob.call(self,xhr.response,!0)},xhr.onerror=function(e){self.trigger(e)},xhr.onloadend=function(){xhr.destroy()},xhr.bind(\"RuntimeError\",function(e,err){self.trigger(\"RuntimeError\",err)}),xhr.send(null,options)}.apply(this,arguments);else{if(\"node\"!==srcType||\"img\"!==src.nodeName.toLowerCase())throw new x.DOMException(x.DOMException.TYPE_MISMATCH_ERR);_load.call(this,src.src,arguments[1])}}catch(ex){this.trigger(\"error\",ex.code)}}).apply(this,arguments)},downsize:function(opts){var defaults={width:this.width,height:this.height,type:this.type||\"image/jpeg\",quality:90,crop:!1,preserveHeaders:!0,resample:!1};opts=\"object\"==typeof opts?Basic.extend(defaults,opts):Basic.extend(defaults,{width:arguments[0],height:arguments[1],crop:arguments[2],preserveHeaders:arguments[3]});try{if(!this.size)throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);if(this.width>Image.MAX_RESIZE_WIDTH||this.height>Image.MAX_RESIZE_HEIGHT)throw new x.ImageError(x.ImageError.MAX_RESOLUTION_ERR);this.exec(\"Image\",\"downsize\",opts.width,opts.height,opts.crop,opts.preserveHeaders)}catch(ex){this.trigger(\"error\",ex.code)}},crop:function(width,height,preserveHeaders){this.downsize(width,height,!0,preserveHeaders)},getAsCanvas:function(){if(!Env.can(\"create_canvas\"))throw new x.RuntimeError(x.RuntimeError.NOT_SUPPORTED_ERR);return this.connectRuntime(this.ruid).exec.call(this,\"Image\",\"getAsCanvas\")},getAsBlob:function(type,quality){if(!this.size)throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);return this.exec(\"Image\",\"getAsBlob\",type||\"image/jpeg\",quality||90)},getAsDataURL:function(type,quality){if(!this.size)throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);return this.exec(\"Image\",\"getAsDataURL\",type||\"image/jpeg\",quality||90)},getAsBinaryString:function(type,quality){var dataUrl=this.getAsDataURL(type,quality);return Encode.atob(dataUrl.substring(dataUrl.indexOf(\"base64,\")+7))},embed:function(el,opts){var runtime,self=this;opts=Basic.extend({width:this.width,height:this.height,type:this.type||\"image/jpeg\",quality:90},opts||{});try{if(!(el=Dom.get(el)))throw new x.DOMException(x.DOMException.INVALID_NODE_TYPE_ERR);if(!this.size)throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);this.width>Image.MAX_RESIZE_WIDTH||(this.height,Image.MAX_RESIZE_HEIGHT);var imgCopy=new Image;return imgCopy.bind(\"Resize\",function(){(function(type,quality){var img=this;if(Env.can(\"create_canvas\")){var canvas=img.getAsCanvas();if(canvas)return el.appendChild(canvas),canvas=null,img.destroy(),void self.trigger(\"embedded\")}var dataUrl=img.getAsDataURL(type,quality);if(!dataUrl)throw new x.ImageError(x.ImageError.WRONG_FORMAT);if(Env.can(\"use_data_uri_of\",dataUrl.length))el.innerHTML='<img src=\"'+dataUrl+'\" width=\"'+img.width+'\" height=\"'+img.height+'\" />',img.destroy(),self.trigger(\"embedded\");else{var tr=new Transporter;tr.bind(\"TransportingComplete\",function(){runtime=self.connectRuntime(this.result.ruid),self.bind(\"Embedded\",function(){Basic.extend(runtime.getShimContainer().style,{top:\"0px\",left:\"0px\",width:img.width+\"px\",height:img.height+\"px\"}),runtime=null},999),runtime.exec.call(self,\"ImageView\",\"display\",this.result.uid,width,height),img.destroy()}),tr.transport(Encode.atob(dataUrl.substring(dataUrl.indexOf(\"base64,\")+7)),type,{required_caps:{display_media:!0},runtime_order:\"flash,silverlight\",container:el})}}).call(this,opts.type,opts.quality)}),imgCopy.bind(\"Load\",function(){imgCopy.downsize(opts)}),this.meta.thumb&&this.meta.thumb.width>=opts.width&&this.meta.thumb.height>=opts.height?imgCopy.load(this.meta.thumb.data):imgCopy.clone(this,!1),imgCopy}catch(ex){this.trigger(\"error\",ex.code)}},destroy:function(){this.ruid&&(this.getRuntime().exec.call(this,\"Image\",\"destroy\"),this.disconnectRuntime()),this.unbindAll()}}),this.handleEventProps(dispatches),this.bind(\"Load Resize\",function(){(function(info){info||(info=this.exec(\"Image\",\"getInfo\"));this.size=info.size,this.width=info.width,this.height=info.height,this.type=info.type,this.meta=info.meta,\"\"===this.name&&(this.name=info.name)}).call(this)},999)}return Image.MAX_RESIZE_WIDTH=8192,Image.MAX_RESIZE_HEIGHT=8192,Image.prototype=EventTarget.instance,Image}),define(\"moxie/runtime/html5/Runtime\",[\"moxie/core/utils/Basic\",\"moxie/core/Exceptions\",\"moxie/runtime/Runtime\",\"moxie/core/utils/Env\"],function(Basic,x,Runtime,Env){var type=\"html5\",extensions={};return Runtime.addConstructor(type,function(options){var div,destroy,I=this,Test=Runtime.capTest,True=Runtime.capTrue,caps=Basic.extend({access_binary:Test(window.FileReader||window.File&&window.File.getAsDataURL),access_image_binary:function(){return I.can(\"access_binary\")&&!!extensions.Image},display_media:Test(Env.can(\"create_canvas\")||Env.can(\"use_data_uri_over32kb\")),do_cors:Test(window.XMLHttpRequest&&\"withCredentials\"in new XMLHttpRequest),drag_and_drop:Test((div=document.createElement(\"div\"),(\"draggable\"in div||\"ondragstart\"in div&&\"ondrop\"in div)&&(\"IE\"!==Env.browser||Env.verComp(Env.version,9,\">\")))),filter_by_extension:Test(\"Chrome\"===Env.browser&&Env.verComp(Env.version,28,\">=\")||\"IE\"===Env.browser&&Env.verComp(Env.version,10,\">=\")||\"Safari\"===Env.browser&&Env.verComp(Env.version,7,\">=\")),return_response_headers:True,return_response_type:function(responseType){return!(\"json\"!==responseType||!window.JSON)||Env.can(\"return_response_type\",responseType)},return_status_code:True,report_upload_progress:Test(window.XMLHttpRequest&&(new XMLHttpRequest).upload),resize_image:function(){return I.can(\"access_binary\")&&Env.can(\"create_canvas\")},select_file:function(){return Env.can(\"use_fileinput\")&&window.File},select_folder:function(){return I.can(\"select_file\")&&\"Chrome\"===Env.browser&&Env.verComp(Env.version,21,\">=\")},select_multiple:function(){return I.can(\"select_file\")&&!(\"Safari\"===Env.browser&&\"Windows\"===Env.os)&&!(\"iOS\"===Env.os&&Env.verComp(Env.osVersion,\"7.0.0\",\">\")&&Env.verComp(Env.osVersion,\"8.0.0\",\"<\"))},send_binary_string:Test(window.XMLHttpRequest&&((new XMLHttpRequest).sendAsBinary||window.Uint8Array&&window.ArrayBuffer)),send_custom_headers:Test(window.XMLHttpRequest),send_multipart:function(){return!!(window.XMLHttpRequest&&(new XMLHttpRequest).upload&&window.FormData)||I.can(\"send_binary_string\")},slice_blob:Test(window.File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),stream_upload:function(){return I.can(\"slice_blob\")&&I.can(\"send_multipart\")},summon_file_dialog:function(){return I.can(\"select_file\")&&(\"Firefox\"===Env.browser&&Env.verComp(Env.version,4,\">=\")||\"Opera\"===Env.browser&&Env.verComp(Env.version,12,\">=\")||\"IE\"===Env.browser&&Env.verComp(Env.version,10,\">=\")||!!~Basic.inArray(Env.browser,[\"Chrome\",\"Safari\"]))},upload_filesize:True},arguments[2]);Runtime.call(this,options,arguments[1]||type,caps),Basic.extend(this,{init:function(){this.trigger(\"Init\")},destroy:(destroy=this.destroy,function(){destroy.call(I),destroy=I=null})}),Basic.extend(this.getShim(),extensions)}),extensions}),define(\"moxie/core/utils/Events\",[\"moxie/core/utils/Basic\"],function(Basic){var eventhash={},uid=\"moxie_\"+Basic.guid();function preventDefault(){this.returnValue=!1}function stopPropagation(){this.cancelBubble=!0}var removeEvent=function(obj,name,callback){var type;if(name=name.toLowerCase(),obj[uid]&&eventhash[obj[uid]]&&eventhash[obj[uid]][name]){for(var i=(type=eventhash[obj[uid]][name]).length-1;i>=0&&(type[i].orig!==callback&&type[i].key!==callback||(obj.removeEventListener?obj.removeEventListener(name,type[i].func,!1):obj.detachEvent&&obj.detachEvent(\"on\"+name,type[i].func),type[i].orig=null,type[i].func=null,type.splice(i,1),void 0===callback));i--);if(type.length||delete eventhash[obj[uid]][name],Basic.isEmptyObj(eventhash[obj[uid]])){delete eventhash[obj[uid]];try{delete obj[uid]}catch(e){obj[uid]=void 0}}}};return{addEvent:function(obj,name,callback,key){var func,events;name=name.toLowerCase(),obj.addEventListener?(func=callback,obj.addEventListener(name,func,!1)):obj.attachEvent&&(func=function(){var evt=window.event;evt.target||(evt.target=evt.srcElement),evt.preventDefault=preventDefault,evt.stopPropagation=stopPropagation,callback(evt)},obj.attachEvent(\"on\"+name,func)),obj[uid]||(obj[uid]=Basic.guid()),eventhash.hasOwnProperty(obj[uid])||(eventhash[obj[uid]]={}),(events=eventhash[obj[uid]]).hasOwnProperty(name)||(events[name]=[]),events[name].push({func:func,orig:callback,key:key})},removeEvent:removeEvent,removeAllEvents:function(obj,key){obj&&obj[uid]&&Basic.each(eventhash[obj[uid]],function(events,name){removeEvent(obj,name,key)})}}}),define(\"moxie/runtime/html5/file/FileInput\",[\"moxie/runtime/html5/Runtime\",\"moxie/file/File\",\"moxie/core/utils/Basic\",\"moxie/core/utils/Dom\",\"moxie/core/utils/Events\",\"moxie/core/utils/Mime\",\"moxie/core/utils/Env\"],function(extensions,File,Basic,Dom,Events,Mime,Env){return extensions.FileInput=function(){var _options;Basic.extend(this,{init:function(options){var input,shimContainer,mimes,browseButton,zIndex,top,comp=this,I=comp.getRuntime();mimes=(_options=options).accept.mimes||Mime.extList2mimes(_options.accept,I.can(\"filter_by_extension\")),(shimContainer=I.getShimContainer()).innerHTML='<input id=\"'+I.uid+'\" type=\"file\" style=\"font-size:999px;opacity:0;\"'+(_options.multiple&&I.can(\"select_multiple\")?\"multiple\":\"\")+(_options.directory&&I.can(\"select_folder\")?\"webkitdirectory directory\":\"\")+(mimes?' accept=\"'+mimes.join(\",\")+'\"':\"\")+\" />\",input=Dom.get(I.uid),Basic.extend(input.style,{position:\"absolute\",top:0,left:0,width:\"100%\",height:\"100%\"}),browseButton=Dom.get(_options.browse_button),I.can(\"summon_file_dialog\")&&(\"static\"===Dom.getStyle(browseButton,\"position\")&&(browseButton.style.position=\"relative\"),zIndex=parseInt(Dom.getStyle(browseButton,\"z-index\"),10)||1,browseButton.style.zIndex=zIndex,shimContainer.style.zIndex=zIndex-1,Events.addEvent(browseButton,\"click\",function(e){var input=Dom.get(I.uid);input&&!input.disabled&&input.click(),e.preventDefault()},comp.uid)),top=I.can(\"summon_file_dialog\")?browseButton:shimContainer,Events.addEvent(top,\"mouseover\",function(){comp.trigger(\"mouseenter\")},comp.uid),Events.addEvent(top,\"mouseout\",function(){comp.trigger(\"mouseleave\")},comp.uid),Events.addEvent(top,\"mousedown\",function(){comp.trigger(\"mousedown\")},comp.uid),Events.addEvent(Dom.get(_options.container),\"mouseup\",function(){comp.trigger(\"mouseup\")},comp.uid),input.onchange=function onChange(e){if(comp.files=[],Basic.each(this.files,function(file){var relativePath=\"\";if(_options.directory&&\".\"==file.name)return!0;file.webkitRelativePath&&(relativePath=\"/\"+file.webkitRelativePath.replace(/^\\//,\"\")),(file=new File(I.uid,file)).relativePath=relativePath,comp.files.push(file)}),\"IE\"!==Env.browser&&\"IEMobile\"!==Env.browser)this.value=\"\";else{var clone=this.cloneNode(!0);this.parentNode.replaceChild(clone,this),clone.onchange=onChange}comp.files.length&&comp.trigger(\"change\")},comp.trigger({type:\"ready\",async:!0}),shimContainer=null},disable:function(state){var input,I=this.getRuntime();(input=Dom.get(I.uid))&&(input.disabled=!!state)},destroy:function(){var I=this.getRuntime(),shim=I.getShim(),shimContainer=I.getShimContainer();Events.removeAllEvents(shimContainer,this.uid),Events.removeAllEvents(_options&&Dom.get(_options.container),this.uid),Events.removeAllEvents(_options&&Dom.get(_options.browse_button),this.uid),shimContainer&&(shimContainer.innerHTML=\"\"),shim.removeInstance(this.uid),_options=shimContainer=shim=null}})}}),define(\"moxie/runtime/html5/file/Blob\",[\"moxie/runtime/html5/Runtime\",\"moxie/file/Blob\"],function(extensions,Blob){return extensions.Blob=function(){this.slice=function(){return new Blob(this.getRuntime().uid,function(blob,start,end){var blobSlice;if(!window.File.prototype.slice)return(blobSlice=window.File.prototype.webkitSlice||window.File.prototype.mozSlice)?blobSlice.call(blob,start,end):null;try{return blob.slice(),blob.slice(start,end)}catch(e){return blob.slice(start,end-start)}}.apply(this,arguments))}}}),define(\"moxie/runtime/html5/file/FileDrop\",[\"moxie/runtime/html5/Runtime\",\"moxie/file/File\",\"moxie/core/utils/Basic\",\"moxie/core/utils/Dom\",\"moxie/core/utils/Events\",\"moxie/core/utils/Mime\"],function(extensions,File,Basic,Dom,Events,Mime){return extensions.FileDrop=function(){var _options,_ruid,_files=[],_allowedExts=[];function _hasFiles(e){if(!e.dataTransfer||!e.dataTransfer.types)return!1;var types=Basic.toArray(e.dataTransfer.types||[]);return-1!==Basic.inArray(\"Files\",types)||-1!==Basic.inArray(\"public.file-url\",types)||-1!==Basic.inArray(\"application/x-moz-file\",types)}function _addFile(file,relativePath){if(function(file){if(!_allowedExts.length)return!0;var ext=Mime.getFileExtension(file.name);return!ext||-1!==Basic.inArray(ext,_allowedExts)}(file)){var fileObj=new File(_ruid,file);fileObj.relativePath=relativePath||\"\",_files.push(fileObj)}}function _readEntries(entries,cb){var queue=[];Basic.each(entries,function(entry){queue.push(function(cbcb){!function(entry,cb){entry.isFile?entry.file(function(file){_addFile(file,entry.fullPath),cb()},function(){cb()}):entry.isDirectory?function(dirEntry,cb){var entries=[],dirReader=dirEntry.createReader();!function getEntries(cbcb){dirReader.readEntries(function(moreEntries){moreEntries.length?([].push.apply(entries,moreEntries),getEntries(cbcb)):cbcb()},cbcb)}(function(){_readEntries(entries,cb)})}(entry,cb):cb()}(entry,cbcb)})}),Basic.inSeries(queue,function(){cb()})}Basic.extend(this,{init:function(options){var dropZone,comp=this;_options=options,_ruid=comp.ruid,_allowedExts=function(accept){for(var exts=[],i=0;i<accept.length;i++)[].push.apply(exts,accept[i].extensions.split(/\\s*,\\s*/));return-1===Basic.inArray(\"*\",exts)?exts:[]}(_options.accept),dropZone=_options.container,Events.addEvent(dropZone,\"dragover\",function(e){_hasFiles(e)&&(e.preventDefault(),e.dataTransfer.dropEffect=\"copy\")},comp.uid),Events.addEvent(dropZone,\"drop\",function(e){var items,cb,entries;_hasFiles(e)&&(e.preventDefault(),_files=[],e.dataTransfer.items&&e.dataTransfer.items[0].webkitGetAsEntry?(items=e.dataTransfer.items,cb=function(){comp.files=_files,comp.trigger(\"drop\")},entries=[],Basic.each(items,function(item){var entry=item.webkitGetAsEntry();entry&&(entry.isFile?_addFile(item.getAsFile(),entry.fullPath):entries.push(entry))}),entries.length?_readEntries(entries,cb):cb()):(Basic.each(e.dataTransfer.files,function(file){_addFile(file)}),comp.files=_files,comp.trigger(\"drop\")))},comp.uid),Events.addEvent(dropZone,\"dragenter\",function(e){comp.trigger(\"dragenter\")},comp.uid),Events.addEvent(dropZone,\"dragleave\",function(e){comp.trigger(\"dragleave\")},comp.uid)},destroy:function(){Events.removeAllEvents(_options&&Dom.get(_options.container),this.uid),_ruid=_files=_allowedExts=_options=null}})}}),define(\"moxie/runtime/html5/file/FileReader\",[\"moxie/runtime/html5/Runtime\",\"moxie/core/utils/Encode\",\"moxie/core/utils/Basic\"],function(extensions,Encode,Basic){return extensions.FileReader=function(){var _fr,_convertToBinary=!1;Basic.extend(this,{read:function(op,blob){var comp=this;comp.result=\"\",(_fr=new window.FileReader).addEventListener(\"progress\",function(e){comp.trigger(e)}),_fr.addEventListener(\"load\",function(e){var str;comp.result=_convertToBinary?(str=_fr.result,Encode.atob(str.substring(str.indexOf(\"base64,\")+7))):_fr.result,comp.trigger(e)}),_fr.addEventListener(\"error\",function(e){comp.trigger(e,_fr.error)}),_fr.addEventListener(\"loadend\",function(e){_fr=null,comp.trigger(e)}),\"function\"===Basic.typeOf(_fr[op])?(_convertToBinary=!1,_fr[op](blob.getSource())):\"readAsBinaryString\"===op&&(_convertToBinary=!0,_fr.readAsDataURL(blob.getSource()))},abort:function(){_fr&&_fr.abort()},destroy:function(){_fr=null}})}}),define(\"moxie/runtime/html5/xhr/XMLHttpRequest\",[\"moxie/runtime/html5/Runtime\",\"moxie/core/utils/Basic\",\"moxie/core/utils/Mime\",\"moxie/core/utils/Url\",\"moxie/file/File\",\"moxie/file/Blob\",\"moxie/xhr/FormData\",\"moxie/core/Exceptions\",\"moxie/core/utils/Env\"],function(extensions,Basic,Mime,Url,File,Blob,FormData,x,Env){return extensions.XMLHttpRequest=function(){var _xhr,_filename,self=this;Basic.extend(this,{send:function(meta,data){var target=this,isGecko2_5_6=\"Mozilla\"===Env.browser&&Env.verComp(Env.version,4,\">=\")&&Env.verComp(Env.version,7,\"<\"),isAndroidBrowser=\"Android Browser\"===Env.browser,mustSendAsBinary=!1;if(_filename=meta.url.replace(/^.+?\\/([\\w\\-\\.]+)$/,\"$1\").toLowerCase(),(_xhr=!window.XMLHttpRequest||\"IE\"===Env.browser&&Env.verComp(Env.version,8,\"<\")?function(){for(var progIDs=[\"Msxml2.XMLHTTP.6.0\",\"Microsoft.XMLHTTP\"],i=0;i<progIDs.length;i++)try{return new ActiveXObject(progIDs[i])}catch(ex){}}():new window.XMLHttpRequest).open(meta.method,meta.url,meta.async,meta.user,meta.password),data instanceof Blob)data.isDetached()&&(mustSendAsBinary=!0),data=data.getSource();else if(data instanceof FormData){if(data.hasBlob())if(data.getBlob().isDetached())data=function(fd){var boundary=\"----moxieboundary\"+(new Date).getTime(),crlf=\"\\r\\n\",multipart=\"\";if(!this.getRuntime().can(\"send_binary_string\"))throw new x.RuntimeError(x.RuntimeError.NOT_SUPPORTED_ERR);return _xhr.setRequestHeader(\"Content-Type\",\"multipart/form-data; boundary=\"+boundary),fd.each(function(value,name){multipart+=value instanceof Blob?\"--\"+boundary+crlf+'Content-Disposition: form-data; name=\"'+name+'\"; filename=\"'+unescape(encodeURIComponent(value.name||\"blob\"))+'\"'+crlf+\"Content-Type: \"+(value.type||\"application/octet-stream\")+crlf+crlf+value.getSource()+crlf:\"--\"+boundary+crlf+'Content-Disposition: form-data; name=\"'+name+'\"'+crlf+crlf+unescape(encodeURIComponent(value))+crlf}),multipart+=\"--\"+boundary+\"--\"+crlf}.call(target,data),mustSendAsBinary=!0;else if((isGecko2_5_6||isAndroidBrowser)&&\"blob\"===Basic.typeOf(data.getBlob().getSource())&&window.FileReader)return void function(meta,data){var blob,fr,target=this;blob=data.getBlob().getSource(),(fr=new window.FileReader).onload=function(){data.append(data.getBlobName(),new Blob(null,{type:blob.type,data:fr.result})),self.send.call(target,meta,data)},fr.readAsBinaryString(blob)}.call(target,meta,data);if(data instanceof FormData){var fd=new window.FormData;data.each(function(value,name){value instanceof Blob?fd.append(name,value.getSource()):fd.append(name,value)}),data=fd}}_xhr.upload?(meta.withCredentials&&(_xhr.withCredentials=!0),_xhr.addEventListener(\"load\",function(e){target.trigger(e)}),_xhr.addEventListener(\"error\",function(e){target.trigger(e)}),_xhr.addEventListener(\"progress\",function(e){target.trigger(e)}),_xhr.upload.addEventListener(\"progress\",function(e){target.trigger({type:\"UploadProgress\",loaded:e.loaded,total:e.total})})):_xhr.onreadystatechange=function(){switch(_xhr.readyState){case 1:case 2:break;case 3:var total,loaded;try{Url.hasSameOrigin(meta.url)&&(total=_xhr.getResponseHeader(\"Content-Length\")||0),_xhr.responseText&&(loaded=_xhr.responseText.length)}catch(ex){total=loaded=0}target.trigger({type:\"progress\",lengthComputable:!!total,total:parseInt(total,10),loaded:loaded});break;case 4:_xhr.onreadystatechange=function(){},0===_xhr.status?target.trigger(\"error\"):target.trigger(\"load\")}},Basic.isEmptyObj(meta.headers)||Basic.each(meta.headers,function(value,header){_xhr.setRequestHeader(header,value)}),\"\"!==meta.responseType&&\"responseType\"in _xhr&&(\"json\"!==meta.responseType||Env.can(\"return_response_type\",\"json\")?_xhr.responseType=meta.responseType:_xhr.responseType=\"text\"),mustSendAsBinary?_xhr.sendAsBinary?_xhr.sendAsBinary(data):function(){for(var ui8a=new Uint8Array(data.length),i=0;i<data.length;i++)ui8a[i]=255&data.charCodeAt(i);_xhr.send(ui8a.buffer)}():_xhr.send(data),target.trigger(\"loadstart\")},getStatus:function(){try{if(_xhr)return _xhr.status}catch(ex){}return 0},getResponse:function(responseType){var xhr,rXML,rText,I=this.getRuntime();try{switch(responseType){case\"blob\":var file=new File(I.uid,_xhr.response),disposition=_xhr.getResponseHeader(\"Content-Disposition\");if(disposition){var match=disposition.match(/filename=([\\'\\\"'])([^\\1]+)\\1/);match&&(_filename=match[2])}return file.name=_filename,file.type||(file.type=Mime.getFileMime(_filename)),file;case\"json\":return Env.can(\"return_response_type\",\"json\")?_xhr.response:200===_xhr.status&&window.JSON?JSON.parse(_xhr.responseText):null;case\"document\":return rXML=(xhr=_xhr).responseXML,rText=xhr.responseText,\"IE\"===Env.browser&&rText&&rXML&&!rXML.documentElement&&/[^\\/]+\\/[^\\+]+\\+xml/.test(xhr.getResponseHeader(\"Content-Type\"))&&((rXML=new window.ActiveXObject(\"Microsoft.XMLDOM\")).async=!1,rXML.validateOnParse=!1,rXML.loadXML(rText)),rXML&&(\"IE\"===Env.browser&&0!==rXML.parseError||!rXML.documentElement||\"parsererror\"===rXML.documentElement.tagName)?null:rXML;default:return\"\"!==_xhr.responseText?_xhr.responseText:null}}catch(ex){return null}},getAllResponseHeaders:function(){try{return _xhr.getAllResponseHeaders()}catch(ex){}return\"\"},abort:function(){_xhr&&_xhr.abort()},destroy:function(){self=_filename=null}})}}),define(\"moxie/runtime/html5/utils/BinaryReader\",[\"moxie/core/utils/Basic\"],function(Basic){function BinaryReader(data){data instanceof ArrayBuffer?function(data){var _dv=new DataView(data);Basic.extend(this,{readByteAt:function(idx){return _dv.getUint8(idx)},writeByteAt:function(idx,value){_dv.setUint8(idx,value)},SEGMENT:function(idx,size,value){switch(arguments.length){case 2:return data.slice(idx,idx+size);case 1:return data.slice(idx);case 3:if(null===value&&(value=new ArrayBuffer),value instanceof ArrayBuffer){var arr=new Uint8Array(this.length()-size+value.byteLength);idx>0&&arr.set(new Uint8Array(data.slice(0,idx)),0),arr.set(new Uint8Array(value),idx),arr.set(new Uint8Array(data.slice(idx+size)),idx+value.byteLength),this.clear(),data=arr.buffer,_dv=new DataView(data);break}default:return data}},length:function(){return data?data.byteLength:0},clear:function(){_dv=data=null}})}.apply(this,arguments):function(data){function putstr(segment,idx,length){length=3===arguments.length?length:data.length-idx-1,data=data.substr(0,idx)+segment+data.substr(length+idx)}Basic.extend(this,{readByteAt:function(idx){return data.charCodeAt(idx)},writeByteAt:function(idx,value){putstr(String.fromCharCode(value),idx,1)},SEGMENT:function(idx,length,segment){switch(arguments.length){case 1:return data.substr(idx);case 2:return data.substr(idx,length);case 3:putstr(null!==segment?segment:\"\",idx,length);break;default:return data}},length:function(){return data?data.length:0},clear:function(){data=null}})}.apply(this,arguments)}return Basic.extend(BinaryReader.prototype,{littleEndian:!1,read:function(idx,size){var sum,mv,i;if(idx+size>this.length())throw new Error(\"You are trying to read outside the source boundaries.\");for(mv=this.littleEndian?0:-8*(size-1),i=0,sum=0;i<size;i++)sum|=this.readByteAt(idx+i)<<Math.abs(mv+8*i);return sum},write:function(idx,num,size){var mv,i;if(idx>this.length())throw new Error(\"You are trying to write outside the source boundaries.\");for(mv=this.littleEndian?0:-8*(size-1),i=0;i<size;i++)this.writeByteAt(idx+i,num>>Math.abs(mv+8*i)&255)},BYTE:function(idx){return this.read(idx,1)},SHORT:function(idx){return this.read(idx,2)},LONG:function(idx){return this.read(idx,4)},SLONG:function(idx){var num=this.read(idx,4);return num>2147483647?num-4294967296:num},CHAR:function(idx){return String.fromCharCode(this.read(idx,1))},STRING:function(idx,count){return this.asArray(\"CHAR\",idx,count).join(\"\")},asArray:function(type,idx,count){for(var values=[],i=0;i<count;i++)values[i]=this[type](idx+i);return values}}),BinaryReader}),define(\"moxie/runtime/html5/image/JPEGHeaders\",[\"moxie/runtime/html5/utils/BinaryReader\",\"moxie/core/Exceptions\"],function(BinaryReader,x){return function JPEGHeaders(data){var _br,idx,marker,headers=[],length=0;if(65496!==(_br=new BinaryReader(data)).SHORT(0))throw _br.clear(),new x.ImageError(x.ImageError.WRONG_FORMAT);for(idx=2;idx<=_br.length();)if((marker=_br.SHORT(idx))>=65488&&marker<=65495)idx+=2;else{if(65498===marker||65497===marker)break;length=_br.SHORT(idx+2)+2,marker>=65505&&marker<=65519&&headers.push({hex:marker,name:\"APP\"+(15&marker),start:idx,length:length,segment:_br.SEGMENT(idx,length)}),idx+=length}return _br.clear(),{headers:headers,restore:function(data){var max,i,br;for(br=new BinaryReader(data),idx=65504==br.SHORT(2)?4+br.SHORT(4):2,i=0,max=headers.length;i<max;i++)br.SEGMENT(idx,0,headers[i].segment),idx+=headers[i].length;return data=br.SEGMENT(),br.clear(),data},strip:function(data){var br,headers,jpegHeaders,i;for(headers=(jpegHeaders=new JPEGHeaders(data)).headers,jpegHeaders.purge(),br=new BinaryReader(data),i=headers.length;i--;)br.SEGMENT(headers[i].start,headers[i].length,\"\");return data=br.SEGMENT(),br.clear(),data},get:function(name){for(var array=[],i=0,max=headers.length;i<max;i++)headers[i].name===name.toUpperCase()&&array.push(headers[i].segment);return array},set:function(name,segment){var i,ii,max,array=[];for(\"string\"==typeof segment?array.push(segment):array=segment,i=ii=0,max=headers.length;i<max&&(headers[i].name===name.toUpperCase()&&(headers[i].segment=array[ii],headers[i].length=array[ii].length,ii++),!(ii>=array.length));i++);},purge:function(){this.headers=headers=[]}}}}),define(\"moxie/runtime/html5/image/ExifParser\",[\"moxie/core/utils/Basic\",\"moxie/runtime/html5/utils/BinaryReader\",\"moxie/core/Exceptions\"],function(Basic,BinaryReader,x){function ExifParser(data){var __super__,tags,tagDescs,offsets,idx,Tiff;if(BinaryReader.call(this,data),tags={tiff:{274:\"Orientation\",270:\"ImageDescription\",271:\"Make\",272:\"Model\",305:\"Software\",34665:\"ExifIFDPointer\",34853:\"GPSInfoIFDPointer\"},exif:{36864:\"ExifVersion\",40961:\"ColorSpace\",40962:\"PixelXDimension\",40963:\"PixelYDimension\",36867:\"DateTimeOriginal\",33434:\"ExposureTime\",33437:\"FNumber\",34855:\"ISOSpeedRatings\",37377:\"ShutterSpeedValue\",37378:\"ApertureValue\",37383:\"MeteringMode\",37384:\"LightSource\",37385:\"Flash\",37386:\"FocalLength\",41986:\"ExposureMode\",41987:\"WhiteBalance\",41990:\"SceneCaptureType\",41988:\"DigitalZoomRatio\",41992:\"Contrast\",41993:\"Saturation\",41994:\"Sharpness\"},gps:{0:\"GPSVersionID\",1:\"GPSLatitudeRef\",2:\"GPSLatitude\",3:\"GPSLongitudeRef\",4:\"GPSLongitude\"},thumb:{513:\"JPEGInterchangeFormat\",514:\"JPEGInterchangeFormatLength\"}},tagDescs={ColorSpace:{1:\"sRGB\",0:\"Uncalibrated\"},MeteringMode:{0:\"Unknown\",1:\"Average\",2:\"CenterWeightedAverage\",3:\"Spot\",4:\"MultiSpot\",5:\"Pattern\",6:\"Partial\",255:\"Other\"},LightSource:{1:\"Daylight\",2:\"Fliorescent\",3:\"Tungsten\",4:\"Flash\",9:\"Fine weather\",10:\"Cloudy weather\",11:\"Shade\",12:\"Daylight fluorescent (D 5700 - 7100K)\",13:\"Day white fluorescent (N 4600 -5400K)\",14:\"Cool white fluorescent (W 3900 - 4500K)\",15:\"White fluorescent (WW 3200 - 3700K)\",17:\"Standard light A\",18:\"Standard light B\",19:\"Standard light C\",20:\"D55\",21:\"D65\",22:\"D75\",23:\"D50\",24:\"ISO studio tungsten\",255:\"Other\"},Flash:{0:\"Flash did not fire\",1:\"Flash fired\",5:\"Strobe return light not detected\",7:\"Strobe return light detected\",9:\"Flash fired, compulsory flash mode\",13:\"Flash fired, compulsory flash mode, return light not detected\",15:\"Flash fired, compulsory flash mode, return light detected\",16:\"Flash did not fire, compulsory flash mode\",24:\"Flash did not fire, auto mode\",25:\"Flash fired, auto mode\",29:\"Flash fired, auto mode, return light not detected\",31:\"Flash fired, auto mode, return light detected\",32:\"No flash function\",65:\"Flash fired, red-eye reduction mode\",69:\"Flash fired, red-eye reduction mode, return light not detected\",71:\"Flash fired, red-eye reduction mode, return light detected\",73:\"Flash fired, compulsory flash mode, red-eye reduction mode\",77:\"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected\",79:\"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected\",89:\"Flash fired, auto mode, red-eye reduction mode\",93:\"Flash fired, auto mode, return light not detected, red-eye reduction mode\",95:\"Flash fired, auto mode, return light detected, red-eye reduction mode\"},ExposureMode:{0:\"Auto exposure\",1:\"Manual exposure\",2:\"Auto bracket\"},WhiteBalance:{0:\"Auto white balance\",1:\"Manual white balance\"},SceneCaptureType:{0:\"Standard\",1:\"Landscape\",2:\"Portrait\",3:\"Night scene\"},Contrast:{0:\"Normal\",1:\"Soft\",2:\"Hard\"},Saturation:{0:\"Normal\",1:\"Low saturation\",2:\"High saturation\"},Sharpness:{0:\"Normal\",1:\"Soft\",2:\"Hard\"},GPSLatitudeRef:{N:\"North latitude\",S:\"South latitude\"},GPSLongitudeRef:{E:\"East longitude\",W:\"West longitude\"}},idx=(offsets={tiffHeader:10}).tiffHeader,__super__={clear:this.clear},Basic.extend(this,{read:function(){try{return ExifParser.prototype.read.apply(this,arguments)}catch(ex){throw new x.ImageError(x.ImageError.INVALID_META_ERR)}},write:function(){try{return ExifParser.prototype.write.apply(this,arguments)}catch(ex){throw new x.ImageError(x.ImageError.INVALID_META_ERR)}},UNDEFINED:function(){return this.BYTE.apply(this,arguments)},RATIONAL:function(idx){return this.LONG(idx)/this.LONG(idx+4)},SRATIONAL:function(idx){return this.SLONG(idx)/this.SLONG(idx+4)},ASCII:function(idx){return this.CHAR(idx)},TIFF:function(){return Tiff||null},EXIF:function(){var Exif=null;if(offsets.exifIFD){try{Exif=extractTags.call(this,offsets.exifIFD,tags.exif)}catch(ex){return null}if(Exif.ExifVersion&&\"array\"===Basic.typeOf(Exif.ExifVersion)){for(var i=0,exifVersion=\"\";i<Exif.ExifVersion.length;i++)exifVersion+=String.fromCharCode(Exif.ExifVersion[i]);Exif.ExifVersion=exifVersion}}return Exif},GPS:function(){var GPS=null;if(offsets.gpsIFD){try{GPS=extractTags.call(this,offsets.gpsIFD,tags.gps)}catch(ex){return null}GPS.GPSVersionID&&\"array\"===Basic.typeOf(GPS.GPSVersionID)&&(GPS.GPSVersionID=GPS.GPSVersionID.join(\".\"))}return GPS},thumb:function(){if(offsets.IFD1)try{var IFD1Tags=extractTags.call(this,offsets.IFD1,tags.thumb);if(\"JPEGInterchangeFormat\"in IFD1Tags)return this.SEGMENT(offsets.tiffHeader+IFD1Tags.JPEGInterchangeFormat,IFD1Tags.JPEGInterchangeFormatLength)}catch(ex){}return null},setExif:function(tag,value){return(\"PixelXDimension\"===tag||\"PixelYDimension\"===tag)&&function(ifd,tag,value){var offset,length,tagOffset,valueOffset=0;if(\"string\"==typeof tag){var tmpTags=tags[ifd.toLowerCase()];for(var hex in tmpTags)if(tmpTags[hex]===tag){tag=hex;break}}offset=offsets[ifd.toLowerCase()+\"IFD\"],length=this.SHORT(offset);for(var i=0;i<length;i++)if(tagOffset=offset+12*i+2,this.SHORT(tagOffset)==tag){valueOffset=tagOffset+8;break}if(!valueOffset)return!1;try{this.write(valueOffset,value,4)}catch(ex){return!1}return!0}.call(this,\"exif\",tag,value)},clear:function(){__super__.clear(),data=tags=tagDescs=Tiff=offsets=__super__=null}}),65505!==this.SHORT(0)||\"EXIF\\0\"!==this.STRING(4,5).toUpperCase())throw new x.ImageError(x.ImageError.INVALID_META_ERR);if(this.littleEndian=18761==this.SHORT(idx),42!==this.SHORT(idx+=2))throw new x.ImageError(x.ImageError.INVALID_META_ERR);offsets.IFD0=offsets.tiffHeader+this.LONG(idx+=2),\"ExifIFDPointer\"in(Tiff=extractTags.call(this,offsets.IFD0,tags.tiff))&&(offsets.exifIFD=offsets.tiffHeader+Tiff.ExifIFDPointer,delete Tiff.ExifIFDPointer),\"GPSInfoIFDPointer\"in Tiff&&(offsets.gpsIFD=offsets.tiffHeader+Tiff.GPSInfoIFDPointer,delete Tiff.GPSInfoIFDPointer),Basic.isEmptyObj(Tiff)&&(Tiff=null);var IFD1Offset=this.LONG(offsets.IFD0+12*this.SHORT(offsets.IFD0)+2);function extractTags(IFD_offset,tags2extract){var length,i,tag,type,count,size,offset,value,values=[],hash={},types={1:\"BYTE\",7:\"UNDEFINED\",2:\"ASCII\",3:\"SHORT\",4:\"LONG\",5:\"RATIONAL\",9:\"SLONG\",10:\"SRATIONAL\"},sizes={BYTE:1,UNDEFINED:1,ASCII:1,SHORT:2,LONG:4,RATIONAL:8,SLONG:4,SRATIONAL:8};for(length=this.SHORT(IFD_offset),i=0;i<length;i++)if(values=[],offset=IFD_offset+2+12*i,(tag=tags2extract[this.SHORT(offset)])!==undefined){if(type=types[this.SHORT(offset+=2)],count=this.LONG(offset+=2),!(size=sizes[type]))throw new x.ImageError(x.ImageError.INVALID_META_ERR);if(offset+=4,size*count>4&&(offset=this.LONG(offset)+offsets.tiffHeader),offset+size*count>=this.length())throw new x.ImageError(x.ImageError.INVALID_META_ERR);\"ASCII\"!==type?(values=this.asArray(type,offset,count),value=1==count?values[0]:values,tagDescs.hasOwnProperty(tag)&&\"object\"!=typeof value?hash[tag]=tagDescs[tag][value]:hash[tag]=value):hash[tag]=Basic.trim(this.STRING(offset,count).replace(/\\0$/,\"\"))}return hash}IFD1Offset&&(offsets.IFD1=offsets.tiffHeader+IFD1Offset)}return ExifParser.prototype=BinaryReader.prototype,ExifParser}),define(\"moxie/runtime/html5/image/JPEG\",[\"moxie/core/utils/Basic\",\"moxie/core/Exceptions\",\"moxie/runtime/html5/image/JPEGHeaders\",\"moxie/runtime/html5/utils/BinaryReader\",\"moxie/runtime/html5/image/ExifParser\"],function(Basic,x,JPEGHeaders,BinaryReader,ExifParser){return function(data){var _br,_hm,_ep,_info;if(65496!==(_br=new BinaryReader(data)).SHORT(0))throw new x.ImageError(x.ImageError.WRONG_FORMAT);_hm=new JPEGHeaders(data);try{_ep=new ExifParser(_hm.get(\"app1\")[0])}catch(ex){}function _getDimensions(br){var marker,length,idx=0;for(br||(br=_br);idx<=br.length();){if((marker=br.SHORT(idx+=2))>=65472&&marker<=65475)return idx+=5,{height:br.SHORT(idx),width:br.SHORT(idx+=2)};length=br.SHORT(idx+=2),idx+=length-2}return null}_info=_getDimensions.call(this),Basic.extend(this,{type:\"image/jpeg\",size:_br.length(),width:_info&&_info.width||0,height:_info&&_info.height||0,setExif:function(tag,value){if(!_ep)return!1;\"object\"===Basic.typeOf(tag)?Basic.each(tag,function(value,tag){_ep.setExif(tag,value)}):_ep.setExif(tag,value),_hm.set(\"app1\",_ep.SEGMENT())},writeHeaders:function(){return arguments.length?_hm.restore(arguments[0]):_hm.restore(data)},stripHeaders:function(data){return _hm.strip(data)},purge:function(){(function(){_ep&&_hm&&_br&&(_ep.clear(),_hm.purge(),_br.clear(),_info=_hm=_ep=_br=null)}).call(this)}}),_ep&&(this.meta={tiff:_ep.TIFF(),exif:_ep.EXIF(),gps:_ep.GPS(),thumb:function(){var br,info,data=_ep.thumb();return data&&(br=new BinaryReader(data),info=_getDimensions(br),br.clear(),info)?(info.data=data,info):null}()})}}),define(\"moxie/runtime/html5/image/PNG\",[\"moxie/core/Exceptions\",\"moxie/core/utils/Basic\",\"moxie/runtime/html5/utils/BinaryReader\"],function(x,Basic,BinaryReader){return function(data){var _br,_info;function _purge(){_br&&(_br.clear(),data=_info=_br=null)}_br=new BinaryReader(data),function(){var idx=0,i=0,signature=[35152,20039,3338,6666];for(i=0;i<signature.length;i++,idx+=2)if(signature[i]!=_br.SHORT(idx))throw new x.ImageError(x.ImageError.WRONG_FORMAT)}(),_info=function(){var chunk,idx;return\"IHDR\"==(chunk=function(idx){var length,type,start,CRC;return length=_br.LONG(idx),type=_br.STRING(idx+=4,4),start=idx+=4,CRC=_br.LONG(idx+length),{length:length,type:type,start:start,CRC:CRC}}.call(this,8)).type?(idx=chunk.start,{width:_br.LONG(idx),height:_br.LONG(idx+=4)}):null}.call(this),Basic.extend(this,{type:\"image/png\",size:_br.length(),width:_info.width,height:_info.height,purge:function(){_purge.call(this)}}),_purge.call(this)}}),define(\"moxie/runtime/html5/image/ImageInfo\",[\"moxie/core/utils/Basic\",\"moxie/core/Exceptions\",\"moxie/runtime/html5/image/JPEG\",\"moxie/runtime/html5/image/PNG\"],function(Basic,x,JPEG,PNG){return function(data){var _img,_cs=[JPEG,PNG];_img=function(){for(var i=0;i<_cs.length;i++)try{return new _cs[i](data)}catch(ex){}throw new x.ImageError(x.ImageError.WRONG_FORMAT)}(),Basic.extend(this,{type:\"\",size:0,width:0,height:0,setExif:function(){},writeHeaders:function(data){return data},stripHeaders:function(data){return data},purge:function(){data=null}}),Basic.extend(this,_img),this.purge=function(){_img.purge(),_img=null}}}),define(\"moxie/runtime/html5/image/MegaPixel\",[],function(){function detectSubsampling(img){var iw=img.naturalWidth;if(iw*img.naturalHeight>1048576){var canvas=document.createElement(\"canvas\");canvas.width=canvas.height=1;var ctx=canvas.getContext(\"2d\");return ctx.drawImage(img,1-iw,0),0===ctx.getImageData(0,0,1,1).data[3]}return!1}return{isSubsampled:detectSubsampling,renderTo:function(img,canvas,options){var iw=img.naturalWidth,ih=img.naturalHeight,width=options.width,height=options.height,x=options.x||0,y=options.y||0,ctx=canvas.getContext(\"2d\");detectSubsampling(img)&&(iw/=2,ih/=2);var d=1024,tmpCanvas=document.createElement(\"canvas\");tmpCanvas.width=tmpCanvas.height=d;for(var tmpCtx=tmpCanvas.getContext(\"2d\"),vertSquashRatio=function(img,iw,ih){var canvas=document.createElement(\"canvas\");canvas.width=1,canvas.height=ih;var ctx=canvas.getContext(\"2d\");ctx.drawImage(img,0,0);for(var data=ctx.getImageData(0,0,1,ih).data,sy=0,ey=ih,py=ih;py>sy;){var alpha=data[4*(py-1)+3];0===alpha?ey=py:sy=py,py=ey+sy>>1}canvas=null;var ratio=py/ih;return 0===ratio?1:ratio}(img,0,ih),sy=0;sy<ih;){for(var sh=sy+d>ih?ih-sy:d,sx=0;sx<iw;){var sw=sx+d>iw?iw-sx:d;tmpCtx.clearRect(0,0,d,d),tmpCtx.drawImage(img,-sx,-sy);var dx=sx*width/iw+x<<0,dw=Math.ceil(sw*width/iw),dy=sy*height/ih/vertSquashRatio+y<<0,dh=Math.ceil(sh*height/ih/vertSquashRatio);ctx.drawImage(tmpCanvas,0,0,sw,sh,dx,dy,dw,dh),sx+=d}sy+=d}tmpCanvas=tmpCtx=null}}}),define(\"moxie/runtime/html5/image/Image\",[\"moxie/runtime/html5/Runtime\",\"moxie/core/utils/Basic\",\"moxie/core/Exceptions\",\"moxie/core/utils/Encode\",\"moxie/file/Blob\",\"moxie/file/File\",\"moxie/runtime/html5/image/ImageInfo\",\"moxie/runtime/html5/image/MegaPixel\",\"moxie/core/utils/Mime\",\"moxie/core/utils/Env\"],function(extensions,Basic,x,Encode,Blob,File,ImageInfo,MegaPixel,Mime,Env){return extensions.Image=function(){var _img,_imgInfo,_canvas,_binStr,_blob,me=this,_modified=!1,_preserveHeaders=!0;function _getImg(){if(!_canvas&&!_img)throw new x.ImageError(x.DOMException.INVALID_STATE_ERR);return _canvas||_img}function _toBinary(str){return Encode.atob(str.substring(str.indexOf(\"base64,\")+7))}function _preload(str){var comp=this;(_img=new Image).onerror=function(){_purge.call(this),comp.trigger(\"error\",x.ImageError.WRONG_FORMAT)},_img.onload=function(){comp.trigger(\"load\")},_img.src=\"data:\"==str.substr(0,5)?str:function(str,type){return\"data:\"+(type||\"\")+\";base64,\"+Encode.btoa(str)}(str,_blob.type)}function _downsize(width,height,crop,preserveHeaders){var scale,img,destWidth,destHeight,orientation,x=0,y=0;if(_preserveHeaders=preserveHeaders,orientation=this.meta&&this.meta.tiff&&this.meta.tiff.Orientation||1,-1!==Basic.inArray(orientation,[5,6,7,8])){var tmp=width;width=height,height=tmp}img=_getImg(),crop?(width=Math.min(width,img.width),height=Math.min(height,img.height),scale=Math.max(width/img.width,height/img.height)):scale=Math.min(width/img.width,height/img.height),scale>1&&!crop&&preserveHeaders?this.trigger(\"Resize\"):(_canvas||(_canvas=document.createElement(\"canvas\")),destWidth=Math.round(img.width*scale),destHeight=Math.round(img.height*scale),crop?(_canvas.width=width,_canvas.height=height,destWidth>width&&(x=Math.round((destWidth-width)/2)),destHeight>height&&(y=Math.round((destHeight-height)/2))):(_canvas.width=destWidth,_canvas.height=destHeight),_preserveHeaders||function(width,height,orientation){switch(orientation){case 5:case 6:case 7:case 8:_canvas.width=height,_canvas.height=width;break;default:_canvas.width=width,_canvas.height=height}var ctx=_canvas.getContext(\"2d\");switch(orientation){case 2:ctx.translate(width,0),ctx.scale(-1,1);break;case 3:ctx.translate(width,height),ctx.rotate(Math.PI);break;case 4:ctx.translate(0,height),ctx.scale(1,-1);break;case 5:ctx.rotate(.5*Math.PI),ctx.scale(1,-1);break;case 6:ctx.rotate(.5*Math.PI),ctx.translate(0,-height);break;case 7:ctx.rotate(.5*Math.PI),ctx.translate(width,-height),ctx.scale(-1,1);break;case 8:ctx.rotate(-.5*Math.PI),ctx.translate(-width,0)}}(_canvas.width,_canvas.height,orientation),function(img,canvas,x,y,w,h){if(\"iOS\"===Env.OS)MegaPixel.renderTo(img,canvas,{width:w,height:h,x:x,y:y});else{var ctx=canvas.getContext(\"2d\");ctx.drawImage(img,x,y,w,h)}}.call(this,img,_canvas,-x,-y,destWidth,destHeight),this.width=_canvas.width,this.height=_canvas.height,_modified=!0,this.trigger(\"Resize\"))}function _purge(){_imgInfo&&(_imgInfo.purge(),_imgInfo=null),_binStr=_img=_canvas=_blob=null,_modified=!1}Basic.extend(this,{loadFromBlob:function(blob){var comp=this,I=comp.getRuntime(),asBinary=!(arguments.length>1)||arguments[1];if(!I.can(\"access_binary\"))throw new x.RuntimeError(x.RuntimeError.NOT_SUPPORTED_ERR);if(_blob=blob,blob.isDetached())return _binStr=blob.getSource(),void _preload.call(this,_binStr);(function(file,callback){var fr,comp=this;if(!window.FileReader)return callback(file.getAsDataURL());(fr=new FileReader).onload=function(){callback(this.result)},fr.onerror=function(){comp.trigger(\"error\",x.ImageError.WRONG_FORMAT)},fr.readAsDataURL(file)}).call(this,blob.getSource(),function(dataUrl){asBinary&&(_binStr=_toBinary(dataUrl)),_preload.call(comp,dataUrl)})},loadFromImage:function(img,exact){this.meta=img.meta,_blob=new File(null,{name:img.name,size:img.size,type:img.type}),_preload.call(this,exact?_binStr=img.getAsBinaryString():img.getAsDataURL())},getInfo:function(){var info,I=this.getRuntime();return!_imgInfo&&_binStr&&I.can(\"access_image_binary\")&&(_imgInfo=new ImageInfo(_binStr)),!(info={width:_getImg().width||0,height:_getImg().height||0,type:_blob.type||Mime.getFileMime(_blob.name),size:_binStr&&_binStr.length||_blob.size||0,name:_blob.name||\"\",meta:_imgInfo&&_imgInfo.meta||this.meta||{}}).meta||!info.meta.thumb||info.meta.thumb.data instanceof Blob||(info.meta.thumb.data=new Blob(null,{type:\"image/jpeg\",data:info.meta.thumb.data})),info},downsize:function(){_downsize.apply(this,arguments)},getAsCanvas:function(){return _canvas&&(_canvas.id=this.uid+\"_canvas\"),_canvas},getAsBlob:function(type,quality){return type!==this.type&&_downsize.call(this,this.width,this.height,!1),new File(null,{name:_blob.name||\"\",type:type,data:me.getAsBinaryString.call(this,type,quality)})},getAsDataURL:function(type){var quality=arguments[1]||90;if(!_modified)return _img.src;if(\"image/jpeg\"!==type)return _canvas.toDataURL(\"image/png\");try{return _canvas.toDataURL(\"image/jpeg\",quality/100)}catch(ex){return _canvas.toDataURL(\"image/jpeg\")}},getAsBinaryString:function(type,quality){if(!_modified)return _binStr||(_binStr=_toBinary(me.getAsDataURL(type,quality))),_binStr;if(\"image/jpeg\"!==type)_binStr=_toBinary(me.getAsDataURL(type,quality));else{var dataUrl;quality||(quality=90);try{dataUrl=_canvas.toDataURL(\"image/jpeg\",quality/100)}catch(ex){dataUrl=_canvas.toDataURL(\"image/jpeg\")}_binStr=_toBinary(dataUrl),_imgInfo&&(_binStr=_imgInfo.stripHeaders(_binStr),_preserveHeaders&&(_imgInfo.meta&&_imgInfo.meta.exif&&_imgInfo.setExif({PixelXDimension:this.width,PixelYDimension:this.height}),_binStr=_imgInfo.writeHeaders(_binStr)),_imgInfo.purge(),_imgInfo=null)}return _modified=!1,_binStr},destroy:function(){me=null,_purge.call(this),this.getRuntime().getShim().removeInstance(this.uid)}})}}),define(\"moxie/runtime/flash/Runtime\",[\"moxie/core/utils/Basic\",\"moxie/core/utils/Env\",\"moxie/core/utils/Dom\",\"moxie/core/Exceptions\",\"moxie/runtime/Runtime\"],function(Basic,Env,Dom,x,Runtime){var type=\"flash\",extensions={};function removeSWF(id){var obj=Dom.get(id);obj&&\"OBJECT\"==obj.nodeName&&(\"IE\"===Env.browser?(obj.style.display=\"none\",function onInit(){4==obj.readyState?function(id){var obj=Dom.get(id);if(obj){for(var i in obj)\"function\"==typeof obj[i]&&(obj[i]=null);obj.parentNode.removeChild(obj)}}(id):setTimeout(onInit,10)}()):obj.parentNode.removeChild(obj))}return Runtime.addConstructor(type,function(options){var initTimer,destroy,I=this;options=Basic.extend({swf_url:Env.swf_url},options),Runtime.call(this,options,type,{access_binary:function(value){return value&&\"browser\"===I.mode},access_image_binary:function(value){return value&&\"browser\"===I.mode},display_media:Runtime.capTrue,do_cors:Runtime.capTrue,drag_and_drop:!1,report_upload_progress:function(){return\"client\"===I.mode},resize_image:Runtime.capTrue,return_response_headers:!1,return_response_type:function(responseType){return!(\"json\"!==responseType||!window.JSON)||!Basic.arrayDiff(responseType,[\"\",\"text\",\"document\"])||\"browser\"===I.mode},return_status_code:function(code){return\"browser\"===I.mode||!Basic.arrayDiff(code,[200,404])},select_file:Runtime.capTrue,select_multiple:Runtime.capTrue,send_binary_string:function(value){return value&&\"browser\"===I.mode},send_browser_cookies:function(value){return value&&\"browser\"===I.mode},send_custom_headers:function(value){return value&&\"browser\"===I.mode},send_multipart:Runtime.capTrue,slice_blob:function(value){return value&&\"browser\"===I.mode},stream_upload:function(value){return value&&\"browser\"===I.mode},summon_file_dialog:!1,upload_filesize:function(size){return Basic.parseSizeStr(size)<=2097152||\"client\"===I.mode},use_http_method:function(methods){return!Basic.arrayDiff(methods,[\"GET\",\"POST\"])}},{access_binary:function(value){return value?\"browser\":\"client\"},access_image_binary:function(value){return value?\"browser\":\"client\"},report_upload_progress:function(value){return value?\"browser\":\"client\"},return_response_type:function(responseType){return Basic.arrayDiff(responseType,[\"\",\"text\",\"json\",\"document\"])?\"browser\":[\"client\",\"browser\"]},return_status_code:function(code){return Basic.arrayDiff(code,[200,404])?\"browser\":[\"client\",\"browser\"]},send_binary_string:function(value){return value?\"browser\":\"client\"},send_browser_cookies:function(value){return value?\"browser\":\"client\"},send_custom_headers:function(value){return value?\"browser\":\"client\"},stream_upload:function(value){return value?\"client\":\"browser\"},upload_filesize:function(size){return Basic.parseSizeStr(size)>=2097152?\"client\":\"browser\"}},\"client\"),function(){var version;try{version=(version=navigator.plugins[\"Shockwave Flash\"]).description}catch(e1){try{version=new ActiveXObject(\"ShockwaveFlash.ShockwaveFlash\").GetVariable(\"$version\")}catch(e2){version=\"0.0\"}}return version=version.match(/\\d+/g),parseFloat(version[0]+\".\"+version[1])}()<10&&(MXI_DEBUG&&Env.debug.runtime&&Env.log(\"\\tFlash didn't meet minimal version requirement (10).\"),this.mode=!1),Basic.extend(this,{getShim:function(){return Dom.get(this.uid)},shimExec:function(component,action){var args=[].slice.call(arguments,2);return I.getShim().exec(this.uid,component,action,args)},init:function(){var html,el,container;container=this.getShimContainer(),Basic.extend(container.style,{position:\"absolute\",top:\"-8px\",left:\"-8px\",width:\"9px\",height:\"9px\",overflow:\"hidden\"}),html='<object id=\"'+this.uid+'\" type=\"application/x-shockwave-flash\" data=\"'+options.swf_url+'\" ',\"IE\"===Env.browser&&(html+='classid=\"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000\" '),html+='width=\"100%\" height=\"100%\" style=\"outline:0\"><param name=\"movie\" value=\"'+options.swf_url+'\" /><param name=\"flashvars\" value=\"uid='+escape(this.uid)+\"&target=\"+Env.global_event_dispatcher+'\" /><param name=\"wmode\" value=\"transparent\" /><param name=\"allowscriptaccess\" value=\"always\" /></object>',\"IE\"===Env.browser?(el=document.createElement(\"div\"),container.appendChild(el),el.outerHTML=html,el=container=null):container.innerHTML=html,initTimer=setTimeout(function(){I&&!I.initialized&&(I.trigger(\"Error\",new x.RuntimeError(x.RuntimeError.NOT_INIT_ERR)),MXI_DEBUG&&Env.debug.runtime&&Env.log(\"\\tFlash failed to initialize within a specified period of time (typically 5s).\"))},5e3)},destroy:(destroy=this.destroy,function(){removeSWF(I.uid),destroy.call(I),clearTimeout(initTimer),options=initTimer=destroy=I=null})},extensions)}),extensions}),define(\"moxie/runtime/flash/file/FileInput\",[\"moxie/runtime/flash/Runtime\",\"moxie/file/File\",\"moxie/core/utils/Basic\"],function(extensions,File,Basic){var FileInput={init:function(options){var comp=this,I=this.getRuntime();this.bind(\"Change\",function(){var files=I.shimExec.call(comp,\"FileInput\",\"getFiles\");comp.files=[],Basic.each(files,function(file){comp.files.push(new File(I.uid,file))})},999),this.getRuntime().shimExec.call(this,\"FileInput\",\"init\",{name:options.name,accept:options.accept,multiple:options.multiple}),this.trigger(\"ready\")}};return extensions.FileInput=FileInput}),define(\"moxie/runtime/flash/file/Blob\",[\"moxie/runtime/flash/Runtime\",\"moxie/file/Blob\"],function(extensions,Blob){var FlashBlob={slice:function(blob,start,end,type){var self=this.getRuntime();return start<0?start=Math.max(blob.size+start,0):start>0&&(start=Math.min(start,blob.size)),end<0?end=Math.max(blob.size+end,0):end>0&&(end=Math.min(end,blob.size)),(blob=self.shimExec.call(this,\"Blob\",\"slice\",start,end,type||\"\"))&&(blob=new Blob(self.uid,blob)),blob}};return extensions.Blob=FlashBlob}),define(\"moxie/runtime/flash/file/FileReader\",[\"moxie/runtime/flash/Runtime\",\"moxie/core/utils/Encode\"],function(extensions,Encode){var FileReader={read:function(op,blob){var comp=this;return comp.result=\"\",\"readAsDataURL\"===op&&(comp.result=\"data:\"+(blob.type||\"\")+\";base64,\"),comp.bind(\"Progress\",function(e,data){data&&(comp.result+=function(data,op){switch(op){case\"readAsText\":return Encode.atob(data,\"utf8\");case\"readAsBinaryString\":return Encode.atob(data);case\"readAsDataURL\":return data}return null}(data,op))},999),comp.getRuntime().shimExec.call(this,\"FileReader\",\"readAsBase64\",blob.uid)}};return extensions.FileReader=FileReader}),define(\"moxie/runtime/flash/file/FileReaderSync\",[\"moxie/runtime/flash/Runtime\",\"moxie/core/utils/Encode\"],function(extensions,Encode){var FileReaderSync={read:function(op,blob){var result;return(result=this.getRuntime().shimExec.call(this,\"FileReaderSync\",\"readAsBase64\",blob.uid))?(\"readAsDataURL\"===op&&(result=\"data:\"+(blob.type||\"\")+\";base64,\"+result),function(data,op){switch(op){case\"readAsText\":return Encode.atob(data,\"utf8\");case\"readAsBinaryString\":return Encode.atob(data);case\"readAsDataURL\":return data}return null}(result,op,blob.type)):null}};return extensions.FileReaderSync=FileReaderSync}),define(\"moxie/runtime/flash/xhr/XMLHttpRequest\",[\"moxie/runtime/flash/Runtime\",\"moxie/core/utils/Basic\",\"moxie/file/Blob\",\"moxie/file/File\",\"moxie/file/FileReaderSync\",\"moxie/xhr/FormData\",\"moxie/runtime/Transporter\"],function(extensions,Basic,Blob,File,FileReaderSync,FormData,Transporter){var XMLHttpRequest={send:function(meta,data){var blobField,target=this,self=target.getRuntime();function send(){meta.transport=self.mode,self.shimExec.call(target,\"XMLHttpRequest\",\"send\",meta,data)}function appendBlob(name,blob){self.shimExec.call(target,\"XMLHttpRequest\",\"appendBlob\",name,blob.uid),data=null,send()}function attachBlob(blob,cb){var tr=new Transporter;tr.bind(\"TransportingComplete\",function(){cb(this.result)}),tr.transport(blob.getSource(),blob.type,{ruid:self.uid})}if(Basic.isEmptyObj(meta.headers)||Basic.each(meta.headers,function(value,header){self.shimExec.call(target,\"XMLHttpRequest\",\"setRequestHeader\",header,value.toString())}),data instanceof FormData)if(data.each(function(value,name){value instanceof Blob?blobField=name:self.shimExec.call(target,\"XMLHttpRequest\",\"append\",name,value)}),data.hasBlob()){var blob=data.getBlob();blob.isDetached()?attachBlob(blob,function(attachedBlob){blob.destroy(),appendBlob(blobField,attachedBlob)}):appendBlob(blobField,blob)}else data=null,send();else data instanceof Blob?data.isDetached()?attachBlob(data,function(attachedBlob){data.destroy(),data=attachedBlob.uid,send()}):(data=data.uid,send()):send()},getResponse:function(responseType){var frs,blob,self=this.getRuntime();if(blob=self.shimExec.call(this,\"XMLHttpRequest\",\"getResponseAsBlob\")){if(blob=new File(self.uid,blob),\"blob\"===responseType)return blob;try{if(frs=new FileReaderSync,~Basic.inArray(responseType,[\"\",\"text\"]))return frs.readAsText(blob);if(\"json\"===responseType&&window.JSON)return JSON.parse(frs.readAsText(blob))}finally{blob.destroy()}}return null},abort:function(upload_complete_flag){this.getRuntime().shimExec.call(this,\"XMLHttpRequest\",\"abort\"),this.dispatchEvent(\"readystatechange\"),this.dispatchEvent(\"abort\")}};return extensions.XMLHttpRequest=XMLHttpRequest}),define(\"moxie/runtime/flash/runtime/Transporter\",[\"moxie/runtime/flash/Runtime\",\"moxie/file/Blob\"],function(extensions,Blob){var Transporter={getAsBlob:function(type){var self=this.getRuntime(),blob=self.shimExec.call(this,\"Transporter\",\"getAsBlob\",type);return blob?new Blob(self.uid,blob):null}};return extensions.Transporter=Transporter}),define(\"moxie/runtime/flash/image/Image\",[\"moxie/runtime/flash/Runtime\",\"moxie/core/utils/Basic\",\"moxie/runtime/Transporter\",\"moxie/file/Blob\",\"moxie/file/FileReaderSync\"],function(extensions,Basic,Transporter,Blob,FileReaderSync){var Image={loadFromBlob:function(blob){var comp=this,self=comp.getRuntime();function exec(srcBlob){self.shimExec.call(comp,\"Image\",\"loadFromBlob\",srcBlob.uid),comp=self=null}if(blob.isDetached()){var tr=new Transporter;tr.bind(\"TransportingComplete\",function(){exec(tr.result.getSource())}),tr.transport(blob.getSource(),blob.type,{ruid:self.uid})}else exec(blob.getSource())},loadFromImage:function(img){return this.getRuntime().shimExec.call(this,\"Image\",\"loadFromImage\",img.uid)},getInfo:function(){var self=this.getRuntime(),info=self.shimExec.call(this,\"Image\",\"getInfo\");return!info.meta||!info.meta.thumb||info.meta.thumb.data instanceof Blob||(info.meta.thumb.data=new Blob(self.uid,info.meta.thumb.data)),info},getAsBlob:function(type,quality){var self=this.getRuntime(),blob=self.shimExec.call(this,\"Image\",\"getAsBlob\",type,quality);return blob?new Blob(self.uid,blob):null},getAsDataURL:function(){var blob=this.getRuntime().Image.getAsBlob.apply(this,arguments);return blob?(new FileReaderSync).readAsDataURL(blob):null}};return extensions.Image=Image}),define(\"moxie/runtime/silverlight/Runtime\",[\"moxie/core/utils/Basic\",\"moxie/core/utils/Env\",\"moxie/core/utils/Dom\",\"moxie/core/Exceptions\",\"moxie/runtime/Runtime\"],function(Basic,Env,Dom,x,Runtime){var type=\"silverlight\",extensions={};return Runtime.addConstructor(type,function(options){var initTimer,destroy,I=this;options=Basic.extend({xap_url:Env.xap_url},options),Runtime.call(this,options,type,{access_binary:Runtime.capTrue,access_image_binary:Runtime.capTrue,display_media:Runtime.capTrue,do_cors:Runtime.capTrue,drag_and_drop:!1,report_upload_progress:Runtime.capTrue,resize_image:Runtime.capTrue,return_response_headers:function(value){return value&&\"client\"===I.mode},return_response_type:function(responseType){return\"json\"!==responseType||!!window.JSON},return_status_code:function(code){return\"client\"===I.mode||!Basic.arrayDiff(code,[200,404])},select_file:Runtime.capTrue,select_multiple:Runtime.capTrue,send_binary_string:Runtime.capTrue,send_browser_cookies:function(value){return value&&\"browser\"===I.mode},send_custom_headers:function(value){return value&&\"client\"===I.mode},send_multipart:Runtime.capTrue,slice_blob:Runtime.capTrue,stream_upload:!0,summon_file_dialog:!1,upload_filesize:Runtime.capTrue,use_http_method:function(methods){return\"client\"===I.mode||!Basic.arrayDiff(methods,[\"GET\",\"POST\"])}},{return_response_headers:function(value){return value?\"client\":\"browser\"},return_status_code:function(code){return Basic.arrayDiff(code,[200,404])?\"client\":[\"client\",\"browser\"]},send_browser_cookies:function(value){return value?\"browser\":\"client\"},send_custom_headers:function(value){return value?\"client\":\"browser\"},use_http_method:function(methods){return Basic.arrayDiff(methods,[\"GET\",\"POST\"])?\"client\":[\"client\",\"browser\"]}}),function(version){var actualVer,actualVerArray,reqVerArray,requiredVersionPart,actualVersionPart,isVersionSupported=!1,index=0;try{try{new ActiveXObject(\"AgControl.AgControl\").IsVersionSupported(version)&&(isVersionSupported=!0)}catch(e){var plugin=navigator.plugins[\"Silverlight Plug-In\"];if(plugin){for(\"1.0.30226.2\"===(actualVer=plugin.description)&&(actualVer=\"2.0.30226.2\"),actualVerArray=actualVer.split(\".\");actualVerArray.length>3;)actualVerArray.pop();for(;actualVerArray.length<4;)actualVerArray.push(0);for(reqVerArray=version.split(\".\");reqVerArray.length>4;)reqVerArray.pop();for(;requiredVersionPart=parseInt(reqVerArray[index],10),actualVersionPart=parseInt(actualVerArray[index],10),++index<reqVerArray.length&&requiredVersionPart===actualVersionPart;);requiredVersionPart<=actualVersionPart&&!isNaN(requiredVersionPart)&&(isVersionSupported=!0)}}}catch(e2){isVersionSupported=!1}return isVersionSupported}(\"2.0.31005.0\")&&\"Opera\"!==Env.browser||(MXI_DEBUG&&Env.debug.runtime&&Env.log(\"\\tSilverlight is not installed or minimal version (2.0.31005.0) requirement not met (not likely).\"),this.mode=!1),Basic.extend(this,{getShim:function(){return Dom.get(this.uid).content.Moxie},shimExec:function(component,action){var args=[].slice.call(arguments,2);return I.getShim().exec(this.uid,component,action,args)},init:function(){this.getShimContainer().innerHTML='<object id=\"'+this.uid+'\" data=\"data:application/x-silverlight,\" type=\"application/x-silverlight-2\" width=\"100%\" height=\"100%\" style=\"outline:none;\"><param name=\"source\" value=\"'+options.xap_url+'\"/><param name=\"background\" value=\"Transparent\"/><param name=\"windowless\" value=\"true\"/><param name=\"enablehtmlaccess\" value=\"true\"/><param name=\"initParams\" value=\"uid='+this.uid+\",target=\"+Env.global_event_dispatcher+'\"/></object>',initTimer=setTimeout(function(){I&&!I.initialized&&(I.trigger(\"Error\",new x.RuntimeError(x.RuntimeError.NOT_INIT_ERR)),MXI_DEBUG&&Env.debug.runtime&&Env.log(\"Silverlight failed to initialize within a specified period of time (5-10s).\"))},\"Windows\"!==Env.OS?1e4:5e3)},destroy:(destroy=this.destroy,function(){destroy.call(I),clearTimeout(initTimer),options=initTimer=destroy=I=null})},extensions)}),extensions}),define(\"moxie/runtime/silverlight/file/FileInput\",[\"moxie/runtime/silverlight/Runtime\",\"moxie/file/File\",\"moxie/core/utils/Basic\"],function(extensions,File,Basic){var FileInput={init:function(options){var comp=this,I=this.getRuntime();this.bind(\"Change\",function(){var files=I.shimExec.call(comp,\"FileInput\",\"getFiles\");comp.files=[],Basic.each(files,function(file){comp.files.push(new File(I.uid,file))})},999),this.getRuntime().shimExec.call(this,\"FileInput\",\"init\",function(accept){for(var filter=\"\",i=0;i<accept.length;i++)filter+=(\"\"!==filter?\"|\":\"\")+accept[i].title+\" | *.\"+accept[i].extensions.replace(/,/g,\";*.\");return filter}(options.accept),options.name,options.multiple),this.trigger(\"ready\")}};return extensions.FileInput=FileInput}),define(\"moxie/runtime/silverlight/file/Blob\",[\"moxie/runtime/silverlight/Runtime\",\"moxie/core/utils/Basic\",\"moxie/runtime/flash/file/Blob\"],function(extensions,Basic,Blob){return extensions.Blob=Basic.extend({},Blob)}),define(\"moxie/runtime/silverlight/file/FileDrop\",[\"moxie/runtime/silverlight/Runtime\",\"moxie/core/utils/Dom\",\"moxie/core/utils/Events\"],function(extensions,Dom,Events){var FileDrop={init:function(){var dropZone,self=this.getRuntime();return dropZone=self.getShimContainer(),Events.addEvent(dropZone,\"dragover\",function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect=\"copy\"},this.uid),Events.addEvent(dropZone,\"dragenter\",function(e){e.preventDefault(),Dom.get(self.uid).dragEnter(e)&&e.stopPropagation()},this.uid),Events.addEvent(dropZone,\"drop\",function(e){e.preventDefault(),Dom.get(self.uid).dragDrop(e)&&e.stopPropagation()},this.uid),self.shimExec.call(this,\"FileDrop\",\"init\")}};return extensions.FileDrop=FileDrop}),define(\"moxie/runtime/silverlight/file/FileReader\",[\"moxie/runtime/silverlight/Runtime\",\"moxie/core/utils/Basic\",\"moxie/runtime/flash/file/FileReader\"],function(extensions,Basic,FileReader){return extensions.FileReader=Basic.extend({},FileReader)}),define(\"moxie/runtime/silverlight/file/FileReaderSync\",[\"moxie/runtime/silverlight/Runtime\",\"moxie/core/utils/Basic\",\"moxie/runtime/flash/file/FileReaderSync\"],function(extensions,Basic,FileReaderSync){return extensions.FileReaderSync=Basic.extend({},FileReaderSync)}),define(\"moxie/runtime/silverlight/xhr/XMLHttpRequest\",[\"moxie/runtime/silverlight/Runtime\",\"moxie/core/utils/Basic\",\"moxie/runtime/flash/xhr/XMLHttpRequest\"],function(extensions,Basic,XMLHttpRequest){return extensions.XMLHttpRequest=Basic.extend({},XMLHttpRequest)}),define(\"moxie/runtime/silverlight/runtime/Transporter\",[\"moxie/runtime/silverlight/Runtime\",\"moxie/core/utils/Basic\",\"moxie/runtime/flash/runtime/Transporter\"],function(extensions,Basic,Transporter){return extensions.Transporter=Basic.extend({},Transporter)}),define(\"moxie/runtime/silverlight/image/Image\",[\"moxie/runtime/silverlight/Runtime\",\"moxie/core/utils/Basic\",\"moxie/file/Blob\",\"moxie/runtime/flash/image/Image\"],function(extensions,Basic,Blob,Image){return extensions.Image=Basic.extend({},Image,{getInfo:function(){var self=this.getRuntime(),info={meta:{}},rawInfo=self.shimExec.call(this,\"Image\",\"getInfo\");return rawInfo.meta&&(Basic.each([\"tiff\",\"exif\",\"gps\",\"thumb\"],function(grp){var tag,i,length,value,meta=rawInfo.meta[grp];if(meta&&meta.keys)for(info.meta[grp]={},i=0,length=meta.keys.length;i<length;i++)(value=meta[tag=meta.keys[i]])&&(/^(\\d|[1-9]\\d+)$/.test(value)?value=parseInt(value,10):/^\\d*\\.\\d+$/.test(value)&&(value=parseFloat(value)),info.meta[grp][tag]=value)}),!info.meta||!info.meta.thumb||info.meta.thumb.data instanceof Blob||(info.meta.thumb.data=new Blob(self.uid,info.meta.thumb.data))),info.width=parseInt(rawInfo.width,10),info.height=parseInt(rawInfo.height,10),info.size=parseInt(rawInfo.size,10),info.type=rawInfo.type,info.name=rawInfo.name,info}})}),define(\"moxie/runtime/html4/Runtime\",[\"moxie/core/utils/Basic\",\"moxie/core/Exceptions\",\"moxie/runtime/Runtime\",\"moxie/core/utils/Env\"],function(Basic,x,Runtime,Env){var type=\"html4\",extensions={};return Runtime.addConstructor(type,function(options){var destroy,I=this,Test=Runtime.capTest,True=Runtime.capTrue;Runtime.call(this,options,type,{access_binary:Test(window.FileReader||window.File&&File.getAsDataURL),access_image_binary:!1,display_media:Test(extensions.Image&&(Env.can(\"create_canvas\")||Env.can(\"use_data_uri_over32kb\"))),do_cors:!1,drag_and_drop:!1,filter_by_extension:Test(\"Chrome\"===Env.browser&&Env.verComp(Env.version,28,\">=\")||\"IE\"===Env.browser&&Env.verComp(Env.version,10,\">=\")||\"Safari\"===Env.browser&&Env.verComp(Env.version,7,\">=\")),resize_image:function(){return extensions.Image&&I.can(\"access_binary\")&&Env.can(\"create_canvas\")},report_upload_progress:!1,return_response_headers:!1,return_response_type:function(responseType){return!(\"json\"!==responseType||!window.JSON)||!!~Basic.inArray(responseType,[\"text\",\"document\",\"\"])},return_status_code:function(code){return!Basic.arrayDiff(code,[200,404])},select_file:function(){return Env.can(\"use_fileinput\")},select_multiple:!1,send_binary_string:!1,send_custom_headers:!1,send_multipart:!0,slice_blob:!1,stream_upload:function(){return I.can(\"select_file\")},summon_file_dialog:function(){return I.can(\"select_file\")&&(\"Firefox\"===Env.browser&&Env.verComp(Env.version,4,\">=\")||\"Opera\"===Env.browser&&Env.verComp(Env.version,12,\">=\")||\"IE\"===Env.browser&&Env.verComp(Env.version,10,\">=\")||!!~Basic.inArray(Env.browser,[\"Chrome\",\"Safari\"]))},upload_filesize:True,use_http_method:function(methods){return!Basic.arrayDiff(methods,[\"GET\",\"POST\"])}}),Basic.extend(this,{init:function(){this.trigger(\"Init\")},destroy:(destroy=this.destroy,function(){destroy.call(I),destroy=I=null})}),Basic.extend(this.getShim(),extensions)}),extensions}),define(\"moxie/runtime/html4/file/FileInput\",[\"moxie/runtime/html4/Runtime\",\"moxie/file/File\",\"moxie/core/utils/Basic\",\"moxie/core/utils/Dom\",\"moxie/core/utils/Events\",\"moxie/core/utils/Mime\",\"moxie/core/utils/Env\"],function(extensions,File,Basic,Dom,Events,Mime,Env){return extensions.FileInput=function(){var _uid,_options,_mimes=[];Basic.extend(this,{init:function(options){var shimContainer,browseButton,zIndex,top,comp=this,I=comp.getRuntime();_options=options,_mimes=options.accept.mimes||Mime.extList2mimes(options.accept,I.can(\"filter_by_extension\")),shimContainer=I.getShimContainer(),browseButton=Dom.get(options.browse_button),I.can(\"summon_file_dialog\")&&(\"static\"===Dom.getStyle(browseButton,\"position\")&&(browseButton.style.position=\"relative\"),zIndex=parseInt(Dom.getStyle(browseButton,\"z-index\"),10)||1,browseButton.style.zIndex=zIndex,shimContainer.style.zIndex=zIndex-1),top=I.can(\"summon_file_dialog\")?browseButton:shimContainer,Events.addEvent(top,\"mouseover\",function(){comp.trigger(\"mouseenter\")},comp.uid),Events.addEvent(top,\"mouseout\",function(){comp.trigger(\"mouseleave\")},comp.uid),Events.addEvent(top,\"mousedown\",function(){comp.trigger(\"mousedown\")},comp.uid),Events.addEvent(Dom.get(options.container),\"mouseup\",function(){comp.trigger(\"mouseup\")},comp.uid),browseButton=null,function addInput(){var shimContainer,browseButton,currForm,form,input,uid,comp=this,I=comp.getRuntime();uid=Basic.guid(\"uid_\"),shimContainer=I.getShimContainer(),_uid&&(currForm=Dom.get(_uid+\"_form\"))&&Basic.extend(currForm.style,{top:\"100%\"}),(form=document.createElement(\"form\")).setAttribute(\"id\",uid+\"_form\"),form.setAttribute(\"method\",\"post\"),form.setAttribute(\"enctype\",\"multipart/form-data\"),form.setAttribute(\"encoding\",\"multipart/form-data\"),Basic.extend(form.style,{overflow:\"hidden\",position:\"absolute\",top:0,left:0,width:\"100%\",height:\"100%\"}),(input=document.createElement(\"input\")).setAttribute(\"id\",uid),input.setAttribute(\"type\",\"file\"),input.setAttribute(\"name\",_options.name||\"Filedata\"),input.setAttribute(\"accept\",_mimes.join(\",\")),Basic.extend(input.style,{fontSize:\"999px\",opacity:0}),form.appendChild(input),shimContainer.appendChild(form),Basic.extend(input.style,{position:\"absolute\",top:0,left:0,width:\"100%\",height:\"100%\"}),\"IE\"===Env.browser&&Env.verComp(Env.version,10,\"<\")&&Basic.extend(input.style,{filter:\"progid:DXImageTransform.Microsoft.Alpha(opacity=0)\"}),input.onchange=function(){var file;if(this.value){if(this.files){if(0===(file=this.files[0]).size)return void form.parentNode.removeChild(form)}else file={name:this.value};file=new File(I.uid,file),this.onchange=function(){},addInput.call(comp),comp.files=[file],input.setAttribute(\"id\",file.uid),form.setAttribute(\"id\",file.uid+\"_form\"),comp.trigger(\"change\"),input=form=null}},I.can(\"summon_file_dialog\")&&(browseButton=Dom.get(_options.browse_button),Events.removeEvent(browseButton,\"click\",comp.uid),Events.addEvent(browseButton,\"click\",function(e){input&&!input.disabled&&input.click(),e.preventDefault()},comp.uid)),_uid=uid,shimContainer=currForm=browseButton=null}.call(this),shimContainer=null,comp.trigger({type:\"ready\",async:!0})},disable:function(state){var input;(input=Dom.get(_uid))&&(input.disabled=!!state)},destroy:function(){var I=this.getRuntime(),shim=I.getShim(),shimContainer=I.getShimContainer();Events.removeAllEvents(shimContainer,this.uid),Events.removeAllEvents(_options&&Dom.get(_options.container),this.uid),Events.removeAllEvents(_options&&Dom.get(_options.browse_button),this.uid),shimContainer&&(shimContainer.innerHTML=\"\"),shim.removeInstance(this.uid),_uid=_mimes=_options=shimContainer=shim=null}})}}),define(\"moxie/runtime/html4/file/FileReader\",[\"moxie/runtime/html4/Runtime\",\"moxie/runtime/html5/file/FileReader\"],function(extensions,FileReader){return extensions.FileReader=FileReader}),define(\"moxie/runtime/html4/xhr/XMLHttpRequest\",[\"moxie/runtime/html4/Runtime\",\"moxie/core/utils/Basic\",\"moxie/core/utils/Dom\",\"moxie/core/utils/Url\",\"moxie/core/Exceptions\",\"moxie/core/utils/Events\",\"moxie/file/Blob\",\"moxie/xhr/FormData\"],function(extensions,Basic,Dom,Url,x,Events,Blob,FormData){return extensions.XMLHttpRequest=function(){var _status,_response,_iframe;function cleanup(cb){var uid,form,inputs,i,target=this,hasFile=!1;if(_iframe){if(uid=_iframe.id.replace(/_iframe$/,\"\"),form=Dom.get(uid+\"_form\")){for(i=(inputs=form.getElementsByTagName(\"input\")).length;i--;)switch(inputs[i].getAttribute(\"type\")){case\"hidden\":inputs[i].parentNode.removeChild(inputs[i]);break;case\"file\":hasFile=!0}inputs=[],hasFile||form.parentNode.removeChild(form),form=null}setTimeout(function(){Events.removeEvent(_iframe,\"load\",target.uid),_iframe.parentNode&&_iframe.parentNode.removeChild(_iframe);var shimContainer=target.getRuntime().getShimContainer();shimContainer.children.length||shimContainer.parentNode.removeChild(shimContainer),shimContainer=_iframe=null,cb()},1)}}Basic.extend(this,{send:function(meta,data){var uid,form,input,blob,container,temp,target=this,I=target.getRuntime();if(_status=_response=null,data instanceof FormData&&data.hasBlob()){if(blob=data.getBlob(),uid=blob.uid,input=Dom.get(uid),!(form=Dom.get(uid+\"_form\")))throw new x.DOMException(x.DOMException.NOT_FOUND_ERR)}else uid=Basic.guid(\"uid_\"),(form=document.createElement(\"form\")).setAttribute(\"id\",uid+\"_form\"),form.setAttribute(\"method\",meta.method),form.setAttribute(\"enctype\",\"multipart/form-data\"),form.setAttribute(\"encoding\",\"multipart/form-data\"),I.getShimContainer().appendChild(form);form.setAttribute(\"target\",uid+\"_iframe\"),data instanceof FormData&&data.each(function(value,name){if(value instanceof Blob)input&&input.setAttribute(\"name\",name);else{var hidden=document.createElement(\"input\");Basic.extend(hidden,{type:\"hidden\",name:name,value:value}),input?form.insertBefore(hidden,input):form.appendChild(hidden)}}),form.setAttribute(\"action\",meta.url),container=I.getShimContainer()||document.body,(temp=document.createElement(\"div\")).innerHTML='<iframe id=\"'+uid+'_iframe\" name=\"'+uid+'_iframe\" src=\"javascript:&quot;&quot;\" style=\"display:none\"></iframe>',_iframe=temp.firstChild,container.appendChild(_iframe),Events.addEvent(_iframe,\"load\",function(){var el;try{el=_iframe.contentWindow.document||_iframe.contentDocument||window.frames[_iframe.id].document,/^4(0[0-9]|1[0-7]|2[2346])\\s/.test(el.title)?_status=el.title.replace(/^(\\d+).*$/,\"$1\"):(_status=200,_response=Basic.trim(el.body.innerHTML),target.trigger({type:\"progress\",loaded:_response.length,total:_response.length}),blob&&target.trigger({type:\"uploadprogress\",loaded:blob.size||1025,total:blob.size||1025}))}catch(ex){if(!Url.hasSameOrigin(meta.url))return void cleanup.call(target,function(){target.trigger(\"error\")});_status=404}cleanup.call(target,function(){target.trigger(\"load\")})},target.uid),form.submit(),target.trigger(\"loadstart\")},getStatus:function(){return _status},getResponse:function(responseType){if(\"json\"===responseType&&\"string\"===Basic.typeOf(_response)&&window.JSON)try{return JSON.parse(_response.replace(/^\\s*<pre[^>]*>/,\"\").replace(/<\\/pre>\\s*$/,\"\"))}catch(ex){return null}return _response},abort:function(){var target=this;_iframe&&_iframe.contentWindow&&(_iframe.contentWindow.stop?_iframe.contentWindow.stop():_iframe.contentWindow.document.execCommand?_iframe.contentWindow.document.execCommand(\"Stop\"):_iframe.src=\"about:blank\"),cleanup.call(this,function(){target.dispatchEvent(\"abort\")})}})}}),define(\"moxie/runtime/html4/image/Image\",[\"moxie/runtime/html4/Runtime\",\"moxie/runtime/html5/image/Image\"],function(extensions,Image){return extensions.Image=Image}),function(ids){for(var i=0;i<ids.length;i++){for(var target=exports,id=ids[i],fragments=id.split(/[.\\/]/),fi=0;fi<fragments.length-1;++fi)target[fragments[fi]]===undefined&&(target[fragments[fi]]={}),target=target[fragments[fi]];target[fragments[fragments.length-1]]=modules[id]}}([\"moxie/core/utils/Basic\",\"moxie/core/utils/Env\",\"moxie/core/I18n\",\"moxie/core/utils/Mime\",\"moxie/core/utils/Dom\",\"moxie/core/Exceptions\",\"moxie/core/EventTarget\",\"moxie/runtime/Runtime\",\"moxie/runtime/RuntimeClient\",\"moxie/file/FileInput\",\"moxie/core/utils/Encode\",\"moxie/file/Blob\",\"moxie/file/File\",\"moxie/file/FileDrop\",\"moxie/file/FileReader\",\"moxie/core/utils/Url\",\"moxie/runtime/RuntimeTarget\",\"moxie/file/FileReaderSync\",\"moxie/xhr/FormData\",\"moxie/xhr/XMLHttpRequest\",\"moxie/runtime/Transporter\",\"moxie/image/Image\",\"moxie/core/utils/Events\"])}(this),function(exports){\"use strict\";var o={},inArray=exports.moxie.core.utils.Basic.inArray;(function addAlias(ns){var name,itemType;for(name in ns)\"object\"!==(itemType=typeof ns[name])||~inArray(name,[\"Exceptions\",\"Env\",\"Mime\"])?\"function\"===itemType&&(o[name]=ns[name]):addAlias(ns[name])})(exports.moxie),o.Env=exports.moxie.core.utils.Env,o.Mime=exports.moxie.core.utils.Mime,o.Exceptions=exports.moxie.core.Exceptions,exports.mOxie=o,exports.o||(exports.o=o)}(this),function(e,t,n){function s(e){function r(e,t,r){var i={chunks:\"slice_blob\",jpgresize:\"send_binary_string\",pngresize:\"send_binary_string\",progress:\"report_upload_progress\",multi_selection:\"select_multiple\",dragdrop:\"drag_and_drop\",drop_element:\"drag_and_drop\",headers:\"send_custom_headers\",urlstream_upload:\"send_binary_string\",canSendBinary:\"send_binary\",triggerDialog:\"summon_file_dialog\"};i[e]?n[i[e]]=t:r||(n[e]=t)}var t=e.required_features,n={};return\"string\"==typeof t?o.each(t.split(/\\s*,\\s*/),function(e){r(e,!0)}):\"object\"==typeof t?o.each(t,function(e,t){r(t,e)}):!0===t&&(e.chunk_size>0&&(n.slice_blob=!0),!e.resize.enabled&&e.multipart||(n.send_binary_string=!0),o.each(e,function(e,t){r(t,!!e,!0)})),n}var r=e.setTimeout,i={},o={VERSION:\"2.1.9\",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:t.mimes,ua:t.ua,typeOf:t.typeOf,extend:t.extend,guid:t.guid,getAll:function(t){var r,n=[];\"array\"!==o.typeOf(t)&&(t=[t]);for(var i=t.length;i--;)(r=o.get(t[i]))&&n.push(r);return n.length?n:null},get:t.get,each:t.each,getPos:t.getPos,getSize:t.getSize,xmlEncode:function(e){var t={\"<\":\"lt\",\">\":\"gt\",\"&\":\"amp\",'\"':\"quot\",\"'\":\"#39\"};return e?(\"\"+e).replace(/[<>&\\\"\\']/g,function(e){return t[e]?\"&\"+t[e]+\";\":e}):e},toArray:t.toArray,inArray:t.inArray,addI18n:t.addI18n,translate:t.translate,isEmptyObj:t.isEmptyObj,hasClass:t.hasClass,addClass:t.addClass,removeClass:t.removeClass,getStyle:t.getStyle,addEvent:t.addEvent,removeEvent:t.removeEvent,removeAllEvents:t.removeAllEvents,cleanName:function(e){var t,n;for(n=[/[\\300-\\306]/g,\"A\",/[\\340-\\346]/g,\"a\",/\\307/g,\"C\",/\\347/g,\"c\",/[\\310-\\313]/g,\"E\",/[\\350-\\353]/g,\"e\",/[\\314-\\317]/g,\"I\",/[\\354-\\357]/g,\"i\",/\\321/g,\"N\",/\\361/g,\"n\",/[\\322-\\330]/g,\"O\",/[\\362-\\370]/g,\"o\",/[\\331-\\334]/g,\"U\",/[\\371-\\374]/g,\"u\"],t=0;t<n.length;t+=2)e=e.replace(n[t],n[t+1]);return e=(e=e.replace(/\\s+/g,\"_\")).replace(/[^a-z0-9_\\-\\.]+/gi,\"\")},buildUrl:function(e,t){var n=\"\";return o.each(t,function(e,t){n+=(n?\"&\":\"\")+encodeURIComponent(t)+\"=\"+encodeURIComponent(e)}),n&&(e+=(e.indexOf(\"?\")>0?\"&\":\"?\")+n),e},formatSize:function(e){function t(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}if(e===n||/\\D/.test(e))return o.translate(\"N/A\");var r=Math.pow(1024,4);return e>r?t(e/r,1)+\" \"+o.translate(\"tb\"):e>(r/=1024)?t(e/r,1)+\" \"+o.translate(\"gb\"):e>(r/=1024)?t(e/r,1)+\" \"+o.translate(\"mb\"):e>1024?Math.round(e/1024)+\" \"+o.translate(\"kb\"):e+\" \"+o.translate(\"b\")},parseSize:t.parseSizeStr,predictRuntime:function(e,n){var r,i;return r=new o.Uploader(e),i=t.Runtime.thatCan(r.getOption().required_features,n||e.runtimes),r.destroy(),i},addFileFilter:function(e,t){i[e]=t}};o.addFileFilter(\"mime_types\",function(e,t,n){e.length&&!e.regexp.test(t.name)?(this.trigger(\"Error\",{code:o.FILE_EXTENSION_ERROR,message:o.translate(\"File extension error.\"),file:t}),n(!1)):n(!0)}),o.addFileFilter(\"max_file_size\",function(e,t,n){e=o.parseSize(e),void 0!==t.size&&e&&t.size>e?(this.trigger(\"Error\",{code:o.FILE_SIZE_ERROR,message:o.translate(\"File size error.\"),file:t}),n(!1)):n(!0)}),o.addFileFilter(\"prevent_duplicates\",function(e,t,n){if(e)for(var r=this.files.length;r--;)if(t.name===this.files[r].name&&t.size===this.files[r].size)return this.trigger(\"Error\",{code:o.FILE_DUPLICATE_ERROR,message:o.translate(\"Duplicate file error.\"),file:t}),void n(!1);n(!0)}),o.Uploader=function(e){function g(){var e,n,t=0;if(this.state==o.STARTED){for(n=0;n<f.length;n++)e||f[n].status!=o.QUEUED?t++:(e=f[n],this.trigger(\"BeforeUpload\",e)&&(e.status=o.UPLOADING,this.trigger(\"UploadFile\",e)));t==f.length&&(this.state!==o.STOPPED&&(this.state=o.STOPPED,this.trigger(\"StateChanged\")),this.trigger(\"UploadComplete\",f))}}function y(e){e.percent=e.size>0?Math.ceil(e.loaded/e.size*100):100,b()}function b(){var e,t;for(d.reset(),e=0;e<f.length;e++)(t=f[e]).size!==n?(d.size+=t.origSize,d.loaded+=t.loaded*t.origSize/t.size):d.size=n,t.status==o.DONE?d.uploaded++:t.status==o.FAILED?d.failed++:d.queued++;d.size===n?d.percent=f.length>0?Math.ceil(d.uploaded/f.length*100):0:(d.bytesPerSec=Math.ceil(d.loaded/((+new Date-p||1)/1e3)),d.percent=d.size>0?Math.ceil(d.loaded/d.size*100):0)}function w(){var e=c[0]||h[0];return!!e&&e.getRuntime().uid}function x(e,n){var r=this,i=0,s=[],u={runtime_order:e.runtimes,required_caps:e.required_features,preferred_caps:l,swf_url:e.flash_swf_url,xap_url:e.silverlight_xap_url};o.each(e.runtimes.split(/\\s*,\\s*/),function(t){e[t]&&(u[t]=e[t])}),e.browse_button&&o.each(e.browse_button,function(n){s.push(function(s){var a=new t.FileInput(o.extend({},u,{accept:e.filters.mime_types,name:e.file_data_name,multiple:e.multi_selection,container:e.container,browse_button:n}));a.onready=function(){var e=t.Runtime.getInfo(this.ruid);t.extend(r.features,{chunks:e.can(\"slice_blob\"),multipart:e.can(\"send_multipart\"),multi_selection:e.can(\"select_multiple\")}),i++,c.push(this),s()},a.onchange=function(){r.addFile(this.files)},a.bind(\"mouseenter mouseleave mousedown mouseup\",function(r){v||(e.browse_button_hover&&(\"mouseenter\"===r.type?t.addClass(n,e.browse_button_hover):\"mouseleave\"===r.type&&t.removeClass(n,e.browse_button_hover)),e.browse_button_active&&(\"mousedown\"===r.type?t.addClass(n,e.browse_button_active):\"mouseup\"===r.type&&t.removeClass(n,e.browse_button_active)))}),a.bind(\"mousedown\",function(){r.trigger(\"Browse\")}),a.bind(\"error runtimeerror\",function(){a=null,s()}),a.init()})}),e.drop_element&&o.each(e.drop_element,function(e){s.push(function(n){var s=new t.FileDrop(o.extend({},u,{drop_zone:e}));s.onready=function(){var e=t.Runtime.getInfo(this.ruid);t.extend(r.features,{chunks:e.can(\"slice_blob\"),multipart:e.can(\"send_multipart\"),dragdrop:e.can(\"drag_and_drop\")}),i++,h.push(this),n()},s.ondrop=function(){r.addFile(this.files)},s.bind(\"error runtimeerror\",function(){s=null,n()}),s.init()})}),t.inSeries(s,function(){\"function\"==typeof n&&n(i)})}function T(e,r,i){var s=new t.Image;try{s.onload=function(){if(r.width>this.width&&r.height>this.height&&r.quality===n&&r.preserve_headers&&!r.crop)return this.destroy(),i(e);s.downsize(r.width,r.height,r.crop,r.preserve_headers)},s.onresize=function(){i(this.getAsBlob(e.type,r.quality)),this.destroy()},s.onerror=function(){i(e)},s.load(e)}catch(o){i(e)}}function N(e,n,r){function f(e,t,n){var r=a[e];switch(e){case\"max_file_size\":\"max_file_size\"===e&&(a.max_file_size=a.filters.max_file_size=t);break;case\"chunk_size\":(t=o.parseSize(t))&&(a[e]=t,a.send_file_name=!0);break;case\"multipart\":a[e]=t,t||(a.send_file_name=!0);break;case\"unique_names\":a[e]=t,t&&(a.send_file_name=!0);break;case\"filters\":\"array\"===o.typeOf(t)&&(t={mime_types:t}),n?o.extend(a.filters,t):a.filters=t,t.mime_types&&(a.filters.mime_types.regexp=function(e){var t=[];return o.each(e,function(e){o.each(e.extensions.split(/,/),function(e){/^\\s*\\*\\s*$/.test(e)?t.push(\"\\\\.*\"):t.push(\"\\\\.\"+e.replace(new RegExp(\"[\"+\"/^$.*+?|()[]{}\\\\\".replace(/./g,\"\\\\$&\")+\"]\",\"g\"),\"\\\\$&\"))})}),new RegExp(\"(\"+t.join(\"|\")+\")$\",\"i\")}(a.filters.mime_types));break;case\"resize\":n?o.extend(a.resize,t,{enabled:!0}):a.resize=t;break;case\"prevent_duplicates\":a.prevent_duplicates=a.filters.prevent_duplicates=!!t;break;case\"container\":case\"browse_button\":case\"drop_element\":t=\"container\"===e?o.get(t):o.getAll(t);case\"runtimes\":case\"multi_selection\":case\"flash_swf_url\":case\"silverlight_xap_url\":a[e]=t,n||(u=!0);break;default:a[e]=t}n||i.trigger(\"OptionChanged\",e,t,r)}var i=this,u=!1;\"object\"==typeof e?o.each(e,function(e,t){f(t,e,r)}):f(e,n,r),r?(a.required_features=s(o.extend({},a)),l=s(o.extend({},a,{required_features:!0}))):u&&(i.trigger(\"Destroy\"),x.call(i,a,function(e){e?(i.runtime=t.Runtime.getInfo(w()).type,i.trigger(\"Init\",{runtime:i.runtime}),i.trigger(\"PostInit\")):i.trigger(\"Error\",{code:o.INIT_ERROR,message:o.translate(\"Init error.\")})}))}function C(e,t){if(e.settings.unique_names){var n=t.name.match(/\\.([^.]+)$/),r=\"part\";n&&(r=n[1]),t.target_name=t.id+\".\"+r}}function k(e,n){function h(){u-- >0?r(p,1e3):(n.loaded=f,e.trigger(\"Error\",{code:o.HTTP_ERROR,message:o.translate(\"HTTP Error.\"),file:n,response:m.responseText,status:m.status,responseHeaders:m.getAllResponseHeaders()}))}function p(){var d,v,y,g={};n.status===o.UPLOADING&&e.state!==o.STOPPED&&(e.settings.send_file_name&&(g.name=n.target_name||n.name),s&&a.chunks&&c.size>s?(y=Math.min(s,c.size-f),d=c.slice(f,f+y)):(y=c.size,d=c),s&&a.chunks&&(e.settings.send_chunk_number?(g.chunk=Math.ceil(f/s),g.chunks=Math.ceil(c.size/s)):(g.offset=f,g.total=c.size)),(m=new t.XMLHttpRequest).upload&&(m.upload.onprogress=function(t){n.loaded=Math.min(n.size,f+t.loaded),e.trigger(\"UploadProgress\",n)}),m.onload=function(){m.status>=400?h():(u=e.settings.max_retries,y<c.size?(d.destroy(),f+=y,n.loaded=Math.min(f,c.size),e.trigger(\"ChunkUploaded\",n,{offset:n.loaded,total:c.size,response:m.responseText,status:m.status,responseHeaders:m.getAllResponseHeaders()}),\"Android Browser\"===t.Env.browser&&e.trigger(\"UploadProgress\",n)):n.loaded=n.size,d=v=null,!f||f>=c.size?(n.size!=n.origSize&&(c.destroy(),c=null),e.trigger(\"UploadProgress\",n),n.status=o.DONE,e.trigger(\"FileUploaded\",n,{response:m.responseText,status:m.status,responseHeaders:m.getAllResponseHeaders()})):r(p,1))},m.onerror=function(){h()},m.onloadend=function(){this.destroy(),m=null},e.settings.multipart&&a.multipart?(m.open(\"post\",i,!0),o.each(e.settings.headers,function(e,t){m.setRequestHeader(t,e)}),v=new t.FormData,o.each(o.extend(g,e.settings.multipart_params),function(e,t){v.append(t,e)}),v.append(e.settings.file_data_name,d),m.send(v,{runtime_order:e.settings.runtimes,required_caps:e.settings.required_features,preferred_caps:l,swf_url:e.settings.flash_swf_url,xap_url:e.settings.silverlight_xap_url})):(i=o.buildUrl(e.settings.url,o.extend(g,e.settings.multipart_params)),m.open(\"post\",i,!0),m.setRequestHeader(\"Content-Type\",\"application/octet-stream\"),o.each(e.settings.headers,function(e,t){m.setRequestHeader(t,e)}),m.send(d,{runtime_order:e.settings.runtimes,required_caps:e.settings.required_features,preferred_caps:l,swf_url:e.settings.flash_swf_url,xap_url:e.settings.silverlight_xap_url})))}var c,i=e.settings.url,s=e.settings.chunk_size,u=e.settings.max_retries,a=e.features,f=0;n.loaded&&(f=n.loaded=s?s*Math.floor(n.loaded/s):0),c=n.getSource(),e.settings.resize.enabled&&function(e,n){if(e.ruid){var r=t.Runtime.getInfo(e.ruid);if(r)return r.can(n)}return!1}(c,\"send_binary_string\")&&~t.inArray(c.type,[\"image/jpeg\",\"image/png\"])?T.call(this,c,e.settings.resize,function(e){c=e,n.size=e.size,p()}):p()}function L(e,t){y(t)}function A(e){if(e.state==o.STARTED)p=+new Date;else if(e.state==o.STOPPED)for(var t=e.files.length-1;t>=0;t--)e.files[t].status==o.UPLOADING&&(e.files[t].status=o.QUEUED,b())}function O(){m&&m.abort()}function M(e){b(),r(function(){g.call(e)},1)}function _(e,t){t.code===o.INIT_ERROR?e.destroy():t.code===o.HTTP_ERROR&&(t.file.status=o.FAILED,y(t.file),e.state==o.STARTED&&(e.trigger(\"CancelUpload\"),r(function(){g.call(e)},1)))}function D(e){e.stop(),o.each(f,function(e){e.destroy()}),f=[],c.length&&(o.each(c,function(e){e.destroy()}),c=[]),h.length&&(o.each(h,function(e){e.destroy()}),h=[]),l={},v=!1,p=m=null,d.reset()}var a,p,d,m,u=o.guid(),f=[],l={},c=[],h=[],v=!1;a={runtimes:t.Runtime.order,max_retries:0,chunk_size:0,multipart:!0,multi_selection:!0,file_data_name:\"file\",flash_swf_url:\"js/Moxie.swf\",silverlight_xap_url:\"js/Moxie.xap\",filters:{mime_types:[],prevent_duplicates:!1,max_file_size:0},resize:{enabled:!1,preserve_headers:!0,crop:!1},send_file_name:!0,send_chunk_number:!0},N.call(this,e,null,!0),d=new o.QueueProgress,o.extend(this,{id:u,uid:u,state:o.STOPPED,features:{},runtime:null,files:f,settings:a,total:d,init:function(){var r,i,e=this;return\"function\"==typeof(r=e.getOption(\"preinit\"))?r(e):o.each(r,function(t,n){e.bind(n,t)}),function(){this.bind(\"FilesAdded FilesRemoved\",function(e){e.trigger(\"QueueChanged\"),e.refresh()}),this.bind(\"CancelUpload\",O),this.bind(\"BeforeUpload\",C),this.bind(\"UploadFile\",k),this.bind(\"UploadProgress\",L),this.bind(\"StateChanged\",A),this.bind(\"QueueChanged\",b),this.bind(\"Error\",_),this.bind(\"FileUploaded\",M),this.bind(\"Destroy\",D)}.call(e),o.each([\"container\",\"browse_button\",\"drop_element\"],function(t){if(null===e.getOption(t))return i={code:o.INIT_ERROR,message:o.translate(\"'%' specified, but cannot be found.\")},!1}),i?e.trigger(\"Error\",i):a.browse_button||a.drop_element?void x.call(e,a,function(n){var r=e.getOption(\"init\");\"function\"==typeof r?r(e):o.each(r,function(t,n){e.bind(n,t)}),n?(e.runtime=t.Runtime.getInfo(w()).type,e.trigger(\"Init\",{runtime:e.runtime}),e.trigger(\"PostInit\")):e.trigger(\"Error\",{code:o.INIT_ERROR,message:o.translate(\"Init error.\")})}):e.trigger(\"Error\",{code:o.INIT_ERROR,message:o.translate(\"You must specify either 'browse_button' or 'drop_element'.\")})},setOption:function(e,t){N.call(this,e,t,!this.runtime)},getOption:function(e){return e?a[e]:a},refresh:function(){c.length&&o.each(c,function(e){e.trigger(\"Refresh\")}),this.trigger(\"Refresh\")},start:function(){this.state!=o.STARTED&&(this.state=o.STARTED,this.trigger(\"StateChanged\"),g.call(this))},stop:function(){this.state!=o.STOPPED&&(this.state=o.STOPPED,this.trigger(\"StateChanged\"),this.trigger(\"CancelUpload\"))},disableBrowse:function(){v=arguments[0]===n||arguments[0],c.length&&o.each(c,function(e){e.disable(v)}),this.trigger(\"DisableBrowse\",v)},getFile:function(e){var t;for(t=f.length-1;t>=0;t--)if(f[t].id===e)return f[t]},addFile:function(e,n){function c(e,n){var r=[];t.each(s.settings.filters,function(t,n){i[n]&&r.push(function(r){i[n].call(s,t,e,function(e){r(!e)})})}),t.inSeries(r,n)}var l,s=this,u=[],a=[];l=w(),function h(e){var i=t.typeOf(e);if(e instanceof t.File){if(!e.ruid&&!e.isDetached()){if(!l)return!1;e.ruid=l,e.connectRuntime(l)}h(new o.File(e))}else e instanceof t.Blob?(h(e.getSource()),e.destroy()):e instanceof o.File?(n&&(e.name=n),u.push(function(t){c(e,function(n){n||(f.push(e),a.push(e),s.trigger(\"FileFiltered\",e)),r(t,1)})})):-1!==t.inArray(i,[\"file\",\"blob\"])?h(new t.File(null,e)):\"node\"===i&&\"filelist\"===t.typeOf(e.files)?t.each(e.files,h):\"array\"===i&&(n=null,t.each(e,h))}(e),u.length&&t.inSeries(u,function(){a.length&&s.trigger(\"FilesAdded\",a)})},removeFile:function(e){for(var t=\"string\"==typeof e?e:e.id,n=f.length-1;n>=0;n--)if(f[n].id===t)return this.splice(n,1)[0]},splice:function(e,t){var r=f.splice(e===n?0:e,t===n?f.length:t),i=!1;return this.state==o.STARTED&&(o.each(r,function(e){if(e.status===o.UPLOADING)return i=!0,!1}),i&&this.stop()),this.trigger(\"FilesRemoved\",r),o.each(r,function(e){e.destroy()}),i&&this.start(),r},dispatchEvent:function(e){var t,n;if(e=e.toLowerCase(),t=this.hasEventListener(e)){t.sort(function(e,t){return t.priority-e.priority}),(n=[].slice.call(arguments)).shift(),n.unshift(this);for(var i=0;i<t.length;i++)if(!1===t[i].fn.apply(t[i].scope,n))return!1}return!0},bind:function(e,t,n,r){o.Uploader.prototype.bind.call(this,e,t,r,n)},destroy:function(){this.trigger(\"Destroy\"),a=d=null,this.unbindAll()}})},o.Uploader.prototype=t.EventTarget.instance,o.File=function(){var e={};return function(n){o.extend(this,{id:o.guid(),name:n.name||n.fileName,type:n.type||\"\",size:n.size||n.fileSize,origSize:n.size||n.fileSize,loaded:0,percent:0,status:o.QUEUED,lastModifiedDate:n.lastModifiedDate||(new Date).toLocaleString(),getNative:function(){var e=this.getSource().getSource();return-1!==t.inArray(t.typeOf(e),[\"blob\",\"file\"])?e:null},getSource:function(){return e[this.id]?e[this.id]:null},destroy:function(){var t=this.getSource();t&&(t.destroy(),delete e[this.id])}}),e[this.id]=n}}(),o.QueueProgress=function(){var e=this;e.size=0,e.loaded=0,e.uploaded=0,e.failed=0,e.queued=0,e.percent=0,e.bytesPerSec=0,e.reset=function(){e.size=e.loaded=e.uploaded=e.failed=e.queued=e.percent=e.bytesPerSec=0}},e.plupload=o}(window,mOxie),function(e){\"use strict\";var t=\"undefined\"==typeof window?null:window;\"function\"==typeof define&&define.amd?define(function(){return e(t)}):\"undefined\"!=typeof module?module.exports=e(t):t.DOMPurify=e(t)}(function e(t){\"use strict\";var r=function(t){return e(t)};if(r.version=\"0.7.4\",!t||!t.document||9!==t.document.nodeType)return r.isSupported=!1,r;var n=t.document,a=n,i=t.DocumentFragment,o=t.HTMLTemplateElement,l=t.NodeFilter,s=t.NamedNodeMap||t.MozNamedAttrMap,f=t.Text,c=t.Comment,u=t.DOMParser;\"function\"==typeof o&&(n=n.createElement(\"template\").content.ownerDocument);var d=n.implementation,m=n.createNodeIterator,p=n.getElementsByTagName,h=n.createDocumentFragment,v=a.importNode,g={};r.isSupported=void 0!==d.createHTMLDocument&&9!==n.documentMode;var y=function(e,t){for(var r=t.length;r--;)e[t[r]]=!0;return e},b=function(e){var r,t={};for(r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t},T=null,x=y({},[\"a\",\"abbr\",\"acronym\",\"address\",\"area\",\"article\",\"aside\",\"audio\",\"b\",\"bdi\",\"bdo\",\"big\",\"blink\",\"blockquote\",\"body\",\"br\",\"button\",\"canvas\",\"caption\",\"center\",\"cite\",\"code\",\"col\",\"colgroup\",\"content\",\"data\",\"datalist\",\"dd\",\"decorator\",\"del\",\"details\",\"dfn\",\"dir\",\"div\",\"dl\",\"dt\",\"element\",\"em\",\"fieldset\",\"figcaption\",\"figure\",\"font\",\"footer\",\"form\",\"h1\",\"h2\",\"h3\",\"h4\",\"h5\",\"h6\",\"head\",\"header\",\"hgroup\",\"hr\",\"html\",\"i\",\"img\",\"input\",\"ins\",\"kbd\",\"label\",\"legend\",\"li\",\"main\",\"map\",\"mark\",\"marquee\",\"menu\",\"menuitem\",\"meter\",\"nav\",\"nobr\",\"ol\",\"optgroup\",\"option\",\"output\",\"p\",\"pre\",\"progress\",\"q\",\"rp\",\"rt\",\"ruby\",\"s\",\"samp\",\"section\",\"select\",\"shadow\",\"small\",\"source\",\"spacer\",\"span\",\"strike\",\"strong\",\"style\",\"sub\",\"summary\",\"sup\",\"table\",\"tbody\",\"td\",\"template\",\"textarea\",\"tfoot\",\"th\",\"thead\",\"time\",\"tr\",\"track\",\"tt\",\"u\",\"ul\",\"var\",\"video\",\"wbr\",\"svg\",\"altglyph\",\"altglyphdef\",\"altglyphitem\",\"animatecolor\",\"animatemotion\",\"animatetransform\",\"circle\",\"clippath\",\"defs\",\"desc\",\"ellipse\",\"font\",\"g\",\"glyph\",\"glyphref\",\"hkern\",\"image\",\"line\",\"lineargradient\",\"marker\",\"mask\",\"metadata\",\"mpath\",\"path\",\"pattern\",\"polygon\",\"polyline\",\"radialgradient\",\"rect\",\"stop\",\"switch\",\"symbol\",\"text\",\"textpath\",\"title\",\"tref\",\"tspan\",\"view\",\"vkern\",\"feBlend\",\"feColorMatrix\",\"feComponentTransfer\",\"feComposite\",\"feConvolveMatrix\",\"feDiffuseLighting\",\"feDisplacementMap\",\"feFlood\",\"feFuncA\",\"feFuncB\",\"feFuncG\",\"feFuncR\",\"feGaussianBlur\",\"feImage\",\"feMerge\",\"feMergeNode\",\"feMorphology\",\"feOffset\",\"feSpecularLighting\",\"feTile\",\"feTurbulence\",\"math\",\"menclose\",\"merror\",\"mfenced\",\"mfrac\",\"mglyph\",\"mi\",\"mlabeledtr\",\"mmuliscripts\",\"mn\",\"mo\",\"mover\",\"mpadded\",\"mphantom\",\"mroot\",\"mrow\",\"ms\",\"mpspace\",\"msqrt\",\"mystyle\",\"msub\",\"msup\",\"msubsup\",\"mtable\",\"mtd\",\"mtext\",\"mtr\",\"munder\",\"munderover\",\"#text\"]),k=null,A=y({},[\"accept\",\"action\",\"align\",\"alt\",\"autocomplete\",\"background\",\"bgcolor\",\"border\",\"cellpadding\",\"cellspacing\",\"checked\",\"cite\",\"class\",\"clear\",\"color\",\"cols\",\"colspan\",\"coords\",\"datetime\",\"default\",\"dir\",\"disabled\",\"download\",\"enctype\",\"face\",\"for\",\"headers\",\"height\",\"hidden\",\"high\",\"href\",\"hreflang\",\"id\",\"ismap\",\"label\",\"lang\",\"list\",\"loop\",\"low\",\"max\",\"maxlength\",\"media\",\"method\",\"min\",\"multiple\",\"name\",\"noshade\",\"novalidate\",\"nowrap\",\"open\",\"optimum\",\"pattern\",\"placeholder\",\"poster\",\"preload\",\"pubdate\",\"radiogroup\",\"readonly\",\"rel\",\"required\",\"rev\",\"reversed\",\"rows\",\"rowspan\",\"spellcheck\",\"scope\",\"selected\",\"shape\",\"size\",\"span\",\"srclang\",\"start\",\"src\",\"step\",\"style\",\"summary\",\"tabindex\",\"title\",\"type\",\"usemap\",\"valign\",\"value\",\"width\",\"xmlns\",\"accent-height\",\"accumulate\",\"additivive\",\"alignment-baseline\",\"ascent\",\"attributename\",\"attributetype\",\"azimuth\",\"basefrequency\",\"baseline-shift\",\"begin\",\"bias\",\"by\",\"clip\",\"clip-path\",\"clip-rule\",\"color\",\"color-interpolation\",\"color-interpolation-filters\",\"color-profile\",\"color-rendering\",\"cx\",\"cy\",\"d\",\"dx\",\"dy\",\"diffuseconstant\",\"direction\",\"display\",\"divisor\",\"dur\",\"edgemode\",\"elevation\",\"end\",\"fill\",\"fill-opacity\",\"fill-rule\",\"filter\",\"flood-color\",\"flood-opacity\",\"font-family\",\"font-size\",\"font-size-adjust\",\"font-stretch\",\"font-style\",\"font-variant\",\"font-weight\",\"fx\",\"fy\",\"g1\",\"g2\",\"glyph-name\",\"glyphref\",\"gradientunits\",\"gradienttransform\",\"image-rendering\",\"in\",\"in2\",\"k\",\"k1\",\"k2\",\"k3\",\"k4\",\"kerning\",\"keypoints\",\"keysplines\",\"keytimes\",\"lengthadjust\",\"letter-spacing\",\"kernelmatrix\",\"kernelunitlength\",\"lighting-color\",\"local\",\"marker-end\",\"marker-mid\",\"marker-start\",\"markerheight\",\"markerunits\",\"markerwidth\",\"maskcontentunits\",\"maskunits\",\"max\",\"mask\",\"mode\",\"min\",\"numoctaves\",\"offset\",\"operator\",\"opacity\",\"order\",\"orient\",\"orientation\",\"origin\",\"overflow\",\"paint-order\",\"path\",\"pathlength\",\"patterncontentunits\",\"patterntransform\",\"patternunits\",\"points\",\"preservealpha\",\"r\",\"rx\",\"ry\",\"radius\",\"refx\",\"refy\",\"repeatcount\",\"repeatdur\",\"restart\",\"rotate\",\"scale\",\"seed\",\"shape-rendering\",\"specularconstant\",\"specularexponent\",\"spreadmethod\",\"stddeviation\",\"stitchtiles\",\"stop-color\",\"stop-opacity\",\"stroke-dasharray\",\"stroke-dashoffset\",\"stroke-linecap\",\"stroke-linejoin\",\"stroke-miterlimit\",\"stroke-opacity\",\"stroke\",\"stroke-width\",\"surfacescale\",\"targetx\",\"targety\",\"transform\",\"text-anchor\",\"text-decoration\",\"text-rendering\",\"textlength\",\"u1\",\"u2\",\"unicode\",\"values\",\"viewbox\",\"visibility\",\"vert-adv-y\",\"vert-origin-x\",\"vert-origin-y\",\"word-spacing\",\"wrap\",\"writing-mode\",\"xchannelselector\",\"ychannelselector\",\"x\",\"x1\",\"x2\",\"y\",\"y1\",\"y2\",\"z\",\"zoomandpan\",\"accent\",\"accentunder\",\"bevelled\",\"close\",\"columnsalign\",\"columnlines\",\"columnspan\",\"denomalign\",\"depth\",\"display\",\"displaystyle\",\"fence\",\"frame\",\"largeop\",\"length\",\"linethickness\",\"lspace\",\"lquote\",\"mathbackground\",\"mathcolor\",\"mathsize\",\"mathvariant\",\"maxsize\",\"minsize\",\"movablelimits\",\"notation\",\"numalign\",\"open\",\"rowalign\",\"rowlines\",\"rowspacing\",\"rowspan\",\"rspace\",\"rquote\",\"scriptlevel\",\"scriptminsize\",\"scriptsizemultiplier\",\"selection\",\"separator\",\"separators\",\"stretchy\",\"subscriptshift\",\"supscriptshift\",\"symmetric\",\"voffset\",\"xlink:href\",\"xml:id\",\"xlink:title\",\"xml:space\",\"xmlns:xlink\"]),w=null,E=null,M=!0,S=!1,D=!1,O=/\\{\\{[\\s\\S]*|[\\s\\S]*\\}\\}/gm,L=/<%[\\s\\S]*|[\\s\\S]*%>/gm,N=!1,_=!1,z=!1,C=!1,R=!0,F=!0,H=y({},[\"audio\",\"head\",\"math\",\"script\",\"style\",\"svg\",\"video\"]),B=y({},[\"audio\",\"video\",\"img\",\"source\"]),I=y({},[\"alt\",\"class\",\"for\",\"id\",\"label\",\"name\",\"pattern\",\"placeholder\",\"summary\",\"title\",\"value\",\"style\",\"xmlns\"]),j=null,G=n.createElement(\"form\"),q=function(e){try{e.parentNode.removeChild(e)}catch(t){e.outerHTML=\"\"}},U=function(e){return m.call(e.ownerDocument||e,e,l.SHOW_ELEMENT|l.SHOW_COMMENT|l.SHOW_TEXT,function(){return l.FILTER_ACCEPT},!1)},J=function(e){var t,r;if($(\"beforeSanitizeElements\",e,null),function(e){return!(e instanceof f||e instanceof c||\"string\"==typeof e.nodeName&&\"string\"==typeof e.textContent&&\"function\"==typeof e.removeChild&&e.attributes instanceof s&&\"function\"==typeof e.removeAttribute&&\"function\"==typeof e.setAttribute)}(e))return q(e),!0;if(t=e.nodeName.toLowerCase(),$(\"uponSanitizeElement\",e,{tagName:t}),!T[t]||w[t]){if(F&&!H[t]&&\"function\"==typeof e.insertAdjacentHTML)try{e.insertAdjacentHTML(\"AfterEnd\",e.innerHTML)}catch(n){}return q(e),!0}return!S||e.firstElementChild||e.content&&e.content.firstElementChild||(e.innerHTML=e.textContent.replace(/</g,\"&lt;\")),D&&3===e.nodeType&&(r=(r=(r=e.textContent).replace(O,\" \")).replace(L,\" \"),e.textContent=r),$(\"afterSanitizeElements\",e,null),!1},K=/^data-[\\w.\\u00B7-\\uFFFF-]/,Q=/^(?:[^a-z]|(?=([a-z+.-]+))\\1(?!:)|(?:mailto|tel|(?:ht|f)tps?):)/i,X=/[\\x00-\\x20\\xA0\\u1680\\u180E\\u2000-\\u2029\\u205f\\u3000]/g,Y=function(e){var r,a,i,o,l,s,f,c;if($(\"beforeSanitizeAttributes\",e,null),s=e.attributes){for(f={attrName:\"\",attrValue:\"\",keepAttr:!0},c=s.length;c--;)if(a=(r=s[c]).name,i=r.value,o=a.toLowerCase(),f.attrName=o,f.attrValue=i,f.keepAttr=!0,$(\"uponSanitizeAttribute\",e,f),i=f.attrValue,\"name\"===o&&\"IMG\"===e.nodeName&&s.id?(l=s.id,s=Array.prototype.slice.apply(s),e.removeAttribute(\"id\"),e.removeAttribute(a),s.indexOf(l)>c&&e.setAttribute(\"id\",l.value)):(\"id\"===a&&e.setAttribute(a,\"\"),e.removeAttribute(a)),f.keepAttr&&(!R||\"id\"!==o&&\"name\"!==o||!(i in t||i in n||i in G))&&(D&&(i=(i=i.replace(O,\" \")).replace(L,\" \")),(k[o]&&!E[o]||!D&&M&&K.test(o))&&(Q.test(i.replace(X,\"\"))||\"src\"===o&&0===i.indexOf(\"data:\")&&B[e.nodeName.toLowerCase()]||I[o])))try{e.setAttribute(a,i)}catch(u){}$(\"afterSanitizeAttributes\",e,null)}},Z=function(e){var t,r=U(e);for($(\"beforeSanitizeShadowDOM\",e,null);t=r.nextNode();)$(\"uponSanitizeShadowNode\",t,null),J(t)||(t.content instanceof i&&Z(t.content),Y(t));$(\"afterSanitizeShadowDOM\",e,null)},$=function(e,t,n){g[e]&&g[e].forEach(function(e){e.call(r,t,n,j)})};return r.sanitize=function(e,n){var o,l,s,f,c;if(e||(e=\"\"),\"string\"!=typeof e){if(\"function\"!=typeof e.toString)throw new TypeError(\"toString is not a function\");e=e.toString()}if(!r.isSupported)return\"object\"==typeof t.toStaticHTML||\"function\"==typeof t.toStaticHTML?t.toStaticHTML(e):e;if(function(e){\"object\"!=typeof e&&(e={}),T=\"ALLOWED_TAGS\"in e?y({},e.ALLOWED_TAGS):x,k=\"ALLOWED_ATTR\"in e?y({},e.ALLOWED_ATTR):A,w=\"FORBID_TAGS\"in e?y({},e.FORBID_TAGS):{},E=\"FORBID_ATTR\"in e?y({},e.FORBID_ATTR):{},M=!1!==e.ALLOW_DATA_ATTR,S=e.SAFE_FOR_JQUERY||!1,D=e.SAFE_FOR_TEMPLATES||!1,N=e.WHOLE_DOCUMENT||!1,_=e.RETURN_DOM||!1,z=e.RETURN_DOM_FRAGMENT||!1,C=e.RETURN_DOM_IMPORT||!1,R=!1!==e.SANITIZE_DOM,F=!1!==e.KEEP_CONTENT,z&&(_=!0),e.ADD_TAGS&&(T===x&&(T=b(T)),y(T,e.ADD_TAGS)),e.ADD_ATTR&&(k===A&&(k=b(k)),y(k,e.ADD_ATTR)),F&&(T[\"#text\"]=!0),Object&&\"freeze\"in Object&&Object.freeze(e),j=e}(n),!_&&!N&&-1===e.indexOf(\"<\"))return e;if(!(o=function(e){var t,r;try{t=(new u).parseFromString(e,\"text/html\")}catch(n){}return t||((r=(t=d.createHTMLDocument(\"\")).body).parentNode.removeChild(r.parentNode.firstElementChild),r.outerHTML=e),\"function\"==typeof t.getElementsByTagName?t.getElementsByTagName(N?\"html\":\"body\")[0]:p.call(t,N?\"html\":\"body\")[0]}(e)))return _?null:\"\";for(f=U(o);l=f.nextNode();)3===l.nodeType&&l===s||J(l)||(l.content instanceof i&&Z(l.content),Y(l),s=l);if(_){if(z)for(c=h.call(o.ownerDocument);o.firstChild;)c.appendChild(o.firstChild);else c=o;return C&&(c=v.call(a,c,!0)),c}return N?o.outerHTML:o.innerHTML},r.addHook=function(e,t){\"function\"==typeof t&&(g[e]=g[e]||[],g[e].push(t))},r.removeHook=function(e){g[e]&&g[e].pop()},r.removeHooks=function(e){g[e]&&(g[e]=[])},r.removeAllHooks=function(){g=[]},r});"}},"heapStats":[{"numNodes":125595,"numEdges":555284,"totalSize":11063216,"hiddenSize":2149984,"arraySize":2081336,"stringSize":2736960,"objectSize":1032000,"codeSize":1734008,"closureSize":1117344,"regexpSize":13776,"heapNumberSize":3408,"nativeSize":0,"syntheticSize":0,"consStringSize":189880,"slicedStringSize":4040,"symbolSize":480,"unknownSize":0},{"numNodes":138273,"numEdges":635218,"totalSize":11977328,"hiddenSize":2169768,"arraySize":2200136,"stringSize":2737208,"objectSize":1299616,"codeSize":1756792,"closureSize":1602208,"regexpSize":13776,"heapNumberSize":3424,"nativeSize":0,"syntheticSize":0,"consStringSize":189880,"slicedStringSize":4040,"symbolSize":480,"unknownSize":0},{"numNodes":151242,"numEdges":715658,"totalSize":12927912,"hiddenSize":2187560,"arraySize":2322040,"stringSize":2737608,"objectSize":1567832,"codeSize":1812184,"closureSize":2087072,"regexpSize":13776,"heapNumberSize":3440,"nativeSize":0,"syntheticSize":0,"consStringSize":189880,"slicedStringSize":6040,"symbolSize":480,"unknownSize":0},{"numNodes":164139,"numEdges":796396,"totalSize":13925960,"hiddenSize":2205864,"arraySize":2477312,"stringSize":2736456,"objectSize":1835448,"codeSize":1885408,"closureSize":2571936,"regexpSize":13776,"heapNumberSize":3440,"nativeSize":0,"syntheticSize":0,"consStringSize":189800,"slicedStringSize":6040,"symbolSize":480,"unknownSize":0},{"numNodes":177025,"numEdges":875820,"totalSize":14768352,"hiddenSize":2223640,"arraySize":2551160,"stringSize":2738088,"objectSize":2103672,"codeSize":1881376,"closureSize":3056800,"regexpSize":13776,"heapNumberSize":3440,"nativeSize":0,"syntheticSize":0,"consStringSize":189880,"slicedStringSize":6040,"symbolSize":480,"unknownSize":0},{"numNodes":189873,"numEdges":955170,"totalSize":15623616,"hiddenSize":2241752,"arraySize":2618904,"stringSize":2738728,"objectSize":2371288,"codeSize":1897664,"closureSize":3541664,"regexpSize":13776,"heapNumberSize":3440,"nativeSize":0,"syntheticSize":0,"consStringSize":189880,"slicedStringSize":6040,"symbolSize":480,"unknownSize":0},{"numNodes":202756,"numEdges":1035013,"totalSize":16506192,"hiddenSize":2259680,"arraySize":2707616,"stringSize":2739368,"objectSize":2638904,"codeSize":1920480,"closureSize":4026528,"regexpSize":13776,"heapNumberSize":3440,"nativeSize":0,"syntheticSize":0,"consStringSize":189880,"slicedStringSize":6040,"symbolSize":480,"unknownSize":0},{"numNodes":215599,"numEdges":1114331,"totalSize":17372952,"hiddenSize":2277744,"arraySize":2776000,"stringSize":2740288,"objectSize":2906520,"codeSize":1947392,"closureSize":4511392,"regexpSize":13776,"heapNumberSize":3440,"nativeSize":0,"syntheticSize":0,"consStringSize":189880,"slicedStringSize":6040,"symbolSize":480,"unknownSize":0}],"rankingEvaluation":{"leakShare":[],"transitiveClosureSize":[],"retainedSize":[]}}